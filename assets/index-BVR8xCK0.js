var xt=Object.defineProperty;var ut=t=>{throw TypeError(t)};var wt=(t,r,e)=>r in t?xt(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var dt=(t,r,e)=>wt(t,typeof r!="symbol"?r+"":r,e),nt=(t,r,e)=>r.has(t)||ut("Cannot "+e);var Ye=(t,r,e)=>(nt(t,r,"read from private field"),e?e.call(t):r.get(t)),ot=(t,r,e)=>r.has(t)?ut("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,e),it=(t,r,e,n)=>(nt(t,r,"write to private field"),n?n.call(t,e):r.set(t,e),e),st=(t,r,e)=>(nt(t,r,"access private method"),e);(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function getAugmentedNamespace(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var e=function n(){return this instanceof n?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:function(){return t[n]}})}),e}var lib={},parsing={},format={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.RecognitionStatuses=void 0,function(r){r.NONE="0",r.DONE="1",r.RUNNING="2"}(t.RecognitionStatuses||(t.RecognitionStatuses={}))})(format);Object.defineProperty(parsing,"__esModule",{value:!0});parsing.SupernoteX=parsing.extractLayerInfo=parsing.extractNestedKeyValue=parsing.extractKeyValue=parsing.parseKeyValue=parsing.getContentAtAddress=void 0;const format_1=format;function checkOffset(t,r,e){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+r>e)throw new RangeError("Trying to access beyond buffer length")}function readUintLE(t,r,e){r=r>>>0,e=e>>>0,checkOffset(r,e,t.length);let n=t[r],o=1,s=0;for(;++s<e&&(o*=256);)n+=t[r+s]*o;return n}function getContentAtAddress(t,r,e){if(r===0)return null;const n=readUintLE(t,r,e);return t.subarray(r+e,r+e+n)}parsing.getContentAtAddress=getContentAtAddress;function parseKeyValue(t,r,e){const n=getContentAtAddress(t,r,e);if(n===null)return{};const o=uint8ArrayToString(n);return extractKeyValue(o)}parsing.parseKeyValue=parseKeyValue;function extractKeyValue(t){const r=/<([^:<>]+):([^:<>]+)>/gm;return[...t.matchAll(r)].reduce((o,[s,a,l])=>{if(a in o){let c=typeof o[a]=="string"?[o[a],l]:[...o[a],l];o[a]=c}else o[a]=l;return o},{})}parsing.extractKeyValue=extractKeyValue;function extractNestedKeyValue(t,r="_",e=[]){const n={};return Object.entries(t).forEach(([o,s])=>{let a,l;if(typeof s!="string")return;const c=o.indexOf(r);if(c>-1)a=o.substring(0,c),l=o.substring(c+1);else for(const h of e)if(o.startsWith(h)){a=h,l=o.substring(a.length);break}a&&l&&(a in n?n[a][l]=s:n[a]={[l]:s})}),n}parsing.extractNestedKeyValue=extractNestedKeyValue;function extractLayerInfo(t){const r=/{(?<content>[^{}]+)}/gm,e=/"(?<key>[^"\[{}\]]+)"#"?(?<value>[^"\[{}\],]+)/gm;return Array.from(t.matchAll(r)).map(s=>{var a,l;if(s.groups===void 0)throw new Error("Undefined layer content.");const h=Array.from(s.groups.content.matchAll(e)).reduce((u,d)=>{if(d.groups===void 0)throw new Error("Undefined key/value pair.");const{key:g,value:m}=d.groups;return u[g]=m,u},{});return{layerId:parseInt((a=h.layerId)!==null&&a!==void 0?a:"0"),name:(l=h.name)!==null&&l!==void 0?l:"Main layer",isBackgroundLayer:h.isBackgroundLayer==="true",isAllowAdd:h.isAllowAdd==="true",isCurrentLayer:h.isCurrentLayer==="true",isVisible:h.isVisible==="true",isDeleted:h.isDeleted==="true",isAllowUp:h.isAllowUp==="true",isAllowDown:h.isAllowDown==="true"}})}parsing.extractLayerInfo=extractLayerInfo;function uint8ArrayToString(t,r="utf8",e=0,n){n=n||t.length;const o=t.slice(e,n);return new TextDecoder(r).decode(o)}class SupernoteX{constructor(r){this.pageWidth=1404,this.pageHeight=1872,this.addressSize=4,this.lengthFieldSize=4,this.defaultLayers=["MAINLAYER","LAYER1","LAYER2","LAYER3","BGLAYER"],this._parseBuffer(r)}_parseBuffer(r){return this._parseSignature(r),this._parseFooter(r),this._parseHeader(r),this.header.APPLY_EQUIPMENT=="N5"&&(this.pageWidth=1920,this.pageHeight=2560),this._parsePages(r),this._parseCover(r),this._parseKeywords(r),this._parseTitles(r),this}_parseSignature(r){const e=/^noteSN_FILE_VER_(\d{8})/,n=uint8ArrayToString(r,"utf8",0,24),o=n.match(e);if(!o)throw new Error("Cannot parse this file. Signature doesn't match.");return this.signature=n,this.version=parseFloat(o[1]),this.signature}_parseFooter(r){const e=r.subarray(r.length-this.addressSize),n=readUintLE(e,0,this.addressSize),o=parseKeyValue(r,n,this.lengthFieldSize),s=extractNestedKeyValue(o,"_",["PAGE"]);return this.footer=Object.assign({FILE:{FEATURE:"24"},COVER:{0:"0"},KEYWORD:{},TITLE:{},STYLE:{},PAGE:{}},s),this.footer}_parseHeader(r){var e;const n=!((e=this.footer.FILE)===null||e===void 0)&&e.FEATURE?parseInt(this.footer.FILE.FEATURE):24,o=parseKeyValue(r,n,this.lengthFieldSize);return this.header=Object.assign({MODULE_LABEL:"0",FILE_TYPE:"0",APPLY_EQUIPMENT:"0",FINAL_OPERATION_PAGE:"0",FINAL_OPERATION_LAYER:"0",ORIGINAL_STYLE:"0",ORIGINAL_STYLEMD5:"0",DEVICE_DPI:"0",SOFT_DPI:"0",FILE_PARSE_TYPE:"0",RATTA_ETMD:"0",APP_VERSION:"0",FILE_RECOGN_TYPE:"0"},o),this.header}_parsePages(r){const e=new Intl.Collator([],{numeric:!0}),n=Array.from(Object.keys(this.footer.PAGE)).sort((o,s)=>e.compare(o,s)).map(o=>{var s,a,l,c,h,f;const u=parseInt(this.footer.PAGE[o]),d=parseKeyValue(r,u,this.lengthFieldSize);return Object.assign(Object.assign({PAGESTYLE:"0",PAGESTYLEMD5:"0",LAYERSWITCH:"0",TOTALPATH:"0",THUMBNAILTYPE:"0",RECOGNSTATUS:format_1.RecognitionStatuses.NONE,RECOGNTEXT:"0",RECOGNFILE:"0",RECOGNFILESTATUS:format_1.RecognitionStatuses.NONE},d),{MAINLAYER:this._parseLayer(r,parseInt((s=d.MAINLAYER)!==null&&s!==void 0?s:"0")),LAYER1:this._parseLayer(r,parseInt((a=d.LAYER1)!==null&&a!==void 0?a:"0")),LAYER2:this._parseLayer(r,parseInt((l=d.LAYER2)!==null&&l!==void 0?l:"0")),LAYER3:this._parseLayer(r,parseInt((c=d.LAYER3)!==null&&c!==void 0?c:"0")),BGLAYER:this._parseLayer(r,parseInt((h=d.BGLAYER)!==null&&h!==void 0?h:"0")),LAYERINFO:extractLayerInfo(d.LAYERINFO),LAYERSEQ:d.LAYERSEQ.split(","),text:this._parseText(r,d.RECOGNTEXT),totalPathBuffer:getContentAtAddress(r,parseInt((f=d.TOTALPATH)!==null&&f!==void 0?f:"0"),this.lengthFieldSize)})});return this.pages=n,n}_parseText(r,e){if(e==="0"||e===void 0)return;const n=parseInt(e),o=getContentAtAddress(r,n,this.lengthFieldSize);if(o===null)return;const s=new TextDecoder("utf8").decode(o);return(JSON.parse(atob(s)).elements||[]).filter(h=>h.type==="Text").map(h=>decodeURIComponent(escape(h.label))).join(`
`)}_parseLayer(r,e){var n;const o=parseKeyValue(r,e,this.lengthFieldSize),s=getContentAtAddress(r,parseInt((n=o.LAYERBITMAP)!==null&&n!==void 0?n:"0"),this.lengthFieldSize);return Object.assign(Object.assign({LAYERTYPE:"NOTE",LAYERPROTOCOL:"RATTA_RLE",LAYERNAME:"MAINLAYER",LAYERPATH:"0",LAYERBITMAP:"0",LAYERVECTORGRAPH:"0",LAYERRECOGN:"0"},o),{bitmapBuffer:s})}_parseCover(r){var e;const n=parseInt((e=this.footer.COVER[0])!==null&&e!==void 0?e:this.footer.COVER[1]);if(n&&n>0){const o=getContentAtAddress(r,n,this.lengthFieldSize);this.cover={bitmapBuffer:o}}return this.cover}_parseKeywords(r){return this.keywords={},Object.entries(this.footer.KEYWORD).forEach(([e,n])=>{e in this.keywords||(this.keywords[e]=[]),typeof n=="string"?this.keywords[e].push(this._parseKeyword(r,parseInt(n))):n.forEach(o=>this.keywords[e].push(this._parseKeyword(r,parseInt(o))))}),this.keywords}_parseKeyword(r,e){var n;const o=parseKeyValue(r,e,this.lengthFieldSize),s=getContentAtAddress(r,parseInt((n=o.KEYWORDSITE)!==null&&n!==void 0?n:"0"),this.lengthFieldSize);return{KEYWORDSEQNO:"0",KEYWORDPAGE:"1",KEYWORDRECT:["0","0","0","0"],KEYWORDRECTORI:["0","0","0","0"],KEYWORDSITE:"0",KEYWORDLEN:"0",KEYWORD:"",bitmapBuffer:s}}_parseTitles(r){return this.titles={},Object.entries(this.footer.TITLE).forEach(([e,n])=>{e in this.titles||(this.titles[e]=[]),typeof n=="string"?this.titles[e].push(this._parseTitle(r,parseInt(n))):n.forEach(o=>this.titles[e].push(this._parseTitle(r,parseInt(o))))}),this.titles}_parseTitle(r,e){var n;const o=parseKeyValue(r,e,this.lengthFieldSize),s=getContentAtAddress(r,parseInt((n=o.TITLEBITMAP)!==null&&n!==void 0?n:"0"),this.lengthFieldSize);return Object.assign(Object.assign({TITLESEQNO:"0",TITLELEVEL:"1",TITLERECT:["0","0","0","0"],TITLERECTORI:["0","0","0","0"],TITLEBITMAP:"0",TITLEPROTOCOL:"RATTA_RLE",TITLESTYLE:"1000254"},o),{bitmapBuffer:s})}}parsing.SupernoteX=SupernoteX;var conversion={};const bitMethods={getBit(t){return this.data[getSlot(t)]&1<<getShift(t)?1:0},setBit(t){this.data[getSlot(t)]|=1<<getShift(t)},clearBit(t){this.data[getSlot(t)]&=~(1<<getShift(t))},toggleBit(t){this.data[getSlot(t)]^=1<<getShift(t)},getBitXY(t,r){return t>=this.width||r>=this.height?0:this.getBit(r*this.width+t)},setBitXY(t,r){this.setBit(r*this.width+t)},clearBitXY(t,r){this.clearBit(r*this.width+t)},toggleBitXY(t,r){this.toggleBit(r*this.width+t)}};function getSlot(t){return t>>3}function getShift(t){return 7-(t&7)}function setBitMethods(t){for(const r in bitMethods)t.prototype[r]=bitMethods[r]}function checkProcessable(t,r={}){let{bitDepth:e,alpha:n,colorModel:o,components:s,channels:a}=r;if(typeof t!="string"||t.length===0)throw new TypeError("processName must be a string");if(e&&(Array.isArray(e)||(e=[e]),!e.includes(this.bitDepth)))throw new TypeError(`The process: ${t} can only be applied if bit depth is in: ${e}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.alpha)))throw new TypeError(`The process: ${t} can only be applied if alpha is in: ${n}`);if(o&&(Array.isArray(o)||(o=[o]),!o.includes(this.colorModel)))throw new TypeError(`The process: ${t} can only be applied if color model is in: ${o}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let l=`The process: ${t} can only be applied if the number of components is in: ${s}`;throw s.length===1&&s[0]===1?new TypeError(`${l}.\rYou should transform your image using "image.grey()" before applying the algorithm.`):new TypeError(l)}if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.channels)))throw new TypeError(`The process: ${t} can only be applied if the number of channels is in: ${a}`)}function createBlob(t,r){t=t||[],r=r||{},typeof r=="string"&&(r={type:r});try{return new Blob(t,r)}catch(s){if(s.name!=="TypeError")throw s;for(var e=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,n=new e,o=0;o<t.length;o+=1)n.append(t[o]);return n.getBlob(r.type)}}function dataURLToBlob(t){var r=t.match(/data:([^;]+)/)[1],e=t.replace(/^[^,]+,/,""),n=binaryStringToArrayBuffer(atob(e));return createBlob([n],{type:r})}function canvasToBlob(t,r,e){return typeof t.toBlob=="function"?new Promise(function(n){t.toBlob(n,r,e)}):Promise.resolve(dataURLToBlob(t.toDataURL(r,e)))}function binaryStringToArrayBuffer(t){for(var r=t.length,e=new ArrayBuffer(r),n=new Uint8Array(e),o=-1;++o<r;)n[o]=t.charCodeAt(o);return e}(function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function r(n="utf-8"){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${n}') is invalid.`)}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),r.prototype.encode=function(n,o={stream:!1}){if(o.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let s=0;const a=n.length;let l=0,c=Math.max(32,a+(a>>1)+7),h=new Uint8Array(c>>3<<3);for(;s<a;){let f=n.charCodeAt(s++);if(f>=55296&&f<=56319){if(s<a){const u=n.charCodeAt(s);(u&64512)===56320&&(++s,f=((f&1023)<<10)+(u&1023)+65536)}if(f>=55296&&f<=56319)continue}if(l+4>h.length){c+=8,c*=1+s/n.length*2,c=c>>3<<3;const u=new Uint8Array(c);u.set(h),h=u}if(f&4294967168)if(!(f&4294965248))h[l++]=f>>6&31|192;else if(!(f&4294901760))h[l++]=f>>12&15|224,h[l++]=f>>6&63|128;else if(!(f&4292870144))h[l++]=f>>18&7|240,h[l++]=f>>12&63|128,h[l++]=f>>6&63|128;else continue;else{h[l++]=f;continue}h[l++]=f&63|128}return h.slice(0,l)};function e(n="utf-8",o={fatal:!1}){if(n!=="utf-8")throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${n}') is invalid.`);if(o.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(e.prototype,"fatal",{value:!1}),Object.defineProperty(e.prototype,"ignoreBOM",{value:!1}),e.prototype.decode=function(n,o={stream:!1}){if(o.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const s=new Uint8Array(n);let a=0;const l=s.length,c=[];for(;a<l;){const h=s[a++];if(h===0)break;if(!(h&128))c.push(h);else if((h&224)===192){const f=s[a++]&63;c.push((h&31)<<6|f)}else if((h&240)===224){const f=s[a++]&63,u=s[a++]&63;c.push((h&31)<<12|f<<6|u)}else if((h&248)===240){const f=s[a++]&63,u=s[a++]&63,d=s[a++]&63;let g=(h&7)<<18|f<<12|u<<6|d;g>65535&&(g-=65536,c.push(g>>>10&1023|55296),g=56320|g&1023),c.push(g)}}return String.fromCharCode.apply(null,c)},t.TextEncoder=r,t.TextDecoder=e})(typeof window<"u"?window:typeof self<"u"?self:void 0);function decode$5(t,r="utf8"){return new TextDecoder(r).decode(t)}const encoder$1=new TextEncoder;function encode$3(t){return encoder$1.encode(t)}const defaultByteLength$1=1024*8,hostBigEndian=(()=>{const t=new Uint8Array(4),r=new Uint32Array(t.buffer);return!((r[0]=1)&t[0])})(),typedArrays={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let IOBuffer$4=class gt{constructor(r=defaultByteLength$1,e={}){let n=!1;typeof r=="number"?r=new ArrayBuffer(r):(n=!0,this.lastWrittenByte=r.byteLength);const o=e.offset?e.offset>>>0:0,s=r.byteLength-o;let a=o;(ArrayBuffer.isView(r)||r instanceof gt)&&(r.byteLength!==r.buffer.byteLength&&(a=r.byteOffset+o),r=r.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=r,this.length=s,this.byteLength=s,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,s),this._mark=0,this._marks=[]}available(r=1){return this.offset+r<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(r=1){return this.offset+=r,this}back(r=1){return this.offset-=r,this}seek(r){return this.offset=r,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const r=this._marks.pop();if(r===void 0)throw new Error("Mark stack empty");return this.seek(r),this}rewind(){return this.offset=0,this}ensureAvailable(r=1){if(!this.available(r)){const n=(this.offset+r)*2,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(r=1){return this.readArray(r,"uint8")}readArray(r,e){const n=typedArrays[e].BYTES_PER_ELEMENT*r,o=this.byteOffset+this.offset,s=this.buffer.slice(o,o+n);if(this.littleEndian===hostBigEndian&&e!=="uint8"&&e!=="int8"){const l=new Uint8Array(this.buffer.slice(o,o+n));l.reverse();const c=new typedArrays[e](l.buffer);return this.offset+=n,c.reverse(),c}const a=new typedArrays[e](s);return this.offset+=n,a}readInt16(){const r=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,r}readUint16(){const r=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,r}readInt32(){const r=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,r}readUint32(){const r=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat32(){const r=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat64(){const r=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,r}readBigInt64(){const r=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,r}readBigUint64(){const r=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,r}readChar(){return String.fromCharCode(this.readInt8())}readChars(r=1){let e="";for(let n=0;n<r;n++)e+=this.readChar();return e}readUtf8(r=1){return decode$5(this.readBytes(r))}decodeText(r=1,e="utf-8"){return decode$5(this.readBytes(r),e)}writeBoolean(r){return this.writeUint8(r?255:0),this}writeInt8(r){return this.ensureAvailable(1),this._data.setInt8(this.offset++,r),this._updateLastWrittenByte(),this}writeUint8(r){return this.ensureAvailable(1),this._data.setUint8(this.offset++,r),this._updateLastWrittenByte(),this}writeByte(r){return this.writeUint8(r)}writeBytes(r){this.ensureAvailable(r.length);for(let e=0;e<r.length;e++)this._data.setUint8(this.offset++,r[e]);return this._updateLastWrittenByte(),this}writeInt16(r){return this.ensureAvailable(2),this._data.setInt16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(r){return this.ensureAvailable(2),this._data.setUint16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(r){return this.ensureAvailable(4),this._data.setInt32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(r){return this.ensureAvailable(4),this._data.setUint32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(r){return this.ensureAvailable(4),this._data.setFloat32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(r){return this.ensureAvailable(8),this._data.setFloat64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(r){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(r){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(r){return this.writeUint8(r.charCodeAt(0))}writeChars(r){for(let e=0;e<r.length;e++)this.writeUint8(r.charCodeAt(e));return this}writeUtf8(r){return this.writeBytes(encode$3(r))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};const IOBuffer$5=Object.freeze(Object.defineProperty({__proto__:null,IOBuffer:IOBuffer$4},Symbol.toStringTag,{value:"Module"})),require$$0$5=getAugmentedNamespace(IOBuffer$5);var constants$4={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const{IOBuffer:IOBuffer$3}=require$$0$5,constants$3=constants$4,tableLeft=[];for(let t=0;t<=8;t++)tableLeft.push(255<<t);class BMPEncoder extends IOBuffer$3{constructor(r){if(r.bitDepth!==1)throw new Error("Only bitDepth of 1 is supported");if(!r.height||!r.width)throw new Error("ImageData width and height are required");super(r.data),this.width=r.width,this.height=r.height,this.bitDepth=r.bitDepth,this.channels=r.channels,this.components=r.components}encode(){this.encoded=new IOBuffer$3,this.encoded.skip(14),this.writeBitmapV5Header(),this.writeColorTable();const r=this.encoded.offset;return this.writePixelArray(),this.encoded.rewind(),this.writeBitmapFileHeader(r),this.encoded.toArray()}writePixelArray(){let r=this.encoded;const e=Math.floor((this.bitDepth*this.width+31)/32)*4,n=Math.ceil(this.bitDepth*this.width/8),o=e-n,s=this.bitDepth*this.width%8,a=s===0?0:8-s,l=e*this.height;let c,h,f=0,u=0,d=8;r.mark(),h=this.readUint8();for(let g=this.height-1;g>=0;g--){const m=g===0;r.reset(),r.skip(g*e);for(let y=0;y<n;y++){const _=y===n-1;u<=a&&_?(r.writeByte(h<<u),(a===0||a===u)&&!m&&(c=h,h=this.readByte())):u===0?(c=h,h=this.readUint8(),r.writeByte(c)):(c=h,h=this.readUint8(),r.writeByte(c<<u&tableLeft[u]|h>>d)),_&&(f+=s||0,r.skip(o),u=f%8,d=8-u)}}e>n&&(r.reset(),r.skip(l-1),r.writeUint8(0))}writeColorTable(){this.encoded.writeUint32(0).writeUint32(16777215)}writeBitmapFileHeader(r){this.encoded.writeChars("BM").writeInt32(this.encoded.lastWrittenByte).writeUint16(0).writeUint16(0).writeUint32(r)}writeBitmapV5Header(){const e=Math.floor((this.bitDepth*this.width+31)/32)*4*this.height;this.encoded.writeUint32(124).writeInt32(this.width).writeInt32(this.height).writeUint16(1).writeUint16(this.bitDepth).writeUint32(constants$3.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(e).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(Math.pow(2,this.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants$3.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants$3.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}}var BMPEncoder_1=BMPEncoder;const Encoder=BMPEncoder_1;var encode$2=function(r){return new Encoder(r).encode()};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Z_FIXED$1=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN$1=2;function zero$1(t){let r=t.length;for(;--r>=0;)t[r]=0}const STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),extra_dbits=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),extra_blbits=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),bl_order=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);function StaticTreeDesc(t,r,e,n,o){this.static_tree=t,this.extra_bits=r,this.extra_base=e,this.elems=n,this.max_length=o,this.has_stree=t&&t.length}let static_l_desc,static_d_desc,static_bl_desc;function TreeDesc(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}const d_code=t=>t<256?_dist_code[t]:_dist_code[256+(t>>>7)],put_short=(t,r)=>{t.pending_buf[t.pending++]=r&255,t.pending_buf[t.pending++]=r>>>8&255},send_bits=(t,r,e)=>{t.bi_valid>Buf_size-e?(t.bi_buf|=r<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=r>>Buf_size-t.bi_valid,t.bi_valid+=e-Buf_size):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=e)},send_code=(t,r,e)=>{send_bits(t,e[r*2],e[r*2+1])},bi_reverse=(t,r)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--r>0);return e>>>1},bi_flush=t=>{t.bi_valid===16?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},gen_bitlen=(t,r)=>{const e=r.dyn_tree,n=r.max_code,o=r.stat_desc.static_tree,s=r.stat_desc.has_stree,a=r.stat_desc.extra_bits,l=r.stat_desc.extra_base,c=r.stat_desc.max_length;let h,f,u,d,g,m,y=0;for(d=0;d<=MAX_BITS$1;d++)t.bl_count[d]=0;for(e[t.heap[t.heap_max]*2+1]=0,h=t.heap_max+1;h<HEAP_SIZE$1;h++)f=t.heap[h],d=e[e[f*2+1]*2+1]+1,d>c&&(d=c,y++),e[f*2+1]=d,!(f>n)&&(t.bl_count[d]++,g=0,f>=l&&(g=a[f-l]),m=e[f*2],t.opt_len+=m*(d+g),s&&(t.static_len+=m*(o[f*2+1]+g)));if(y!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,y-=2}while(y>0);for(d=c;d!==0;d--)for(f=t.bl_count[d];f!==0;)u=t.heap[--h],!(u>n)&&(e[u*2+1]!==d&&(t.opt_len+=(d-e[u*2+1])*e[u*2],e[u*2+1]=d),f--)}},gen_codes=(t,r,e)=>{const n=new Array(MAX_BITS$1+1);let o=0,s,a;for(s=1;s<=MAX_BITS$1;s++)o=o+e[s-1]<<1,n[s]=o;for(a=0;a<=r;a++){let l=t[a*2+1];l!==0&&(t[a*2]=bi_reverse(n[l]++,l))}},tr_static_init=()=>{let t,r,e,n,o;const s=new Array(MAX_BITS$1+1);for(e=0,n=0;n<LENGTH_CODES$1-1;n++)for(base_length[n]=e,t=0;t<1<<extra_lbits[n];t++)_length_code[e++]=n;for(_length_code[e-1]=n,o=0,n=0;n<16;n++)for(base_dist[n]=o,t=0;t<1<<extra_dbits[n];t++)_dist_code[o++]=n;for(o>>=7;n<D_CODES$1;n++)for(base_dist[n]=o<<7,t=0;t<1<<extra_dbits[n]-7;t++)_dist_code[256+o++]=n;for(r=0;r<=MAX_BITS$1;r++)s[r]=0;for(t=0;t<=143;)static_ltree[t*2+1]=8,t++,s[8]++;for(;t<=255;)static_ltree[t*2+1]=9,t++,s[9]++;for(;t<=279;)static_ltree[t*2+1]=7,t++,s[7]++;for(;t<=287;)static_ltree[t*2+1]=8,t++,s[8]++;for(gen_codes(static_ltree,L_CODES$1+1,s),t=0;t<D_CODES$1;t++)static_dtree[t*2+1]=5,static_dtree[t*2]=bi_reverse(t,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS$1+1,L_CODES$1,MAX_BITS$1),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES$1,MAX_BITS$1),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES$1,MAX_BL_BITS)},init_block=t=>{let r;for(r=0;r<L_CODES$1;r++)t.dyn_ltree[r*2]=0;for(r=0;r<D_CODES$1;r++)t.dyn_dtree[r*2]=0;for(r=0;r<BL_CODES$1;r++)t.bl_tree[r*2]=0;t.dyn_ltree[END_BLOCK*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},bi_windup=t=>{t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},smaller=(t,r,e,n)=>{const o=r*2,s=e*2;return t[o]<t[s]||t[o]===t[s]&&n[r]<=n[e]},pqdownheap=(t,r,e)=>{const n=t.heap[e];let o=e<<1;for(;o<=t.heap_len&&(o<t.heap_len&&smaller(r,t.heap[o+1],t.heap[o],t.depth)&&o++,!smaller(r,n,t.heap[o],t.depth));)t.heap[e]=t.heap[o],e=o,o<<=1;t.heap[e]=n},compress_block=(t,r,e)=>{let n,o,s=0,a,l;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+s++]&255,n+=(t.pending_buf[t.sym_buf+s++]&255)<<8,o=t.pending_buf[t.sym_buf+s++],n===0?send_code(t,o,r):(a=_length_code[o],send_code(t,a+LITERALS$1+1,r),l=extra_lbits[a],l!==0&&(o-=base_length[a],send_bits(t,o,l)),n--,a=d_code(n),send_code(t,a,e),l=extra_dbits[a],l!==0&&(n-=base_dist[a],send_bits(t,n,l)));while(s<t.sym_next);send_code(t,END_BLOCK,r)},build_tree=(t,r)=>{const e=r.dyn_tree,n=r.stat_desc.static_tree,o=r.stat_desc.has_stree,s=r.stat_desc.elems;let a,l,c=-1,h;for(t.heap_len=0,t.heap_max=HEAP_SIZE$1,a=0;a<s;a++)e[a*2]!==0?(t.heap[++t.heap_len]=c=a,t.depth[a]=0):e[a*2+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=c<2?++c:0,e[h*2]=1,t.depth[h]=0,t.opt_len--,o&&(t.static_len-=n[h*2+1]);for(r.max_code=c,a=t.heap_len>>1;a>=1;a--)pqdownheap(t,e,a);h=s;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,e,1),l=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=l,e[h*2]=e[a*2]+e[l*2],t.depth[h]=(t.depth[a]>=t.depth[l]?t.depth[a]:t.depth[l])+1,e[a*2+1]=e[l*2+1]=h,t.heap[1]=h++,pqdownheap(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],gen_bitlen(t,r),gen_codes(e,c,t.bl_count)},scan_tree=(t,r,e)=>{let n,o=-1,s,a=r[0*2+1],l=0,c=7,h=4;for(a===0&&(c=138,h=3),r[(e+1)*2+1]=65535,n=0;n<=e;n++)s=a,a=r[(n+1)*2+1],!(++l<c&&s===a)&&(l<h?t.bl_tree[s*2]+=l:s!==0?(s!==o&&t.bl_tree[s*2]++,t.bl_tree[REP_3_6*2]++):l<=10?t.bl_tree[REPZ_3_10*2]++:t.bl_tree[REPZ_11_138*2]++,l=0,o=s,a===0?(c=138,h=3):s===a?(c=6,h=3):(c=7,h=4))},send_tree=(t,r,e)=>{let n,o=-1,s,a=r[0*2+1],l=0,c=7,h=4;for(a===0&&(c=138,h=3),n=0;n<=e;n++)if(s=a,a=r[(n+1)*2+1],!(++l<c&&s===a)){if(l<h)do send_code(t,s,t.bl_tree);while(--l!==0);else s!==0?(s!==o&&(send_code(t,s,t.bl_tree),l--),send_code(t,REP_3_6,t.bl_tree),send_bits(t,l-3,2)):l<=10?(send_code(t,REPZ_3_10,t.bl_tree),send_bits(t,l-3,3)):(send_code(t,REPZ_11_138,t.bl_tree),send_bits(t,l-11,7));l=0,o=s,a===0?(c=138,h=3):s===a?(c=6,h=3):(c=7,h=4)}},build_bl_tree=t=>{let r;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),r=BL_CODES$1-1;r>=3&&t.bl_tree[bl_order[r]*2+1]===0;r--);return t.opt_len+=3*(r+1)+5+5+4,r},send_all_trees=(t,r,e,n)=>{let o;for(send_bits(t,r-257,5),send_bits(t,e-1,5),send_bits(t,n-4,4),o=0;o<n;o++)send_bits(t,t.bl_tree[bl_order[o]*2+1],3);send_tree(t,t.dyn_ltree,r-1),send_tree(t,t.dyn_dtree,e-1)},detect_data_type=t=>{let r=4093624447,e;for(e=0;e<=31;e++,r>>>=1)if(r&1&&t.dyn_ltree[e*2]!==0)return Z_BINARY;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Z_TEXT;for(e=32;e<LITERALS$1;e++)if(t.dyn_ltree[e*2]!==0)return Z_TEXT;return Z_BINARY};let static_init_done=!1;const _tr_init$1=t=>{static_init_done||(tr_static_init(),static_init_done=!0),t.l_desc=new TreeDesc(t.dyn_ltree,static_l_desc),t.d_desc=new TreeDesc(t.dyn_dtree,static_d_desc),t.bl_desc=new TreeDesc(t.bl_tree,static_bl_desc),t.bi_buf=0,t.bi_valid=0,init_block(t)},_tr_stored_block$1=(t,r,e,n)=>{send_bits(t,(STORED_BLOCK<<1)+(n?1:0),3),bi_windup(t),put_short(t,e),put_short(t,~e),e&&t.pending_buf.set(t.window.subarray(r,r+e),t.pending),t.pending+=e},_tr_align$1=t=>{send_bits(t,STATIC_TREES<<1,3),send_code(t,END_BLOCK,static_ltree),bi_flush(t)},_tr_flush_block$1=(t,r,e,n)=>{let o,s,a=0;t.level>0?(t.strm.data_type===Z_UNKNOWN$1&&(t.strm.data_type=detect_data_type(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),a=build_bl_tree(t),o=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=o&&(o=s)):o=s=e+5,e+4<=o&&r!==-1?_tr_stored_block$1(t,r,e,n):t.strategy===Z_FIXED$1||s===o?(send_bits(t,(STATIC_TREES<<1)+(n?1:0),3),compress_block(t,static_ltree,static_dtree)):(send_bits(t,(DYN_TREES<<1)+(n?1:0),3),send_all_trees(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),n&&bi_windup(t)},_tr_tally$1=(t,r,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,r===0?t.dyn_ltree[e*2]++:(t.matches++,r--,t.dyn_ltree[(_length_code[e]+LITERALS$1+1)*2]++,t.dyn_dtree[d_code(r)*2]++),t.sym_next===t.sym_end);var _tr_init_1=_tr_init$1,_tr_stored_block_1=_tr_stored_block$1,_tr_flush_block_1=_tr_flush_block$1,_tr_tally_1=_tr_tally$1,_tr_align_1=_tr_align$1,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};const adler32=(t,r,e,n)=>{let o=t&65535|0,s=t>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do o=o+r[n++]|0,s=s+o|0;while(--a);o%=65521,s%=65521}return o|s<<16|0};var adler32_1=adler32;const makeTable=()=>{let t,r=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;r[e]=t}return r},crcTable$1=new Uint32Array(makeTable()),crc32=(t,r,e,n)=>{const o=crcTable$1,s=n+e;t^=-1;for(let a=n;a<s;a++)t=t>>>8^o[(t^r[a])&255];return t^-1};var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init,_tr_stored_block,_tr_flush_block,_tr_tally,_tr_align}=trees,{Z_NO_FLUSH:Z_NO_FLUSH$2,Z_PARTIAL_FLUSH,Z_FULL_FLUSH:Z_FULL_FLUSH$1,Z_FINISH:Z_FINISH$3,Z_BLOCK:Z_BLOCK$1,Z_OK:Z_OK$3,Z_STREAM_END:Z_STREAM_END$3,Z_STREAM_ERROR:Z_STREAM_ERROR$2,Z_DATA_ERROR:Z_DATA_ERROR$2,Z_BUF_ERROR:Z_BUF_ERROR$1,Z_DEFAULT_COMPRESSION:Z_DEFAULT_COMPRESSION$1,Z_FILTERED,Z_HUFFMAN_ONLY,Z_RLE,Z_FIXED,Z_DEFAULT_STRATEGY:Z_DEFAULT_STRATEGY$1,Z_UNKNOWN,Z_DEFLATED:Z_DEFLATED$2}=constants$2,MAX_MEM_LEVEL=9,MAX_WBITS$1=15,DEF_MEM_LEVEL=8,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,MIN_MATCH=3,MAX_MATCH=258,MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1,PRESET_DICT=32,INIT_STATE=42,GZIP_STATE=57,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,err=(t,r)=>(t.msg=messages[r],r),rank=t=>t*2-(t>4?9:0),zero=t=>{let r=t.length;for(;--r>=0;)t[r]=0},slide_hash=t=>{let r,e,n,o=t.w_size;r=t.hash_size,n=r;do e=t.head[--n],t.head[n]=e>=o?e-o:0;while(--r);r=o,n=r;do e=t.prev[--n],t.prev[n]=e>=o?e-o:0;while(--r)};let HASH_ZLIB=(t,r,e)=>(r<<t.hash_shift^e)&t.hash_mask,HASH=HASH_ZLIB;const flush_pending=t=>{const r=t.state;let e=r.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+e),t.next_out),t.next_out+=e,r.pending_out+=e,t.total_out+=e,t.avail_out-=e,r.pending-=e,r.pending===0&&(r.pending_out=0))},flush_block_only=(t,r)=>{_tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,flush_pending(t.strm)},put_byte=(t,r)=>{t.pending_buf[t.pending++]=r},putShortMSB=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=r&255},read_buf=(t,r,e,n)=>{let o=t.avail_in;return o>n&&(o=n),o===0?0:(t.avail_in-=o,r.set(t.input.subarray(t.next_in,t.next_in+o),e),t.state.wrap===1?t.adler=adler32_1(t.adler,r,o,e):t.state.wrap===2&&(t.adler=crc32_1(t.adler,r,o,e)),t.next_in+=o,t.total_in+=o,o)},longest_match=(t,r)=>{let e=t.max_chain_length,n=t.strstart,o,s,a=t.prev_length,l=t.nice_match;const c=t.strstart>t.w_size-MIN_LOOKAHEAD?t.strstart-(t.w_size-MIN_LOOKAHEAD):0,h=t.window,f=t.w_mask,u=t.prev,d=t.strstart+MAX_MATCH;let g=h[n+a-1],m=h[n+a];t.prev_length>=t.good_match&&(e>>=2),l>t.lookahead&&(l=t.lookahead);do if(o=r,!(h[o+a]!==m||h[o+a-1]!==g||h[o]!==h[n]||h[++o]!==h[n+1])){n+=2,o++;do;while(h[++n]===h[++o]&&h[++n]===h[++o]&&h[++n]===h[++o]&&h[++n]===h[++o]&&h[++n]===h[++o]&&h[++n]===h[++o]&&h[++n]===h[++o]&&h[++n]===h[++o]&&n<d);if(s=MAX_MATCH-(d-n),n=d-MAX_MATCH,s>a){if(t.match_start=r,a=s,s>=l)break;g=h[n+a-1],m=h[n+a]}}while((r=u[r&f])>c&&--e!==0);return a<=t.lookahead?a:t.lookahead},fill_window=t=>{const r=t.w_size;let e,n,o;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-MIN_LOOKAHEAD)&&(t.window.set(t.window.subarray(r,r+r-n),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),slide_hash(t),n+=r),t.strm.avail_in===0)break;if(e=read_buf(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=e,t.lookahead+t.insert>=MIN_MATCH)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=HASH(t,t.ins_h,t.window[o+1]);t.insert&&(t.ins_h=HASH(t,t.ins_h,t.window[o+MIN_MATCH-1]),t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<MIN_MATCH)););}while(t.lookahead<MIN_LOOKAHEAD&&t.strm.avail_in!==0)},deflate_stored=(t,r)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,o,s,a=0,l=t.strm.avail_in;do{if(n=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,o=t.strstart-t.block_start,n>o+t.strm.avail_in&&(n=o+t.strm.avail_in),n>s&&(n=s),n<e&&(n===0&&r!==Z_FINISH$3||r===Z_NO_FLUSH$2||n!==o+t.strm.avail_in)))break;a=r===Z_FINISH$3&&n===o+t.strm.avail_in?1:0,_tr_stored_block(t,0,0,a),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,flush_pending(t.strm),o&&(o>n&&(o=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,n-=o),n&&(read_buf(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(a===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?BS_FINISH_DONE:r!==Z_NO_FLUSH$2&&r!==Z_FINISH$3&&t.strm.avail_in===0&&t.strstart===t.block_start?BS_BLOCK_DONE:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(read_buf(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,e=s>t.w_size?t.w_size:s,o=t.strstart-t.block_start,(o>=e||(o||r===Z_FINISH$3)&&r!==Z_NO_FLUSH$2&&t.strm.avail_in===0&&o<=s)&&(n=o>s?s:o,a=r===Z_FINISH$3&&t.strm.avail_in===0&&n===o?1:0,_tr_stored_block(t,t.block_start,n,a),t.block_start+=n,flush_pending(t.strm)),a?BS_FINISH_STARTED:BS_NEED_MORE)},deflate_fast=(t,r)=>{let e,n;for(;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(t.lookahead===0)break}if(e=0,t.lookahead>=MIN_MATCH&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,e)),t.match_length>=MIN_MATCH)if(n=_tr_tally(t,t.strstart-t.match_start,t.match_length-MIN_MATCH),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=MIN_MATCH){t.match_length--;do t.strstart++,t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+1]);else n=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}return t.insert=t.strstart<MIN_MATCH-1?t.strstart:MIN_MATCH-1,r===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.sym_next&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_slow=(t,r)=>{let e,n,o;for(;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(t.lookahead===0)break}if(e=0,t.lookahead>=MIN_MATCH&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=MIN_MATCH-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,e),t.match_length<=5&&(t.strategy===Z_FILTERED||t.match_length===MIN_MATCH&&t.strstart-t.match_start>4096)&&(t.match_length=MIN_MATCH-1)),t.prev_length>=MIN_MATCH&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-MIN_MATCH,n=_tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-MIN_MATCH),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=o&&(t.ins_h=HASH(t,t.ins_h,t.window[t.strstart+MIN_MATCH-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=MIN_MATCH-1,t.strstart++,n&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}else if(t.match_available){if(n=_tr_tally(t,0,t.window[t.strstart-1]),n&&flush_block_only(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return BS_NEED_MORE}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=_tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<MIN_MATCH-1?t.strstart:MIN_MATCH-1,r===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.sym_next&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_rle=(t,r)=>{let e,n,o,s;const a=t.window;for(;;){if(t.lookahead<=MAX_MATCH){if(fill_window(t),t.lookahead<=MAX_MATCH&&r===Z_NO_FLUSH$2)return BS_NEED_MORE;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=MIN_MATCH&&t.strstart>0&&(o=t.strstart-1,n=a[o],n===a[++o]&&n===a[++o]&&n===a[++o])){s=t.strstart+MAX_MATCH;do;while(n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&n===a[++o]&&o<s);t.match_length=MAX_MATCH-(s-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=MIN_MATCH?(e=_tr_tally(t,1,t.match_length-MIN_MATCH),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}return t.insert=0,r===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.sym_next&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE},deflate_huff=(t,r)=>{let e;for(;;){if(t.lookahead===0&&(fill_window(t),t.lookahead===0)){if(r===Z_NO_FLUSH$2)return BS_NEED_MORE;break}if(t.match_length=0,e=_tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(flush_block_only(t,!1),t.strm.avail_out===0))return BS_NEED_MORE}return t.insert=0,r===Z_FINISH$3?(flush_block_only(t,!0),t.strm.avail_out===0?BS_FINISH_STARTED:BS_FINISH_DONE):t.sym_next&&(flush_block_only(t,!1),t.strm.avail_out===0)?BS_NEED_MORE:BS_BLOCK_DONE};function Config(t,r,e,n,o){this.good_length=t,this.max_lazy=r,this.nice_length=e,this.max_chain=n,this.func=o}const configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],lm_init=t=>{t.window_size=2*t.w_size,zero(t.head),t.max_lazy_match=configuration_table[t.level].max_lazy,t.good_match=configuration_table[t.level].good_length,t.nice_match=configuration_table[t.level].nice_length,t.max_chain_length=configuration_table[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=MIN_MATCH-1,t.match_available=0,t.ins_h=0};function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(HEAP_SIZE*2),this.dyn_dtree=new Uint16Array((2*D_CODES+1)*2),this.bl_tree=new Uint16Array((2*BL_CODES+1)*2),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(MAX_BITS+1),this.heap=new Uint16Array(2*L_CODES+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*L_CODES+1),zero(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const deflateStateCheck=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==INIT_STATE&&r.status!==GZIP_STATE&&r.status!==EXTRA_STATE&&r.status!==NAME_STATE&&r.status!==COMMENT_STATE&&r.status!==HCRC_STATE&&r.status!==BUSY_STATE&&r.status!==FINISH_STATE?1:0},deflateResetKeep=t=>{if(deflateStateCheck(t))return err(t,Z_STREAM_ERROR$2);t.total_in=t.total_out=0,t.data_type=Z_UNKNOWN;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?GZIP_STATE:r.wrap?INIT_STATE:BUSY_STATE,t.adler=r.wrap===2?0:1,r.last_flush=-2,_tr_init(r),Z_OK$3},deflateReset=t=>{const r=deflateResetKeep(t);return r===Z_OK$3&&lm_init(t.state),r},deflateSetHeader=(t,r)=>deflateStateCheck(t)||t.state.wrap!==2?Z_STREAM_ERROR$2:(t.state.gzhead=r,Z_OK$3),deflateInit2=(t,r,e,n,o,s)=>{if(!t)return Z_STREAM_ERROR$2;let a=1;if(r===Z_DEFAULT_COMPRESSION$1&&(r=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),o<1||o>MAX_MEM_LEVEL||e!==Z_DEFLATED$2||n<8||n>15||r<0||r>9||s<0||s>Z_FIXED||n===8&&a!==1)return err(t,Z_STREAM_ERROR$2);n===8&&(n=9);const l=new DeflateState;return t.state=l,l.strm=t,l.status=INIT_STATE,l.wrap=a,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+MIN_MATCH-1)/MIN_MATCH),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=r,l.strategy=s,l.method=e,deflateReset(t)},deflateInit=(t,r)=>deflateInit2(t,r,Z_DEFLATED$2,MAX_WBITS$1,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY$1),deflate$2=(t,r)=>{if(deflateStateCheck(t)||r>Z_BLOCK$1||r<0)return t?err(t,Z_STREAM_ERROR$2):Z_STREAM_ERROR$2;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===FINISH_STATE&&r!==Z_FINISH$3)return err(t,t.avail_out===0?Z_BUF_ERROR$1:Z_STREAM_ERROR$2);const n=e.last_flush;if(e.last_flush=r,e.pending!==0){if(flush_pending(t),t.avail_out===0)return e.last_flush=-1,Z_OK$3}else if(t.avail_in===0&&rank(r)<=rank(n)&&r!==Z_FINISH$3)return err(t,Z_BUF_ERROR$1);if(e.status===FINISH_STATE&&t.avail_in!==0)return err(t,Z_BUF_ERROR$1);if(e.status===INIT_STATE&&e.wrap===0&&(e.status=BUSY_STATE),e.status===INIT_STATE){let o=Z_DEFLATED$2+(e.w_bits-8<<4)<<8,s=-1;if(e.strategy>=Z_HUFFMAN_ONLY||e.level<2?s=0:e.level<6?s=1:e.level===6?s=2:s=3,o|=s<<6,e.strstart!==0&&(o|=PRESET_DICT),o+=31-o%31,putShortMSB(e,o),e.strstart!==0&&(putShortMSB(e,t.adler>>>16),putShortMSB(e,t.adler&65535)),t.adler=1,e.status=BUSY_STATE,flush_pending(t),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(e.status===GZIP_STATE){if(t.adler=0,put_byte(e,31),put_byte(e,139),put_byte(e,8),e.gzhead)put_byte(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),put_byte(e,e.gzhead.time&255),put_byte(e,e.gzhead.time>>8&255),put_byte(e,e.gzhead.time>>16&255),put_byte(e,e.gzhead.time>>24&255),put_byte(e,e.level===9?2:e.strategy>=Z_HUFFMAN_ONLY||e.level<2?4:0),put_byte(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(put_byte(e,e.gzhead.extra.length&255),put_byte(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=crc32_1(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=EXTRA_STATE;else if(put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,0),put_byte(e,e.level===9?2:e.strategy>=Z_HUFFMAN_ONLY||e.level<2?4:0),put_byte(e,OS_CODE),e.status=BUSY_STATE,flush_pending(t),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(e.status===EXTRA_STATE){if(e.gzhead.extra){let o=e.pending,s=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let l=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+l),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>o&&(t.adler=crc32_1(t.adler,e.pending_buf,e.pending-o,o)),e.gzindex+=l,flush_pending(t),e.pending!==0)return e.last_flush=-1,Z_OK$3;o=0,s-=l}let a=new Uint8Array(e.gzhead.extra);e.pending_buf.set(a.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>o&&(t.adler=crc32_1(t.adler,e.pending_buf,e.pending-o,o)),e.gzindex=0}e.status=NAME_STATE}if(e.status===NAME_STATE){if(e.gzhead.name){let o=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>o&&(t.adler=crc32_1(t.adler,e.pending_buf,e.pending-o,o)),flush_pending(t),e.pending!==0)return e.last_flush=-1,Z_OK$3;o=0}e.gzindex<e.gzhead.name.length?s=e.gzhead.name.charCodeAt(e.gzindex++)&255:s=0,put_byte(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>o&&(t.adler=crc32_1(t.adler,e.pending_buf,e.pending-o,o)),e.gzindex=0}e.status=COMMENT_STATE}if(e.status===COMMENT_STATE){if(e.gzhead.comment){let o=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>o&&(t.adler=crc32_1(t.adler,e.pending_buf,e.pending-o,o)),flush_pending(t),e.pending!==0)return e.last_flush=-1,Z_OK$3;o=0}e.gzindex<e.gzhead.comment.length?s=e.gzhead.comment.charCodeAt(e.gzindex++)&255:s=0,put_byte(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>o&&(t.adler=crc32_1(t.adler,e.pending_buf,e.pending-o,o))}e.status=HCRC_STATE}if(e.status===HCRC_STATE){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(flush_pending(t),e.pending!==0))return e.last_flush=-1,Z_OK$3;put_byte(e,t.adler&255),put_byte(e,t.adler>>8&255),t.adler=0}if(e.status=BUSY_STATE,flush_pending(t),e.pending!==0)return e.last_flush=-1,Z_OK$3}if(t.avail_in!==0||e.lookahead!==0||r!==Z_NO_FLUSH$2&&e.status!==FINISH_STATE){let o=e.level===0?deflate_stored(e,r):e.strategy===Z_HUFFMAN_ONLY?deflate_huff(e,r):e.strategy===Z_RLE?deflate_rle(e,r):configuration_table[e.level].func(e,r);if((o===BS_FINISH_STARTED||o===BS_FINISH_DONE)&&(e.status=FINISH_STATE),o===BS_NEED_MORE||o===BS_FINISH_STARTED)return t.avail_out===0&&(e.last_flush=-1),Z_OK$3;if(o===BS_BLOCK_DONE&&(r===Z_PARTIAL_FLUSH?_tr_align(e):r!==Z_BLOCK$1&&(_tr_stored_block(e,0,0,!1),r===Z_FULL_FLUSH$1&&(zero(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),flush_pending(t),t.avail_out===0))return e.last_flush=-1,Z_OK$3}return r!==Z_FINISH$3?Z_OK$3:e.wrap<=0?Z_STREAM_END$3:(e.wrap===2?(put_byte(e,t.adler&255),put_byte(e,t.adler>>8&255),put_byte(e,t.adler>>16&255),put_byte(e,t.adler>>24&255),put_byte(e,t.total_in&255),put_byte(e,t.total_in>>8&255),put_byte(e,t.total_in>>16&255),put_byte(e,t.total_in>>24&255)):(putShortMSB(e,t.adler>>>16),putShortMSB(e,t.adler&65535)),flush_pending(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Z_OK$3:Z_STREAM_END$3)},deflateEnd=t=>{if(deflateStateCheck(t))return Z_STREAM_ERROR$2;const r=t.state.status;return t.state=null,r===BUSY_STATE?err(t,Z_DATA_ERROR$2):Z_OK$3},deflateSetDictionary=(t,r)=>{let e=r.length;if(deflateStateCheck(t))return Z_STREAM_ERROR$2;const n=t.state,o=n.wrap;if(o===2||o===1&&n.status!==INIT_STATE||n.lookahead)return Z_STREAM_ERROR$2;if(o===1&&(t.adler=adler32_1(t.adler,r,e,0)),n.wrap=0,e>=n.w_size){o===0&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(r.subarray(e-n.w_size,e),0),r=c,e=n.w_size}const s=t.avail_in,a=t.next_in,l=t.input;for(t.avail_in=e,t.next_in=0,t.input=r,fill_window(n);n.lookahead>=MIN_MATCH;){let c=n.strstart,h=n.lookahead-(MIN_MATCH-1);do n.ins_h=HASH(n,n.ins_h,n.window[c+MIN_MATCH-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--h);n.strstart=c,n.lookahead=MIN_MATCH-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=MIN_MATCH-1,n.match_available=0,t.next_in=a,t.input=l,t.avail_in=s,n.wrap=o,Z_OK$3};var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2$1=deflate$2,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1$2={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2$1,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo};const _has=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var assign=function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const e=r.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)_has(e,n)&&(t[n]=e[n])}}return t},flattenChunks=t=>{let r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].length;const e=new Uint8Array(r);for(let n=0,o=0,s=t.length;n<s;n++){let a=t[n];e.set(a,o),o+=a.length}return e},common={assign,flattenChunks};let STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{STR_APPLY_UIA_OK=!1}const _utf8len=new Uint8Array(256);for(let t=0;t<256;t++)_utf8len[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,e,n,o,s,a=t.length,l=0;for(o=0;o<a;o++)e=t.charCodeAt(o),(e&64512)===55296&&o+1<a&&(n=t.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(r=new Uint8Array(l),s=0,o=0;s<l;o++)e=t.charCodeAt(o),(e&64512)===55296&&o+1<a&&(n=t.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),e<128?r[s++]=e:e<2048?(r[s++]=192|e>>>6,r[s++]=128|e&63):e<65536?(r[s++]=224|e>>>12,r[s++]=128|e>>>6&63,r[s++]=128|e&63):(r[s++]=240|e>>>18,r[s++]=128|e>>>12&63,r[s++]=128|e>>>6&63,r[s++]=128|e&63);return r};const buf2binstring=(t,r)=>{if(r<65534&&t.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,t.length===r?t:t.subarray(0,r));let e="";for(let n=0;n<r;n++)e+=String.fromCharCode(t[n]);return e};var buf2string=(t,r)=>{const e=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let n,o;const s=new Array(e*2);for(o=0,n=0;n<e;){let a=t[n++];if(a<128){s[o++]=a;continue}let l=_utf8len[a];if(l>4){s[o++]=65533,n+=l-1;continue}for(a&=l===2?31:l===3?15:7;l>1&&n<e;)a=a<<6|t[n++]&63,l--;if(l>1){s[o++]=65533;continue}a<65536?s[o++]=a:(a-=65536,s[o++]=55296|a>>10&1023,s[o++]=56320|a&1023)}return buf2binstring(s,o)},utf8border=(t,r)=>{r=r||t.length,r>t.length&&(r=t.length);let e=r-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?r:e+_utf8len[t[e]]>r?e:r},strings={string2buf,buf2string,utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream;const toString$1$1=Object.prototype.toString,{Z_NO_FLUSH:Z_NO_FLUSH$1,Z_SYNC_FLUSH,Z_FULL_FLUSH,Z_FINISH:Z_FINISH$2,Z_OK:Z_OK$2,Z_STREAM_END:Z_STREAM_END$2,Z_DEFAULT_COMPRESSION,Z_DEFAULT_STRATEGY,Z_DEFLATED:Z_DEFLATED$1}=constants$2;function Deflate$1(t){this.options=common.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let e=deflate_1$2.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(e!==Z_OK$2)throw new Error(messages[e]);if(r.header&&deflate_1$2.deflateSetHeader(this.strm,r.header),r.dictionary){let n;if(typeof r.dictionary=="string"?n=strings.string2buf(r.dictionary):toString$1$1.call(r.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(r.dictionary):n=r.dictionary,e=deflate_1$2.deflateSetDictionary(this.strm,n),e!==Z_OK$2)throw new Error(messages[e]);this._dict_set=!0}}Deflate$1.prototype.push=function(t,r){const e=this.strm,n=this.options.chunkSize;let o,s;if(this.ended)return!1;for(r===~~r?s=r:s=r===!0?Z_FINISH$2:Z_NO_FLUSH$1,typeof t=="string"?e.input=strings.string2buf(t):toString$1$1.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(s===Z_SYNC_FLUSH||s===Z_FULL_FLUSH)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(o=deflate_1$2.deflate(e,s),o===Z_STREAM_END$2)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),o=deflate_1$2.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===Z_OK$2;if(e.avail_out===0){this.onData(e.output);continue}if(s>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};Deflate$1.prototype.onData=function(t){this.chunks.push(t)};Deflate$1.prototype.onEnd=function(t){t===Z_OK$2&&(this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function deflate$1(t,r){const e=new Deflate$1(r);if(e.push(t,!0),e.err)throw e.msg||messages[e.err];return e.result}function deflateRaw$1(t,r){return r=r||{},r.raw=!0,deflate$1(t,r)}function gzip$1(t,r){return r=r||{},r.gzip=!0,deflate$1(t,r)}var Deflate_1$1=Deflate$1,deflate_2=deflate$1,deflateRaw_1$1=deflateRaw$1,gzip_1$1=gzip$1,constants$1=constants$2,deflate_1$1={Deflate:Deflate_1$1,deflate:deflate_2,deflateRaw:deflateRaw_1$1,gzip:gzip_1$1,constants:constants$1};const BAD$1=16209,TYPE$1=16191;var inffast=function(r,e){let n,o,s,a,l,c,h,f,u,d,g,m,y,_,w,S,v,b,k,C,R,A,$,E;const I=r.state;n=r.next_in,$=r.input,o=n+(r.avail_in-5),s=r.next_out,E=r.output,a=s-(e-r.avail_out),l=s+(r.avail_out-257),c=I.dmax,h=I.wsize,f=I.whave,u=I.wnext,d=I.window,g=I.hold,m=I.bits,y=I.lencode,_=I.distcode,w=(1<<I.lenbits)-1,S=(1<<I.distbits)-1;e:do{m<15&&(g+=$[n++]<<m,m+=8,g+=$[n++]<<m,m+=8),v=y[g&w];t:for(;;){if(b=v>>>24,g>>>=b,m-=b,b=v>>>16&255,b===0)E[s++]=v&65535;else if(b&16){k=v&65535,b&=15,b&&(m<b&&(g+=$[n++]<<m,m+=8),k+=g&(1<<b)-1,g>>>=b,m-=b),m<15&&(g+=$[n++]<<m,m+=8,g+=$[n++]<<m,m+=8),v=_[g&S];r:for(;;){if(b=v>>>24,g>>>=b,m-=b,b=v>>>16&255,b&16){if(C=v&65535,b&=15,m<b&&(g+=$[n++]<<m,m+=8,m<b&&(g+=$[n++]<<m,m+=8)),C+=g&(1<<b)-1,C>c){r.msg="invalid distance too far back",I.mode=BAD$1;break e}if(g>>>=b,m-=b,b=s-a,C>b){if(b=C-b,b>f&&I.sane){r.msg="invalid distance too far back",I.mode=BAD$1;break e}if(R=0,A=d,u===0){if(R+=h-b,b<k){k-=b;do E[s++]=d[R++];while(--b);R=s-C,A=E}}else if(u<b){if(R+=h+u-b,b-=u,b<k){k-=b;do E[s++]=d[R++];while(--b);if(R=0,u<k){b=u,k-=b;do E[s++]=d[R++];while(--b);R=s-C,A=E}}}else if(R+=u-b,b<k){k-=b;do E[s++]=d[R++];while(--b);R=s-C,A=E}for(;k>2;)E[s++]=A[R++],E[s++]=A[R++],E[s++]=A[R++],k-=3;k&&(E[s++]=A[R++],k>1&&(E[s++]=A[R++]))}else{R=s-C;do E[s++]=E[R++],E[s++]=E[R++],E[s++]=E[R++],k-=3;while(k>2);k&&(E[s++]=E[R++],k>1&&(E[s++]=E[R++]))}}else if(b&64){r.msg="invalid distance code",I.mode=BAD$1;break e}else{v=_[(v&65535)+(g&(1<<b)-1)];continue r}break}}else if(b&64)if(b&32){I.mode=TYPE$1;break e}else{r.msg="invalid literal/length code",I.mode=BAD$1;break e}else{v=y[(v&65535)+(g&(1<<b)-1)];continue t}break}}while(n<o&&s<l);k=m>>3,n-=k,m-=k<<3,g&=(1<<m)-1,r.next_in=n,r.next_out=s,r.avail_in=n<o?5+(o-n):5-(n-o),r.avail_out=s<l?257+(l-s):257-(s-l),I.hold=g,I.bits=m};const MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=(t,r,e,n,o,s,a,l)=>{const c=l.bits;let h=0,f=0,u=0,d=0,g=0,m=0,y=0,_=0,w=0,S=0,v,b,k,C,R,A=null,$;const E=new Uint16Array(MAXBITS+1),I=new Uint16Array(MAXBITS+1);let B=null,P,Y,V;for(h=0;h<=MAXBITS;h++)E[h]=0;for(f=0;f<n;f++)E[r[e+f]]++;for(g=c,d=MAXBITS;d>=1&&E[d]===0;d--);if(g>d&&(g=d),d===0)return o[s++]=1<<24|64<<16|0,o[s++]=1<<24|64<<16|0,l.bits=1,0;for(u=1;u<d&&E[u]===0;u++);for(g<u&&(g=u),_=1,h=1;h<=MAXBITS;h++)if(_<<=1,_-=E[h],_<0)return-1;if(_>0&&(t===CODES$1||d!==1))return-1;for(I[1]=0,h=1;h<MAXBITS;h++)I[h+1]=I[h]+E[h];for(f=0;f<n;f++)r[e+f]!==0&&(a[I[r[e+f]]++]=f);if(t===CODES$1?(A=B=a,$=20):t===LENS$1?(A=lbase,B=lext,$=257):(A=dbase,B=dext,$=0),S=0,f=0,h=u,R=s,m=g,y=0,k=-1,w=1<<g,C=w-1,t===LENS$1&&w>ENOUGH_LENS$1||t===DISTS$1&&w>ENOUGH_DISTS$1)return 1;for(;;){P=h-y,a[f]+1<$?(Y=0,V=a[f]):a[f]>=$?(Y=B[a[f]-$],V=A[a[f]-$]):(Y=96,V=0),v=1<<h-y,b=1<<m,u=b;do b-=v,o[R+(S>>y)+b]=P<<24|Y<<16|V|0;while(b!==0);for(v=1<<h-1;S&v;)v>>=1;if(v!==0?(S&=v-1,S+=v):S=0,f++,--E[h]===0){if(h===d)break;h=r[e+a[f]]}if(h>g&&(S&C)!==k){for(y===0&&(y=g),R+=u,m=h-y,_=1<<m;m+y<d&&(_-=E[m+y],!(_<=0));)m++,_<<=1;if(w+=1<<m,t===LENS$1&&w>ENOUGH_LENS$1||t===DISTS$1&&w>ENOUGH_DISTS$1)return 1;k=S&C,o[k]=g<<24|m<<16|R-s|0}}return S!==0&&(o[R+S]=h-y<<24|64<<16|0),l.bits=g,0};var inftrees=inflate_table;const CODES=0,LENS=1,DISTS=2,{Z_FINISH:Z_FINISH$1,Z_BLOCK,Z_TREES,Z_OK:Z_OK$1,Z_STREAM_END:Z_STREAM_END$1,Z_NEED_DICT:Z_NEED_DICT$1,Z_STREAM_ERROR:Z_STREAM_ERROR$1,Z_DATA_ERROR:Z_DATA_ERROR$1,Z_MEM_ERROR:Z_MEM_ERROR$1,Z_BUF_ERROR,Z_DEFLATED}=constants$2,HEAD=16180,FLAGS=16181,TIME=16182,OS=16183,EXLEN=16184,EXTRA=16185,NAME=16186,COMMENT=16187,HCRC=16188,DICTID=16189,DICT=16190,TYPE=16191,TYPEDO=16192,STORED=16193,COPY_=16194,COPY=16195,TABLE=16196,LENLENS=16197,CODELENS=16198,LEN_=16199,LEN=16200,LENEXT=16201,DIST=16202,DISTEXT=16203,MATCH=16204,LIT=16205,CHECK=16206,LENGTH=16207,DONE=16208,BAD=16209,MEM=16210,SYNC=16211,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function InflateState(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const inflateStateCheck=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<HEAD||r.mode>SYNC?1:0},inflateResetKeep=t=>{if(inflateStateCheck(t))return Z_STREAM_ERROR$1;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=r.wrap&1),r.mode=HEAD,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(ENOUGH_LENS),r.distcode=r.distdyn=new Int32Array(ENOUGH_DISTS),r.sane=1,r.back=-1,Z_OK$1},inflateReset=t=>{if(inflateStateCheck(t))return Z_STREAM_ERROR$1;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,inflateResetKeep(t)},inflateReset2=(t,r)=>{let e;if(inflateStateCheck(t))return Z_STREAM_ERROR$1;const n=t.state;return r<0?(e=0,r=-r):(e=(r>>4)+5,r<48&&(r&=15)),r&&(r<8||r>15)?Z_STREAM_ERROR$1:(n.window!==null&&n.wbits!==r&&(n.window=null),n.wrap=e,n.wbits=r,inflateReset(t))},inflateInit2=(t,r)=>{if(!t)return Z_STREAM_ERROR$1;const e=new InflateState;t.state=e,e.strm=t,e.window=null,e.mode=HEAD;const n=inflateReset2(t,r);return n!==Z_OK$1&&(t.state=null),n},inflateInit=t=>inflateInit2(t,DEF_WBITS);let virgin=!0,lenfix,distfix;const fixedtables=t=>{if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(inftrees(LENS,t.lens,0,288,lenfix,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;inftrees(DISTS,t.lens,0,32,distfix,0,t.work,{bits:5}),virgin=!1}t.lencode=lenfix,t.lenbits=9,t.distcode=distfix,t.distbits=5},updatewindow=(t,r,e,n)=>{let o;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(r.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(o=s.wsize-s.wnext,o>n&&(o=n),s.window.set(r.subarray(e-n,e-n+o),s.wnext),n-=o,n?(s.window.set(r.subarray(e-n,e),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0},inflate$2=(t,r)=>{let e,n,o,s,a,l,c,h,f,u,d,g,m,y,_=0,w,S,v,b,k,C,R,A;const $=new Uint8Array(4);let E,I;const B=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(inflateStateCheck(t)||!t.output||!t.input&&t.avail_in!==0)return Z_STREAM_ERROR$1;e=t.state,e.mode===TYPE&&(e.mode=TYPEDO),a=t.next_out,o=t.output,c=t.avail_out,s=t.next_in,n=t.input,l=t.avail_in,h=e.hold,f=e.bits,u=l,d=c,A=Z_OK$1;e:for(;;)switch(e.mode){case HEAD:if(e.wrap===0){e.mode=TYPEDO;break}for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(e.wrap&2&&h===35615){e.wbits===0&&(e.wbits=15),e.check=0,$[0]=h&255,$[1]=h>>>8&255,e.check=crc32_1(e.check,$,2,0),h=0,f=0,e.mode=FLAGS;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((h&255)<<8)+(h>>8))%31){t.msg="incorrect header check",e.mode=BAD;break}if((h&15)!==Z_DEFLATED){t.msg="unknown compression method",e.mode=BAD;break}if(h>>>=4,f-=4,R=(h&15)+8,e.wbits===0&&(e.wbits=R),R>15||R>e.wbits){t.msg="invalid window size",e.mode=BAD;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=h&512?DICTID:TYPE,h=0,f=0;break;case FLAGS:for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(e.flags=h,(e.flags&255)!==Z_DEFLATED){t.msg="unknown compression method",e.mode=BAD;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=BAD;break}e.head&&(e.head.text=h>>8&1),e.flags&512&&e.wrap&4&&($[0]=h&255,$[1]=h>>>8&255,e.check=crc32_1(e.check,$,2,0)),h=0,f=0,e.mode=TIME;case TIME:for(;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}e.head&&(e.head.time=h),e.flags&512&&e.wrap&4&&($[0]=h&255,$[1]=h>>>8&255,$[2]=h>>>16&255,$[3]=h>>>24&255,e.check=crc32_1(e.check,$,4,0)),h=0,f=0,e.mode=OS;case OS:for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}e.head&&(e.head.xflags=h&255,e.head.os=h>>8),e.flags&512&&e.wrap&4&&($[0]=h&255,$[1]=h>>>8&255,e.check=crc32_1(e.check,$,2,0)),h=0,f=0,e.mode=EXLEN;case EXLEN:if(e.flags&1024){for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}e.length=h,e.head&&(e.head.extra_len=h),e.flags&512&&e.wrap&4&&($[0]=h&255,$[1]=h>>>8&255,e.check=crc32_1(e.check,$,2,0)),h=0,f=0}else e.head&&(e.head.extra=null);e.mode=EXTRA;case EXTRA:if(e.flags&1024&&(g=e.length,g>l&&(g=l),g&&(e.head&&(R=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(s,s+g),R)),e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,n,g,s)),l-=g,s+=g,e.length-=g),e.length))break e;e.length=0,e.mode=NAME;case NAME:if(e.flags&2048){if(l===0)break e;g=0;do R=n[s+g++],e.head&&R&&e.length<65536&&(e.head.name+=String.fromCharCode(R));while(R&&g<l);if(e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,n,g,s)),l-=g,s+=g,R)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=COMMENT;case COMMENT:if(e.flags&4096){if(l===0)break e;g=0;do R=n[s+g++],e.head&&R&&e.length<65536&&(e.head.comment+=String.fromCharCode(R));while(R&&g<l);if(e.flags&512&&e.wrap&4&&(e.check=crc32_1(e.check,n,g,s)),l-=g,s+=g,R)break e}else e.head&&(e.head.comment=null);e.mode=HCRC;case HCRC:if(e.flags&512){for(;f<16;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(e.wrap&4&&h!==(e.check&65535)){t.msg="header crc mismatch",e.mode=BAD;break}h=0,f=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=TYPE;break;case DICTID:for(;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}t.adler=e.check=zswap32(h),h=0,f=0,e.mode=DICT;case DICT:if(e.havedict===0)return t.next_out=a,t.avail_out=c,t.next_in=s,t.avail_in=l,e.hold=h,e.bits=f,Z_NEED_DICT$1;t.adler=e.check=1,e.mode=TYPE;case TYPE:if(r===Z_BLOCK||r===Z_TREES)break e;case TYPEDO:if(e.last){h>>>=f&7,f-=f&7,e.mode=CHECK;break}for(;f<3;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}switch(e.last=h&1,h>>>=1,f-=1,h&3){case 0:e.mode=STORED;break;case 1:if(fixedtables(e),e.mode=LEN_,r===Z_TREES){h>>>=2,f-=2;break e}break;case 2:e.mode=TABLE;break;case 3:t.msg="invalid block type",e.mode=BAD}h>>>=2,f-=2;break;case STORED:for(h>>>=f&7,f-=f&7;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if((h&65535)!==(h>>>16^65535)){t.msg="invalid stored block lengths",e.mode=BAD;break}if(e.length=h&65535,h=0,f=0,e.mode=COPY_,r===Z_TREES)break e;case COPY_:e.mode=COPY;case COPY:if(g=e.length,g){if(g>l&&(g=l),g>c&&(g=c),g===0)break e;o.set(n.subarray(s,s+g),a),l-=g,s+=g,c-=g,a+=g,e.length-=g;break}e.mode=TYPE;break;case TABLE:for(;f<14;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(e.nlen=(h&31)+257,h>>>=5,f-=5,e.ndist=(h&31)+1,h>>>=5,f-=5,e.ncode=(h&15)+4,h>>>=4,f-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=BAD;break}e.have=0,e.mode=LENLENS;case LENLENS:for(;e.have<e.ncode;){for(;f<3;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}e.lens[B[e.have++]]=h&7,h>>>=3,f-=3}for(;e.have<19;)e.lens[B[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,E={bits:e.lenbits},A=inftrees(CODES,e.lens,0,19,e.lencode,0,e.work,E),e.lenbits=E.bits,A){t.msg="invalid code lengths set",e.mode=BAD;break}e.have=0,e.mode=CODELENS;case CODELENS:for(;e.have<e.nlen+e.ndist;){for(;_=e.lencode[h&(1<<e.lenbits)-1],w=_>>>24,S=_>>>16&255,v=_&65535,!(w<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(v<16)h>>>=w,f-=w,e.lens[e.have++]=v;else{if(v===16){for(I=w+2;f<I;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(h>>>=w,f-=w,e.have===0){t.msg="invalid bit length repeat",e.mode=BAD;break}R=e.lens[e.have-1],g=3+(h&3),h>>>=2,f-=2}else if(v===17){for(I=w+3;f<I;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=w,f-=w,R=0,g=3+(h&7),h>>>=3,f-=3}else{for(I=w+7;f<I;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=w,f-=w,R=0,g=11+(h&127),h>>>=7,f-=7}if(e.have+g>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=BAD;break}for(;g--;)e.lens[e.have++]=R}}if(e.mode===BAD)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=BAD;break}if(e.lenbits=9,E={bits:e.lenbits},A=inftrees(LENS,e.lens,0,e.nlen,e.lencode,0,e.work,E),e.lenbits=E.bits,A){t.msg="invalid literal/lengths set",e.mode=BAD;break}if(e.distbits=6,e.distcode=e.distdyn,E={bits:e.distbits},A=inftrees(DISTS,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,E),e.distbits=E.bits,A){t.msg="invalid distances set",e.mode=BAD;break}if(e.mode=LEN_,r===Z_TREES)break e;case LEN_:e.mode=LEN;case LEN:if(l>=6&&c>=258){t.next_out=a,t.avail_out=c,t.next_in=s,t.avail_in=l,e.hold=h,e.bits=f,inffast(t,d),a=t.next_out,o=t.output,c=t.avail_out,s=t.next_in,n=t.input,l=t.avail_in,h=e.hold,f=e.bits,e.mode===TYPE&&(e.back=-1);break}for(e.back=0;_=e.lencode[h&(1<<e.lenbits)-1],w=_>>>24,S=_>>>16&255,v=_&65535,!(w<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(S&&!(S&240)){for(b=w,k=S,C=v;_=e.lencode[C+((h&(1<<b+k)-1)>>b)],w=_>>>24,S=_>>>16&255,v=_&65535,!(b+w<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=b,f-=b,e.back+=b}if(h>>>=w,f-=w,e.back+=w,e.length=v,S===0){e.mode=LIT;break}if(S&32){e.back=-1,e.mode=TYPE;break}if(S&64){t.msg="invalid literal/length code",e.mode=BAD;break}e.extra=S&15,e.mode=LENEXT;case LENEXT:if(e.extra){for(I=e.extra;f<I;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}e.length+=h&(1<<e.extra)-1,h>>>=e.extra,f-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=DIST;case DIST:for(;_=e.distcode[h&(1<<e.distbits)-1],w=_>>>24,S=_>>>16&255,v=_&65535,!(w<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(!(S&240)){for(b=w,k=S,C=v;_=e.distcode[C+((h&(1<<b+k)-1)>>b)],w=_>>>24,S=_>>>16&255,v=_&65535,!(b+w<=f);){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}h>>>=b,f-=b,e.back+=b}if(h>>>=w,f-=w,e.back+=w,S&64){t.msg="invalid distance code",e.mode=BAD;break}e.offset=v,e.extra=S&15,e.mode=DISTEXT;case DISTEXT:if(e.extra){for(I=e.extra;f<I;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}e.offset+=h&(1<<e.extra)-1,h>>>=e.extra,f-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=BAD;break}e.mode=MATCH;case MATCH:if(c===0)break e;if(g=d-c,e.offset>g){if(g=e.offset-g,g>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=BAD;break}g>e.wnext?(g-=e.wnext,m=e.wsize-g):m=e.wnext-g,g>e.length&&(g=e.length),y=e.window}else y=o,m=a-e.offset,g=e.length;g>c&&(g=c),c-=g,e.length-=g;do o[a++]=y[m++];while(--g);e.length===0&&(e.mode=LEN);break;case LIT:if(c===0)break e;o[a++]=e.length,c--,e.mode=LEN;break;case CHECK:if(e.wrap){for(;f<32;){if(l===0)break e;l--,h|=n[s++]<<f,f+=8}if(d-=c,t.total_out+=d,e.total+=d,e.wrap&4&&d&&(t.adler=e.check=e.flags?crc32_1(e.check,o,d,a-d):adler32_1(e.check,o,d,a-d)),d=c,e.wrap&4&&(e.flags?h:zswap32(h))!==e.check){t.msg="incorrect data check",e.mode=BAD;break}h=0,f=0}e.mode=LENGTH;case LENGTH:if(e.wrap&&e.flags){for(;f<32;){if(l===0)break e;l--,h+=n[s++]<<f,f+=8}if(e.wrap&4&&h!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=BAD;break}h=0,f=0}e.mode=DONE;case DONE:A=Z_STREAM_END$1;break e;case BAD:A=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return t.next_out=a,t.avail_out=c,t.next_in=s,t.avail_in=l,e.hold=h,e.bits=f,(e.wsize||d!==t.avail_out&&e.mode<BAD&&(e.mode<CHECK||r!==Z_FINISH$1))&&updatewindow(t,t.output,t.next_out,d-t.avail_out),u-=t.avail_in,d-=t.avail_out,t.total_in+=u,t.total_out+=d,e.total+=d,e.wrap&4&&d&&(t.adler=e.check=e.flags?crc32_1(e.check,o,d,t.next_out-d):adler32_1(e.check,o,d,t.next_out-d)),t.data_type=e.bits+(e.last?64:0)+(e.mode===TYPE?128:0)+(e.mode===LEN_||e.mode===COPY_?256:0),(u===0&&d===0||r===Z_FINISH$1)&&A===Z_OK$1&&(A=Z_BUF_ERROR),A},inflateEnd=t=>{if(inflateStateCheck(t))return Z_STREAM_ERROR$1;let r=t.state;return r.window&&(r.window=null),t.state=null,Z_OK$1},inflateGetHeader=(t,r)=>{if(inflateStateCheck(t))return Z_STREAM_ERROR$1;const e=t.state;return e.wrap&2?(e.head=r,r.done=!1,Z_OK$1):Z_STREAM_ERROR$1},inflateSetDictionary=(t,r)=>{const e=r.length;let n,o,s;return inflateStateCheck(t)||(n=t.state,n.wrap!==0&&n.mode!==DICT)?Z_STREAM_ERROR$1:n.mode===DICT&&(o=1,o=adler32_1(o,r,e,0),o!==n.check)?Z_DATA_ERROR$1:(s=updatewindow(t,r,e,e),s?(n.mode=MEM,Z_MEM_ERROR$1):(n.havedict=1,Z_OK$1))};var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader;const toString$2=Object.prototype.toString,{Z_NO_FLUSH,Z_FINISH,Z_OK,Z_STREAM_END,Z_NEED_DICT,Z_STREAM_ERROR,Z_DATA_ERROR,Z_MEM_ERROR}=constants$2;function Inflate$1(t){this.options=common.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(t&&t.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15||(r.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;let e=inflate_1$2.inflateInit2(this.strm,r.windowBits);if(e!==Z_OK)throw new Error(messages[e]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=strings.string2buf(r.dictionary):toString$2.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(e=inflate_1$2.inflateSetDictionary(this.strm,r.dictionary),e!==Z_OK)))throw new Error(messages[e])}Inflate$1.prototype.push=function(t,r){const e=this.strm,n=this.options.chunkSize,o=this.options.dictionary;let s,a,l;if(this.ended)return!1;for(r===~~r?a=r:a=r===!0?Z_FINISH:Z_NO_FLUSH,toString$2.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),s=inflate_1$2.inflate(e,a),s===Z_NEED_DICT&&o&&(s=inflate_1$2.inflateSetDictionary(e,o),s===Z_OK?s=inflate_1$2.inflate(e,a):s===Z_DATA_ERROR&&(s=Z_NEED_DICT));e.avail_in>0&&s===Z_STREAM_END&&e.state.wrap>0&&t[e.next_in]!==0;)inflate_1$2.inflateReset(e),s=inflate_1$2.inflate(e,a);switch(s){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(s),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||s===Z_STREAM_END))if(this.options.to==="string"){let c=strings.utf8border(e.output,e.next_out),h=e.next_out-c,f=strings.buf2string(e.output,c);e.next_out=h,e.avail_out=n-h,h&&e.output.set(e.output.subarray(c,c+h),0),this.onData(f)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(s===Z_OK&&l===0)){if(s===Z_STREAM_END)return s=inflate_1$2.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Inflate$1.prototype.onData=function(t){this.chunks.push(t)};Inflate$1.prototype.onEnd=function(t){t===Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function inflate$1(t,r){const e=new Inflate$1(r);if(e.push(t),e.err)throw e.msg||messages[e.err];return e.result}function inflateRaw$1(t,r){return r=r||{},r.raw=!0,inflate$1(t,r)}var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants};const{Deflate,deflate,deflateRaw,gzip}=deflate_1$1,{Inflate,inflate,inflateRaw,ungzip}=inflate_1$1;var deflate_1=deflate,Inflate_1=Inflate,inflate_1=inflate;const pngSignature=[137,80,78,71,13,10,26,10],crcTable=[];for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)r&1?r=3988292384^r>>>1:r=r>>>1;crcTable[t]=r}const initialCrc=4294967295;function updateCrc(t,r,e){let n=t;for(let o=0;o<e;o++)n=crcTable[(n^r[o])&255]^n>>>8;return n}function crc(t,r){return(updateCrc(initialCrc,t,r)^initialCrc)>>>0}var ColorType;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"})(ColorType||(ColorType={}));var CompressionMethod;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"})(CompressionMethod||(CompressionMethod={}));var FilterMethod;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"})(FilterMethod||(FilterMethod={}));var InterlaceMethod;(function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"})(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=uint8[0]===255;class PngDecoder extends IOBuffer$4{constructor(r,e={}){super(r);const{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new Inflate_1,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=ColorType.UNKNOWN,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let r=0;r<pngSignature.length;r++)if(this.readUint8()!==pngSignature[r])throw new Error(`wrong PNG signature. Byte at ${r} should be ${pngSignature[r]}.`)}decodeChunk(){const r=this.readUint32(),e=this.readChars(4),n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(r);break;case"iCCP":this.decodeiCCP(r);break;case"tEXt":this.decodetEXt(r);break;case"pHYs":this.decodepHYs();break;default:this.skip(r);break}if(this.offset-n!==r)throw new Error(`Length mismatch while decoding chunk ${e}`);if(this._checkCrc){const o=this.readUint32(),s=r+4,a=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-s-4,s),s);if(a!==o)throw new Error(`CRC mismatch for chunk ${e}. Expected ${o}, found ${a}`)}else this.skip(4)}decodeIHDR(){const r=this._png;r.width=this.readUint32(),r.height=this.readUint32(),r.depth=checkBitDepth(this.readUint8());const e=this.readUint8();this._colorType=e;let n;switch(e){case ColorType.GREYSCALE:n=1;break;case ColorType.TRUECOLOUR:n=3;break;case ColorType.INDEXED_COLOUR:n=1;break;case ColorType.GREYSCALE_ALPHA:n=2;break;case ColorType.TRUECOLOUR_ALPHA:n=4;break;default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(r){if(r%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${r}`);const e=r/3;this._hasPalette=!0;const n=[];this._palette=n;for(let o=0;o<e;o++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(r){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,r)),this.skip(r)}decodetRNS(r){switch(this._colorType){case ColorType.GREYSCALE:case ColorType.TRUECOLOUR:{if(r%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${r}`);if(r/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${r/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(r/2);for(let e=0;e<r/2;e++)this._transparency[e]=this.readUint16();break}case ColorType.INDEXED_COLOUR:{if(r>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${r} vs ${this._palette.length})`);let e=0;for(;e<r;e++){const n=this.readByte();this._palette[e].push(n)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(r){let e="",n;for(;(n=this.readChar())!==NULL;)e+=n;const o=this.readUint8();if(o!==CompressionMethod.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${o}`);const s=this.readBytes(r-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:inflate_1(s)}}decodetEXt(r){let e="",n;for(;(n=this.readChar())!==NULL;)e+=n;this._png.text[e]=this.readChars(r-e.length-1)}decodepHYs(){const r=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:r,y:e,unit:n}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const r=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===InterlaceMethod.NO_INTERLACE)this.decodeInterlaceNull(r);else throw new Error(`Interlace method ${this._interlaceMethod} not supported`)}decodeInterlaceNull(r){const e=this._png.height,n=this._png.channels*this._png.depth/8,o=this._png.width*n,s=new Uint8Array(this._png.height*o);let a=empty,l=0,c,h;for(let f=0;f<e;f++){switch(c=r.subarray(l+1,l+1+o),h=s.subarray(f*o,(f+1)*o),r[l]){case 0:unfilterNone(c,h,o);break;case 1:unfilterSub(c,h,o,n);break;case 2:unfilterUp(c,h,a,o);break;case 3:unfilterAverage(c,h,a,o,n);break;case 4:unfilterPaeth(c,h,a,o,n);break;default:throw new Error(`Unsupported filter: ${r[l]}`)}a=h,l+=o+1}if(this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency),this._png.depth===16){const f=new Uint16Array(s.buffer);if(osIsLittleEndian)for(let u=0;u<f.length;u++)f[u]=swap16(f[u]);this._png.data=f}else this._png.data=s}}function unfilterNone(t,r,e){for(let n=0;n<e;n++)r[n]=t[n]}function unfilterSub(t,r,e,n){let o=0;for(;o<n;o++)r[o]=t[o];for(;o<e;o++)r[o]=t[o]+r[o-n]&255}function unfilterUp(t,r,e,n){let o=0;if(e.length===0)for(;o<n;o++)r[o]=t[o];else for(;o<n;o++)r[o]=t[o]+e[o]&255}function unfilterAverage(t,r,e,n,o){let s=0;if(e.length===0){for(;s<o;s++)r[s]=t[s];for(;s<n;s++)r[s]=t[s]+(r[s-o]>>1)&255}else{for(;s<o;s++)r[s]=t[s]+(e[s]>>1)&255;for(;s<n;s++)r[s]=t[s]+(r[s-o]+e[s]>>1)&255}}function unfilterPaeth(t,r,e,n,o){let s=0;if(e.length===0){for(;s<o;s++)r[s]=t[s];for(;s<n;s++)r[s]=t[s]+r[s-o]&255}else{for(;s<o;s++)r[s]=t[s]+e[s]&255;for(;s<n;s++)r[s]=t[s]+paethPredictor(r[s-o],e[s],e[s-o])&255}}function paethPredictor(t,r,e){const n=t+r-e,o=Math.abs(n-t),s=Math.abs(n-r),a=Math.abs(n-e);return o<=s&&o<=a?t:s<=a?r:e}function swap16(t){return(t&255)<<8|t>>8&255}function checkBitDepth(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}const defaultZlibOptions={level:3};class PngEncoder extends IOBuffer$4{constructor(r,e={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions={...defaultZlibOptions,...e.zlib},this._png=this._checkData(r),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(r){this.writeUint32(r.length),this.writeChars("IDAT"),this.writeBytes(r),this.writeCrc(r.length+4)}encodeData(){const{width:r,height:e,channels:n,depth:o,data:s}=this._png,a=n*r,l=new IOBuffer$4().setBigEndian();let c=0;for(let u=0;u<e;u++)if(l.writeByte(0),o===8)c=writeDataBytes(s,l,a,c);else if(o===16)c=writeDataUint16(s,l,a,c);else throw new Error("unreachable");const h=l.toArray(),f=deflate_1(h,this._zlibOptions);this.encodeIDAT(f)}_checkData(r){const{colorType:e,channels:n,depth:o}=getColorType(r),s={width:checkInteger(r.width,"width"),height:checkInteger(r.height,"height"),channels:n,data:r.data,depth:o,text:{}};this._colorType=e;const a=s.width*s.height*n;if(s.data.length!==a)throw new RangeError(`wrong data size. Found ${s.data.length}, expected ${a}`);return s}writeCrc(r){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-r,r),r))}}function checkInteger(t,r){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(`${r} must be a positive integer`)}function getColorType(t){const{channels:r=4,depth:e=8}=t;if(r!==4&&r!==3&&r!==2&&r!==1)throw new RangeError(`unsupported number of channels: ${r}`);if(e!==8&&e!==16)throw new RangeError(`unsupported bit depth: ${e}`);const n={channels:r,depth:e,colorType:ColorType.UNKNOWN};switch(r){case 4:n.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:n.colorType=ColorType.TRUECOLOUR;break;case 1:n.colorType=ColorType.GREYSCALE;break;case 2:n.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels")}return n}function writeDataBytes(t,r,e,n){for(let o=0;o<e;o++)r.writeByte(t[n++]);return n}function writeDataUint16(t,r,e,n){for(let o=0;o<e;o++)r.writeUint16(t[n++]);return n}var ResolutionUnitSpecifier;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));function decodePng(t,r){return new PngDecoder(t,r).decode()}function encodePng$1(t,r){return new PngEncoder(t,r).encode()}var buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup$1=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$3=0,len=code.length;i$3<len;++i$3)lookup$1[i$3]=code[i$3],revLookup[code.charCodeAt(i$3)]=i$3;revLookup[45]=62;revLookup[95]=63;function getLens(t){var r=t.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=t.indexOf("=");e===-1&&(e=r);var n=e===r?0:4-e%4;return[e,n]}function byteLength(t){var r=getLens(t),e=r[0],n=r[1];return(e+n)*3/4-n}function _byteLength(t,r,e){return(r+e)*3/4-e}function toByteArray(t){var r,e=getLens(t),n=e[0],o=e[1],s=new Arr(_byteLength(t,n,o)),a=0,l=o>0?n-4:n,c;for(c=0;c<l;c+=4)r=revLookup[t.charCodeAt(c)]<<18|revLookup[t.charCodeAt(c+1)]<<12|revLookup[t.charCodeAt(c+2)]<<6|revLookup[t.charCodeAt(c+3)],s[a++]=r>>16&255,s[a++]=r>>8&255,s[a++]=r&255;return o===2&&(r=revLookup[t.charCodeAt(c)]<<2|revLookup[t.charCodeAt(c+1)]>>4,s[a++]=r&255),o===1&&(r=revLookup[t.charCodeAt(c)]<<10|revLookup[t.charCodeAt(c+1)]<<4|revLookup[t.charCodeAt(c+2)]>>2,s[a++]=r>>8&255,s[a++]=r&255),s}function tripletToBase64(t){return lookup$1[t>>18&63]+lookup$1[t>>12&63]+lookup$1[t>>6&63]+lookup$1[t&63]}function encodeChunk(t,r,e){for(var n,o=[],s=r;s<e;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),o.push(tripletToBase64(n));return o.join("")}function fromByteArray(t){for(var r,e=t.length,n=e%3,o=[],s=16383,a=0,l=e-n;a<l;a+=s)o.push(encodeChunk(t,a,a+s>l?l:a+s));return n===1?(r=t[e-1],o.push(lookup$1[r>>2]+lookup$1[r<<4&63]+"==")):n===2&&(r=(t[e-2]<<8)+t[e-1],o.push(lookup$1[r>>10]+lookup$1[r>>4&63]+lookup$1[r<<2&63]+"=")),o.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(t,r,e,n,o){var s,a,l=o*8-n-1,c=(1<<l)-1,h=c>>1,f=-7,u=e?o-1:0,d=e?-1:1,g=t[r+u];for(u+=d,s=g&(1<<-f)-1,g>>=-f,f+=l;f>0;s=s*256+t[r+u],u+=d,f-=8);for(a=s&(1<<-f)-1,s>>=-f,f+=n;f>0;a=a*256+t[r+u],u+=d,f-=8);if(s===0)s=1-h;else{if(s===c)return a?NaN:(g?-1:1)*(1/0);a=a+Math.pow(2,n),s=s-h}return(g?-1:1)*a*Math.pow(2,s-n)};ieee754.write=function(t,r,e,n,o,s){var a,l,c,h=s*8-o-1,f=(1<<h)-1,u=f>>1,d=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:s-1,m=n?1:-1,y=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,a=f):(a=Math.floor(Math.log(r)/Math.LN2),r*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+u>=1?r+=d/c:r+=d*Math.pow(2,1-u),r*c>=2&&(a++,c/=2),a+u>=f?(l=0,a=f):a+u>=1?(l=(r*c-1)*Math.pow(2,o),a=a+u):(l=r*Math.pow(2,u-1)*Math.pow(2,o),a=0));o>=8;t[e+g]=l&255,g+=m,l/=256,o-=8);for(a=a<<o|l,h+=o;h>0;t[e+g]=a&255,g+=m,a/=256,h-=8);t[e+g-m]|=y*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const r=base64Js,e=ieee754,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=f,t.SlowBuffer=k,t.INSPECT_MAX_BYTES=50;const o=2147483647;t.kMaxLength=o;const{Uint8Array:s,ArrayBuffer:a,SharedArrayBuffer:l}=globalThis;f.TYPED_ARRAY_SUPPORT=c(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const M=new s(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,s.prototype),Object.setPrototypeOf(M,p),M.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function h(M){if(M>o)throw new RangeError('The value "'+M+'" is invalid for option "size"');const p=new s(M);return Object.setPrototypeOf(p,f.prototype),p}function f(M,p,x){if(typeof M=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(M)}return u(M,p,x)}f.poolSize=8192;function u(M,p,x){if(typeof M=="string")return y(M,p);if(a.isView(M))return w(M);if(M==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M);if(ye(M,a)||M&&ye(M.buffer,a)||typeof l<"u"&&(ye(M,l)||M&&ye(M.buffer,l)))return S(M,p,x);if(typeof M=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const T=M.valueOf&&M.valueOf();if(T!=null&&T!==M)return f.from(T,p,x);const F=v(M);if(F)return F;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof M[Symbol.toPrimitive]=="function")return f.from(M[Symbol.toPrimitive]("string"),p,x);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M)}f.from=function(M,p,x){return u(M,p,x)},Object.setPrototypeOf(f.prototype,s.prototype),Object.setPrototypeOf(f,s);function d(M){if(typeof M!="number")throw new TypeError('"size" argument must be of type number');if(M<0)throw new RangeError('The value "'+M+'" is invalid for option "size"')}function g(M,p,x){return d(M),M<=0?h(M):p!==void 0?typeof x=="string"?h(M).fill(p,x):h(M).fill(p):h(M)}f.alloc=function(M,p,x){return g(M,p,x)};function m(M){return d(M),h(M<0?0:b(M)|0)}f.allocUnsafe=function(M){return m(M)},f.allocUnsafeSlow=function(M){return m(M)};function y(M,p){if((typeof p!="string"||p==="")&&(p="utf8"),!f.isEncoding(p))throw new TypeError("Unknown encoding: "+p);const x=C(M,p)|0;let T=h(x);const F=T.write(M,p);return F!==x&&(T=T.slice(0,F)),T}function _(M){const p=M.length<0?0:b(M.length)|0,x=h(p);for(let T=0;T<p;T+=1)x[T]=M[T]&255;return x}function w(M){if(ye(M,s)){const p=new s(M);return S(p.buffer,p.byteOffset,p.byteLength)}return _(M)}function S(M,p,x){if(p<0||M.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(M.byteLength<p+(x||0))throw new RangeError('"length" is outside of buffer bounds');let T;return p===void 0&&x===void 0?T=new s(M):x===void 0?T=new s(M,p):T=new s(M,p,x),Object.setPrototypeOf(T,f.prototype),T}function v(M){if(f.isBuffer(M)){const p=b(M.length)|0,x=h(p);return x.length===0||M.copy(x,0,0,p),x}if(M.length!==void 0)return typeof M.length!="number"||ee(M.length)?h(0):_(M);if(M.type==="Buffer"&&Array.isArray(M.data))return _(M.data)}function b(M){if(M>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return M|0}function k(M){return+M!=M&&(M=0),f.alloc(+M)}f.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==f.prototype},f.compare=function(p,x){if(ye(p,s)&&(p=f.from(p,p.offset,p.byteLength)),ye(x,s)&&(x=f.from(x,x.offset,x.byteLength)),!f.isBuffer(p)||!f.isBuffer(x))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===x)return 0;let T=p.length,F=x.length;for(let N=0,z=Math.min(T,F);N<z;++N)if(p[N]!==x[N]){T=p[N],F=x[N];break}return T<F?-1:F<T?1:0},f.isEncoding=function(p){switch(String(p).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(p,x){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return f.alloc(0);let T;if(x===void 0)for(x=0,T=0;T<p.length;++T)x+=p[T].length;const F=f.allocUnsafe(x);let N=0;for(T=0;T<p.length;++T){let z=p[T];if(ye(z,s))N+z.length>F.length?(f.isBuffer(z)||(z=f.from(z)),z.copy(F,N)):s.prototype.set.call(F,z,N);else if(f.isBuffer(z))z.copy(F,N);else throw new TypeError('"list" argument must be an Array of Buffers');N+=z.length}return F};function C(M,p){if(f.isBuffer(M))return M.length;if(a.isView(M)||ye(M,a))return M.byteLength;if(typeof M!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof M);const x=M.length,T=arguments.length>2&&arguments[2]===!0;if(!T&&x===0)return 0;let F=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return x;case"utf8":case"utf-8":return le(M).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x*2;case"hex":return x>>>1;case"base64":return H(M).length;default:if(F)return T?-1:le(M).length;p=(""+p).toLowerCase(),F=!0}}f.byteLength=C;function R(M,p,x){let T=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((x===void 0||x>this.length)&&(x=this.length),x<=0)||(x>>>=0,p>>>=0,x<=p))return"";for(M||(M="utf8");;)switch(M){case"hex":return fe(this,p,x);case"utf8":case"utf-8":return re(this,p,x);case"ascii":return W(this,p,x);case"latin1":case"binary":return de(this,p,x);case"base64":return J(this,p,x);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Z(this,p,x);default:if(T)throw new TypeError("Unknown encoding: "+M);M=(M+"").toLowerCase(),T=!0}}f.prototype._isBuffer=!0;function A(M,p,x){const T=M[p];M[p]=M[x],M[x]=T}f.prototype.swap16=function(){const p=this.length;if(p%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let x=0;x<p;x+=2)A(this,x,x+1);return this},f.prototype.swap32=function(){const p=this.length;if(p%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let x=0;x<p;x+=4)A(this,x,x+3),A(this,x+1,x+2);return this},f.prototype.swap64=function(){const p=this.length;if(p%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let x=0;x<p;x+=8)A(this,x,x+7),A(this,x+1,x+6),A(this,x+2,x+5),A(this,x+3,x+4);return this},f.prototype.toString=function(){const p=this.length;return p===0?"":arguments.length===0?re(this,0,p):R.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(p){if(!f.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p?!0:f.compare(this,p)===0},f.prototype.inspect=function(){let p="";const x=t.INSPECT_MAX_BYTES;return p=this.toString("hex",0,x).replace(/(.{2})/g,"$1 ").trim(),this.length>x&&(p+=" ... "),"<Buffer "+p+">"},n&&(f.prototype[n]=f.prototype.inspect),f.prototype.compare=function(p,x,T,F,N){if(ye(p,s)&&(p=f.from(p,p.offset,p.byteLength)),!f.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof p);if(x===void 0&&(x=0),T===void 0&&(T=p?p.length:0),F===void 0&&(F=0),N===void 0&&(N=this.length),x<0||T>p.length||F<0||N>this.length)throw new RangeError("out of range index");if(F>=N&&x>=T)return 0;if(F>=N)return-1;if(x>=T)return 1;if(x>>>=0,T>>>=0,F>>>=0,N>>>=0,this===p)return 0;let z=N-F,ge=T-x;const Ie=Math.min(z,ge),Te=this.slice(F,N),De=p.slice(x,T);for(let ke=0;ke<Ie;++ke)if(Te[ke]!==De[ke]){z=Te[ke],ge=De[ke];break}return z<ge?-1:ge<z?1:0};function $(M,p,x,T,F){if(M.length===0)return-1;if(typeof x=="string"?(T=x,x=0):x>2147483647?x=2147483647:x<-2147483648&&(x=-2147483648),x=+x,ee(x)&&(x=F?0:M.length-1),x<0&&(x=M.length+x),x>=M.length){if(F)return-1;x=M.length-1}else if(x<0)if(F)x=0;else return-1;if(typeof p=="string"&&(p=f.from(p,T)),f.isBuffer(p))return p.length===0?-1:E(M,p,x,T,F);if(typeof p=="number")return p=p&255,typeof s.prototype.indexOf=="function"?F?s.prototype.indexOf.call(M,p,x):s.prototype.lastIndexOf.call(M,p,x):E(M,[p],x,T,F);throw new TypeError("val must be string, number or Buffer")}function E(M,p,x,T,F){let N=1,z=M.length,ge=p.length;if(T!==void 0&&(T=String(T).toLowerCase(),T==="ucs2"||T==="ucs-2"||T==="utf16le"||T==="utf-16le")){if(M.length<2||p.length<2)return-1;N=2,z/=2,ge/=2,x/=2}function Ie(De,ke){return N===1?De[ke]:De.readUInt16BE(ke*N)}let Te;if(F){let De=-1;for(Te=x;Te<z;Te++)if(Ie(M,Te)===Ie(p,De===-1?0:Te-De)){if(De===-1&&(De=Te),Te-De+1===ge)return De*N}else De!==-1&&(Te-=Te-De),De=-1}else for(x+ge>z&&(x=z-ge),Te=x;Te>=0;Te--){let De=!0;for(let ke=0;ke<ge;ke++)if(Ie(M,Te+ke)!==Ie(p,ke)){De=!1;break}if(De)return Te}return-1}f.prototype.includes=function(p,x,T){return this.indexOf(p,x,T)!==-1},f.prototype.indexOf=function(p,x,T){return $(this,p,x,T,!0)},f.prototype.lastIndexOf=function(p,x,T){return $(this,p,x,T,!1)};function I(M,p,x,T){x=Number(x)||0;const F=M.length-x;T?(T=Number(T),T>F&&(T=F)):T=F;const N=p.length;T>N/2&&(T=N/2);let z;for(z=0;z<T;++z){const ge=parseInt(p.substr(z*2,2),16);if(ee(ge))return z;M[x+z]=ge}return z}function B(M,p,x,T){return Se(le(p,M.length-x),M,x,T)}function P(M,p,x,T){return Se(ue(p),M,x,T)}function Y(M,p,x,T){return Se(H(p),M,x,T)}function V(M,p,x,T){return Se(xe(p,M.length-x),M,x,T)}f.prototype.write=function(p,x,T,F){if(x===void 0)F="utf8",T=this.length,x=0;else if(T===void 0&&typeof x=="string")F=x,T=this.length,x=0;else if(isFinite(x))x=x>>>0,isFinite(T)?(T=T>>>0,F===void 0&&(F="utf8")):(F=T,T=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const N=this.length-x;if((T===void 0||T>N)&&(T=N),p.length>0&&(T<0||x<0)||x>this.length)throw new RangeError("Attempt to write outside buffer bounds");F||(F="utf8");let z=!1;for(;;)switch(F){case"hex":return I(this,p,x,T);case"utf8":case"utf-8":return B(this,p,x,T);case"ascii":case"latin1":case"binary":return P(this,p,x,T);case"base64":return Y(this,p,x,T);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,p,x,T);default:if(z)throw new TypeError("Unknown encoding: "+F);F=(""+F).toLowerCase(),z=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function J(M,p,x){return p===0&&x===M.length?r.fromByteArray(M):r.fromByteArray(M.slice(p,x))}function re(M,p,x){x=Math.min(M.length,x);const T=[];let F=p;for(;F<x;){const N=M[F];let z=null,ge=N>239?4:N>223?3:N>191?2:1;if(F+ge<=x){let Ie,Te,De,ke;switch(ge){case 1:N<128&&(z=N);break;case 2:Ie=M[F+1],(Ie&192)===128&&(ke=(N&31)<<6|Ie&63,ke>127&&(z=ke));break;case 3:Ie=M[F+1],Te=M[F+2],(Ie&192)===128&&(Te&192)===128&&(ke=(N&15)<<12|(Ie&63)<<6|Te&63,ke>2047&&(ke<55296||ke>57343)&&(z=ke));break;case 4:Ie=M[F+1],Te=M[F+2],De=M[F+3],(Ie&192)===128&&(Te&192)===128&&(De&192)===128&&(ke=(N&15)<<18|(Ie&63)<<12|(Te&63)<<6|De&63,ke>65535&&ke<1114112&&(z=ke))}}z===null?(z=65533,ge=1):z>65535&&(z-=65536,T.push(z>>>10&1023|55296),z=56320|z&1023),T.push(z),F+=ge}return se(T)}const q=4096;function se(M){const p=M.length;if(p<=q)return String.fromCharCode.apply(String,M);let x="",T=0;for(;T<p;)x+=String.fromCharCode.apply(String,M.slice(T,T+=q));return x}function W(M,p,x){let T="";x=Math.min(M.length,x);for(let F=p;F<x;++F)T+=String.fromCharCode(M[F]&127);return T}function de(M,p,x){let T="";x=Math.min(M.length,x);for(let F=p;F<x;++F)T+=String.fromCharCode(M[F]);return T}function fe(M,p,x){const T=M.length;(!p||p<0)&&(p=0),(!x||x<0||x>T)&&(x=T);let F="";for(let N=p;N<x;++N)F+=ae[M[N]];return F}function Z(M,p,x){const T=M.slice(p,x);let F="";for(let N=0;N<T.length-1;N+=2)F+=String.fromCharCode(T[N]+T[N+1]*256);return F}f.prototype.slice=function(p,x){const T=this.length;p=~~p,x=x===void 0?T:~~x,p<0?(p+=T,p<0&&(p=0)):p>T&&(p=T),x<0?(x+=T,x<0&&(x=0)):x>T&&(x=T),x<p&&(x=p);const F=this.subarray(p,x);return Object.setPrototypeOf(F,f.prototype),F};function X(M,p,x){if(M%1!==0||M<0)throw new RangeError("offset is not uint");if(M+p>x)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(p,x,T){p=p>>>0,x=x>>>0,T||X(p,x,this.length);let F=this[p],N=1,z=0;for(;++z<x&&(N*=256);)F+=this[p+z]*N;return F},f.prototype.readUintBE=f.prototype.readUIntBE=function(p,x,T){p=p>>>0,x=x>>>0,T||X(p,x,this.length);let F=this[p+--x],N=1;for(;x>0&&(N*=256);)F+=this[p+--x]*N;return F},f.prototype.readUint8=f.prototype.readUInt8=function(p,x){return p=p>>>0,x||X(p,1,this.length),this[p]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(p,x){return p=p>>>0,x||X(p,2,this.length),this[p]|this[p+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(p,x){return p=p>>>0,x||X(p,2,this.length),this[p]<<8|this[p+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(p,x){return p=p>>>0,x||X(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+this[p+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(p,x){return p=p>>>0,x||X(p,4,this.length),this[p]*16777216+(this[p+1]<<16|this[p+2]<<8|this[p+3])},f.prototype.readBigUInt64LE=ce(function(p){p=p>>>0,_e(p,"offset");const x=this[p],T=this[p+7];(x===void 0||T===void 0)&&pe(p,this.length-8);const F=x+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24,N=this[++p]+this[++p]*2**8+this[++p]*2**16+T*2**24;return BigInt(F)+(BigInt(N)<<BigInt(32))}),f.prototype.readBigUInt64BE=ce(function(p){p=p>>>0,_e(p,"offset");const x=this[p],T=this[p+7];(x===void 0||T===void 0)&&pe(p,this.length-8);const F=x*2**24+this[++p]*2**16+this[++p]*2**8+this[++p],N=this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+T;return(BigInt(F)<<BigInt(32))+BigInt(N)}),f.prototype.readIntLE=function(p,x,T){p=p>>>0,x=x>>>0,T||X(p,x,this.length);let F=this[p],N=1,z=0;for(;++z<x&&(N*=256);)F+=this[p+z]*N;return N*=128,F>=N&&(F-=Math.pow(2,8*x)),F},f.prototype.readIntBE=function(p,x,T){p=p>>>0,x=x>>>0,T||X(p,x,this.length);let F=x,N=1,z=this[p+--F];for(;F>0&&(N*=256);)z+=this[p+--F]*N;return N*=128,z>=N&&(z-=Math.pow(2,8*x)),z},f.prototype.readInt8=function(p,x){return p=p>>>0,x||X(p,1,this.length),this[p]&128?(255-this[p]+1)*-1:this[p]},f.prototype.readInt16LE=function(p,x){p=p>>>0,x||X(p,2,this.length);const T=this[p]|this[p+1]<<8;return T&32768?T|4294901760:T},f.prototype.readInt16BE=function(p,x){p=p>>>0,x||X(p,2,this.length);const T=this[p+1]|this[p]<<8;return T&32768?T|4294901760:T},f.prototype.readInt32LE=function(p,x){return p=p>>>0,x||X(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},f.prototype.readInt32BE=function(p,x){return p=p>>>0,x||X(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},f.prototype.readBigInt64LE=ce(function(p){p=p>>>0,_e(p,"offset");const x=this[p],T=this[p+7];(x===void 0||T===void 0)&&pe(p,this.length-8);const F=this[p+4]+this[p+5]*2**8+this[p+6]*2**16+(T<<24);return(BigInt(F)<<BigInt(32))+BigInt(x+this[++p]*2**8+this[++p]*2**16+this[++p]*2**24)}),f.prototype.readBigInt64BE=ce(function(p){p=p>>>0,_e(p,"offset");const x=this[p],T=this[p+7];(x===void 0||T===void 0)&&pe(p,this.length-8);const F=(x<<24)+this[++p]*2**16+this[++p]*2**8+this[++p];return(BigInt(F)<<BigInt(32))+BigInt(this[++p]*2**24+this[++p]*2**16+this[++p]*2**8+T)}),f.prototype.readFloatLE=function(p,x){return p=p>>>0,x||X(p,4,this.length),e.read(this,p,!0,23,4)},f.prototype.readFloatBE=function(p,x){return p=p>>>0,x||X(p,4,this.length),e.read(this,p,!1,23,4)},f.prototype.readDoubleLE=function(p,x){return p=p>>>0,x||X(p,8,this.length),e.read(this,p,!0,52,8)},f.prototype.readDoubleBE=function(p,x){return p=p>>>0,x||X(p,8,this.length),e.read(this,p,!1,52,8)};function j(M,p,x,T,F,N){if(!f.isBuffer(M))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>F||p<N)throw new RangeError('"value" argument is out of bounds');if(x+T>M.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(p,x,T,F){if(p=+p,x=x>>>0,T=T>>>0,!F){const ge=Math.pow(2,8*T)-1;j(this,p,x,T,ge,0)}let N=1,z=0;for(this[x]=p&255;++z<T&&(N*=256);)this[x+z]=p/N&255;return x+T},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(p,x,T,F){if(p=+p,x=x>>>0,T=T>>>0,!F){const ge=Math.pow(2,8*T)-1;j(this,p,x,T,ge,0)}let N=T-1,z=1;for(this[x+N]=p&255;--N>=0&&(z*=256);)this[x+N]=p/z&255;return x+T},f.prototype.writeUint8=f.prototype.writeUInt8=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,1,255,0),this[x]=p&255,x+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,2,65535,0),this[x]=p&255,this[x+1]=p>>>8,x+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,2,65535,0),this[x]=p>>>8,this[x+1]=p&255,x+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,4,4294967295,0),this[x+3]=p>>>24,this[x+2]=p>>>16,this[x+1]=p>>>8,this[x]=p&255,x+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,4,4294967295,0),this[x]=p>>>24,this[x+1]=p>>>16,this[x+2]=p>>>8,this[x+3]=p&255,x+4};function Q(M,p,x,T,F){K(p,T,F,M,x,7);let N=Number(p&BigInt(4294967295));M[x++]=N,N=N>>8,M[x++]=N,N=N>>8,M[x++]=N,N=N>>8,M[x++]=N;let z=Number(p>>BigInt(32)&BigInt(4294967295));return M[x++]=z,z=z>>8,M[x++]=z,z=z>>8,M[x++]=z,z=z>>8,M[x++]=z,x}function oe(M,p,x,T,F){K(p,T,F,M,x,7);let N=Number(p&BigInt(4294967295));M[x+7]=N,N=N>>8,M[x+6]=N,N=N>>8,M[x+5]=N,N=N>>8,M[x+4]=N;let z=Number(p>>BigInt(32)&BigInt(4294967295));return M[x+3]=z,z=z>>8,M[x+2]=z,z=z>>8,M[x+1]=z,z=z>>8,M[x]=z,x+8}f.prototype.writeBigUInt64LE=ce(function(p,x=0){return Q(this,p,x,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=ce(function(p,x=0){return oe(this,p,x,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(p,x,T,F){if(p=+p,x=x>>>0,!F){const Ie=Math.pow(2,8*T-1);j(this,p,x,T,Ie-1,-Ie)}let N=0,z=1,ge=0;for(this[x]=p&255;++N<T&&(z*=256);)p<0&&ge===0&&this[x+N-1]!==0&&(ge=1),this[x+N]=(p/z>>0)-ge&255;return x+T},f.prototype.writeIntBE=function(p,x,T,F){if(p=+p,x=x>>>0,!F){const Ie=Math.pow(2,8*T-1);j(this,p,x,T,Ie-1,-Ie)}let N=T-1,z=1,ge=0;for(this[x+N]=p&255;--N>=0&&(z*=256);)p<0&&ge===0&&this[x+N+1]!==0&&(ge=1),this[x+N]=(p/z>>0)-ge&255;return x+T},f.prototype.writeInt8=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,1,127,-128),p<0&&(p=255+p+1),this[x]=p&255,x+1},f.prototype.writeInt16LE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,2,32767,-32768),this[x]=p&255,this[x+1]=p>>>8,x+2},f.prototype.writeInt16BE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,2,32767,-32768),this[x]=p>>>8,this[x+1]=p&255,x+2},f.prototype.writeInt32LE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,4,2147483647,-2147483648),this[x]=p&255,this[x+1]=p>>>8,this[x+2]=p>>>16,this[x+3]=p>>>24,x+4},f.prototype.writeInt32BE=function(p,x,T){return p=+p,x=x>>>0,T||j(this,p,x,4,2147483647,-2147483648),p<0&&(p=4294967295+p+1),this[x]=p>>>24,this[x+1]=p>>>16,this[x+2]=p>>>8,this[x+3]=p&255,x+4},f.prototype.writeBigInt64LE=ce(function(p,x=0){return Q(this,p,x,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=ce(function(p,x=0){return oe(this,p,x,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ee(M,p,x,T,F,N){if(x+T>M.length)throw new RangeError("Index out of range");if(x<0)throw new RangeError("Index out of range")}function me(M,p,x,T,F){return p=+p,x=x>>>0,F||Ee(M,p,x,4),e.write(M,p,x,T,23,4),x+4}f.prototype.writeFloatLE=function(p,x,T){return me(this,p,x,!0,T)},f.prototype.writeFloatBE=function(p,x,T){return me(this,p,x,!1,T)};function be(M,p,x,T,F){return p=+p,x=x>>>0,F||Ee(M,p,x,8),e.write(M,p,x,T,52,8),x+8}f.prototype.writeDoubleLE=function(p,x,T){return be(this,p,x,!0,T)},f.prototype.writeDoubleBE=function(p,x,T){return be(this,p,x,!1,T)},f.prototype.copy=function(p,x,T,F){if(!f.isBuffer(p))throw new TypeError("argument should be a Buffer");if(T||(T=0),!F&&F!==0&&(F=this.length),x>=p.length&&(x=p.length),x||(x=0),F>0&&F<T&&(F=T),F===T||p.length===0||this.length===0)return 0;if(x<0)throw new RangeError("targetStart out of bounds");if(T<0||T>=this.length)throw new RangeError("Index out of range");if(F<0)throw new RangeError("sourceEnd out of bounds");F>this.length&&(F=this.length),p.length-x<F-T&&(F=p.length-x+T);const N=F-T;return this===p&&typeof s.prototype.copyWithin=="function"?this.copyWithin(x,T,F):s.prototype.set.call(p,this.subarray(T,F),x),N},f.prototype.fill=function(p,x,T,F){if(typeof p=="string"){if(typeof x=="string"?(F=x,x=0,T=this.length):typeof T=="string"&&(F=T,T=this.length),F!==void 0&&typeof F!="string")throw new TypeError("encoding must be a string");if(typeof F=="string"&&!f.isEncoding(F))throw new TypeError("Unknown encoding: "+F);if(p.length===1){const z=p.charCodeAt(0);(F==="utf8"&&z<128||F==="latin1")&&(p=z)}}else typeof p=="number"?p=p&255:typeof p=="boolean"&&(p=Number(p));if(x<0||this.length<x||this.length<T)throw new RangeError("Out of range index");if(T<=x)return this;x=x>>>0,T=T===void 0?this.length:T>>>0,p||(p=0);let N;if(typeof p=="number")for(N=x;N<T;++N)this[N]=p;else{const z=f.isBuffer(p)?p:f.from(p,F),ge=z.length;if(ge===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for(N=0;N<T-x;++N)this[N+x]=z[N%ge]}return this};const we={};function Ae(M,p,x){we[M]=class extends x{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${M}]`,this.stack,delete this.name}get code(){return M}set code(F){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:F,writable:!0})}toString(){return`${this.name} [${M}]: ${this.message}`}}}Ae("ERR_BUFFER_OUT_OF_BOUNDS",function(M){return M?`${M} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ae("ERR_INVALID_ARG_TYPE",function(M,p){return`The "${M}" argument must be of type number. Received type ${typeof p}`},TypeError),Ae("ERR_OUT_OF_RANGE",function(M,p,x){let T=`The value of "${M}" is out of range.`,F=x;return Number.isInteger(x)&&Math.abs(x)>2**32?F=Me(String(x)):typeof x=="bigint"&&(F=String(x),(x>BigInt(2)**BigInt(32)||x<-(BigInt(2)**BigInt(32)))&&(F=Me(F)),F+="n"),T+=` It must be ${p}. Received ${F}`,T},RangeError);function Me(M){let p="",x=M.length;const T=M[0]==="-"?1:0;for(;x>=T+4;x-=3)p=`_${M.slice(x-3,x)}${p}`;return`${M.slice(0,x)}${p}`}function ie(M,p,x){_e(p,"offset"),(M[p]===void 0||M[p+x]===void 0)&&pe(p,M.length-(x+1))}function K(M,p,x,T,F,N){if(M>x||M<p){const z=typeof p=="bigint"?"n":"";let ge;throw p===0||p===BigInt(0)?ge=`>= 0${z} and < 2${z} ** ${(N+1)*8}${z}`:ge=`>= -(2${z} ** ${(N+1)*8-1}${z}) and < 2 ** ${(N+1)*8-1}${z}`,new we.ERR_OUT_OF_RANGE("value",ge,M)}ie(T,F,N)}function _e(M,p){if(typeof M!="number")throw new we.ERR_INVALID_ARG_TYPE(p,"number",M)}function pe(M,p,x){throw Math.floor(M)!==M?(_e(M,x),new we.ERR_OUT_OF_RANGE("offset","an integer",M)):p<0?new we.ERR_BUFFER_OUT_OF_BOUNDS:new we.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${p}`,M)}const ve=/[^+/0-9A-Za-z-_]/g;function U(M){if(M=M.split("=")[0],M=M.trim().replace(ve,""),M.length<2)return"";for(;M.length%4!==0;)M=M+"=";return M}function le(M,p){p=p||1/0;let x;const T=M.length;let F=null;const N=[];for(let z=0;z<T;++z){if(x=M.charCodeAt(z),x>55295&&x<57344){if(!F){if(x>56319){(p-=3)>-1&&N.push(239,191,189);continue}else if(z+1===T){(p-=3)>-1&&N.push(239,191,189);continue}F=x;continue}if(x<56320){(p-=3)>-1&&N.push(239,191,189),F=x;continue}x=(F-55296<<10|x-56320)+65536}else F&&(p-=3)>-1&&N.push(239,191,189);if(F=null,x<128){if((p-=1)<0)break;N.push(x)}else if(x<2048){if((p-=2)<0)break;N.push(x>>6|192,x&63|128)}else if(x<65536){if((p-=3)<0)break;N.push(x>>12|224,x>>6&63|128,x&63|128)}else if(x<1114112){if((p-=4)<0)break;N.push(x>>18|240,x>>12&63|128,x>>6&63|128,x&63|128)}else throw new Error("Invalid code point")}return N}function ue(M){const p=[];for(let x=0;x<M.length;++x)p.push(M.charCodeAt(x)&255);return p}function xe(M,p){let x,T,F;const N=[];for(let z=0;z<M.length&&!((p-=2)<0);++z)x=M.charCodeAt(z),T=x>>8,F=x%256,N.push(F),N.push(T);return N}function H(M){return r.toByteArray(U(M))}function Se(M,p,x,T){let F;for(F=0;F<T&&!(F+x>=p.length||F>=M.length);++F)p[F+x]=M[F];return F}function ye(M,p){return M instanceof p||M!=null&&M.constructor!=null&&M.constructor.name!=null&&M.constructor.name===p.name}function ee(M){return M!==M}const ae=function(){const M="0123456789abcdef",p=new Array(256);for(let x=0;x<16;++x){const T=x*16;for(let F=0;F<16;++F)p[T+F]=M[x]+M[F]}return p}();function ce(M){return typeof BigInt>"u"?ne:M}function ne(){throw new Error("BigInt not supported")}})(buffer);const Buffer=buffer.Buffer;var encoder={exports:{}};(function(t){function r(n){var o=Math.floor,s=new Array(64),a=new Array(64),l=new Array(64),c=new Array(64),h,f,u,d,g=new Array(65535),m=new Array(65535),y=new Array(64),_=new Array(64),w=[],S=0,v=7,b=new Array(64),k=new Array(64),C=new Array(64),R=new Array(256),A=new Array(2048),$,E=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],I=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],B=[0,1,2,3,4,5,6,7,8,9,10,11],P=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Y=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],V=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],J=[0,1,2,3,4,5,6,7,8,9,10,11],re=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],q=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function se(U){for(var le=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ue=0;ue<64;ue++){var xe=o((le[ue]*U+50)/100);xe<1?xe=1:xe>255&&(xe=255),s[E[ue]]=xe}for(var H=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Se=0;Se<64;Se++){var ye=o((H[Se]*U+50)/100);ye<1?ye=1:ye>255&&(ye=255),a[E[Se]]=ye}for(var ee=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ae=0,ce=0;ce<8;ce++)for(var ne=0;ne<8;ne++)l[ae]=1/(s[E[ae]]*ee[ce]*ee[ne]*8),c[ae]=1/(a[E[ae]]*ee[ce]*ee[ne]*8),ae++}function W(U,le){for(var ue=0,xe=0,H=new Array,Se=1;Se<=16;Se++){for(var ye=1;ye<=U[Se];ye++)H[le[xe]]=[],H[le[xe]][0]=ue,H[le[xe]][1]=Se,xe++,ue++;ue*=2}return H}function de(){h=W(I,B),f=W(V,J),u=W(P,Y),d=W(re,q)}function fe(){for(var U=1,le=2,ue=1;ue<=15;ue++){for(var xe=U;xe<le;xe++)m[32767+xe]=ue,g[32767+xe]=[],g[32767+xe][1]=ue,g[32767+xe][0]=xe;for(var H=-(le-1);H<=-U;H++)m[32767+H]=ue,g[32767+H]=[],g[32767+H][1]=ue,g[32767+H][0]=le-1+H;U<<=1,le<<=1}}function Z(){for(var U=0;U<256;U++)A[U]=19595*U,A[U+256>>0]=38470*U,A[U+512>>0]=7471*U+32768,A[U+768>>0]=-11059*U,A[U+1024>>0]=-21709*U,A[U+1280>>0]=32768*U+8421375,A[U+1536>>0]=-27439*U,A[U+1792>>0]=-5329*U}function X(U){for(var le=U[0],ue=U[1]-1;ue>=0;)le&1<<ue&&(S|=1<<v),ue--,v--,v<0&&(S==255?(j(255),j(0)):j(S),v=7,S=0)}function j(U){w.push(U)}function Q(U){j(U>>8&255),j(U&255)}function oe(U,le){var ue,xe,H,Se,ye,ee,ae,ce,ne=0,M,p=8,x=64;for(M=0;M<p;++M){ue=U[ne],xe=U[ne+1],H=U[ne+2],Se=U[ne+3],ye=U[ne+4],ee=U[ne+5],ae=U[ne+6],ce=U[ne+7];var T=ue+ce,F=ue-ce,N=xe+ae,z=xe-ae,ge=H+ee,Ie=H-ee,Te=Se+ye,De=Se-ye,ke=T+Te,Ge=T-Te,je=N+ge,ze=N-ge;U[ne]=ke+je,U[ne+4]=ke-je;var Ke=(ze+Ge)*.707106781;U[ne+2]=Ge+Ke,U[ne+6]=Ge-Ke,ke=De+Ie,je=Ie+z,ze=z+F;var Ze=(ke-ze)*.382683433,D=.5411961*ke+Ze,O=1.306562965*ze+Ze,L=je*.707106781,G=F+L,te=F-L;U[ne+5]=te+D,U[ne+3]=te-D,U[ne+1]=G+O,U[ne+7]=G-O,ne+=8}for(ne=0,M=0;M<p;++M){ue=U[ne],xe=U[ne+8],H=U[ne+16],Se=U[ne+24],ye=U[ne+32],ee=U[ne+40],ae=U[ne+48],ce=U[ne+56];var he=ue+ce,Re=ue-ce,$e=xe+ae,Be=xe-ae,Oe=H+ee,Je=H-ee,Fe=Se+ye,He=Se-ye,Pe=he+Fe,Ue=he-Fe,Ne=$e+Oe,Xe=$e-Oe;U[ne]=Pe+Ne,U[ne+32]=Pe-Ne;var Qe=(Xe+Ue)*.707106781;U[ne+16]=Ue+Qe,U[ne+48]=Ue-Qe,Pe=He+Je,Ne=Je+Be,Xe=Be+Re;var Ve=(Pe-Xe)*.382683433,tt=.5411961*Pe+Ve,lt=1.306562965*Xe+Ve,ht=Ne*.707106781,ct=Re+ht,ft=Re-ht;U[ne+40]=ft+tt,U[ne+24]=ft-tt,U[ne+8]=ct+lt,U[ne+56]=ct-lt,ne++}var rt;for(M=0;M<x;++M)rt=U[M]*le[M],y[M]=rt>0?rt+.5|0:rt-.5|0;return y}function Ee(){Q(65504),Q(16),j(74),j(70),j(73),j(70),j(0),j(1),j(1),j(0),Q(1),Q(1),j(0),j(0)}function me(U){if(U){Q(65505),U[0]===69&&U[1]===120&&U[2]===105&&U[3]===102?Q(U.length+2):(Q(U.length+5+2),j(69),j(120),j(105),j(102),j(0));for(var le=0;le<U.length;le++)j(U[le])}}function be(U,le){Q(65472),Q(17),j(8),Q(le),Q(U),j(3),j(1),j(17),j(0),j(2),j(17),j(1),j(3),j(17),j(1)}function we(){Q(65499),Q(132),j(0);for(var U=0;U<64;U++)j(s[U]);j(1);for(var le=0;le<64;le++)j(a[le])}function Ae(){Q(65476),Q(418),j(0);for(var U=0;U<16;U++)j(I[U+1]);for(var le=0;le<=11;le++)j(B[le]);j(16);for(var ue=0;ue<16;ue++)j(P[ue+1]);for(var xe=0;xe<=161;xe++)j(Y[xe]);j(1);for(var H=0;H<16;H++)j(V[H+1]);for(var Se=0;Se<=11;Se++)j(J[Se]);j(17);for(var ye=0;ye<16;ye++)j(re[ye+1]);for(var ee=0;ee<=161;ee++)j(q[ee])}function Me(U){typeof U>"u"||U.constructor!==Array||U.forEach(le=>{if(typeof le=="string"){Q(65534);var ue=le.length;Q(ue+2);var xe;for(xe=0;xe<ue;xe++)j(le.charCodeAt(xe))}})}function ie(){Q(65498),Q(12),j(3),j(1),j(0),j(2),j(17),j(3),j(17),j(0),j(63),j(0)}function K(U,le,ue,xe,H){for(var Se=H[0],ye=H[240],ee,ae=16,ce=63,ne=64,M=oe(U,le),p=0;p<ne;++p)_[E[p]]=M[p];var x=_[0]-ue;ue=_[0],x==0?X(xe[0]):(ee=32767+x,X(xe[m[ee]]),X(g[ee]));for(var T=63;T>0&&_[T]==0;T--);if(T==0)return X(Se),ue;for(var F=1,N;F<=T;){for(var z=F;_[F]==0&&F<=T;++F);var ge=F-z;if(ge>=ae){N=ge>>4;for(var Ie=1;Ie<=N;++Ie)X(ye);ge=ge&15}ee=32767+_[F],X(H[(ge<<4)+m[ee]]),X(g[ee]),F++}return T!=ce&&X(Se),ue}function _e(){for(var U=String.fromCharCode,le=0;le<256;le++)R[le]=U(le)}this.encode=function(U,le){new Date().getTime(),le&&pe(le),w=new Array,S=0,v=7,Q(65496),Ee(),Me(U.comments),me(U.exifBuffer),we(),be(U.width,U.height),Ae(),ie();var ue=0,xe=0,H=0;S=0,v=7,this.encode.displayName="_encode_";for(var Se=U.data,ye=U.width,ee=U.height,ae=ye*4,ce,ne=0,M,p,x,T,F,N,z,ge;ne<ee;){for(ce=0;ce<ae;){for(T=ae*ne+ce,F=T,N=-1,z=0,ge=0;ge<64;ge++)z=ge>>3,N=(ge&7)*4,F=T+z*ae+N,ne+z>=ee&&(F-=ae*(ne+1+z-ee)),ce+N>=ae&&(F-=ce+N-ae+4),M=Se[F++],p=Se[F++],x=Se[F++],b[ge]=(A[M]+A[p+256>>0]+A[x+512>>0]>>16)-128,k[ge]=(A[M+768>>0]+A[p+1024>>0]+A[x+1280>>0]>>16)-128,C[ge]=(A[M+1280>>0]+A[p+1536>>0]+A[x+1792>>0]>>16)-128;ue=K(b,l,ue,h,u),xe=K(k,c,xe,f,d),H=K(C,c,H,f,d),ce+=32}ne+=8}if(v>=0){var Ie=[];Ie[1]=v+1,Ie[0]=(1<<v+1)-1,X(Ie)}return Q(65497),Buffer.from(w)};function pe(U){if(U<=0&&(U=1),U>100&&(U=100),$!=U){var le=0;U<50?le=Math.floor(5e3/U):le=Math.floor(200-U*2),se(le),$=U}}function ve(){var U=new Date().getTime();n||(n=50),_e(),de(),fe(),Z(),pe(n),new Date().getTime()-U}ve()}t.exports=e;function e(n,o){typeof o>"u"&&(o=50);var s=new r(o),a=s.encode(n,o);return{data:a,width:n.width,height:n.height}}})(encoder);var encoderExports=encoder.exports,decoder={exports:{}};(function(t){var r=function(){var o=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),s=4017,a=799,l=3406,c=2276,h=1567,f=3784,u=5793,d=2896;function g(){}function m(k,C){for(var R=0,A=[],$,E,I=16;I>0&&!k[I-1];)I--;A.push({children:[],index:0});var B=A[0],P;for($=0;$<I;$++){for(E=0;E<k[$];E++){for(B=A.pop(),B.children[B.index]=C[R];B.index>0;){if(A.length===0)throw new Error("Could not recreate Huffman Table");B=A.pop()}for(B.index++,A.push(B);A.length<=$;)A.push(P={children:[],index:0}),B.children[B.index]=P.children,B=P;R++}$+1<I&&(A.push(P={children:[],index:0}),B.children[B.index]=P.children,B=P)}return A[0].children}function y(k,C,R,A,$,E,I,B,P,Y){R.precision,R.samplesPerLine,R.scanLines;var V=R.mcusPerLine,J=R.progressive;R.maxH,R.maxV;var re=C,q=0,se=0;function W(){if(se>0)return se--,q>>se&1;if(q=k[C++],q==255){var ee=k[C++];if(ee)throw new Error("unexpected marker: "+(q<<8|ee).toString(16))}return se=7,q>>>7}function de(ee){for(var ae=ee,ce;(ce=W())!==null;){if(ae=ae[ce],typeof ae=="number")return ae;if(typeof ae!="object")throw new Error("invalid huffman sequence")}return null}function fe(ee){for(var ae=0;ee>0;){var ce=W();if(ce===null)return;ae=ae<<1|ce,ee--}return ae}function Z(ee){var ae=fe(ee);return ae>=1<<ee-1?ae:ae+(-1<<ee)+1}function X(ee,ae){var ce=de(ee.huffmanTableDC),ne=ce===0?0:Z(ce);ae[0]=ee.pred+=ne;for(var M=1;M<64;){var p=de(ee.huffmanTableAC),x=p&15,T=p>>4;if(x===0){if(T<15)break;M+=16;continue}M+=T;var F=o[M];ae[F]=Z(x),M++}}function j(ee,ae){var ce=de(ee.huffmanTableDC),ne=ce===0?0:Z(ce)<<P;ae[0]=ee.pred+=ne}function Q(ee,ae){ae[0]|=W()<<P}var oe=0;function Ee(ee,ae){if(oe>0){oe--;return}for(var ce=E,ne=I;ce<=ne;){var M=de(ee.huffmanTableAC),p=M&15,x=M>>4;if(p===0){if(x<15){oe=fe(x)+(1<<x)-1;break}ce+=16;continue}ce+=x;var T=o[ce];ae[T]=Z(p)*(1<<P),ce++}}var me=0,be;function we(ee,ae){for(var ce=E,ne=I,M=0;ce<=ne;){var p=o[ce],x=ae[p]<0?-1:1;switch(me){case 0:var T=de(ee.huffmanTableAC),F=T&15,M=T>>4;if(F===0)M<15?(oe=fe(M)+(1<<M),me=4):(M=16,me=1);else{if(F!==1)throw new Error("invalid ACn encoding");be=Z(F),me=M?2:3}continue;case 1:case 2:ae[p]?ae[p]+=(W()<<P)*x:(M--,M===0&&(me=me==2?3:0));break;case 3:ae[p]?ae[p]+=(W()<<P)*x:(ae[p]=be<<P,me=0);break;case 4:ae[p]&&(ae[p]+=(W()<<P)*x);break}ce++}me===4&&(oe--,oe===0&&(me=0))}function Ae(ee,ae,ce,ne,M){var p=ce/V|0,x=ce%V,T=p*ee.v+ne,F=x*ee.h+M;ee.blocks[T]===void 0&&Y.tolerantDecoding||ae(ee,ee.blocks[T][F])}function Me(ee,ae,ce){var ne=ce/ee.blocksPerLine|0,M=ce%ee.blocksPerLine;ee.blocks[ne]===void 0&&Y.tolerantDecoding||ae(ee,ee.blocks[ne][M])}var ie=A.length,K,_e,pe,ve,U,le;J?E===0?le=B===0?j:Q:le=B===0?Ee:we:le=X;var ue=0,xe,H;ie==1?H=A[0].blocksPerLine*A[0].blocksPerColumn:H=V*R.mcusPerColumn,$||($=H);for(var Se,ye;ue<H;){for(_e=0;_e<ie;_e++)A[_e].pred=0;if(oe=0,ie==1)for(K=A[0],U=0;U<$;U++)Me(K,le,ue),ue++;else for(U=0;U<$;U++){for(_e=0;_e<ie;_e++)for(K=A[_e],Se=K.h,ye=K.v,pe=0;pe<ye;pe++)for(ve=0;ve<Se;ve++)Ae(K,le,ue,pe,ve);if(ue++,ue===H)break}if(ue===H)do{if(k[C]===255&&k[C+1]!==0)break;C+=1}while(C<k.length-2);if(se=0,xe=k[C]<<8|k[C+1],xe<65280)throw new Error("marker was not found");if(xe>=65488&&xe<=65495)C+=2;else break}return C-re}function _(k,C){var R=[],A=C.blocksPerLine,$=C.blocksPerColumn,E=A<<3,I=new Int32Array(64),B=new Uint8Array(64);function P(fe,Z,X){var j=C.quantizationTable,Q,oe,Ee,me,be,we,Ae,Me,ie,K=X,_e;for(_e=0;_e<64;_e++)K[_e]=fe[_e]*j[_e];for(_e=0;_e<8;++_e){var pe=8*_e;if(K[1+pe]==0&&K[2+pe]==0&&K[3+pe]==0&&K[4+pe]==0&&K[5+pe]==0&&K[6+pe]==0&&K[7+pe]==0){ie=u*K[0+pe]+512>>10,K[0+pe]=ie,K[1+pe]=ie,K[2+pe]=ie,K[3+pe]=ie,K[4+pe]=ie,K[5+pe]=ie,K[6+pe]=ie,K[7+pe]=ie;continue}Q=u*K[0+pe]+128>>8,oe=u*K[4+pe]+128>>8,Ee=K[2+pe],me=K[6+pe],be=d*(K[1+pe]-K[7+pe])+128>>8,Me=d*(K[1+pe]+K[7+pe])+128>>8,we=K[3+pe]<<4,Ae=K[5+pe]<<4,ie=Q-oe+1>>1,Q=Q+oe+1>>1,oe=ie,ie=Ee*f+me*h+128>>8,Ee=Ee*h-me*f+128>>8,me=ie,ie=be-Ae+1>>1,be=be+Ae+1>>1,Ae=ie,ie=Me+we+1>>1,we=Me-we+1>>1,Me=ie,ie=Q-me+1>>1,Q=Q+me+1>>1,me=ie,ie=oe-Ee+1>>1,oe=oe+Ee+1>>1,Ee=ie,ie=be*c+Me*l+2048>>12,be=be*l-Me*c+2048>>12,Me=ie,ie=we*a+Ae*s+2048>>12,we=we*s-Ae*a+2048>>12,Ae=ie,K[0+pe]=Q+Me,K[7+pe]=Q-Me,K[1+pe]=oe+Ae,K[6+pe]=oe-Ae,K[2+pe]=Ee+we,K[5+pe]=Ee-we,K[3+pe]=me+be,K[4+pe]=me-be}for(_e=0;_e<8;++_e){var ve=_e;if(K[8+ve]==0&&K[16+ve]==0&&K[24+ve]==0&&K[32+ve]==0&&K[40+ve]==0&&K[48+ve]==0&&K[56+ve]==0){ie=u*X[_e+0]+8192>>14,K[0+ve]=ie,K[8+ve]=ie,K[16+ve]=ie,K[24+ve]=ie,K[32+ve]=ie,K[40+ve]=ie,K[48+ve]=ie,K[56+ve]=ie;continue}Q=u*K[0+ve]+2048>>12,oe=u*K[32+ve]+2048>>12,Ee=K[16+ve],me=K[48+ve],be=d*(K[8+ve]-K[56+ve])+2048>>12,Me=d*(K[8+ve]+K[56+ve])+2048>>12,we=K[24+ve],Ae=K[40+ve],ie=Q-oe+1>>1,Q=Q+oe+1>>1,oe=ie,ie=Ee*f+me*h+2048>>12,Ee=Ee*h-me*f+2048>>12,me=ie,ie=be-Ae+1>>1,be=be+Ae+1>>1,Ae=ie,ie=Me+we+1>>1,we=Me-we+1>>1,Me=ie,ie=Q-me+1>>1,Q=Q+me+1>>1,me=ie,ie=oe-Ee+1>>1,oe=oe+Ee+1>>1,Ee=ie,ie=be*c+Me*l+2048>>12,be=be*l-Me*c+2048>>12,Me=ie,ie=we*a+Ae*s+2048>>12,we=we*s-Ae*a+2048>>12,Ae=ie,K[0+ve]=Q+Me,K[56+ve]=Q-Me,K[8+ve]=oe+Ae,K[48+ve]=oe-Ae,K[16+ve]=Ee+we,K[40+ve]=Ee-we,K[24+ve]=me+be,K[32+ve]=me-be}for(_e=0;_e<64;++_e){var U=128+(K[_e]+8>>4);Z[_e]=U<0?0:U>255?255:U}}b(E*$*8);for(var Y,V,J=0;J<$;J++){var re=J<<3;for(Y=0;Y<8;Y++)R.push(new Uint8Array(E));for(var q=0;q<A;q++){P(C.blocks[J][q],B,I);var se=0,W=q<<3;for(V=0;V<8;V++){var de=R[re+V];for(Y=0;Y<8;Y++)de[W+Y]=B[se++]}}}return R}function w(k){return k<0?0:k>255?255:k}g.prototype={load:function(C){var R=new XMLHttpRequest;R.open("GET",C,!0),R.responseType="arraybuffer",R.onload=(function(){var A=new Uint8Array(R.response||R.mozResponseArrayBuffer);this.parse(A),this.onload&&this.onload()}).bind(this),R.send(null)},parse:function(C){var R=this.opts.maxResolutionInMP*1e3*1e3,A=0;C.length;function $(){var x=C[A]<<8|C[A+1];return A+=2,x}function E(){var x=$(),T=C.subarray(A,A+x-2);return A+=T.length,T}function I(x){var T=1,F=1,N,z;for(z in x.components)x.components.hasOwnProperty(z)&&(N=x.components[z],T<N.h&&(T=N.h),F<N.v&&(F=N.v));var ge=Math.ceil(x.samplesPerLine/8/T),Ie=Math.ceil(x.scanLines/8/F);for(z in x.components)if(x.components.hasOwnProperty(z)){N=x.components[z];var Te=Math.ceil(Math.ceil(x.samplesPerLine/8)*N.h/T),De=Math.ceil(Math.ceil(x.scanLines/8)*N.v/F),ke=ge*N.h,Ge=Ie*N.v,je=Ge*ke,ze=[];b(je*256);for(var Ke=0;Ke<Ge;Ke++){for(var Ze=[],D=0;D<ke;D++)Ze.push(new Int32Array(64));ze.push(Ze)}N.blocksPerLine=Te,N.blocksPerColumn=De,N.blocks=ze}x.maxH=T,x.maxV=F,x.mcusPerLine=ge,x.mcusPerColumn=Ie}var B=null,P=null,Y,V,J=[],re=[],q=[],se=[],W=$(),de=-1;if(this.comments=[],W!=65496)throw new Error("SOI not found");for(W=$();W!=65497;){var fe,Z;switch(W){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var X=E();if(W===65534){var j=String.fromCharCode.apply(null,X);this.comments.push(j)}W===65504&&X[0]===74&&X[1]===70&&X[2]===73&&X[3]===70&&X[4]===0&&(B={version:{major:X[5],minor:X[6]},densityUnits:X[7],xDensity:X[8]<<8|X[9],yDensity:X[10]<<8|X[11],thumbWidth:X[12],thumbHeight:X[13],thumbData:X.subarray(14,14+3*X[12]*X[13])}),W===65505&&X[0]===69&&X[1]===120&&X[2]===105&&X[3]===102&&X[4]===0&&(this.exifBuffer=X.subarray(5,X.length)),W===65518&&X[0]===65&&X[1]===100&&X[2]===111&&X[3]===98&&X[4]===101&&X[5]===0&&(P={version:X[6],flags0:X[7]<<8|X[8],flags1:X[9]<<8|X[10],transformCode:X[11]});break;case 65499:for(var Q=$(),oe=Q+A-2;A<oe;){var Ee=C[A++];b(256);var me=new Int32Array(64);if(Ee>>4)if(Ee>>4===1)for(Z=0;Z<64;Z++){var be=o[Z];me[be]=$()}else throw new Error("DQT: invalid table spec");else for(Z=0;Z<64;Z++){var be=o[Z];me[be]=C[A++]}J[Ee&15]=me}break;case 65472:case 65473:case 65474:$(),Y={},Y.extended=W===65473,Y.progressive=W===65474,Y.precision=C[A++],Y.scanLines=$(),Y.samplesPerLine=$(),Y.components={},Y.componentsOrder=[];var we=Y.scanLines*Y.samplesPerLine;if(we>R){var Ae=Math.ceil((we-R)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Ae}MP`)}var Me=C[A++],ie;for(fe=0;fe<Me;fe++){ie=C[A];var K=C[A+1]>>4,_e=C[A+1]&15,pe=C[A+2];if(K<=0||_e<=0)throw new Error("Invalid sampling factor, expected values above 0");Y.componentsOrder.push(ie),Y.components[ie]={h:K,v:_e,quantizationIdx:pe},A+=3}I(Y),re.push(Y);break;case 65476:var ve=$();for(fe=2;fe<ve;){var U=C[A++],le=new Uint8Array(16),ue=0;for(Z=0;Z<16;Z++,A++)ue+=le[Z]=C[A];b(16+ue);var xe=new Uint8Array(ue);for(Z=0;Z<ue;Z++,A++)xe[Z]=C[A];fe+=17+ue,(U>>4?q:se)[U&15]=m(le,xe)}break;case 65501:$(),V=$();break;case 65500:$(),$();break;case 65498:$();var H=C[A++],Se=[],ye;for(fe=0;fe<H;fe++){ye=Y.components[C[A++]];var ee=C[A++];ye.huffmanTableDC=se[ee>>4],ye.huffmanTableAC=q[ee&15],Se.push(ye)}var ae=C[A++],ce=C[A++],ne=C[A++],M=y(C,A,Y,Se,V,ae,ce,ne>>4,ne&15,this.opts);A+=M;break;case 65535:C[A]!==255&&A--;break;default:if(C[A-3]==255&&C[A-2]>=192&&C[A-2]<=254){A-=3;break}else if(W===224||W==225){if(de!==-1)throw new Error(`first unknown JPEG marker at offset ${de.toString(16)}, second unknown JPEG marker ${W.toString(16)} at offset ${(A-1).toString(16)}`);de=A-1;const x=$();if(C[A+x-2]===255){A+=x-2;break}}throw new Error("unknown JPEG marker "+W.toString(16))}W=$()}if(re.length!=1)throw new Error("only single frame JPEGs supported");for(var fe=0;fe<re.length;fe++){var p=re[fe].components;for(var Z in p)p[Z].quantizationTable=J[p[Z].quantizationIdx],delete p[Z].quantizationIdx}this.width=Y.samplesPerLine,this.height=Y.scanLines,this.jfif=B,this.adobe=P,this.components=[];for(var fe=0;fe<Y.componentsOrder.length;fe++){var ye=Y.components[Y.componentsOrder[fe]];this.components.push({lines:_(Y,ye),scaleX:ye.h/Y.maxH,scaleY:ye.v/Y.maxV})}},getData:function(C,R){var A=this.width/C,$=this.height/R,E,I,B,P,Y,V,J,re,q,se,W=0,de,fe,Z,X,j,Q,oe,Ee,me,be,we,Ae=C*R*this.components.length;b(Ae);var Me=new Uint8Array(Ae);switch(this.components.length){case 1:for(E=this.components[0],se=0;se<R;se++)for(Y=E.lines[0|se*E.scaleY*$],q=0;q<C;q++)de=Y[0|q*E.scaleX*A],Me[W++]=de;break;case 2:for(E=this.components[0],I=this.components[1],se=0;se<R;se++)for(Y=E.lines[0|se*E.scaleY*$],V=I.lines[0|se*I.scaleY*$],q=0;q<C;q++)de=Y[0|q*E.scaleX*A],Me[W++]=de,de=V[0|q*I.scaleX*A],Me[W++]=de;break;case 3:for(we=!0,this.adobe&&this.adobe.transformCode?we=!0:typeof this.opts.colorTransform<"u"&&(we=!!this.opts.colorTransform),E=this.components[0],I=this.components[1],B=this.components[2],se=0;se<R;se++)for(Y=E.lines[0|se*E.scaleY*$],V=I.lines[0|se*I.scaleY*$],J=B.lines[0|se*B.scaleY*$],q=0;q<C;q++)we?(de=Y[0|q*E.scaleX*A],fe=V[0|q*I.scaleX*A],Z=J[0|q*B.scaleX*A],Ee=w(de+1.402*(Z-128)),me=w(de-.3441363*(fe-128)-.71413636*(Z-128)),be=w(de+1.772*(fe-128))):(Ee=Y[0|q*E.scaleX*A],me=V[0|q*I.scaleX*A],be=J[0|q*B.scaleX*A]),Me[W++]=Ee,Me[W++]=me,Me[W++]=be;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(we=!1,this.adobe&&this.adobe.transformCode?we=!0:typeof this.opts.colorTransform<"u"&&(we=!!this.opts.colorTransform),E=this.components[0],I=this.components[1],B=this.components[2],P=this.components[3],se=0;se<R;se++)for(Y=E.lines[0|se*E.scaleY*$],V=I.lines[0|se*I.scaleY*$],J=B.lines[0|se*B.scaleY*$],re=P.lines[0|se*P.scaleY*$],q=0;q<C;q++)we?(de=Y[0|q*E.scaleX*A],fe=V[0|q*I.scaleX*A],Z=J[0|q*B.scaleX*A],X=re[0|q*P.scaleX*A],j=255-w(de+1.402*(Z-128)),Q=255-w(de-.3441363*(fe-128)-.71413636*(Z-128)),oe=255-w(de+1.772*(fe-128))):(j=Y[0|q*E.scaleX*A],Q=V[0|q*I.scaleX*A],oe=J[0|q*B.scaleX*A],X=re[0|q*P.scaleX*A]),Me[W++]=255-j,Me[W++]=255-Q,Me[W++]=255-oe,Me[W++]=255-X;break;default:throw new Error("Unsupported color mode")}return Me},copyToImageData:function(C,R){var A=C.width,$=C.height,E=C.data,I=this.getData(A,$),B=0,P=0,Y,V,J,re,q,se,W,de,fe;switch(this.components.length){case 1:for(V=0;V<$;V++)for(Y=0;Y<A;Y++)J=I[B++],E[P++]=J,E[P++]=J,E[P++]=J,R&&(E[P++]=255);break;case 3:for(V=0;V<$;V++)for(Y=0;Y<A;Y++)W=I[B++],de=I[B++],fe=I[B++],E[P++]=W,E[P++]=de,E[P++]=fe,R&&(E[P++]=255);break;case 4:for(V=0;V<$;V++)for(Y=0;Y<A;Y++)q=I[B++],se=I[B++],J=I[B++],re=I[B++],W=255-w(q*(1-re/255)+re),de=255-w(se*(1-re/255)+re),fe=255-w(J*(1-re/255)+re),E[P++]=W,E[P++]=de,E[P++]=fe,R&&(E[P++]=255);break;default:throw new Error("Unsupported color mode")}}};var S=0,v=0;function b(k=0){var C=S+k;if(C>v){var R=Math.ceil((C-v)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${R}MB`)}S=C}return g.resetMaxMemoryUsage=function(k){S=0,v=k},g.getBytesAllocated=function(){return S},g.requestMemoryAllocation=b,g}();t.exports=e;function e(n,o={}){var s={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},a={...s,...o},l=new Uint8Array(n),c=new r;c.opts=a,r.resetMaxMemoryUsage(a.maxMemoryUsageInMB*1024*1024),c.parse(l);var h=a.formatAsRGBA?4:3,f=c.width*c.height*h;try{r.requestMemoryAllocation(f);var u={width:c.width,height:c.height,exifBuffer:c.exifBuffer,data:a.useTArray?new Uint8Array(f):Buffer.alloc(f)};c.comments.length>0&&(u.comments=c.comments)}catch(d){throw d instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+f):d instanceof ReferenceError&&d.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):d}return c.copyToImageData(u,a.formatAsRGBA),u}})(decoder);var decoderExports=decoder.exports,encode$1=encoderExports,decode$4=decoderExports,jpegJs={encode:encode$1,decode:decode$4};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let t=0;t<chars.length;t++)lookup[chars.charCodeAt(t)]=t;function encode(t){let r,e=t.length,n="";for(r=0;r<e;r+=3)n+=chars[t[r]>>2],n+=chars[(t[r]&3)<<4|t[r+1]>>4],n+=chars[(t[r+1]&15)<<2|t[r+2]>>6],n+=chars[t[r+2]&63];return e%3===2?n=`${n.substring(0,n.length-1)}=`:e%3===1&&(n=`${n.substring(0,n.length-2)}==`),n}function decode$3(t){let r=t.length*.75,e=t.length,n=0,o,s,a,l;t[t.length-1]==="="&&(r--,t[t.length-2]==="="&&r--);const c=new Uint8Array(r);for(let h=0;h<e;h+=4)o=lookup[t.charCodeAt(h)],s=lookup[t.charCodeAt(h+1)],a=lookup[t.charCodeAt(h+2)],l=lookup[t.charCodeAt(h+3)],c[n++]=o<<2|s>>4,c[n++]=(s&15)<<4|a>>2,c[n++]=(a&3)<<6|l&63;return c}function toBase64URL(t,r){const e=encode(t);return`data:${r};base64,${e}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(t,r){let e=self.document.createElement("canvas");return e.width=t,e.height=r,e}function fetchBinary(t,{withCredentials:r=!1}={}){return new Promise(function(e,n){let o=new self.XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.withCredentials=r,o.onload=function(s){this.status!==200?n(s):e(this.response)},o.onerror=n,o.send()})}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(t){return t.includes("/")||(t=`image/${t}`),t}function encodeJpeg(t,r={}){const e={width:t.width,height:t.height,data:t.getRGBAData()};return jpegJs.encode(e,r.quality).data}function encodePng(t,r){const e={width:t.width,height:t.height,channels:t.channels,depth:t.bitDepth,data:t.data};return(e.depth===1||e.depth===32)&&(e.depth=8,e.channels=4,e.data=t.getRGBAData()),encodePng$1(e,r)}const exportMethods={save(t,r={}){const{useCanvas:e=!1,encoder:n=void 0}=r;let{format:o}=r;if(!o){const s=/\.(?<format>[a-zA-Z]+)$/.exec(t);s&&(o=s.groups.format.toLowerCase())}if(!o)throw new Error("file format not provided");return new Promise((s,a)=>{let l,c;switch(o.toLowerCase()){case"png":{e?l=this.getCanvas().pngStream():c=encodePng(this,n);break}case"jpg":case"jpeg":e?l=this.getCanvas().jpegStream():c=encodeJpeg(this,n);break;case"bmp":c=encode$2(this,n);break;default:throw new RangeError(`invalid output format: ${o}`)}if(l){let h=createWriteStream();h.on("finish",s),h.on("error",a),l.pipe(h)}else c&&writeFile()})},toDataURL(t="image/png",r={}){typeof t=="object"&&(r=t,t="image/png");const{useCanvas:e=!1,encoder:n=void 0}=r;t=getType(t);function o(s,a){const l=s(a,n);return toBase64URL(l,t)}return t==="image/bmp"?o(encode$2,this):t==="image/png"&&!e?o(encodePng,this):t==="image/jpeg"&&!e?o(encodeJpeg,this):this.getCanvas().toDataURL(t)},toBuffer(t={}){const{format:r="png",encoder:e=void 0}=t;switch(r.toLowerCase()){case"png":return encodePng(this,e);case"jpeg":case"jpg":return encodeJpeg(this,e);case"bmp":return encode$2(this,e);default:throw new RangeError(`invalid output format: ${r}`)}},toBase64(t="image/png",r={}){if(r.async)return this.toDataURL(t,r).then(function(e){return e.substring(e.indexOf(",")+1)});{const e=this.toDataURL(t,r);return e.substring(e.indexOf(",")+1)}},toBlob(t="image/png",r=.8){return canvasToBlob(this.getCanvas(),t,r)},getCanvas(){const t=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let r=createCanvas(this.width,this.height);return r.getContext("2d").putImageData(t,0,0),r}};function setExportMethods(t){for(const r in exportMethods)t.prototype[r]=exportMethods[r]}var hasOwn$1={exports:{}};const name$1="has-own",version="1.0.1",description="A safer .hasOwnProperty() - hasOwn(name, obj)",main="index.js",scripts={test:"make test"},author="Aaron Heckmann <aaron.heckmann+github@gmail.com>",license="MIT",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},homepage="https://github.com/aheckmann/has-own/",devDependencies={mocha:"^6.2.2"},require$$0$4={name:name$1,version,description,main,scripts,author,license,repository,homepage,devDependencies};(function(t,r){var e=Object.prototype.hasOwnProperty;t.exports=r=function(o,s){return e.call(s,o)},r.version=require$$0$4.version})(hasOwn$1,hasOwn$1.exports);var hasOwnExports=hasOwn$1.exports;const hasOwn=getDefaultExportFromCjs(hasOwnExports);let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};function extendMethod(t,r,e={}){let{inPlace:n=!1,returnThis:o=!0,partialArgs:s=[]}=e;return n?Image.prototype[t]=function(...a){this.computed=null;let l=r.apply(this,[...s,...a]);return o?this:l}:Image.prototype[t]=function(...a){return r.apply(this,[...s,...a])},Image}function extendProperty(t,r,e={}){let{partialArgs:n=[]}=e;return computedPropertyDescriptor$1.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let o=r.apply(this,n);return this.computed[t]=o,o},Object.defineProperty(Image.prototype,t,computedPropertyDescriptor$1),Image}const GREY$1="GREY",RGB$1="RGB",HSL="HSL",HSV="HSV",CMYK$1="CMYK",ColorModel=Object.freeze(Object.defineProperty({__proto__:null,CMYK:CMYK$1,GREY:GREY$1,HSL,HSV,RGB:RGB$1},Symbol.toStringTag,{value:"Module"}));function getRGBAData(t={}){const{clamped:r}=t;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const e=this.width*this.height*4;let n=r?new Uint8ClampedArray(e):new Uint8Array(e);return this.bitDepth===1?fillDataFromBinary(this,n):this.bitDepth===32?(this.checkProcessable("getRGBAData",{alpha:0}),this.components===1?fillDataFromGrey32(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB32(this,n))):this.components===1?fillDataFromGrey(this,n):this.components===3&&(this.checkProcessable("getRGBAData",{colorModel:[RGB$1]}),fillDataFromRGB(this,n)),this.alpha===1?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,n)):fillAlpha(this,n),n}function fillDataFromBinary(t,r){for(let e=0;e<t.size;e++){const n=t.getBit(e);r[e*4]=n*255,r[e*4+1]=n*255,r[e*4+2]=n*255}}function fillDataFromGrey32(t,r){const e=t.min[0],o=t.max[0]-e;for(let s=0;s<t.size;s++){const a=Math.floor(255*(t.data[s]-e)/o);r[s*4]=a,r[s*4+1]=a,r[s*4+2]=a}}function fillDataFromRGB32(t,r){const e=Math.min(...t.min),o=Math.max(...t.max)-e;for(let s=0;s<t.size;s++){const a=Math.floor(255*(t.data[s*3]-e)/o),l=Math.floor(255*(t.data[s*3+1]-e)/o),c=Math.floor(255*(t.data[s*3+2]-e)/o);r[s*4]=a,r[s*4+1]=l,r[s*4+2]=c}}function fillDataFromGrey(t,r){for(let e=0;e<t.size;e++)r[e*4]=t.data[e*t.channels]>>>t.bitDepth-8,r[e*4+1]=t.data[e*t.channels]>>>t.bitDepth-8,r[e*4+2]=t.data[e*t.channels]>>>t.bitDepth-8}function fillDataFromRGB(t,r){for(let e=0;e<t.size;e++)r[e*4]=t.data[e*t.channels]>>>t.bitDepth-8,r[e*4+1]=t.data[e*t.channels+1]>>>t.bitDepth-8,r[e*4+2]=t.data[e*t.channels+2]>>>t.bitDepth-8}function copyAlpha(t,r){for(let e=0;e<t.size;e++)r[e*4+3]=t.data[e*t.channels+t.components]>>t.bitDepth-8}function fillAlpha(t,r){for(let e=0;e<t.size;e++)r[e*4+3]=255}const BINARY="BINARY",GREY="GREY",GREYA="GREYA",RGB="RGB",RGBA="RGBA",CMYK="CMYK",CMYKA="CMYKA",kinds={};kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY$1};kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY$1};kinds[GREY]={components:1,alpha:0,bitDepth:8,colorModel:GREY$1};kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB$1};kinds[RGB]={components:3,alpha:0,bitDepth:8,colorModel:RGB$1};kinds[CMYK]={components:4,alpha:0,bitDepth:8,colorModel:CMYK$1};kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK$1};function getKind(t){const r=kinds[t];if(!r)throw new RangeError(`invalid image kind: ${t}`);return r}const validBitDepth=[1,8,16,32];function verifyKindDefinition(t){const{components:r,alpha:e,bitDepth:n,colorModel:o}=t;if(!Number.isInteger(r)||r<=0)throw new RangeError(`invalid components: ${r}. Must be a positive integer`);if(e!==0&&e!==1&&typeof e!="boolean")throw new TypeError(`invalid alpha: ${e}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(n))throw new RangeError(`invalid bitDepth: ${n}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[o])throw new RangeError(`invalid colorModel: ${o}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(t,r,e){let n=r*t;return e===1&&(n=Math.ceil(n/8)),n}function createPixelArray(t,r,e,n,o,s){const a=n*t;let l;switch(o){case 1:l=new Uint8Array(Math.ceil(a/8));break;case 8:l=new Uint8Array(a);break;case 16:l=new Uint16Array(a);break;case 32:l=new Float32Array(a);break;default:throw new Error(`Cannot create pixel array for bit depth ${o}`)}if(e)for(let c=r;c<l.length;c+=n)l[c]=s;return l}const defaultByteLength=1024*8,charArray=[];let IOBuffer$2=class{constructor(r,e){e=e||{},r===void 0&&(r=defaultByteLength),typeof r=="number"&&(r=new ArrayBuffer(r));let n=r.byteLength;const o=e.offset?e.offset>>>0:0;r.buffer&&(n=r.byteLength-o,r.byteLength!==r.buffer.byteLength?r=r.buffer.slice(r.byteOffset+o,r.byteOffset+r.byteLength):o?r=r.buffer.slice(o):r=r.buffer),this.buffer=r,this.length=n,this.byteLength=n,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=n||defaultByteLength,this._mark=0}available(r){return r===void 0&&(r=1),this.offset+r<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(r){r===void 0&&(r=1),this.offset+=r}seek(r){this.offset=r}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(r){if(r===void 0&&(r=1),!this.available(r)){const e=this._increment+this._increment;this._increment=e;const n=this.length+e,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=n,this._data=new DataView(this.buffer)}}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(r){r===void 0&&(r=1);for(var e=new Uint8Array(r),n=0;n<r;n++)e[n]=this.readByte();return e}readInt16(){var r=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,r}readUint16(){var r=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,r}readInt32(){var r=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,r}readUint32(){var r=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat32(){var r=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat64(){var r=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,r}readChar(){return String.fromCharCode(this.readInt8())}readChars(r){r===void 0&&(r=1),charArray.length=r;for(var e=0;e<r;e++)charArray[e]=this.readChar();return charArray.join("")}writeBoolean(r){this.writeUint8(r?255:0)}writeInt8(r){this.ensureAvailable(1),this._data.setInt8(this.offset++,r)}writeUint8(r){this.ensureAvailable(1),this._data.setUint8(this.offset++,r)}writeByte(r){this.writeUint8(r)}writeBytes(r){this.ensureAvailable(r.length);for(var e=0;e<r.length;e++)this._data.setUint8(this.offset++,r[e])}writeInt16(r){this.ensureAvailable(2),this._data.setInt16(this.offset,r,this.littleEndian),this.offset+=2}writeUint16(r){this.ensureAvailable(2),this._data.setUint16(this.offset,r,this.littleEndian),this.offset+=2}writeInt32(r){this.ensureAvailable(4),this._data.setInt32(this.offset,r,this.littleEndian),this.offset+=4}writeUint32(r){this.ensureAvailable(4),this._data.setUint32(this.offset,r,this.littleEndian),this.offset+=4}writeFloat32(r){this.ensureAvailable(4),this._data.setFloat32(this.offset,r,this.littleEndian),this.offset+=4}writeFloat64(r){this.ensureAvailable(8),this._data.setFloat64(this.offset,r,this.littleEndian),this.offset+=8}writeChar(r){this.writeUint8(r.charCodeAt(0))}writeChars(r){for(var e=0;e<r.length;e++)this.writeUint8(r.charCodeAt(e))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}};var IOBuffer_1=IOBuffer$2,src$4={};const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(var i$2 in tagsById$5)tagsByName$5[tagsById$5[i$2]]=i$2;var standard$1={tagsById:tagsById$5,tagsByName:tagsByName$5};const tagsById$4={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$4={};for(var i$1 in tagsById$4)tagsByName$4[tagsById$4[i$1]]=i$1;var exif$1={tagsById:tagsById$4,tagsByName:tagsByName$4};const tagsById$3={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$3={};for(var i in tagsById$3)tagsByName$3[tagsById$3[i]]=i;var gps$1={tagsById:tagsById$3,tagsByName:tagsByName$3};const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};let IFD$2=class{constructor(r){if(!r)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=r,this._map=null}get(r){if(typeof r=="number")return this.fields.get(r);if(typeof r=="string")return this.fields.get(tags$1[this.kind].tagsByName[r]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const e=tags$1[this.kind].tagsById;for(var r of this.fields.keys())e[r]&&(this._map[e[r]]=this.fields.get(r))}return this._map}};var ifd=IFD$2;const Ifd=ifd,dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;let TiffIfd$1=class extends Ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var r=new Date,e=dateTimeRegex$1.exec(this.dateTime);return r.setFullYear(e[1],e[2]-1,e[3]),r.setHours(e[4],e[5],e[6]),r}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray$1(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray$1(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}};function alwaysArray$1(t){return typeof t=="number"?[t]:t}var tiffIfd=TiffIfd$1,ifdValue={},types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);ifdValue.getByteLength=function(t,r){return types$1.get(t)[0]*r};ifdValue.readData=function(t,r,e){return types$1.get(r)[1](t,e)};function readByte$1(t,r){if(r===1)return t.readUint8();for(var e=new Uint8Array(r),n=0;n<r;n++)e[n]=t.readUint8();return e}function readASCII$1(t,r){for(var e=[],n="",o=0;o<r;o++){var s=String.fromCharCode(t.readUint8());s==="\0"?(e.push(n),n=""):n+=s}return e.length===1?e[0]:e}function readShort$1(t,r){if(r===1)return t.readUint16();for(var e=new Uint16Array(r),n=0;n<r;n++)e[n]=t.readUint16();return e}function readLong$1(t,r){if(r===1)return t.readUint32();for(var e=new Uint32Array(r),n=0;n<r;n++)e[n]=t.readUint32();return e}function readRational$1(t,r){if(r===1)return t.readUint32()/t.readUint32();for(var e=new Array(r),n=0;n<r;n++)e[n]=t.readUint32()/t.readUint32();return e}function readSByte$1(t,r){if(r===1)return t.readInt8();for(var e=new Int8Array(r),n=0;n<r;n++)e[n]=t.readInt8();return e}function readSShort$1(t,r){if(r===1)return t.readInt16();for(var e=new Int16Array(r),n=0;n<r;n++)e[n]=t.readInt16();return e}function readSLong$1(t,r){if(r===1)return t.readInt32();for(var e=new Int32Array(r),n=0;n<r;n++)e[n]=t.readInt32();return e}function readSRational$1(t,r){if(r===1)return t.readInt32()/t.readInt32();for(var e=new Array(r),n=0;n<r;n++)e[n]=t.readInt32()/t.readInt32();return e}function readFloat$1(t,r){if(r===1)return t.readFloat32();for(var e=new Float32Array(r),n=0;n<r;n++)e[n]=t.readFloat32();return e}function readDouble$1(t,r){if(r===1)return t.readFloat64();for(var e=new Float64Array(r),n=0;n<r;n++)e[n]=t.readFloat64();return e}const IOBuffer$1=IOBuffer_1,IFD$1=ifd,TiffIFD=tiffIfd,IFDValue=ifdValue,defaultOptions$d={ignoreImageData:!1,onlyFirst:!1};let TIFFDecoder$2=class extends IOBuffer$1{constructor(r,e){super(r,e),this._nextIFD=0}decode(r){r=Object.assign({},defaultOptions$d,r);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(r)),r.onlyFirst)return e[0];return e}decodeHeader(){let r=this.readUint16();if(r===18761)this.setLittleEndian();else if(r===19789)this.setBigEndian();else throw new Error("invalid byte order: 0x"+r.toString(16));if(r=this.readUint16(),r!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(r){this.seek(this._nextIFD);var e;r.kind?e=new IFD$1(r.kind):e=new TiffIFD;const n=this.readUint16();for(var o=0;o<n;o++)this.decodeIFDEntry(e);return r.ignoreImageData||this.decodeImageData(e),this._nextIFD=this.readUint32(),e}decodeIFDEntry(r){const e=this.offset,n=this.readUint16(),o=this.readUint16(),s=this.readUint32();if(o<1||o>12){this.skip(4);return}IFDValue.getByteLength(o,s)>4&&this.seek(this.readUint32());const l=IFDValue.readData(this,o,s);if(r.fields.set(n,l),n===34665||n===34853){let c=this.offset,h;n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,r[h]=this.decodeIFD({kind:h,ignoreImageData:!0}),this.offset=c}this.seek(e),this.skip(12)}decodeImageData(r){const e=r.orientation;switch(e&&e!==1&&unsupported$1("orientation",e),r.type){case 1:case 2:this.readStripData(r);break;default:unsupported$1("image type",r.type);break}}readStripData(r){const e=r.width,n=r.height,o=validateBitDepth(r.bitsPerSample),s=r.sampleFormat;let a=e*n;const l=getDataArray$1(a,1,o,s),c=r.compression,f=r.rowsPerStrip*e,u=r.stripOffsets,d=r.stripByteCounts;for(var g=0,m=0;m<u.length;m++){var y=this.getStripData(c,u[m],d[m]),_=a>f?f:a;a-=_,o===8?g=fill8bit$1(l,y,g,_):o===16?g=fill16bit$1(l,y,g,_,this.isLittleEndian()):o===32&&s===3?g=fillFloat32$1(l,y,g,_,this.isLittleEndian()):unsupported$1("bitDepth",o)}r.data=l}getStripData(r,e,n){switch(r){case 1:return new DataView(this.buffer,e,n);case 2:case 32773:return unsupported$1("Compression",r);default:throw new Error("invalid compression: "+r)}}};var tiffDecoder=TIFFDecoder$2;function getDataArray$1(t,r,e,n){return e===8?new Uint8Array(t*r):e===16?new Uint16Array(t*r):e===32&&n===3?new Float32Array(t*r):unsupported$1("bit depth / sample format",e+" / "+n)}function fill8bit$1(t,r,e,n){for(var o=0;o<n;o++)t[e++]=r.getUint8(o);return e}function fill16bit$1(t,r,e,n,o){for(var s=0;s<n*2;s+=2)t[e++]=r.getUint16(s,o);return e}function fillFloat32$1(t,r,e,n,o){for(var s=0;s<n*4;s+=4)t[e++]=r.getFloat32(s,o);return e}function unsupported$1(t,r){throw new Error("Unsupported "+t+": "+r)}function validateBitDepth(t){if(t.length){const e=t;t=e[0];for(var r=0;r<e.length;r++)e[r]!==t&&unsupported$1("bit depth",e)}return t}const TIFFDecoder$1=tiffDecoder;var decode$2=function(r,e){return new TIFFDecoder$1(r,e).decode(e)};src$4.decode=decode$2;const IOBuffer=IOBuffer_1,tiff=src$4;function decode$1(t){const r=new IOBuffer(t),e={};if(r.setBigEndian(),r.readUint16()!==65496)throw new Error("SOI marker not found. Not a valid JPEG file");if(r.readUint16()===65505){r.readUint16();const s=r.readBytes(6);if(s[0]===69&&s[1]===120&&s[2]===105&&s[3]===102&&s[4]===0&&s[5]===0){const a=tiff.decode(r,{onlyFirst:!0,ignoreImageData:!0,offset:r.offset});e.exif=a}}return e}var decode_1=decode$1,decode=decode_1,imageType$2={exports:{}},fileType$1={exports:{}};(function(module){const toBytes=t=>[...t].map(r=>r.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(t,r=0){let e=t[r],n=1,o=0;for(;++o<8;)n*=256,e+=t[r+o]*n;return e}const fileType=t=>{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof t}\``);const r=t instanceof Uint8Array?t:new Uint8Array(t);if(!(r&&r.length>1))return null;const e=(o,s)=>{s=Object.assign({offset:0},s);for(let a=0;a<o.length;a++)if(s.mask){if(o[a]!==(s.mask[a]&r[a+s.offset]))return!1}else if(o[a]!==r[a+s.offset])return!1;return!0},n=(o,s)=>e(toBytes(o),s);if(e([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(e([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(e([71,73,70]))return{ext:"gif",mime:"image/gif"};if(e([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(e([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((e([73,73,42,0])||e([77,77,0,42]))&&e([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(e([73,73,42,0])||e([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(e([66,77]))return{ext:"bmp",mime:"image/bmp"};if(e([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(e([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(e([80,75,3,4])){if(e([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(e(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(n("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(n("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(n("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const o=(c,h=0)=>c.findIndex((f,u,d)=>u>=h&&d[u]===80&&d[u+1]===75&&d[u+2]===3&&d[u+3]===4);let s=0,a=!1,l=null;do{const c=s+30;if(a||(a=e(oxmlContentTypes,{offset:c})||e(oxmlRels,{offset:c})),l||(n("word/",{offset:c})?l={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:n("ppt/",{offset:c})?l={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:n("xl/",{offset:c})&&(l={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),a&&l)return l;s=o(r,c)}while(s>=0);if(l)return l}if(e([80,75])&&(r[2]===3||r[2]===5||r[2]===7)&&(r[3]===4||r[3]===6||r[3]===8))return{ext:"zip",mime:"application/zip"};if(e([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(e([82,97,114,33,26,7])&&(r[6]===0||r[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(e([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(e([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(e([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(e([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(e([51,103,112,53])||e([0,0,0])&&e([102,116,121,112],{offset:4})&&(e([109,112,52,49],{offset:8})||e([109,112,52,50],{offset:8})||e([105,115,111,109],{offset:8})||e([105,115,111,50],{offset:8})||e([109,109,112,52],{offset:8})||e([77,52,86],{offset:8})||e([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(e([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(e([26,69,223,163])){const o=r.subarray(4,4100),s=o.findIndex((a,l,c)=>c[l]===66&&c[l+1]===130);if(s!==-1){const a=s+3,l=c=>[...c].every((h,f)=>o[a+f]===h.charCodeAt(0));if(l("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(l("webm"))return{ext:"webm",mime:"video/webm"}}}if(e([0,0,0,20,102,116,121,112,113,116,32,32])||e([102,114,101,101],{offset:4})||e([102,116,121,112,113,116,32,32],{offset:4})||e([109,100,97,116],{offset:4})||e([109,111,111,118],{offset:4})||e([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(e([82,73,70,70])){if(e([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(e([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(e([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(e([48,38,178,117,142,102,207,17,166,217])){let o=30;do{const s=readUInt64LE(r,o+16);if(e([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:o})){if(e([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:o+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(e([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:o+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}o+=s}while(o+24<=r.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(e([0,0,1,186])||e([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(e([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let o=0;o<2&&o<r.length-16;o++){if(e([73,68,51],{offset:o})||e([255,226],{offset:o,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(e([255,228],{offset:o,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(e([255,248],{offset:o,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(e([255,240],{offset:o,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(e([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(e([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(e([79,103,103,83]))return e([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:e([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:e([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:e([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:e([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(e([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(e([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(e([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(e([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(e([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(e([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((r[0]===67||r[0]===70)&&e([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(e([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(e([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(e([119,79,70,70])&&(e([0,1,0,0],{offset:4})||e([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(e([119,79,70,50])&&(e([0,1,0,0],{offset:4})||e([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(e([76,80],{offset:34})&&(e([0,0,1],{offset:8})||e([1,0,2],{offset:8})||e([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(e([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(e([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(e([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(e([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(e([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(e([37,33]))return{ext:"ps",mime:"application/postscript"};if(e([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(e([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(e([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(e([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(e([77,83,67,70])||e([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(e([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(e([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(e([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(e([31,160])||e([31,157]))return{ext:"Z",mime:"application/x-compress"};if(e([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(e([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(e([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(e([71],{offset:4})&&(e([71],{offset:192})||e([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(e([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(e([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(e([0,0,0,12,106,80,32,32,13,10,135,10])){if(e([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(e([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(e([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(e([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(e([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(e([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(e([102,116,121,112],{offset:4})){if(e([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(e([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(e([104,101,105,99],{offset:8})||e([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(e([104,101,118,99],{offset:8})||e([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return e([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:e([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:e([77,80,43])?{ext:"mpc",mime:"audio/x-musepack"}:e([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:e([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:e([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:e([212,195,178,161])||e([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const t=new stream.PassThrough,r=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{t.fileType=fileType(r)}catch(e){reject(e)}readableStream.unshift(r),stream.pipeline?resolve(stream.pipeline(readableStream,t,()=>{})):resolve(readableStream.pipe(t))})})})(fileType$1);var fileTypeExports=fileType$1.exports;const fileType=fileTypeExports,imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=t=>{const r=fileType(t);return imageExts.has(r&&r.ext)?r:null};imageType$2.exports=imageType;imageType$2.exports.default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType.minimumBytes});var imageTypeExports=imageType$2.exports;const imageType$1=getDefaultExportFromCjs(imageTypeExports);function guessStripByteCounts(t){if(t.compression!==1)throw new Error("missing mandatory StripByteCounts field in compressed image");const r=t.rowsPerStrip*t.width*t.samplesPerPixel*(t.bitsPerSample/8);return new Array(t.stripOffsets.length).fill(r)}function applyHorizontalDifferencing8Bit(t,r,e){let n=0;for(;n<t.length;){for(let o=e;o<r*e;o+=e)for(let s=0;s<e;s++)t[n+o+s]=t[n+o+s]+t[n+o-(e-s)]&255;n+=r*e}}function applyHorizontalDifferencing16Bit(t,r,e){let n=0;for(;n<t.length;){for(let o=e;o<r*e;o+=e)for(let s=0;s<e;s++)t[n+o+s]=t[n+o+s]+t[n+o-(e-s)]&65535;n+=r*e}}const tagsById$2={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$2={};for(let t in tagsById$2)tagsByName$2[tagsById$2[t]]=Number(t);const exif=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$2,tagsByName:tagsByName$2},Symbol.toStringTag,{value:"Module"})),tagsById$1={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$1={};for(let t in tagsById$1)tagsByName$1[tagsById$1[t]]=Number(t);const gps=Object.freeze(Object.defineProperty({__proto__:null,tagsById:tagsById$1,tagsByName:tagsByName$1},Symbol.toStringTag,{value:"Module"})),tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(let t in tagsById)tagsByName[tagsById[t]]=Number(t);const standard=Object.freeze(Object.defineProperty({__proto__:null,tagsById,tagsByName},Symbol.toStringTag,{value:"Module"})),tags={standard,exif,gps};class IFD{constructor(r){if(!r)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=r,this._hasMap=!1,this._map={}}get(r){if(typeof r=="number")return this.fields.get(r);if(typeof r=="string")return this.fields.get(tags[this.kind].tagsByName[r]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const r=tags[this.kind].tagsById;for(let e of this.fields.keys())r[e]&&(this._map[r[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}let types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]);function getByteLength(t,r){const e=types.get(t);if(!e)throw new Error(`type not found: ${t}`);return e[0]*r}function readData(t,r,e){const n=types.get(r);if(!n)throw new Error(`type not found: ${r}`);return n[1](t,e)}function readByte(t,r){if(r===1)return t.readUint8();let e=new Uint8Array(r);for(let n=0;n<r;n++)e[n]=t.readUint8();return e}function readASCII(t,r){let e=[],n="";for(let o=0;o<r;o++){let s=String.fromCharCode(t.readUint8());s==="\0"?(e.push(n),n=""):n+=s}return e.length===1?e[0]:e}function readShort(t,r){if(r===1)return t.readUint16();let e=new Uint16Array(r);for(let n=0;n<r;n++)e[n]=t.readUint16();return e}function readLong(t,r){if(r===1)return t.readUint32();let e=new Uint32Array(r);for(let n=0;n<r;n++)e[n]=t.readUint32();return e}function readRational(t,r){if(r===1)return t.readUint32()/t.readUint32();let e=new Array(r);for(let n=0;n<r;n++)e[n]=t.readUint32()/t.readUint32();return e}function readSByte(t,r){if(r===1)return t.readInt8();let e=new Int8Array(r);for(let n=0;n<r;n++)e[n]=t.readInt8();return e}function readSShort(t,r){if(r===1)return t.readInt16();let e=new Int16Array(r);for(let n=0;n<r;n++)e[n]=t.readInt16();return e}function readSLong(t,r){if(r===1)return t.readInt32();let e=new Int32Array(r);for(let n=0;n<r;n++)e[n]=t.readInt32();return e}function readSRational(t,r){if(r===1)return t.readInt32()/t.readInt32();let e=new Array(r);for(let n=0;n<r;n++)e[n]=t.readInt32()/t.readInt32();return e}function readFloat(t,r){if(r===1)return t.readFloat32();let e=new Float32Array(r);for(let n=0;n<r;n++)e[n]=t.readFloat32();return e}function readDouble(t,r){if(r===1)return t.readFloat64();let e=new Float64Array(r);for(let n=0;n<r;n++)e[n]=t.readFloat64();return e}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9;let stringTable=[];function initializeStringTable(){if(stringTable.length===0){for(let r=0;r<256;r++)stringTable.push([r]);const t=[];for(let r=256;r<4096;r++)stringTable.push(t)}}const andTable=[511,1023,2047,4095],bitJumps=[0,0,0,0,0,0,0,0,0,511,1023,2047,4095];class LzwDecoder{constructor(r){this.nextData=0,this.nextBits=0,this.bytePointer=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.stripArray=new Uint8Array(r.buffer,r.byteOffset,r.byteLength),this.outData=new IOBuffer$4(r.byteLength),this.initializeTable()}decode(){let r=0,e=0;for(;(r=this.getNextCode())!==EOI_CODE;)if(r===CLEAR_CODE){if(this.initializeTable(),r=this.getNextCode(),r===EOI_CODE)break;this.writeString(this.stringFromCode(r)),e=r}else if(this.isInTable(r))this.writeString(this.stringFromCode(r)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(r)[0])),e=r;else{const o=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(o),this.addStringToTable(o),e=r}const n=this.outData.toArray();return new DataView(n.buffer,n.byteOffset,n.byteLength)}initializeTable(){initializeStringTable(),this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(r){this.outData.writeBytes(r)}stringFromCode(r){return stringTable[r]}isInTable(r){return r<this.tableLength}addStringToTable(r){if(stringTable[this.tableLength++]=r,stringTable.length>4096)throw stringTable=[],new Error("LZW decoding error. Please open an issue at https://github.com/image-js/tiff/issues/new/choose (include a test image).");this.tableLength===bitJumps[this.currentBitLength]&&this.currentBitLength++}getNextCode(){this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8,this.nextBits<this.currentBitLength&&(this.nextData=this.nextData<<8|this.stripArray[this.bytePointer++]&255,this.nextBits+=8);const r=this.nextData>>this.nextBits-this.currentBitLength&andTable[this.currentBitLength-9];return this.nextBits-=this.currentBitLength,this.bytePointer>this.stripArray.length?257:r}}function decompressLzw(t){return new LzwDecoder(t).decode()}const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends IFD{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let r=new Date,e=dateTimeRegex.exec(this.dateTime);if(e===null)throw new Error(`invalid dateTime: ${this.dateTime}`);return r.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),r.setHours(Number(e[4]),Number(e[5]),Number(e[6])),r}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const r=this.get("BitsPerSample");return r&&typeof r!="number"?r[0]:r}get alpha(){const r=this.extraSamples;return r?r[0]!==0:!1}get associatedAlpha(){const r=this.extraSamples;return r?r[0]===1:!1}get extraSamples(){return alwaysArray(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const r=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*r)throw new Error(`ColorMap size must be ${r}`);const n=[];for(let o=0;o<r;o++)n.push([e[o],e[o+r],e[o+2*r]]);return n}}function alwaysArray(t){return typeof t=="number"?[t]:t}function decompressZlib(t){const r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e=inflate_1(r);return new DataView(e.buffer,e.byteOffset,e.byteLength)}const defaultOptions$c={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer$4{constructor(r){super(r),this._nextIFD=0}get isMultiPage(){let r=0;for(this.decodeHeader();this._nextIFD;)if(r++,this.decodeIFD({ignoreImageData:!0},!0),r===2)return!0;if(r===1)return!1;throw unsupported("ifdCount",r)}get pageCount(){let r=0;for(this.decodeHeader();this._nextIFD;)r++,this.decodeIFD({ignoreImageData:!0},!0);if(r>0)return r;throw unsupported("ifdCount",r)}decode(r={}){r=Object.assign({},defaultOptions$c,r);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(r,!0)),r.onlyFirst)return[e[0]];return e}decodeHeader(){const r=this.readUint16();if(r===18761)this.setLittleEndian();else if(r===19789)this.setBigEndian();else throw new Error(`invalid byte order: 0x${r.toString(16)}`);if(this.readUint16()!==42)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(r,e){this.seek(this._nextIFD);let n;if(e)n=new TiffIfd;else{if(!r.kind)throw new Error("kind is missing");n=new IFD(r.kind)}const o=this.readUint16();for(let s=0;s<o;s++)this.decodeIFDEntry(n);if(!r.ignoreImageData){if(!(n instanceof TiffIfd))throw new Error("must be a tiff ifd");this.decodeImageData(n)}return this._nextIFD=this.readUint32(),n}decodeIFDEntry(r){const e=this.offset,n=this.readUint16(),o=this.readUint16(),s=this.readUint32();if(o<1||o>12){this.skip(4);return}getByteLength(o,s)>4&&this.seek(this.readUint32());const l=readData(this,o,s);if(r.fields.set(n,l),n===34665||n===34853){let c=this.offset,h="exif";n===34665?h="exif":n===34853&&(h="gps"),this._nextIFD=l,r[h]=this.decodeIFD({kind:h,ignoreImageData:!0},!1),this.offset=c}this.seek(e),this.skip(12)}decodeImageData(r){const e=r.orientation;if(e&&e!==1)throw unsupported("orientation",e);switch(r.type){case 0:case 1:case 2:case 3:this.readStripData(r);break;default:throw unsupported("image type",r.type)}if(this.applyPredictor(r),this.convertAlpha(r),r.type===0){const n=r.bitsPerSample,o=Math.pow(2,n)-1;for(let s=0;s<r.data.length;s++)r.data[s]=o-r.data[s]}}readStripData(r){const e=r.width,n=r.height,o=r.bitsPerSample,s=r.sampleFormat,a=e*n*r.samplesPerPixel,l=getDataArray(a,o,s),h=r.rowsPerStrip*e*r.samplesPerPixel,f=r.stripOffsets,u=r.stripByteCounts||guessStripByteCounts(r);let d=a,g=0;for(let m=0;m<f.length;m++){let y=new DataView(this.buffer,this.byteOffset+f[m],u[m]),_=d>h?h:d;d-=_;let w=y;switch(r.compression){case 1:break;case 5:{w=decompressLzw(y);break}case 8:{w=decompressZlib(y);break}case 2:throw unsupported("Compression","CCITT Group 3");case 32773:throw unsupported("Compression","PackBits");default:throw unsupported("Compression",r.compression)}g=this.fillUncompressed(o,s,l,w,g,_)}r.data=l}fillUncompressed(r,e,n,o,s,a){if(r===8)return fill8bit(n,o,s,a);if(r===16)return fill16bit(n,o,s,a,this.isLittleEndian());if(r===32&&e===3)return fillFloat32(n,o,s,a,this.isLittleEndian());throw unsupported("bitDepth",r)}applyPredictor(r){const e=r.bitsPerSample;switch(r.predictor){case 1:break;case 2:{if(e===8)applyHorizontalDifferencing8Bit(r.data,r.width,r.components);else if(e===16)applyHorizontalDifferencing16Bit(r.data,r.width,r.components);else throw new Error(`Horizontal differencing is only supported for images with a bit depth of ${e}`);break}default:throw new Error(`invalid predictor: ${r.predictor}`)}}convertAlpha(r){if(r.alpha&&r.associatedAlpha){const{data:e,components:n,maxSampleValue:o}=r;for(let s=0;s<e.length;s+=n){const a=e[s+n-1];for(let l=0;l<n-1;l++)e[s+l]=Math.round(e[s+l]*o/a)}}}}function getDataArray(t,r,e){if(r===8)return new Uint8Array(t);if(r===16)return new Uint16Array(t);if(r===32&&e===3)return new Float32Array(t);throw unsupported("bit depth / sample format",`${r} / ${e}`)}function fill8bit(t,r,e,n){for(let o=0;o<n;o++)t[e++]=r.getUint8(o);return e}function fill16bit(t,r,e,n,o){for(let s=0;s<n*2;s+=2)t[e++]=r.getUint16(s,o);return e}function fillFloat32(t,r,e,n,o){for(let s=0;s<n*4;s+=4)t[e++]=r.getFloat32(s,o);return e}function unsupported(t,r){return new Error(`Unsupported ${t}: ${r}`)}function decodeTIFF(t,r){return new TIFFDecoder(t).decode(r)}function matchAndCrop(t={}){let{algorithm:r="matchToPrevious",ignoreBorder:e=[0,0]}=t;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let n=r==="matchToPrevious",o=this[0],s=[];s[0]={position:[0,0],image:this[0]};let a=[0,0];for(let d=1;d<this.length;d++){let g=o.getBestMatch(this[d],{border:e});s[d]={position:[g[0]+a[0],g[1]+a[1]],image:this[d]},n&&(a[0]+=g[0],a[1]+=g[1],o=this[d])}let l=0,c=0,h=0,f=0;for(let d=0;d<s.length;d++){let g=s[d];g.position[0]>l&&(l=g.position[0]),g.position[0]<c&&(c=g.position[0]),g.position[1]>h&&(h=g.position[1]),g.position[1]<f&&(f=g.position[1])}c=0-c,f=0-f;for(let d=0;d<s.length;d++){let g=s[d];g.crop=g.image.crop({x:l-g.position[0],y:h-g.position[1],width:o.width-c-l,height:o.height-f-h})}let u=[];for(let d=0;d<s.length;d++)u[d]=s[d].crop;return new Stack(u)}function min$2(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].min;for(let r=1;r<this.length;r++)for(let e=0;e<t.length;e++)t[e]=Math.min(t[e],this[r].min[e]);return t}function max$2(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].max;for(let r=1;r<this.length;r++)for(let e=0;e<t.length;e++)t[e]=Math.max(t[e],this[r].max[e]);return t}function median$2(t){let r=t.reduce((a,l)=>a+l);if(r===0)throw new Error("unreachable");let e=0,n=0,o=r/2,s;for(;;){if(t[e]>0){if(s!==void 0)return(s+e)/2;if(n+=t[e],n>o)return e;n===o&&(s=e)}e++}}function mean$2(t){let r=0,e=0;for(let n=0;n<t.length;n++)r+=t[n],e+=t[n]*n;return r===0?0:e/r}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let t=this.getHistograms({maxSlots:this[0].maxValue+1}),r=new Array(t.length);for(let e=0;e<t.length;e++){let n=t[e];r[e]=median$2(n)}return r}function histogram(t){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].getHistogram(t);for(let e=1;e<this.length;e++){let n=this[e].getHistogram(t);for(let o=0;o<r.length;o++)r[o]+=n[o]}return r}function histograms(t){this.checkProcessable("min",{bitDepth:[8,16]});let r=this[0].getHistograms(t),e=r[0].length;for(let n=1;n<this.length;n++){let o=this[n].getHistograms(t);for(let s=0;s<r.length;s++)for(let a=0;a<e;a++)r[s][a]+=o[s][a]}return r}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let t=new Uint32Array(this[0].data.length);for(let n=0;n<this.length;n++){let o=this[n];for(let s=0;s<this[0].data.length;s++)t[s]+=o.data[s]}let r=Image.createFrom(this[0]),e=r.data;for(let n=0;n<this[0].data.length;n++)e[n]=t[n]/this.length;return r}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let t=Image.createFrom(this[0]);t.data.fill(0);for(const r of this)for(let e=0;e<t.data.length;e++)t.data[e]=Math.max(r.data[e],t.data[e]);return t}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let t=Image.createFrom(this[0]);t.data.fill(t.maxValue);for(const r of this)for(let e=0;e<t.data.length;e++)t.data[e]=Math.min(r.data[e],t.data[e]);return t}function extend$2(t){t.extendMethod("matchAndCrop",matchAndCrop),t.extendMethod("getMin",min$2),t.extendMethod("getMax",max$2),t.extendMethod("getMedian",median$1),t.extendMethod("getHistogram",histogram),t.extendMethod("getHistograms",histograms),t.extendMethod("getAverage",averageImage),t.extendMethod("getAverageImage",averageImage),t.extendMethod("getMaxImage",maxImage),t.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(r){if(Array.isArray(r)){super(r.length);for(let e=0;e<r.length;e++)this[e]=r[e]}else typeof r=="number"?super(r):super();this.computed=null}static load(r){return Promise.all(r.map(Image.load)).then(e=>new Stack(e))}static extendMethod(r,e,n={}){let{inPlace:o=!1,returnThis:s=!0,partialArgs:a=[]}=n;return o?Stack.prototype[r]=function(...l){this.computed=null;let c=e.apply(this,[...a,...l]);return s?this:c}:Stack.prototype[r]=function(...l){return e.apply(this,[...a,...l])},Stack}static extendProperty(r,e,n={}){let{partialArgs:o=[]}=n;return computedPropertyDescriptor.get=function(){if(this.computed===null)this.computed={};else if(hasOwn(r,this.computed))return this.computed[r];let s=e.apply(this,o);return this.computed[r]=s,s},Object.defineProperty(Stack.prototype,r,computedPropertyDescriptor),Stack}checkProcessable(r,e={}){if(typeof r!="string")throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(this.size===0)throw new TypeError(`The process: ${r} can not be applied on an empty stack`);this[0].checkProcessable(r,e);for(let n=1;n<this.length;n++){if((e.sameSize===void 0||e.sameSize)&&this[0].width!==this[n].width)throw new TypeError(`The process: ${r} can not be applied if width is not identical in all images`);if((e.sameSize===void 0||e.sameSize)&&this[0].height!==this[n].height)throw new TypeError(`The process: ${r} can not be applied if height is not identical in all images`);if((e.sameAlpha===void 0||e.sameAlpha)&&this[0].alpha!==this[n].alpha)throw new TypeError(`The process: ${r} can not be applied if alpha is not identical in all images`);if((e.sameBitDepth===void 0||e.sameBitDepth)&&this[0].bitDepth!==this[n].bitDepth)throw new TypeError(`The process: ${r} can not be applied if bitDepth is not identical in all images`);if((e.sameColorModel===void 0||e.sameColorModel)&&this[0].colorModel!==this[n].colorModel)throw new TypeError(`The process: ${r} can not be applied if colorModel is not identical in all images`);if((e.sameNumberChannels===void 0||e.sameNumberChannels)&&this[0].channels!==this[n].channels)throw new TypeError(`The process: ${r} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(t,r){if(typeof t!="function")throw new TypeError(`${t} is not a function`);let e=new Stack(this.length);for(let n=0;n<this.length;n++)e[n]=t.call(r,this[n],n,this);return e});extend$2(Stack);const isDataURL=/^data:[a-z]+\/(?:[a-z]+);base64,/;function load(t,r){if(typeof t=="string")return loadURL(t,r);if(t instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(t),void 0,r&&r.ignorePalette));if(t.buffer)return Promise.resolve(loadBinary(t,void 0,r&&r.ignorePalette));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(t,r,e){const n=imageType$1(t);if(n)switch(n.mime){case"image/png":return loadPNG(t);case"image/jpeg":return loadJPEG(t);case"image/tiff":return loadTIFF(t,e);default:return loadGeneric(o(n.mime))}return loadGeneric(o("application/octet-stream"));function o(s){return r||toBase64URL(t,s)}}function loadURL(t,r){const e=t.slice(0,64).match(isDataURL);let n;return e!==null?n=Promise.resolve(decode$3(t.slice(e[0].length))):n=fetchBinary(t,r),n.then(o=>{const s=new Uint8Array(o);return loadBinary(s,e?t:void 0,r&&r.ignorePalette)})}function loadPNG(t){const r=decodePng(t);let e=r.channels,n,o=0;return e===2||e===4?(n=e-1,o=1):n=e,r.palette?loadPNGFromPalette(r):new Image(r.width,r.height,r.data,{components:n,alpha:o,bitDepth:r.depth})}function loadPNGFromPalette(t){const r=t.width*t.height,e=t.palette[0].length,n=new Uint8Array(r*e),o=8/t.depth,s=t.depth<8?o:1,a=parseInt("1".repeat(t.depth),2),l=e===4;let c=0;for(let h=0;h<r;h++){const f=Math.floor(h/s);let u=t.data[f];t.depth<8&&(u=u>>>t.depth*(o-1-h%o)&a);const d=t.palette[u];n[c++]=d[0],n[c++]=d[1],n[c++]=d[2],l&&(n[c++]=d[3])}return new Image(t.width,t.height,n,{components:3,alpha:l,bitDepth:8})}function loadJPEG(t){const r=decode(t);let e;r.exif&&(e=getMetadata(r.exif));const n=jpegJs.decode(t,{useTArray:!0,maxMemoryUsageInMB:1024});let o=new Image(n.width,n.height,n.data,{meta:e});if(e&&e.tiff.tags.Orientation){const s=e.tiff.tags.Orientation;s>2&&(o=o.rotate({3:180,4:180,5:90,6:90,7:270,8:270}[s])),[2,4,5,7].includes(s)&&(o=o.flipX())}return o}function loadTIFF(t,r){let e=decodeTIFF(t);return e.length===1?getImageFromIFD(e[0],r):new Stack(e.map(function(n){return getImageFromIFD(n,r)}))}function getMetadata(t){const r={tiff:{fields:t.fields,tags:t.map}};return t.exif&&(r.exif=t.exif),t.gps&&(r.gps=t.gps),r}function getImageFromIFD(t,r){if(!r&&t.type===3){const e=new Uint16Array(3*t.width*t.height),n=t.palette;let o=0;for(let s=0;s<t.data.length;s++){const a=t.data[s],l=n[a];e[o++]=l[0],e[o++]=l[1],e[o++]=l[2]}return new Image(t.width,t.height,e,{components:3,alpha:t.alpha,colorModel:RGB$1,bitDepth:16,meta:getMetadata(t)})}else return new Image(t.width,t.height,t.data,{components:t.type===2?3:1,alpha:t.alpha,colorModel:t.type===2?RGB$1:GREY$1,bitDepth:t.bitsPerSample.length?t.bitsPerSample[0]:t.bitsPerSample,meta:getMetadata(t)})}function loadGeneric(t,r){return r=r||{},new Promise(function(e,n){let o=new DOMImage;o.onload=function(){let s=o.width,a=o.height,c=createCanvas(s,a).getContext("2d");c.drawImage(o,0,0,s,a);let h=c.getImageData(0,0,s,a).data;e(new Image(s,a,h,r))},o.onerror=function(){n(new Error(`Could not load ${t}`))},o.src=t})}const valueMethods={getValueXY(t,r,e){return this.data[(r*this.width+t)*this.channels+e]},setValueXY(t,r,e,n){return this.data[(r*this.width+t)*this.channels+e]=n,this.computed=null,this},getValue(t,r){return this.data[t*this.channels+r]},setValue(t,r,e){return this.data[t*this.channels+r]=e,this.computed=null,this},getPixelXY(t,r){return this.getPixel(r*this.width+t)},setPixelXY(t,r,e){return this.setPixel(r*this.width+t,e)},getPixel(t){const r=new Array(this.channels),e=t*this.channels;for(let n=0;n<this.channels;n++)r[n]=this.data[e+n];return r},setPixel(t,r){const e=t*this.channels;for(let n=0;n<r.length;n++)this.data[e+n]=r[n];return this.computed=null,this}};function setValueMethods(t){for(const r in valueMethods)t.prototype[r]=valueMethods[r]}function getImageParameters(t){return{width:t.width,height:t.height,components:t.components,alpha:t.alpha,colorModel:t.colorModel,bitDepth:t.bitDepth}}function getOutputImage(t,r,e,n={}){const{out:o}=r;if(o===void 0)return n.copy?t.clone():Image.createFrom(t,e);{if(!Image.isImage(o))throw new TypeError("out must be an Image object");const s=Object.assign(getImageParameters(t),e);for(const a in s)if(o[a]!==s[a])throw new RangeError(`cannot use out. Its ${a} must be "${s[a]}" (found "${o[a]}")`);return o}}function getOutputImageOrInPlace(t,r,e){if(r.inPlace!==void 0&&typeof r.inPlace!="boolean")throw new TypeError("inPlace option must be a boolean");if(r.inPlace){if(r.out!==void 0)throw new TypeError("out option must not be set if inPlace option is true");return t}return getOutputImage(t,r,null,e)}function abs(t={}){this.checkProcessable("abs",{bitDepth:[32]});const r=getOutputImageOrInPlace(this,t);return absolute(this,r),r}function absolute(t,r){for(let e=0;e<t.data.length;e++)r.data[e]=Math.abs(t.data[e])}function copyAlphaChannel(t,r){if(t.alpha===1&&r.alpha===1)for(let e=0;e<t.size;e++)r.data[e*r.channels+r.components]=t.data[e*t.channels+t.components]}function invert(t={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const r=getOutputImageOrInPlace(this,t);return this.bitDepth===1?invertBinary(this,r):(invertColor(this,r),this!==r&&copyAlphaChannel(this,r)),r}function invertBinary(t,r){for(let e=0;e<t.data.length;e++)r.data[e]=~t.data[e]}function invertColor(t,r){for(let e=0;e<t.data.length;e+=t.channels)for(let n=0;n<t.components;n++)r.data[e+n]=t.maxValue-t.data[e+n]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let t=0;t<this.height;t++){let r=t*this.width*this.channels;for(let e=0;e<Math.floor(this.width/2);e++){let n=e*this.channels+r,o=(this.width-e-1)*this.channels+r;for(let s=0;s<this.channels;s++){let a=this.data[n+s];this.data[n+s]=this.data[o+s],this.data[o+s]=a}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let t=0;t<Math.floor(this.height/2);t++)for(let r=0;r<this.width;r++){let e=r*this.channels+t*this.width*this.channels,n=r*this.channels+(this.height-1-t)*this.channels*this.width;for(let o=0;o<this.channels;o++){let s=this.data[e+o];this.data[e+o]=this.data[n+o],this.data[n+o]=s}}return this}function blurFilter(t={}){const{radius:r=1}=t;if(r<1)throw new Error("radius must be greater than 1");const e=2*r+1,n=new Array(e);for(let o=0;o<e;o++){n[o]=new Array(e);for(let s=0;s<e;s++)n[o][s]=1/(e*e)}return this.convolution(n)}var medianQuickselect_min={exports:{}};(function(t){(function(){function r(o){for(var s=0,a=o.length-1,l=void 0,c=void 0,h=void 0,f=n(s,a);;){if(a<=s)return o[f];if(a==s+1)return o[s]>o[a]&&e(o,s,a),o[f];for(l=n(s,a),o[l]>o[a]&&e(o,l,a),o[s]>o[a]&&e(o,s,a),o[l]>o[s]&&e(o,l,s),e(o,l,s+1),c=s+1,h=a;;){do c++;while(o[s]>o[c]);do h--;while(o[h]>o[s]);if(h<c)break;e(o,c,h)}e(o,s,h),h<=f&&(s=c),h>=f&&(a=h-1)}}var e=function(s,a,l){var c;return c=[s[l],s[a]],s[a]=c[0],s[l]=c[1],c},n=function(s,a){return~~((s+a)/2)};t.exports?t.exports=r:window.median=r})()})(medianQuickselect_min);var medianQuickselect_minExports=medianQuickselect_min.exports;const quickSelectMedian=getDefaultExportFromCjs(medianQuickselect_minExports);function validateArrayOfChannels(t,r={}){let{channels:e,allowAlpha:n,defaultAlpha:o}=r;return typeof n!="boolean"&&(n=!0),typeof e>"u"?allChannels(t,o):validateChannels(t,e,n)}function allChannels(t,r){let e=r?t.channels:t.components,n=new Array(e);for(let o=0;o<e;o++)n[o]=o;return n}function validateChannels(t,r,e){Array.isArray(r)||(r=[r]);for(let n=0;n<r.length;n++)r[n]=validateChannel(t,r[n],e);return r}function validateChannel(t,r,e=!0){if(r===void 0)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if(typeof r=="string"){switch(t.colorModel){case GREY$1:break;case RGB$1:if("rgb".includes(r))switch(r){case"r":r=0;break;case"g":r=1;break;case"b":r=2;break}break;case HSL:if("hsl".includes(r))switch(r){case"h":r=0;break;case"s":r=1;break;case"l":r=2;break}break;case HSV:if("hsv".includes(r))switch(r){case"h":r=0;break;case"s":r=1;break;case"v":r=2;break}break;case CMYK$1:if("cmyk".includes(r))switch(r){case"c":r=0;break;case"m":r=1;break;case"y":r=2;break;case"k":r=3;break}break;default:throw new Error(`Unexpected color model: ${t.colorModel}`)}if(r==="a"){if(!t.alpha)throw new Error("validateChannel : the image does not contain alpha channel");r=t.components}if(typeof r=="string")throw new Error(`validateChannel : undefined channel: ${r}`)}if(r>=t.channels)throw new RangeError(`validateChannel : the channel has to be >=0 and <${t.channels}`);if(!e&&r>=t.components)throw new RangeError("validateChannel : alpha channel may not be selected");return r}function medianFilter(t={}){let{radius:r=1,border:e="copy",channels:n}=t;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),r<1)throw new Error("radius must be greater than 0");n=validateArrayOfChannels(this,n);let o=r,s=r,a=Image.createFrom(this),l=(o*2+1)*(s*2+1),c=new Array(l);for(let h=0;h<n.length;h++){let f=n[h];for(let u=s;u<this.height-s;u++)for(let d=o;d<this.width-o;d++){let g=0;for(let y=-s;y<=s;y++)for(let _=-o;_<=o;_++){let w=((u+y)*this.width+d+_)*this.channels+f;c[g++]=this.data[w]}let m=(u*this.width+d)*this.channels+f;a.data[m]=quickSelectMedian(c)}}if(this.alpha&&!n.includes(this.channels))for(let h=this.components;h<this.data.length;h=h+this.channels)a.data[h]=this.data[h];return a.setBorder({size:[o,s],algorithm:e}),a}function gaussianFilter(t={}){let{radius:r=1,sigma:e,channels:n,border:o="copy"}=t;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(r,e);return this.convolution([s,s],{border:o,channels:n,algorithm:"separable"})}function getKernel(t,r){const e=t*2+1,n=new Array(e),o=r||((e-1)*.5-1)*.3+.8,s=-.5/(o*o);let a=0;for(let l=0;l<e;l++){const c=l-t,h=Math.exp(s*c*c);n[l]=h,a+=h}for(let l=0;l<e;l++)n[l]/=a;return n}const DISCRETE_LAPLACE_4=[[0,1,0],[1,-4,1],[0,1,0]],DISCRETE_LAPLACE_8=[[1,1,1],[1,-8,1],[1,1,1]],SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]],SECOND_DERIVATIVE=[[-1,-2,0,2,1],[-2,-4,0,4,2],[0,0,0,0,0],[1,2,0,-2,-1],[2,4,0,-4,-2]],SECOND_DERIVATIVE_INV=[[1,2,0,-2,-1],[2,4,0,-4,-2],[0,0,0,0,0],[-2,-4,0,4,2],[-1,-2,0,2,1]];var src$3={},fftlib={};(function(t){(function(){var r;r=t;var e={release:"0.3.0",date:"2013-03"};r.toString=function(){return"version "+e.release+", released "+e.date};for(var n=0,o=null,s=null,a={init:function(h){if(h!==0&&!(h&h-1))n=h,a._initArray(),a._makeBitReversalTable(),a._makeCosSinTable();else throw new Error("init: radix-2 required")},fft1d:function(h,f){a.fft(h,f,1)},ifft1d:function(h,f){var u=1/n;a.fft(h,f,-1);for(var d=0;d<n;d++)h[d]*=u,f[d]*=u},bt1d:function(h,f){a.fft(h,f,-1)},fft2d:function(h,f){for(var u=[],d=[],g=0,m=0;m<n;m++){g=m*n;for(var y=0;y<n;y++)u[y]=h[y+g],d[y]=f[y+g];a.fft1d(u,d);for(var _=0;_<n;_++)h[_+g]=u[_],f[_+g]=d[_]}for(var w=0;w<n;w++){for(var S=0;S<n;S++)g=w+S*n,u[S]=h[g],d[S]=f[g];a.fft1d(u,d);for(var v=0;v<n;v++)g=w+v*n,h[g]=u[v],f[g]=d[v]}},ifft2d:function(h,f){for(var u=[],d=[],g=0,m=0;m<n;m++){g=m*n;for(var y=0;y<n;y++)u[y]=h[y+g],d[y]=f[y+g];a.ifft1d(u,d);for(var _=0;_<n;_++)h[_+g]=u[_],f[_+g]=d[_]}for(var w=0;w<n;w++){for(var S=0;S<n;S++)g=w+S*n,u[S]=h[g],d[S]=f[g];a.ifft1d(u,d);for(var v=0;v<n;v++)g=w+v*n,h[g]=u[v],f[g]=d[v]}},fft:function(h,f,u){for(var d,g,m,y,_,w,S,v,b,k=n>>2,C=0;C<n;C++)y=o[C],C<y&&(_=h[C],h[C]=h[y],h[y]=_,_=f[C],f[C]=f[y],f[y]=_);for(var R=1;R<n;R<<=1){g=0,d=n/(R<<1);for(var A=0;A<R;A++){w=s[g+k],S=u*s[g];for(var $=A;$<n;$+=R<<1)m=$+R,v=w*h[m]+S*f[m],b=w*f[m]-S*h[m],h[m]=h[$]-v,h[$]+=v,f[m]=f[$]-b,f[$]+=b;g+=d}}},_initArray:function(){typeof Uint32Array<"u"?o=new Uint32Array(n):o=[],typeof Float64Array<"u"?s=new Float64Array(n*1.25):s=[]},_paddingZero:function(){},_makeBitReversalTable:function(){var h=0,f=0,u=0;for(o[0]=0;++h<n;){for(u=n>>1;u<=f;)f-=u,u>>=1;f+=u,o[h]=f}},_makeCosSinTable:function(){var h=n>>1,f=n>>2,u=n>>3,d=h+f,g=Math.sin(Math.PI/n),m=2*g*g,y=Math.sqrt(m*(2-m)),_=s[f]=1,w=s[0]=0;g=2*m;for(var S=1;S<u;S++)_-=m,m+=g*_,w+=y,y-=g*w,s[S]=w,s[f-S]=_;u!==0&&(s[u]=Math.sqrt(.5));for(var v=0;v<f;v++)s[h-v]=s[v];for(var b=0;b<d;b++)s[b+h]=-s[b]}},l=["init","fft1d","ifft1d","fft2d","ifft2d"],c=0;c<l.length;c++)r[l[c]]=a[l[c]];return r.bt=a.bt1d,r.fft=a.fft1d,r.ifft=a.ifft1d,r}).call(commonjsGlobal)})(fftlib);var FFT$1=fftlib,FFTUtils$1={DEBUG:!1,ifft2DArray:function(t,r,e){var n=new Array(r*e),o=r/2,s=(e-1)*2;FFT$1.init(o);for(var a={re:new Array(o),im:new Array(o)},l=0;l<e;l++){for(var c=o-1;c>=0;c--)a.re[c]=t[c*2*e+l],a.im[c]=t[(c*2+1)*e+l];FFT$1.bt(a.re,a.im);for(var c=o-1;c>=0;c--)n[c*2*e+l]=a.re[c],n[(c*2+1)*e+l]=a.im[c]}var h=new Array(o*s);FFT$1.init(s);for(var f={re:new Array(s),im:new Array(s)},u=s*o,c=0;c<r;c+=2){f.re[0]=n[c*e],f.im[0]=n[(c+1)*e];for(var l=1;l<e;l++)f.re[l]=n[c*e+l],f.im[l]=n[(c+1)*e+l],f.re[s-l]=n[c*e+l],f.im[s-l]=-n[(c+1)*e+l];FFT$1.bt(f.re,f.im);for(var d=c/2*s,l=s-1;l>=0;l--)h[d+l]=f.re[l]/u}return h},fft2DArray:function(t,r,e,n){Object.assign({},{inplace:!0});var o=e/2+1,s=r*2,a=new Array(s*o);FFT$1.init(e);for(var l={re:new Array(e),im:new Array(e)},c={re:new Array(e),im:new Array(e)},h={re:new Array(e),im:new Array(e)},f,u,d,g,m,y=0;y<r/2;y++){f=y*2*e,l.re=t.slice(f,f+e),f=(y*2+1)*e,l.im=t.slice(f,f+e),FFT$1.fft1d(l.re,l.im),this.reconstructTwoRealFFT(l,c,h),u=y*4*o,d=(y*4+1)*o,g=(y*4+2)*o,m=(y*4+3)*o;for(var _=o-1;_>=0;_--)a[u+_]=c.re[_],a[d+_]=c.im[_],a[g+_]=h.re[_],a[m+_]=h.im[_]}c=null,h=null;var w=new Array(s*o);FFT$1.init(r);for(var S={re:new Array(r),im:new Array(r)},v=o-1;v>=0;v--){for(var y=r-1;y>=0;y--)S.re[y]=a[y*2*o+v],S.im[y]=a[(y*2+1)*o+v],isNaN(S.re[y])&&(S.re[y]=0),isNaN(S.im[y])&&(S.im[y]=0);FFT$1.fft1d(S.re,S.im);for(var y=r-1;y>=0;y--)w[y*2*o+v]=S.re[y],w[(y*2+1)*o+v]=S.im[y]}return w},reconstructTwoRealFFT:function(t,r,e){var n=t.re.length;r.re[0]=t.re[0],r.im[0]=0,e.re[0]=t.im[0],e.im[0]=0;for(var o,s,a,l,c,h=n/2;h>0;h--)c=n-h,o=.5*(t.re[h]-t.re[c]),s=.5*(t.re[h]+t.re[c]),a=.5*(t.im[h]-t.im[c]),l=.5*(t.im[h]+t.im[c]),r.re[h]=s,r.im[h]=a,r.re[c]=s,r.im[c]=-a,e.re[h]=l,e.im[h]=-o,e.re[c]=l,e.im[c]=o},convolute2DI:function(t,r,e,n){for(var o,s,a=0;a<e/2;a++)for(var l=0;l<n;l++)o=t[a*2*n+l]*r[a*2*n+l]-t[(a*2+1)*n+l]*r[(a*2+1)*n+l],s=t[a*2*n+l]*r[(a*2+1)*n+l]+t[(a*2+1)*n+l]*r[a*2*n+l],t[a*2*n+l]=o,t[(a*2+1)*n+l]=s},convolute:function(t,r,e,n,o){for(var s=new Array(n*e),a=0;a<e*n;a++)s[a]=t[a];s=this.fft2DArray(s,e,n);for(var l=r.length,c=r[0].length,h=new Array(n*e),a=0;a<n*e;a++)h[a]=0;for(var f,u,d=Math.floor((l-1)/2),g=Math.floor((c-1)/2),m=0;m<l;m++){f=(m-d+e)%e;for(var y=0;y<c;y++)u=(y-g+n)%n,h[f*n+u]=r[m][y]}h=this.fft2DArray(h,e,n);var _=e*2,w=n/2+1;return this.convolute2DI(s,h,_,w),this.ifft2DArray(s,_,w)},toRadix2:function(t,r,e){var n,o,s,a,l=e,c=r;if(!(e!==0&&!(e&e-1))){for(l=0;e>>++l;);l=1<<l}if(!(r!==0&&!(r&r-1))){for(c=0;r>>++c;);c=1<<c}if(c==r&&l==e)return{data:t,rows:r,cols:e};var h=new Array(c*l),f=Math.floor((c-r)/2)-r,u=Math.floor((l-e)/2)-e;for(n=0;n<c;n++)for(s=n*l,a=(n-f)%r*e,o=0;o<l;o++)h[s+o]=t[a+(o-u)%e];return{data:h,rows:c,cols:l}},crop:function(t,r,e,n,o,s){if(r==n&&e==o)return t;Object.assign({},s);var a=new Array(o*n),l=Math.floor((r-n)/2),c=Math.floor((e-o)/2),h,f,u,d;for(u=0;u<n;u++)for(h=u*o,f=(u+l)*e,d=0;d<o;d++)a[h+d]=t[f+(d+c)];return a}},FFTUtils_1=FFTUtils$1;src$3.FFTUtils=FFTUtils_1;src$3.FFT=fftlib;var FFTUtils=src$3.FFTUtils;function convolutionFFT(t,r,e){var n=matrix2Array(t),o=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},e),a,l;if(s.rows&&s.cols)a=s.rows,l=s.cols;else throw new Error("Invalid number of rows or columns "+a+" "+l);var c=s.divisor,h,f,u=r.length,d=r[0].length;if(s.normalize)for(c=0,h=0;h<u;h++)for(f=0;f<d;f++)c+=r[h][f];if(c===0)throw new RangeError("convolution: The divisor is equal to zero");var g=FFTUtils.toRadix2(o,a,l),m=FFTUtils.convolute(g.data,r,g.rows,g.cols);if(m=FFTUtils.crop(m,g.rows,g.cols,a,l),c!=0&&c!=1)for(h=0;h<m.length;h++)m[h]/=c;return m}function convolutionDirect(t,r,e){var n=matrix2Array(t),o=n.data,s=Object.assign({normalize:!1,divisor:1,rows:n.rows,cols:n.cols},e),a,l;if(s.rows&&s.cols)a=s.rows,l=s.cols;else throw new Error("Invalid number of rows or columns "+a+" "+l);var c=s.divisor,h=r.length,f=r[0].length,u,d,g,m,y,_,w,S,v;if(s.normalize)for(c=0,u=0;u<h;u++)for(d=0;d<f;d++)c+=r[u][d];if(c===0)throw new RangeError("convolution: The divisor is equal to zero");var b=new Array(a*l),k=Math.floor(h/2),C=Math.floor(f/2);for(m=0;m<a;m++)for(g=0;g<l;g++){for(_=0,d=0;d<h;d++)for(u=0;u<f;u++)w=r[h-d-1][f-u-1],S=(m+d-k+a)%a,v=(g+u-C+l)%l,y=S*l+v,_+=o[y]*w;y=m*l+g,b[y]=_/c}return b}function LoG(t,r,e){var n=1e3;e&&e.factor&&(n=e.factor);var o=new Array(r),s,a,l,c;n*=-1;var h=(r-1)/2,f=2*t*t;for(s=0;s<r;s++)for(o[s]=new Array(r),c=(s-h)*(s-h),a=0;a<r;a++)l=-((a-h)*(a-h)+c)/f,o[s][a]=Math.round(n*(1+l)*Math.exp(l));return o}function matrix2Array(t){var r=t,e,n;if(typeof t[0]!="number"){e=t.length,n=t[0].length,r=new Array(e*n);for(var o=0;o<e;o++)for(var s=0;s<n;s++)r[o*n+s]=t[o][s]}else{var a=Math.sqrt(t.length);Number.isInteger(a)&&(e=a,n=a)}return{data:r,rows:e,cols:n}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG},matrix2Array},_isFinite=Number.isFinite||function(t){return!(typeof t!="number"||t!==t||t===1/0||t===-1/0)},isFinite$1=_isFinite,isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite$1(t)&&Math.floor(t)===t};const isInteger$1=getDefaultExportFromCjs(isInteger);function validateKernel(t){let r,e;if(Array.isArray(t))if(Array.isArray(t[0])){if(!(t.length&1)||!(t[0].length&1))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");r=Math.floor(t.length/2),e=Math.floor(t[0].length/2)}else{let n=Math.sqrt(t.length);if(isInteger$1(n))e=r=Math.floor(Math.sqrt(t.length)/2);else throw new RangeError("validateKernel: Kernel array should be a square");let o=new Array(n);for(let s=0;s<n;s++){o[s]=new Array(n);for(let a=0;a<n;a++)o[s][a]=t[s*n+a]}t=o}else throw new Error(`validateKernel: Invalid Kernel: ${t}`);return{kernel:t,kWidth:e,kHeight:r}}function clamp$1(t,r){return Math.round(Math.min(Math.max(t,0),r.maxValue))}function directConvolution(t,r,e){if(e===void 0){const s=t.length+r.length-1;e=new Array(s)}fill(e);for(var n=0;n<t.length;n++)for(var o=0;o<r.length;o++)e[n+o]+=t[n]*r[o];return e}function fill(t){for(var r=0;r<t.length;r++)t[r]=0}function FFT(t){if(this.size=t|0,this.size<=1||this.size&this.size-1)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var r=new Array(this.size*2),e=0;e<r.length;e+=2){const c=Math.PI*e/this.size;r[e]=Math.cos(c),r[e+1]=-Math.sin(c)}this.table=r;for(var n=0,o=1;this.size>o;o<<=1)n++;this._width=n%2===0?n-1:n,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var a=0;a<this._width;a+=2){var l=this._width-a-2;this._bitrev[s]|=(s>>>a&3)<<l}}this._out=null,this._data=null,this._inv=0}FFT.prototype.fromComplexArray=function t(r,e){for(var n=e||new Array(r.length>>>1),o=0;o<r.length;o+=2)n[o>>>1]=r[o];return n};FFT.prototype.createComplexArray=function t(){const r=new Array(this._csize);for(var e=0;e<r.length;e++)r[e]=0;return r};FFT.prototype.toComplexArray=function t(r,e){for(var n=e||this.createComplexArray(),o=0;o<n.length;o+=2)n[o]=r[o>>>1],n[o+1]=0;return n};FFT.prototype.completeSpectrum=function t(r){for(var e=this._csize,n=e>>>1,o=2;o<n;o+=2)r[e-o]=r[o],r[e-o+1]=-r[o+1]};FFT.prototype.transform=function t(r,e){if(r===e)throw new Error("Input and output buffers must be different");this._out=r,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null};FFT.prototype.realTransform=function t(r,e){if(r===e)throw new Error("Input and output buffers must be different");this._out=r,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null};FFT.prototype.inverseTransform=function t(r,e){if(r===e)throw new Error("Input and output buffers must be different");this._out=r,this._data=e,this._inv=1,this._transform4();for(var n=0;n<r.length;n++)r[n]/=this.size;this._out=null,this._data=null};FFT.prototype._transform4=function t(){var r=this._out,e=this._csize,n=this._width,o=1<<n,s=e/o<<1,a,l,c=this._bitrev;if(s===4)for(a=0,l=0;a<e;a+=s,l++){const y=c[l];this._singleTransform2(a,y,o)}else for(a=0,l=0;a<e;a+=s,l++){const y=c[l];this._singleTransform4(a,y,o)}var h=this._inv?-1:1,f=this.table;for(o>>=2;o>=2;o>>=2){s=e/o<<1;var u=s>>>2;for(a=0;a<e;a+=s)for(var d=a+u,g=a,m=0;g<d;g+=2,m+=o){const y=g,_=y+u,w=_+u,S=w+u,v=r[y],b=r[y+1],k=r[_],C=r[_+1],R=r[w],A=r[w+1],$=r[S],E=r[S+1],I=v,B=b,P=f[m],Y=h*f[m+1],V=k*P-C*Y,J=k*Y+C*P,re=f[2*m],q=h*f[2*m+1],se=R*re-A*q,W=R*q+A*re,de=f[3*m],fe=h*f[3*m+1],Z=$*de-E*fe,X=$*fe+E*de,j=I+se,Q=B+W,oe=I-se,Ee=B-W,me=V+Z,be=J+X,we=h*(V-Z),Ae=h*(J-X),Me=j+me,ie=Q+be,K=j-me,_e=Q-be,pe=oe+Ae,ve=Ee-we,U=oe-Ae,le=Ee+we;r[y]=Me,r[y+1]=ie,r[_]=pe,r[_+1]=ve,r[w]=K,r[w+1]=_e,r[S]=U,r[S+1]=le}}};FFT.prototype._singleTransform2=function t(r,e,n){const o=this._out,s=this._data,a=s[e],l=s[e+1],c=s[e+n],h=s[e+n+1],f=a+c,u=l+h,d=a-c,g=l-h;o[r]=f,o[r+1]=u,o[r+2]=d,o[r+3]=g};FFT.prototype._singleTransform4=function t(r,e,n){const o=this._out,s=this._data,a=this._inv?-1:1,l=n*2,c=n*3,h=s[e],f=s[e+1],u=s[e+n],d=s[e+n+1],g=s[e+l],m=s[e+l+1],y=s[e+c],_=s[e+c+1],w=h+g,S=f+m,v=h-g,b=f-m,k=u+y,C=d+_,R=a*(u-y),A=a*(d-_),$=w+k,E=S+C,I=v+A,B=b-R,P=w-k,Y=S-C,V=v-A,J=b+R;o[r]=$,o[r+1]=E,o[r+2]=I,o[r+3]=B,o[r+4]=P,o[r+5]=Y,o[r+6]=V,o[r+7]=J};FFT.prototype._realTransform4=function t(){var r=this._out,e=this._csize,n=this._width,o=1<<n,s=e/o<<1,a,l,c=this._bitrev;if(s===4)for(a=0,l=0;a<e;a+=s,l++){const F=c[l];this._singleRealTransform2(a,F>>>1,o>>>1)}else for(a=0,l=0;a<e;a+=s,l++){const F=c[l];this._singleRealTransform4(a,F>>>1,o>>>1)}var h=this._inv?-1:1,f=this.table;for(o>>=2;o>=2;o>>=2){s=e/o<<1;var u=s>>>1,d=u>>>1,g=d>>>1;for(a=0;a<e;a+=s)for(var m=0,y=0;m<=g;m+=2,y+=o){var _=a+m,w=_+d,S=w+d,v=S+d,b=r[_],k=r[_+1],C=r[w],R=r[w+1],A=r[S],$=r[S+1],E=r[v],I=r[v+1],B=b,P=k,Y=f[y],V=h*f[y+1],J=C*Y-R*V,re=C*V+R*Y,q=f[2*y],se=h*f[2*y+1],W=A*q-$*se,de=A*se+$*q,fe=f[3*y],Z=h*f[3*y+1],X=E*fe-I*Z,j=E*Z+I*fe,Q=B+W,oe=P+de,Ee=B-W,me=P-de,be=J+X,we=re+j,Ae=h*(J-X),Me=h*(re-j),ie=Q+be,K=oe+we,_e=Ee+Me,pe=me-Ae;if(r[_]=ie,r[_+1]=K,r[w]=_e,r[w+1]=pe,m===0){var ve=Q-be,U=oe-we;r[S]=ve,r[S+1]=U;continue}if(m!==g){var le=Ee,ue=-me,xe=Q,H=-oe,Se=-h*Me,ye=-h*Ae,ee=-h*we,ae=-h*be,ce=le+Se,ne=ue+ye,M=xe+ae,p=H-ee,x=a+d-m,T=a+u-m;r[x]=ce,r[x+1]=ne,r[T]=M,r[T+1]=p}}}};FFT.prototype._singleRealTransform2=function t(r,e,n){const o=this._out,s=this._data,a=s[e],l=s[e+n],c=a+l,h=a-l;o[r]=c,o[r+1]=0,o[r+2]=h,o[r+3]=0};FFT.prototype._singleRealTransform4=function t(r,e,n){const o=this._out,s=this._data,a=this._inv?-1:1,l=n*2,c=n*3,h=s[e],f=s[e+n],u=s[e+l],d=s[e+c],g=h+u,m=h-u,y=f+d,_=a*(f-d),w=g+y,S=m,v=-_,b=g-y,k=m,C=_;o[r]=w,o[r+1]=0,o[r+2]=S,o[r+3]=v,o[r+4]=b,o[r+5]=0,o[r+6]=k,o[r+7]=C};function convolutionSeparable(t,r,e,n){const o=new Array(t.length);let s,a,l,c;c=r[1],l=(c.length-1)/2,a=new Array(e+c.length-1),s=new Array(e);for(let h=0;h<n;h++){for(let f=0;f<e;f++)s[f]=t[h*e+f];directConvolution(s,c,a);for(let f=0;f<e;f++)o[h*e+f]=a[l+f]}c=r[0],l=(c.length-1)/2,a=new Array(n+c.length-1),s=new Array(n);for(let h=0;h<e;h++){for(let f=0;f<n;f++)s[f]=o[f*e+h];directConvolution(s,c,a);for(let f=0;f<n;f++)o[f*e+h]=a[l+f]}return o}var matrix$2={};const toString$1=Object.prototype.toString;function isAnyArray$1(t){const r=toString$1.call(t);return r.endsWith("Array]")&&!r.includes("Big")}const libEsm=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:isAnyArray$1},Symbol.toStringTag,{value:"Module"})),require$$0$3=getAugmentedNamespace(libEsm);function max$1(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray$1(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,n=e===void 0?0:e,o=r.toIndex,s=o===void 0?t.length:o;if(n<0||n>=t.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[n],l=n+1;l<s;l++)t[l]>a&&(a=t[l]);return a}function min$1(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!isAnyArray$1(t))throw new TypeError("input must be an array");if(t.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,n=e===void 0?0:e,o=r.toIndex,s=o===void 0?t.length:o;if(n<0||n>=t.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=n||s>t.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var a=t[n],l=n+1;l<s;l++)t[l]<a&&(a=t[l]);return a}function rescale$1(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(isAnyArray$1(t)){if(t.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(r.output!==void 0){if(!isAnyArray$1(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var n=min$1(t),o=max$1(t);if(n===o)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=r.min,a=s===void 0?r.autoMinMax?n:0:s,l=r.max,c=l===void 0?r.autoMinMax?o:1:l;if(a>=c)throw new RangeError("min option must be smaller than max option");for(var h=(c-a)/(o-n),f=0;f<t.length;f++)e[f]=(t[f]-n)*h+a;return e}const libEs6=Object.freeze(Object.defineProperty({__proto__:null,default:rescale$1},Symbol.toStringTag,{value:"Module"})),require$$1=getAugmentedNamespace(libEs6);Object.defineProperty(matrix$2,"__esModule",{value:!0});var isAnyArray=require$$0$3,rescale=require$$1;const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(t,r={}){const{maxRows:e=15,maxColumns:n=10,maxNumSize:o=8,padMinus:s="auto"}=r;return`${t.constructor.name} {
${indent}[
${indentData}${inspectData(t,e,n,o,s)}
${indent}]
${indent}rows: ${t.rows}
${indent}columns: ${t.columns}
}`}function inspectData(t,r,e,n,o){const{rows:s,columns:a}=t,l=Math.min(s,r),c=Math.min(a,e),h=[];if(o==="auto"){o=!1;e:for(let f=0;f<l;f++)for(let u=0;u<c;u++)if(t.get(f,u)<0){o=!0;break e}}for(let f=0;f<l;f++){let u=[];for(let d=0;d<c;d++)u.push(formatNumber(t.get(f,d),n,o));h.push(`${u.join(" ")}`)}return c!==a&&(h[h.length-1]+=` ... ${a-e} more columns`),l!==s&&h.push(`... ${s-r} more rows`),h.join(`
${indentData}`)}function formatNumber(t,r,e){return(t>=0&&e?` ${formatNumber2(t,r-1)}`:formatNumber2(t,r)).padEnd(r)}function formatNumber2(t,r){let e=t.toString();if(e.length<=r)return e;let n=t.toFixed(r);if(n.length>r&&(n=t.toFixed(Math.max(0,r-(n.length-r)))),n.length<=r&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let o=t.toExponential(r);return o.length>r&&(o=t.toExponential(Math.max(0,r-(o.length-r)))),o.slice(0)}function installMathOperations(t,r){t.prototype.add=function(n){return typeof n=="number"?this.addS(n):this.addM(n)},t.prototype.addS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)+n);return this},t.prototype.addM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)+n.get(o,s));return this},t.add=function(n,o){return new r(n).add(o)},t.prototype.sub=function(n){return typeof n=="number"?this.subS(n):this.subM(n)},t.prototype.subS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)-n);return this},t.prototype.subM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)-n.get(o,s));return this},t.sub=function(n,o){return new r(n).sub(o)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(n){return typeof n=="number"?this.mulS(n):this.mulM(n)},t.prototype.mulS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)*n);return this},t.prototype.mulM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)*n.get(o,s));return this},t.mul=function(n,o){return new r(n).mul(o)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(n){return typeof n=="number"?this.divS(n):this.divM(n)},t.prototype.divS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)/n);return this},t.prototype.divM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)/n.get(o,s));return this},t.div=function(n,o){return new r(n).div(o)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(n){return typeof n=="number"?this.modS(n):this.modM(n)},t.prototype.modS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)%n);return this},t.prototype.modM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)%n.get(o,s));return this},t.mod=function(n,o){return new r(n).mod(o)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(n){return typeof n=="number"?this.andS(n):this.andM(n)},t.prototype.andS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)&n);return this},t.prototype.andM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)&n.get(o,s));return this},t.and=function(n,o){return new r(n).and(o)},t.prototype.or=function(n){return typeof n=="number"?this.orS(n):this.orM(n)},t.prototype.orS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)|n);return this},t.prototype.orM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)|n.get(o,s));return this},t.or=function(n,o){return new r(n).or(o)},t.prototype.xor=function(n){return typeof n=="number"?this.xorS(n):this.xorM(n)},t.prototype.xorS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)^n);return this},t.prototype.xorM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)^n.get(o,s));return this},t.xor=function(n,o){return new r(n).xor(o)},t.prototype.leftShift=function(n){return typeof n=="number"?this.leftShiftS(n):this.leftShiftM(n)},t.prototype.leftShiftS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)<<n);return this},t.prototype.leftShiftM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)<<n.get(o,s));return this},t.leftShift=function(n,o){return new r(n).leftShift(o)},t.prototype.signPropagatingRightShift=function(n){return typeof n=="number"?this.signPropagatingRightShiftS(n):this.signPropagatingRightShiftM(n)},t.prototype.signPropagatingRightShiftS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>n);return this},t.prototype.signPropagatingRightShiftM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>n.get(o,s));return this},t.signPropagatingRightShift=function(n,o){return new r(n).signPropagatingRightShift(o)},t.prototype.rightShift=function(n){return typeof n=="number"?this.rightShiftS(n):this.rightShiftM(n)},t.prototype.rightShiftS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>>n);return this},t.prototype.rightShiftM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)>>>n.get(o,s));return this},t.rightShift=function(n,o){return new r(n).rightShift(o)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,~this.get(n,o));return this},t.not=function(n){return new r(n).not()},t.prototype.abs=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.abs(this.get(n,o)));return this},t.abs=function(n){return new r(n).abs()},t.prototype.acos=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.acos(this.get(n,o)));return this},t.acos=function(n){return new r(n).acos()},t.prototype.acosh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.acosh(this.get(n,o)));return this},t.acosh=function(n){return new r(n).acosh()},t.prototype.asin=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.asin(this.get(n,o)));return this},t.asin=function(n){return new r(n).asin()},t.prototype.asinh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.asinh(this.get(n,o)));return this},t.asinh=function(n){return new r(n).asinh()},t.prototype.atan=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.atan(this.get(n,o)));return this},t.atan=function(n){return new r(n).atan()},t.prototype.atanh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.atanh(this.get(n,o)));return this},t.atanh=function(n){return new r(n).atanh()},t.prototype.cbrt=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.cbrt(this.get(n,o)));return this},t.cbrt=function(n){return new r(n).cbrt()},t.prototype.ceil=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.ceil(this.get(n,o)));return this},t.ceil=function(n){return new r(n).ceil()},t.prototype.clz32=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.clz32(this.get(n,o)));return this},t.clz32=function(n){return new r(n).clz32()},t.prototype.cos=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.cos(this.get(n,o)));return this},t.cos=function(n){return new r(n).cos()},t.prototype.cosh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.cosh(this.get(n,o)));return this},t.cosh=function(n){return new r(n).cosh()},t.prototype.exp=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.exp(this.get(n,o)));return this},t.exp=function(n){return new r(n).exp()},t.prototype.expm1=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.expm1(this.get(n,o)));return this},t.expm1=function(n){return new r(n).expm1()},t.prototype.floor=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.floor(this.get(n,o)));return this},t.floor=function(n){return new r(n).floor()},t.prototype.fround=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.fround(this.get(n,o)));return this},t.fround=function(n){return new r(n).fround()},t.prototype.log=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log(this.get(n,o)));return this},t.log=function(n){return new r(n).log()},t.prototype.log1p=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log1p(this.get(n,o)));return this},t.log1p=function(n){return new r(n).log1p()},t.prototype.log10=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log10(this.get(n,o)));return this},t.log10=function(n){return new r(n).log10()},t.prototype.log2=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.log2(this.get(n,o)));return this},t.log2=function(n){return new r(n).log2()},t.prototype.round=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.round(this.get(n,o)));return this},t.round=function(n){return new r(n).round()},t.prototype.sign=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sign(this.get(n,o)));return this},t.sign=function(n){return new r(n).sign()},t.prototype.sin=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sin(this.get(n,o)));return this},t.sin=function(n){return new r(n).sin()},t.prototype.sinh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sinh(this.get(n,o)));return this},t.sinh=function(n){return new r(n).sinh()},t.prototype.sqrt=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.sqrt(this.get(n,o)));return this},t.sqrt=function(n){return new r(n).sqrt()},t.prototype.tan=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.tan(this.get(n,o)));return this},t.tan=function(n){return new r(n).tan()},t.prototype.tanh=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.tanh(this.get(n,o)));return this},t.tanh=function(n){return new r(n).tanh()},t.prototype.trunc=function(){for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.set(n,o,Math.trunc(this.get(n,o)));return this},t.trunc=function(n){return new r(n).trunc()},t.pow=function(n,o){return new r(n).pow(o)},t.prototype.pow=function(n){return typeof n=="number"?this.powS(n):this.powM(n)},t.prototype.powS=function(n){for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)**n);return this},t.prototype.powM=function(n){if(n=r.checkMatrix(n),this.rows!==n.rows||this.columns!==n.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let s=0;s<this.columns;s++)this.set(o,s,this.get(o,s)**n.get(o,s));return this}}function checkRowIndex(t,r,e){let n=e?t.rows:t.rows-1;if(r<0||r>n)throw new RangeError("Row index out of range")}function checkColumnIndex(t,r,e){let n=e?t.columns:t.columns-1;if(r<0||r>n)throw new RangeError("Column index out of range")}function checkRowVector(t,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function checkColumnVector(t,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function checkRowIndices(t,r){if(!isAnyArray.isAnyArray(r))throw new TypeError("row indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=t.rows)throw new RangeError("row indices are out of range")}function checkColumnIndices(t,r){if(!isAnyArray.isAnyArray(r))throw new TypeError("column indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=t.columns)throw new RangeError("column indices are out of range")}function checkRange(t,r,e,n,o){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",r),checkNumber("endRow",e),checkNumber("startColumn",n),checkNumber("endColumn",o),r>e||n>o||r<0||r>=t.rows||e<0||e>=t.rows||n<0||n>=t.columns||o<0||o>=t.columns)throw new RangeError("Submatrix indices are out of range")}function newArray$2(t,r=0){let e=[];for(let n=0;n<t;n++)e.push(r);return e}function checkNumber(t,r){if(typeof r!="number")throw new TypeError(`${t} must be a number`)}function checkNonEmpty(t){if(t.isEmpty())throw new Error("Empty matrix has no elements to index")}function sumByRow(t){let r=newArray$2(t.rows);for(let e=0;e<t.rows;++e)for(let n=0;n<t.columns;++n)r[e]+=t.get(e,n);return r}function sumByColumn(t){let r=newArray$2(t.columns);for(let e=0;e<t.rows;++e)for(let n=0;n<t.columns;++n)r[n]+=t.get(e,n);return r}function sumAll(t){let r=0;for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)r+=t.get(e,n);return r}function productByRow(t){let r=newArray$2(t.rows,1);for(let e=0;e<t.rows;++e)for(let n=0;n<t.columns;++n)r[e]*=t.get(e,n);return r}function productByColumn(t){let r=newArray$2(t.columns,1);for(let e=0;e<t.rows;++e)for(let n=0;n<t.columns;++n)r[n]*=t.get(e,n);return r}function productAll(t){let r=1;for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)r*=t.get(e,n);return r}function varianceByRow(t,r,e){const n=t.rows,o=t.columns,s=[];for(let a=0;a<n;a++){let l=0,c=0,h=0;for(let f=0;f<o;f++)h=t.get(a,f)-e[a],l+=h,c+=h*h;r?s.push((c-l*l/o)/(o-1)):s.push((c-l*l/o)/o)}return s}function varianceByColumn(t,r,e){const n=t.rows,o=t.columns,s=[];for(let a=0;a<o;a++){let l=0,c=0,h=0;for(let f=0;f<n;f++)h=t.get(f,a)-e[a],l+=h,c+=h*h;r?s.push((c-l*l/n)/(n-1)):s.push((c-l*l/n)/n)}return s}function varianceAll(t,r,e){const n=t.rows,o=t.columns,s=n*o;let a=0,l=0,c=0;for(let h=0;h<n;h++)for(let f=0;f<o;f++)c=t.get(h,f)-e,a+=c,l+=c*c;return r?(l-a*a/s)/(s-1):(l-a*a/s)/s}function centerByRow(t,r){for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)t.set(e,n,t.get(e,n)-r[e])}function centerByColumn(t,r){for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)t.set(e,n,t.get(e,n)-r[n])}function centerAll(t,r){for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)t.set(e,n,t.get(e,n)-r)}function getScaleByRow(t){const r=[];for(let e=0;e<t.rows;e++){let n=0;for(let o=0;o<t.columns;o++)n+=t.get(e,o)**2/(t.columns-1);r.push(Math.sqrt(n))}return r}function scaleByRow(t,r){for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)t.set(e,n,t.get(e,n)/r[e])}function getScaleByColumn(t){const r=[];for(let e=0;e<t.columns;e++){let n=0;for(let o=0;o<t.rows;o++)n+=t.get(o,e)**2/(t.rows-1);r.push(Math.sqrt(n))}return r}function scaleByColumn(t,r){for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)t.set(e,n,t.get(e,n)/r[n])}function getScaleAll(t){const r=t.size-1;let e=0;for(let n=0;n<t.columns;n++)for(let o=0;o<t.rows;o++)e+=t.get(o,n)**2/r;return Math.sqrt(e)}function scaleAll(t,r){for(let e=0;e<t.rows;e++)for(let n=0;n<t.columns;n++)t.set(e,n,t.get(e,n)/r)}let AbstractMatrix$1=class Ce{static from1DArray(r,e,n){if(r*e!==n.length)throw new RangeError("data length does not match given dimensions");let s=new Matrix$3(r,e);for(let a=0;a<r;a++)for(let l=0;l<e;l++)s.set(a,l,n[a*e+l]);return s}static rowVector(r){let e=new Matrix$3(1,r.length);for(let n=0;n<r.length;n++)e.set(0,n,r[n]);return e}static columnVector(r){let e=new Matrix$3(r.length,1);for(let n=0;n<r.length;n++)e.set(n,0,r[n]);return e}static zeros(r,e){return new Matrix$3(r,e)}static ones(r,e){return new Matrix$3(r,e).fill(1)}static rand(r,e,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:o=Math.random}=n;let s=new Matrix$3(r,e);for(let a=0;a<r;a++)for(let l=0;l<e;l++)s.set(a,l,o());return s}static randInt(r,e,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:o=0,max:s=1e3,random:a=Math.random}=n;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(o>=s)throw new RangeError("min must be smaller than max");let l=s-o,c=new Matrix$3(r,e);for(let h=0;h<r;h++)for(let f=0;f<e;f++){let u=o+Math.round(a()*l);c.set(h,f,u)}return c}static eye(r,e,n){e===void 0&&(e=r),n===void 0&&(n=1);let o=Math.min(r,e),s=this.zeros(r,e);for(let a=0;a<o;a++)s.set(a,a,n);return s}static diag(r,e,n){let o=r.length;e===void 0&&(e=o),n===void 0&&(n=e);let s=Math.min(o,e,n),a=this.zeros(e,n);for(let l=0;l<s;l++)a.set(l,l,r[l]);return a}static min(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let n=r.rows,o=r.columns,s=new Matrix$3(n,o);for(let a=0;a<n;a++)for(let l=0;l<o;l++)s.set(a,l,Math.min(r.get(a,l),e.get(a,l)));return s}static max(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let n=r.rows,o=r.columns,s=new this(n,o);for(let a=0;a<n;a++)for(let l=0;l<o;l++)s.set(a,l,Math.max(r.get(a,l),e.get(a,l)));return s}static checkMatrix(r){return Ce.isMatrix(r)?r:new Matrix$3(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)r.call(this,e,n);return this}to1DArray(){let r=[];for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)r.push(this.get(e,n));return r}to2DArray(){let r=[];for(let e=0;e<this.rows;e++){r.push([]);for(let n=0;n<this.columns;n++)r[e].push(this.get(e,n))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let e=0;e<=r;e++)if(this.get(r,e)!==this.get(e,r))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let r=0;r<this.rows;r++)if(this.get(r,r)!==0)return!1;return!0}isEchelonForm(){let r=0,e=0,n=-1,o=!0,s=!1;for(;r<this.rows&&o;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>n?(s=!0,n=e):(o=!1,s=!0);r++}return o}isReducedEchelonForm(){let r=0,e=0,n=-1,o=!0,s=!1;for(;r<this.rows&&o;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>n?(s=!0,n=e):(o=!1,s=!0);for(let a=e+1;a<this.rows;a++)this.get(r,a)!==0&&(o=!1);r++}return o}echelonForm(){let r=this.clone(),e=0,n=0;for(;e<r.rows&&n<r.columns;){let o=e;for(let s=e;s<r.rows;s++)r.get(s,n)>r.get(o,n)&&(o=s);if(r.get(o,n)===0)n++;else{r.swapRows(e,o);let s=r.get(e,n);for(let a=n;a<r.columns;a++)r.set(e,a,r.get(e,a)/s);for(let a=e+1;a<r.rows;a++){let l=r.get(a,n)/r.get(e,n);r.set(a,n,0);for(let c=n+1;c<r.columns;c++)r.set(a,c,r.get(a,c)-r.get(e,c)*l)}e++,n++}}return r}reducedEchelonForm(){let r=this.echelonForm(),e=r.columns,n=r.rows,o=n-1;for(;o>=0;)if(r.maxRow(o)===0)o--;else{let s=0,a=!1;for(;s<n&&a===!1;)r.get(o,s)===1?a=!0:s++;for(let l=0;l<o;l++){let c=r.get(l,s);for(let h=s;h<e;h++){let f=r.get(l,h)-c*r.get(o,h);r.set(l,h,f)}}o--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:n=1}=r;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let o=new Matrix$3(this.rows*e,this.columns*n);for(let s=0;s<e;s++)for(let a=0;a<n;a++)o.setSubMatrix(this,this.rows*s,this.columns*a);return o}fill(r){for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,r);return this}neg(){return this.mulS(-1)}getRow(r){checkRowIndex(this,r);let e=[];for(let n=0;n<this.columns;n++)e.push(this.get(r,n));return e}getRowVector(r){return Matrix$3.rowVector(this.getRow(r))}setRow(r,e){checkRowIndex(this,r),e=checkRowVector(this,e);for(let n=0;n<this.columns;n++)this.set(r,n,e[n]);return this}swapRows(r,e){checkRowIndex(this,r),checkRowIndex(this,e);for(let n=0;n<this.columns;n++){let o=this.get(r,n);this.set(r,n,this.get(e,n)),this.set(e,n,o)}return this}getColumn(r){checkColumnIndex(this,r);let e=[];for(let n=0;n<this.rows;n++)e.push(this.get(n,r));return e}getColumnVector(r){return Matrix$3.columnVector(this.getColumn(r))}setColumn(r,e){checkColumnIndex(this,r),e=checkColumnVector(this,e);for(let n=0;n<this.rows;n++)this.set(n,r,e[n]);return this}swapColumns(r,e){checkColumnIndex(this,r),checkColumnIndex(this,e);for(let n=0;n<this.rows;n++){let o=this.get(n,r);this.set(n,r,this.get(n,e)),this.set(n,e,o)}return this}addRowVector(r){r=checkRowVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+r[n]);return this}subRowVector(r){r=checkRowVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-r[n]);return this}mulRowVector(r){r=checkRowVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*r[n]);return this}divRowVector(r){r=checkRowVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/r[n]);return this}addColumnVector(r){r=checkColumnVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)+r[e]);return this}subColumnVector(r){r=checkColumnVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)-r[e]);return this}mulColumnVector(r){r=checkColumnVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)*r[e]);return this}divColumnVector(r){r=checkColumnVector(this,r);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)this.set(e,n,this.get(e,n)/r[e]);return this}mulRow(r,e){checkRowIndex(this,r);for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*e);return this}mulColumn(r,e){checkColumnIndex(this,r);for(let n=0;n<this.rows;n++)this.set(n,r,this.get(n,r)*e);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>e[n]&&(e[n]=this.get(n,o));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>e[o]&&(e[o]=this.get(n,o));return e}case void 0:{let e=this.get(0,0);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>e&&(e=this.get(n,o));return e}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){checkNonEmpty(this);let r=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)>r&&(r=this.get(n,o),e[0]=n,e[1]=o);return e}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<e[n]&&(e[n]=this.get(n,o));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<e[o]&&(e[o]=this.get(n,o));return e}case void 0:{let e=this.get(0,0);for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<e&&(e=this.get(n,o));return e}default:throw new Error(`invalid option: ${r}`)}}minIndex(){checkNonEmpty(this);let r=this.get(0,0),e=[0,0];for(let n=0;n<this.rows;n++)for(let o=0;o<this.columns;o++)this.get(n,o)<r&&(r=this.get(n,o),e[0]=n,e[1]=o);return e}maxRow(r){if(checkRowIndex(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let n=1;n<this.columns;n++)this.get(r,n)>e&&(e=this.get(r,n));return e}maxRowIndex(r){checkRowIndex(this,r),checkNonEmpty(this);let e=this.get(r,0),n=[r,0];for(let o=1;o<this.columns;o++)this.get(r,o)>e&&(e=this.get(r,o),n[1]=o);return n}minRow(r){if(checkRowIndex(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let n=1;n<this.columns;n++)this.get(r,n)<e&&(e=this.get(r,n));return e}minRowIndex(r){checkRowIndex(this,r),checkNonEmpty(this);let e=this.get(r,0),n=[r,0];for(let o=1;o<this.columns;o++)this.get(r,o)<e&&(e=this.get(r,o),n[1]=o);return n}maxColumn(r){if(checkColumnIndex(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let n=1;n<this.rows;n++)this.get(n,r)>e&&(e=this.get(n,r));return e}maxColumnIndex(r){checkColumnIndex(this,r),checkNonEmpty(this);let e=this.get(0,r),n=[0,r];for(let o=1;o<this.rows;o++)this.get(o,r)>e&&(e=this.get(o,r),n[0]=o);return n}minColumn(r){if(checkColumnIndex(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let n=1;n<this.rows;n++)this.get(n,r)<e&&(e=this.get(n,r));return e}minColumnIndex(r){checkColumnIndex(this,r),checkNonEmpty(this);let e=this.get(0,r),n=[0,r];for(let o=1;o<this.rows;o++)this.get(o,r)<e&&(e=this.get(o,r),n[0]=o);return n}diag(){let r=Math.min(this.rows,this.columns),e=[];for(let n=0;n<r;n++)e.push(this.get(n,n));return e}norm(r="frobenius"){switch(r){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${r}`)}}cumulativeSum(){let r=0;for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)r+=this.get(e,n),this.set(e,n,r);return this}dot(r){Ce.isMatrix(r)&&(r=r.to1DArray());let e=this.to1DArray();if(e.length!==r.length)throw new RangeError("vectors do not have the same size");let n=0;for(let o=0;o<e.length;o++)n+=e[o]*r[o];return n}mmul(r){r=Matrix$3.checkMatrix(r);let e=this.rows,n=this.columns,o=r.columns,s=new Matrix$3(e,o),a=new Float64Array(n);for(let l=0;l<o;l++){for(let c=0;c<n;c++)a[c]=r.get(c,l);for(let c=0;c<e;c++){let h=0;for(let f=0;f<n;f++)h+=this.get(c,f)*a[f];s.set(c,l,h)}}return s}mpow(r){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(r)||r<0)throw new RangeError("Exponent must be a non-negative integer");let e=Matrix$3.eye(this.rows),n=this;for(let o=r;o>1;o/=2)o&1&&(e=e.mmul(n)),n=n.mmul(n);return e}strassen2x2(r){r=Matrix$3.checkMatrix(r);let e=new Matrix$3(2,2);const n=this.get(0,0),o=r.get(0,0),s=this.get(0,1),a=r.get(0,1),l=this.get(1,0),c=r.get(1,0),h=this.get(1,1),f=r.get(1,1),u=(n+h)*(o+f),d=(l+h)*o,g=n*(a-f),m=h*(c-o),y=(n+s)*f,_=(l-n)*(o+a),w=(s-h)*(c+f),S=u+m-y+w,v=g+y,b=d+m,k=u-d+g+_;return e.set(0,0,S),e.set(0,1,v),e.set(1,0,b),e.set(1,1,k),e}strassen3x3(r){r=Matrix$3.checkMatrix(r);let e=new Matrix$3(3,3);const n=this.get(0,0),o=this.get(0,1),s=this.get(0,2),a=this.get(1,0),l=this.get(1,1),c=this.get(1,2),h=this.get(2,0),f=this.get(2,1),u=this.get(2,2),d=r.get(0,0),g=r.get(0,1),m=r.get(0,2),y=r.get(1,0),_=r.get(1,1),w=r.get(1,2),S=r.get(2,0),v=r.get(2,1),b=r.get(2,2),k=(n+o+s-a-l-f-u)*_,C=(n-a)*(-g+_),R=l*(-d+g+y-_-w-S+b),A=(-n+a+l)*(d-g+_),$=(a+l)*(-d+g),E=n*d,I=(-n+h+f)*(d-m+w),B=(-n+h)*(m-w),P=(h+f)*(-d+m),Y=(n+o+s-l-c-h-f)*w,V=f*(-d+m+y-_-w-S+v),J=(-s+f+u)*(_+S-v),re=(s-u)*(_-v),q=s*S,se=(f+u)*(-S+v),W=(-s+l+c)*(w+S-b),de=(s-c)*(w-b),fe=(l+c)*(-S+b),Z=o*y,X=c*v,j=a*m,Q=h*g,oe=u*b,Ee=E+q+Z,me=k+A+$+E+J+q+se,be=E+I+P+Y+q+W+fe,we=C+R+A+E+q+W+de,Ae=C+A+$+E+X,Me=q+W+de+fe+j,ie=E+I+B+V+J+re+q,K=J+re+q+se+Q,_e=E+I+B+P+oe;return e.set(0,0,Ee),e.set(0,1,me),e.set(0,2,be),e.set(1,0,we),e.set(1,1,Ae),e.set(1,2,Me),e.set(2,0,ie),e.set(2,1,K),e.set(2,2,_e),e}mmulStrassen(r){r=Matrix$3.checkMatrix(r);let e=this.clone(),n=e.rows,o=e.columns,s=r.rows,a=r.columns;o!==s&&console.warn(`Multiplying ${n} x ${o} and ${s} x ${a} matrix: dimensions do not match.`);function l(u,d,g){let m=u.rows,y=u.columns;if(m===d&&y===g)return u;{let _=Ce.zeros(d,g);return _=_.setSubMatrix(u,0,0),_}}let c=Math.max(n,s),h=Math.max(o,a);e=l(e,c,h),r=l(r,c,h);function f(u,d,g,m){if(g<=512||m<=512)return u.mmul(d);g%2===1&&m%2===1?(u=l(u,g+1,m+1),d=l(d,g+1,m+1)):g%2===1?(u=l(u,g+1,m),d=l(d,g+1,m)):m%2===1&&(u=l(u,g,m+1),d=l(d,g,m+1));let y=parseInt(u.rows/2,10),_=parseInt(u.columns/2,10),w=u.subMatrix(0,y-1,0,_-1),S=d.subMatrix(0,y-1,0,_-1),v=u.subMatrix(0,y-1,_,u.columns-1),b=d.subMatrix(0,y-1,_,d.columns-1),k=u.subMatrix(y,u.rows-1,0,_-1),C=d.subMatrix(y,d.rows-1,0,_-1),R=u.subMatrix(y,u.rows-1,_,u.columns-1),A=d.subMatrix(y,d.rows-1,_,d.columns-1),$=f(Ce.add(w,R),Ce.add(S,A),y,_),E=f(Ce.add(k,R),S,y,_),I=f(w,Ce.sub(b,A),y,_),B=f(R,Ce.sub(C,S),y,_),P=f(Ce.add(w,v),A,y,_),Y=f(Ce.sub(k,w),Ce.add(S,b),y,_),V=f(Ce.sub(v,R),Ce.add(C,A),y,_),J=Ce.add($,B);J.sub(P),J.add(V);let re=Ce.add(I,P),q=Ce.add(E,B),se=Ce.sub($,E);se.add(I),se.add(Y);let W=Ce.zeros(2*J.rows,2*J.columns);return W=W.setSubMatrix(J,0,0),W=W.setSubMatrix(re,J.rows,0),W=W.setSubMatrix(q,0,J.columns),W=W.setSubMatrix(se,J.rows,J.columns),W.subMatrix(0,g-1,0,m-1)}return f(e,r,c,h)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:n=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let o=new Matrix$3(this.rows,this.columns);for(let s=0;s<this.rows;s++){const a=this.getRow(s);a.length>0&&rescale(a,{min:e,max:n,output:a}),o.setRow(s,a)}return o}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:n=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(e>=n)throw new RangeError("min must be smaller than max");let o=new Matrix$3(this.rows,this.columns);for(let s=0;s<this.columns;s++){const a=this.getColumn(s);a.length&&rescale(a,{min:e,max:n,output:a}),o.setColumn(s,a)}return o}flipRows(){const r=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let n=0;n<r;n++){let o=this.get(e,n),s=this.get(e,this.columns-1-n);this.set(e,n,s),this.set(e,this.columns-1-n,o)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let n=0;n<r;n++){let o=this.get(n,e),s=this.get(this.rows-1-n,e);this.set(n,e,s),this.set(this.rows-1-n,e,o)}return this}kroneckerProduct(r){r=Matrix$3.checkMatrix(r);let e=this.rows,n=this.columns,o=r.rows,s=r.columns,a=new Matrix$3(e*o,n*s);for(let l=0;l<e;l++)for(let c=0;c<n;c++)for(let h=0;h<o;h++)for(let f=0;f<s;f++)a.set(o*l+h,s*c+f,this.get(l,c)*r.get(h,f));return a}kroneckerSum(r){if(r=Matrix$3.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,n=r.rows,o=this.kroneckerProduct(Matrix$3.eye(n,n)),s=Matrix$3.eye(e,e).kroneckerProduct(r);return o.add(s)}transpose(){let r=new Matrix$3(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let n=0;n<this.columns;n++)r.set(n,e,this.get(e,n));return r}sortRows(r=compareNumbers){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(r));return this}sortColumns(r=compareNumbers){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(r));return this}subMatrix(r,e,n,o){checkRange(this,r,e,n,o);let s=new Matrix$3(e-r+1,o-n+1);for(let a=r;a<=e;a++)for(let l=n;l<=o;l++)s.set(a-r,l-n,this.get(a,l));return s}subMatrixRow(r,e,n){if(e===void 0&&(e=0),n===void 0&&(n=this.columns-1),e>n||e<0||e>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let o=new Matrix$3(r.length,n-e+1);for(let s=0;s<r.length;s++)for(let a=e;a<=n;a++){if(r[s]<0||r[s]>=this.rows)throw new RangeError(`Row index out of range: ${r[s]}`);o.set(s,a-e,this.get(r[s],a))}return o}subMatrixColumn(r,e,n){if(e===void 0&&(e=0),n===void 0&&(n=this.rows-1),e>n||e<0||e>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let o=new Matrix$3(n-e+1,r.length);for(let s=0;s<r.length;s++)for(let a=e;a<=n;a++){if(r[s]<0||r[s]>=this.columns)throw new RangeError(`Column index out of range: ${r[s]}`);o.set(a-e,s,this.get(a,r[s]))}return o}setSubMatrix(r,e,n){if(r=Matrix$3.checkMatrix(r),r.isEmpty())return this;let o=e+r.rows-1,s=n+r.columns-1;checkRange(this,e,o,n,s);for(let a=0;a<r.rows;a++)for(let l=0;l<r.columns;l++)this.set(e+a,n+l,r.get(a,l));return this}selection(r,e){checkRowIndices(this,r),checkColumnIndices(this,e);let n=new Matrix$3(r.length,e.length);for(let o=0;o<r.length;o++){let s=r[o];for(let a=0;a<e.length;a++){let l=e[a];n.set(o,a,this.get(s,l))}}return n}trace(){let r=Math.min(this.rows,this.columns),e=0;for(let n=0;n<r;n++)e+=this.get(n,n);return e}clone(){return this.constructor.copy(this,new Matrix$3(this.rows,this.columns))}static copy(r,e){for(const[n,o,s]of r.entries())e.set(n,o,s);return e}sum(r){switch(r){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const e=this.sum(r);switch(r){case"row":{for(let n=0;n<this.rows;n++)e[n]/=this.columns;return e}case"column":{for(let n=0;n<this.columns;n++)e[n]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:o=this.mean(r)}=e;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!isAnyArray.isAnyArray(o))throw new TypeError("mean must be an array");return varianceByRow(this,n,o)}case"column":{if(!isAnyArray.isAnyArray(o))throw new TypeError("mean must be an array");return varianceByColumn(this,n,o)}case void 0:{if(typeof o!="number")throw new TypeError("mean must be a number");return varianceAll(this,n,o)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,e){typeof r=="object"&&(e=r,r=void 0);const n=this.variance(r,e);if(r===void 0)return Math.sqrt(n);for(let o=0;o<n.length;o++)n[o]=Math.sqrt(n[o]);return n}center(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:n=this.mean(r)}=e;switch(r){case"row":{if(!isAnyArray.isAnyArray(n))throw new TypeError("center must be an array");return centerByRow(this,n),this}case"column":{if(!isAnyArray.isAnyArray(n))throw new TypeError("center must be an array");return centerByColumn(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return centerAll(this,n),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");let n=e.scale;switch(r){case"row":{if(n===void 0)n=getScaleByRow(this);else if(!isAnyArray.isAnyArray(n))throw new TypeError("scale must be an array");return scaleByRow(this,n),this}case"column":{if(n===void 0)n=getScaleByColumn(this);else if(!isAnyArray.isAnyArray(n))throw new TypeError("scale must be an array");return scaleByColumn(this,n),this}case void 0:{if(n===void 0)n=getScaleAll(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return scaleAll(this,n),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return inspectMatrixWithOptions(this,r)}[Symbol.iterator](){return this.entries()}*entries(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield[r,e,this.get(r,e)]}*values(){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)yield this.get(r,e)}};AbstractMatrix$1.prototype.klass="Matrix";typeof Symbol<"u"&&(AbstractMatrix$1.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix);function compareNumbers(t,r){return t-r}function isArrayOfNumbers(t){return t.every(r=>typeof r=="number")}AbstractMatrix$1.random=AbstractMatrix$1.rand;AbstractMatrix$1.randomInt=AbstractMatrix$1.randInt;AbstractMatrix$1.diagonal=AbstractMatrix$1.diag;AbstractMatrix$1.prototype.diagonal=AbstractMatrix$1.prototype.diag;AbstractMatrix$1.identity=AbstractMatrix$1.eye;AbstractMatrix$1.prototype.negate=AbstractMatrix$1.prototype.neg;AbstractMatrix$1.prototype.tensorProduct=AbstractMatrix$1.prototype.kroneckerProduct;var et,at,qe;let Matrix$3=(qe=class extends AbstractMatrix$1{constructor(e,n){super();ot(this,et);dt(this,"data");if(qe.isMatrix(e))st(this,et,at).call(this,e.rows,e.columns),qe.copy(e,this);else if(Number.isInteger(e)&&e>=0)st(this,et,at).call(this,e,n);else if(isAnyArray.isAnyArray(e)){const o=e;if(e=o.length,n=e?o[0].length:0,typeof n!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<e;s++){if(o[s].length!==n)throw new RangeError("Inconsistent array dimensions");if(!isArrayOfNumbers(o[s]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(o[s]))}this.rows=e,this.columns=n}else throw new TypeError("First argument must be a positive number or an array")}set(e,n,o){return this.data[e][n]=o,this}get(e,n){return this.data[e][n]}removeRow(e){return checkRowIndex(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,n){return n===void 0&&(n=e,e=this.rows),checkRowIndex(this,e,!0),n=Float64Array.from(checkRowVector(this,n)),this.data.splice(e,0,n),this.rows+=1,this}removeColumn(e){checkColumnIndex(this,e);for(let n=0;n<this.rows;n++){const o=new Float64Array(this.columns-1);for(let s=0;s<e;s++)o[s]=this.data[n][s];for(let s=e+1;s<this.columns;s++)o[s-1]=this.data[n][s];this.data[n]=o}return this.columns-=1,this}addColumn(e,n){typeof n>"u"&&(n=e,e=this.columns),checkColumnIndex(this,e,!0),n=checkColumnVector(this,n);for(let o=0;o<this.rows;o++){const s=new Float64Array(this.columns+1);let a=0;for(;a<e;a++)s[a]=this.data[o][a];for(s[a++]=n[o];a<this.columns+1;a++)s[a]=this.data[o][a-1];this.data[o]=s}return this.columns+=1,this}},et=new WeakSet,at=function(e,n){if(this.data=[],Number.isInteger(n)&&n>=0)for(let o=0;o<e;o++)this.data.push(new Float64Array(n));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=n},qe);installMathOperations(AbstractMatrix$1,Matrix$3);var Le,We;let SymmetricMatrix$1=(We=class extends AbstractMatrix$1{constructor(e){super();ot(this,Le);if(Matrix$3.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");it(this,Le,Matrix$3.copy(e,new Matrix$3(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)it(this,Le,new Matrix$3(e,e));else if(it(this,Le,new Matrix$3(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return Ye(this,Le).size}get rows(){return Ye(this,Le).rows}get columns(){return Ye(this,Le).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return Matrix$3.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new We(this.diagonalSize);for(const[n,o,s]of this.upperRightEntries())e.set(n,o,s);return e}toMatrix(){return new Matrix$3(this)}get(e,n){return Ye(this,Le).get(e,n)}set(e,n,o){return Ye(this,Le).set(e,n,o),Ye(this,Le).set(n,e,o),this}removeCross(e){return Ye(this,Le).removeRow(e),Ye(this,Le).removeColumn(e),this}addCross(e,n){n===void 0&&(n=e,e=this.diagonalSize);const o=n.slice();return o.splice(e,1),Ye(this,Le).addRow(e,o),Ye(this,Le).addColumn(e,n),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const n=[];for(const[o,s]of e.entries())s||n.push(o);n.reverse();for(const o of n)this.removeCross(o);return this}toCompact(){const{diagonalSize:e}=this,n=new Array(e*(e+1)/2);for(let o=0,s=0,a=0;a<n.length;a++)n[a]=this.get(s,o),++o>=e&&(o=++s);return n}static fromCompact(e){const n=e.length,o=(Math.sqrt(8*n+1)-1)/2;if(!Number.isInteger(o))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const s=new We(o);for(let a=0,l=0,c=0;c<n;c++)s.set(a,l,e[c]),++a>=o&&(a=++l);return s}*upperRightEntries(){for(let e=0,n=0;e<this.diagonalSize;void 0){const o=this.get(e,n);yield[e,n,o],++n>=this.diagonalSize&&(n=++e)}}*upperRightValues(){for(let e=0,n=0;e<this.diagonalSize;void 0)yield this.get(e,n),++n>=this.diagonalSize&&(n=++e)}},Le=new WeakMap,We);SymmetricMatrix$1.prototype.klassType="SymmetricMatrix";let DistanceMatrix$1=class pt extends SymmetricMatrix$1{static isDistanceMatrix(r){return SymmetricMatrix$1.isSymmetricMatrix(r)&&r.klassSubType==="DistanceMatrix"}constructor(r){if(super(r),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(r,e,n){return r===e&&(n=0),super.set(r,e,n)}addCross(r,e){return e===void 0&&(e=r,r=this.diagonalSize),e=e.slice(),e[r]=0,super.addCross(r,e)}toSymmetricMatrix(){return new SymmetricMatrix$1(this)}clone(){const r=new pt(this.diagonalSize);for(const[e,n,o]of this.upperRightEntries())e!==n&&r.set(e,n,o);return r}toCompact(){const{diagonalSize:r}=this,e=(r-1)*r/2,n=new Array(e);for(let o=1,s=0,a=0;a<n.length;a++)n[a]=this.get(s,o),++o>=r&&(o=++s+1);return n}static fromCompact(r){const e=r.length;if(e===0)return new this(0);const n=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(r)}`);const o=new this(n);for(let s=1,a=0,l=0;l<e;l++)o.set(s,a,r[l]),++s>=n&&(s=++a+1);return o}};DistanceMatrix$1.prototype.klassSubType="DistanceMatrix";class BaseView extends AbstractMatrix$1{constructor(r,e,n){super(),this.matrix=r,this.rows=e,this.columns=n}}let MatrixColumnView$1=class extends BaseView{constructor(r,e){checkColumnIndex(r,e),super(r,r.rows,1),this.column=e}set(r,e,n){return this.matrix.set(r,this.column,n),this}get(r){return this.matrix.get(r,this.column)}},MatrixColumnSelectionView$1=class extends BaseView{constructor(r,e){checkColumnIndices(r,e),super(r,r.rows,e.length),this.columnIndices=e}set(r,e,n){return this.matrix.set(r,this.columnIndices[e],n),this}get(r,e){return this.matrix.get(r,this.columnIndices[e])}},MatrixFlipColumnView$1=class extends BaseView{constructor(r){super(r,r.rows,r.columns)}set(r,e,n){return this.matrix.set(r,this.columns-e-1,n),this}get(r,e){return this.matrix.get(r,this.columns-e-1)}},MatrixFlipRowView$1=class extends BaseView{constructor(r){super(r,r.rows,r.columns)}set(r,e,n){return this.matrix.set(this.rows-r-1,e,n),this}get(r,e){return this.matrix.get(this.rows-r-1,e)}},MatrixRowView$1=class extends BaseView{constructor(r,e){checkRowIndex(r,e),super(r,1,r.columns),this.row=e}set(r,e,n){return this.matrix.set(this.row,e,n),this}get(r,e){return this.matrix.get(this.row,e)}},MatrixRowSelectionView$1=class extends BaseView{constructor(r,e){checkRowIndices(r,e),super(r,e.length,r.columns),this.rowIndices=e}set(r,e,n){return this.matrix.set(this.rowIndices[r],e,n),this}get(r,e){return this.matrix.get(this.rowIndices[r],e)}},MatrixSelectionView$1=class extends BaseView{constructor(r,e,n){checkRowIndices(r,e),checkColumnIndices(r,n),super(r,e.length,n.length),this.rowIndices=e,this.columnIndices=n}set(r,e,n){return this.matrix.set(this.rowIndices[r],this.columnIndices[e],n),this}get(r,e){return this.matrix.get(this.rowIndices[r],this.columnIndices[e])}},MatrixSubView$1=class extends BaseView{constructor(r,e,n,o,s){checkRange(r,e,n,o,s),super(r,n-e+1,s-o+1),this.startRow=e,this.startColumn=o}set(r,e,n){return this.matrix.set(this.startRow+r,this.startColumn+e,n),this}get(r,e){return this.matrix.get(this.startRow+r,this.startColumn+e)}},MatrixTransposeView$2=class extends BaseView{constructor(r){super(r,r.columns,r.rows)}set(r,e,n){return this.matrix.set(e,r,n),this}get(r,e){return this.matrix.get(e,r)}},WrapperMatrix1D$1=class extends AbstractMatrix$1{constructor(r,e={}){const{rows:n=1}=e;if(r.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=r.length/n,this.data=r}set(r,e,n){let o=this._calculateIndex(r,e);return this.data[o]=n,this}get(r,e){let n=this._calculateIndex(r,e);return this.data[n]}_calculateIndex(r,e){return r*this.columns+e}},WrapperMatrix2D$1=class extends AbstractMatrix$1{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,n){return this.data[r][e]=n,this}get(r,e){return this.data[r][e]}};function wrap$1(t,r){if(isAnyArray.isAnyArray(t))return t[0]&&isAnyArray.isAnyArray(t[0])?new WrapperMatrix2D$1(t):new WrapperMatrix1D$1(t,r);throw new Error("the argument is not an array")}let LuDecomposition$1=class{constructor(r){r=WrapperMatrix2D$1.checkMatrix(r);let e=r.clone(),n=e.rows,o=e.columns,s=new Float64Array(n),a=1,l,c,h,f,u,d,g,m,y;for(l=0;l<n;l++)s[l]=l;for(m=new Float64Array(n),c=0;c<o;c++){for(l=0;l<n;l++)m[l]=e.get(l,c);for(l=0;l<n;l++){for(y=Math.min(l,c),u=0,h=0;h<y;h++)u+=e.get(l,h)*m[h];m[l]-=u,e.set(l,c,m[l])}for(f=c,l=c+1;l<n;l++)Math.abs(m[l])>Math.abs(m[f])&&(f=l);if(f!==c){for(h=0;h<o;h++)d=e.get(f,h),e.set(f,h,e.get(c,h)),e.set(c,h,d);g=s[f],s[f]=s[c],s[c]=g,a=-a}if(c<n&&e.get(c,c)!==0)for(l=c+1;l<n;l++)e.set(l,c,e.get(l,c)/e.get(c,c))}this.LU=e,this.pivotVector=s,this.pivotSign=a}isSingular(){let r=this.LU,e=r.columns;for(let n=0;n<e;n++)if(r.get(n,n)===0)return!0;return!1}solve(r){r=Matrix$3.checkMatrix(r);let e=this.LU;if(e.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let o=r.columns,s=r.subMatrixRow(this.pivotVector,0,o-1),a=e.columns,l,c,h;for(h=0;h<a;h++)for(l=h+1;l<a;l++)for(c=0;c<o;c++)s.set(l,c,s.get(l,c)-s.get(h,c)*e.get(l,h));for(h=a-1;h>=0;h--){for(c=0;c<o;c++)s.set(h,c,s.get(h,c)/e.get(h,h));for(l=0;l<h;l++)for(c=0;c<o;c++)s.set(l,c,s.get(l,c)-s.get(h,c)*e.get(l,h))}return s}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,n=r.columns;for(let o=0;o<n;o++)e*=r.get(o,o);return e}get lowerTriangularMatrix(){let r=this.LU,e=r.rows,n=r.columns,o=new Matrix$3(e,n);for(let s=0;s<e;s++)for(let a=0;a<n;a++)s>a?o.set(s,a,r.get(s,a)):s===a?o.set(s,a,1):o.set(s,a,0);return o}get upperTriangularMatrix(){let r=this.LU,e=r.rows,n=r.columns,o=new Matrix$3(e,n);for(let s=0;s<e;s++)for(let a=0;a<n;a++)s<=a?o.set(s,a,r.get(s,a)):o.set(s,a,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}};function hypotenuse$1(t,r){let e=0;return Math.abs(t)>Math.abs(r)?(e=r/t,Math.abs(t)*Math.sqrt(1+e*e)):r!==0?(e=t/r,Math.abs(r)*Math.sqrt(1+e*e)):0}let QrDecomposition$1=class{constructor(r){r=WrapperMatrix2D$1.checkMatrix(r);let e=r.clone(),n=r.rows,o=r.columns,s=new Float64Array(o),a,l,c,h;for(c=0;c<o;c++){let f=0;for(a=c;a<n;a++)f=hypotenuse$1(f,e.get(a,c));if(f!==0){for(e.get(c,c)<0&&(f=-f),a=c;a<n;a++)e.set(a,c,e.get(a,c)/f);for(e.set(c,c,e.get(c,c)+1),l=c+1;l<o;l++){for(h=0,a=c;a<n;a++)h+=e.get(a,c)*e.get(a,l);for(h=-h/e.get(c,c),a=c;a<n;a++)e.set(a,l,e.get(a,l)+h*e.get(a,c))}}s[c]=-f}this.QR=e,this.Rdiag=s}solve(r){r=Matrix$3.checkMatrix(r);let e=this.QR,n=e.rows;if(r.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o=r.columns,s=r.clone(),a=e.columns,l,c,h,f;for(h=0;h<a;h++)for(c=0;c<o;c++){for(f=0,l=h;l<n;l++)f+=e.get(l,h)*s.get(l,c);for(f=-f/e.get(h,h),l=h;l<n;l++)s.set(l,c,s.get(l,c)+f*e.get(l,h))}for(h=a-1;h>=0;h--){for(c=0;c<o;c++)s.set(h,c,s.get(h,c)/this.Rdiag[h]);for(l=0;l<h;l++)for(c=0;c<o;c++)s.set(l,c,s.get(l,c)-s.get(h,c)*e.get(l,h))}return s.subMatrix(0,a-1,0,o-1)}isFullRank(){let r=this.QR.columns;for(let e=0;e<r;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,e=r.columns,n=new Matrix$3(e,e),o,s;for(o=0;o<e;o++)for(s=0;s<e;s++)o<s?n.set(o,s,r.get(o,s)):o===s?n.set(o,s,this.Rdiag[o]):n.set(o,s,0);return n}get orthogonalMatrix(){let r=this.QR,e=r.rows,n=r.columns,o=new Matrix$3(e,n),s,a,l,c;for(l=n-1;l>=0;l--){for(s=0;s<e;s++)o.set(s,l,0);for(o.set(l,l,1),a=l;a<n;a++)if(r.get(l,l)!==0){for(c=0,s=l;s<e;s++)c+=r.get(s,l)*o.get(s,a);for(c=-c/r.get(l,l),s=l;s<e;s++)o.set(s,a,o.get(s,a)+c*r.get(s,l))}}return o}},SingularValueDecomposition$1=class{constructor(r,e={}){if(r=WrapperMatrix2D$1.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let n=r.rows,o=r.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:a=!0,autoTranspose:l=!1}=e;let c=!!s,h=!!a,f=!1,u;if(n<o)if(!l)u=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{u=r.transpose(),n=u.rows,o=u.columns,f=!0;let E=c;c=h,h=E}else u=r.clone();let d=Math.min(n,o),g=Math.min(n+1,o),m=new Float64Array(g),y=new Matrix$3(n,d),_=new Matrix$3(o,o),w=new Float64Array(o),S=new Float64Array(n),v=new Float64Array(g);for(let E=0;E<g;E++)v[E]=E;let b=Math.min(n-1,o),k=Math.max(0,Math.min(o-2,n)),C=Math.max(b,k);for(let E=0;E<C;E++){if(E<b){m[E]=0;for(let I=E;I<n;I++)m[E]=hypotenuse$1(m[E],u.get(I,E));if(m[E]!==0){u.get(E,E)<0&&(m[E]=-m[E]);for(let I=E;I<n;I++)u.set(I,E,u.get(I,E)/m[E]);u.set(E,E,u.get(E,E)+1)}m[E]=-m[E]}for(let I=E+1;I<o;I++){if(E<b&&m[E]!==0){let B=0;for(let P=E;P<n;P++)B+=u.get(P,E)*u.get(P,I);B=-B/u.get(E,E);for(let P=E;P<n;P++)u.set(P,I,u.get(P,I)+B*u.get(P,E))}w[I]=u.get(E,I)}if(c&&E<b)for(let I=E;I<n;I++)y.set(I,E,u.get(I,E));if(E<k){w[E]=0;for(let I=E+1;I<o;I++)w[E]=hypotenuse$1(w[E],w[I]);if(w[E]!==0){w[E+1]<0&&(w[E]=0-w[E]);for(let I=E+1;I<o;I++)w[I]/=w[E];w[E+1]+=1}if(w[E]=-w[E],E+1<n&&w[E]!==0){for(let I=E+1;I<n;I++)S[I]=0;for(let I=E+1;I<n;I++)for(let B=E+1;B<o;B++)S[I]+=w[B]*u.get(I,B);for(let I=E+1;I<o;I++){let B=-w[I]/w[E+1];for(let P=E+1;P<n;P++)u.set(P,I,u.get(P,I)+B*S[P])}}if(h)for(let I=E+1;I<o;I++)_.set(I,E,w[I])}}let R=Math.min(o,n+1);if(b<o&&(m[b]=u.get(b,b)),n<R&&(m[R-1]=0),k+1<R&&(w[k]=u.get(k,R-1)),w[R-1]=0,c){for(let E=b;E<d;E++){for(let I=0;I<n;I++)y.set(I,E,0);y.set(E,E,1)}for(let E=b-1;E>=0;E--)if(m[E]!==0){for(let I=E+1;I<d;I++){let B=0;for(let P=E;P<n;P++)B+=y.get(P,E)*y.get(P,I);B=-B/y.get(E,E);for(let P=E;P<n;P++)y.set(P,I,y.get(P,I)+B*y.get(P,E))}for(let I=E;I<n;I++)y.set(I,E,-y.get(I,E));y.set(E,E,1+y.get(E,E));for(let I=0;I<E-1;I++)y.set(I,E,0)}else{for(let I=0;I<n;I++)y.set(I,E,0);y.set(E,E,1)}}if(h)for(let E=o-1;E>=0;E--){if(E<k&&w[E]!==0)for(let I=E+1;I<o;I++){let B=0;for(let P=E+1;P<o;P++)B+=_.get(P,E)*_.get(P,I);B=-B/_.get(E+1,E);for(let P=E+1;P<o;P++)_.set(P,I,_.get(P,I)+B*_.get(P,E))}for(let I=0;I<o;I++)_.set(I,E,0);_.set(E,E,1)}let A=R-1,$=Number.EPSILON;for(;R>0;){let E,I;for(E=R-2;E>=-1&&E!==-1;E--){const B=Number.MIN_VALUE+$*Math.abs(m[E]+Math.abs(m[E+1]));if(Math.abs(w[E])<=B||Number.isNaN(w[E])){w[E]=0;break}}if(E===R-2)I=4;else{let B;for(B=R-1;B>=E&&B!==E;B--){let P=(B!==R?Math.abs(w[B]):0)+(B!==E+1?Math.abs(w[B-1]):0);if(Math.abs(m[B])<=$*P){m[B]=0;break}}B===E?I=3:B===R-1?I=1:(I=2,E=B)}switch(E++,I){case 1:{let B=w[R-2];w[R-2]=0;for(let P=R-2;P>=E;P--){let Y=hypotenuse$1(m[P],B),V=m[P]/Y,J=B/Y;if(m[P]=Y,P!==E&&(B=-J*w[P-1],w[P-1]=V*w[P-1]),h)for(let re=0;re<o;re++)Y=V*_.get(re,P)+J*_.get(re,R-1),_.set(re,R-1,-J*_.get(re,P)+V*_.get(re,R-1)),_.set(re,P,Y)}break}case 2:{let B=w[E-1];w[E-1]=0;for(let P=E;P<R;P++){let Y=hypotenuse$1(m[P],B),V=m[P]/Y,J=B/Y;if(m[P]=Y,B=-J*w[P],w[P]=V*w[P],c)for(let re=0;re<n;re++)Y=V*y.get(re,P)+J*y.get(re,E-1),y.set(re,E-1,-J*y.get(re,P)+V*y.get(re,E-1)),y.set(re,P,Y)}break}case 3:{const B=Math.max(Math.abs(m[R-1]),Math.abs(m[R-2]),Math.abs(w[R-2]),Math.abs(m[E]),Math.abs(w[E])),P=m[R-1]/B,Y=m[R-2]/B,V=w[R-2]/B,J=m[E]/B,re=w[E]/B,q=((Y+P)*(Y-P)+V*V)/2,se=P*V*(P*V);let W=0;(q!==0||se!==0)&&(q<0?W=0-Math.sqrt(q*q+se):W=Math.sqrt(q*q+se),W=se/(q+W));let de=(J+P)*(J-P)+W,fe=J*re;for(let Z=E;Z<R-1;Z++){let X=hypotenuse$1(de,fe);X===0&&(X=Number.MIN_VALUE);let j=de/X,Q=fe/X;if(Z!==E&&(w[Z-1]=X),de=j*m[Z]+Q*w[Z],w[Z]=j*w[Z]-Q*m[Z],fe=Q*m[Z+1],m[Z+1]=j*m[Z+1],h)for(let oe=0;oe<o;oe++)X=j*_.get(oe,Z)+Q*_.get(oe,Z+1),_.set(oe,Z+1,-Q*_.get(oe,Z)+j*_.get(oe,Z+1)),_.set(oe,Z,X);if(X=hypotenuse$1(de,fe),X===0&&(X=Number.MIN_VALUE),j=de/X,Q=fe/X,m[Z]=X,de=j*w[Z]+Q*m[Z+1],m[Z+1]=-Q*w[Z]+j*m[Z+1],fe=Q*w[Z+1],w[Z+1]=j*w[Z+1],c&&Z<n-1)for(let oe=0;oe<n;oe++)X=j*y.get(oe,Z)+Q*y.get(oe,Z+1),y.set(oe,Z+1,-Q*y.get(oe,Z)+j*y.get(oe,Z+1)),y.set(oe,Z,X)}w[R-2]=de;break}case 4:{if(m[E]<=0&&(m[E]=m[E]<0?-m[E]:0,h))for(let B=0;B<=A;B++)_.set(B,E,-_.get(B,E));for(;E<A&&!(m[E]>=m[E+1]);){let B=m[E];if(m[E]=m[E+1],m[E+1]=B,h&&E<o-1)for(let P=0;P<o;P++)B=_.get(P,E+1),_.set(P,E+1,_.get(P,E)),_.set(P,E,B);if(c&&E<n-1)for(let P=0;P<n;P++)B=y.get(P,E+1),y.set(P,E+1,y.get(P,E)),y.set(P,E,B);E++}R--;break}}}if(f){let E=_;_=y,y=E}this.m=n,this.n=o,this.s=m,this.U=y,this.V=_}solve(r){let e=r,n=this.threshold,o=this.s.length,s=Matrix$3.zeros(o,o);for(let d=0;d<o;d++)Math.abs(this.s[d])<=n?s.set(d,d,0):s.set(d,d,1/this.s[d]);let a=this.U,l=this.rightSingularVectors,c=l.mmul(s),h=l.rows,f=a.rows,u=Matrix$3.zeros(h,f);for(let d=0;d<h;d++)for(let g=0;g<f;g++){let m=0;for(let y=0;y<o;y++)m+=c.get(d,y)*a.get(g,y);u.set(d,g,m)}return u.mmul(e)}solveForDiagonal(r){return this.solve(Matrix$3.diag(r))}inverse(){let r=this.V,e=this.threshold,n=r.rows,o=r.columns,s=new Matrix$3(n,this.s.length);for(let f=0;f<n;f++)for(let u=0;u<o;u++)Math.abs(this.s[u])>e&&s.set(f,u,r.get(f,u)/this.s[u]);let a=this.U,l=a.rows,c=a.columns,h=new Matrix$3(n,l);for(let f=0;f<n;f++)for(let u=0;u<l;u++){let d=0;for(let g=0;g<c;g++)d+=s.get(f,g)*a.get(u,g);h.set(f,u,d)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,n=this.s;for(let o=0,s=n.length;o<s;o++)n[o]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix$3.diag(this.s)}};function inverse$1(t,r=!1){return t=WrapperMatrix2D$1.checkMatrix(t),r?new SingularValueDecomposition$1(t).inverse():solve$1(t,Matrix$3.eye(t.rows))}function solve$1(t,r,e=!1){return t=WrapperMatrix2D$1.checkMatrix(t),r=WrapperMatrix2D$1.checkMatrix(r),e?new SingularValueDecomposition$1(t).solve(r):t.isSquare()?new LuDecomposition$1(t).solve(r):new QrDecomposition$1(t).solve(r)}function determinant$1(t){if(t=Matrix$3.checkMatrix(t),t.isSquare()){if(t.columns===0)return 1;let r,e,n,o;if(t.columns===2)return r=t.get(0,0),e=t.get(0,1),n=t.get(1,0),o=t.get(1,1),r*o-e*n;if(t.columns===3){let s,a,l;return s=new MatrixSelectionView$1(t,[1,2],[1,2]),a=new MatrixSelectionView$1(t,[1,2],[0,2]),l=new MatrixSelectionView$1(t,[1,2],[0,1]),r=t.get(0,0),e=t.get(0,1),n=t.get(0,2),r*determinant$1(s)-e*determinant$1(a)+n*determinant$1(l)}else return new LuDecomposition$1(t).determinant}else throw Error("determinant can only be calculated for a square matrix")}function xrange(t,r){let e=[];for(let n=0;n<t;n++)n!==r&&e.push(n);return e}function dependenciesOneRow(t,r,e,n=1e-9,o=1e-9){if(t>o)return new Array(r.rows+1).fill(0);{let s=r.addRow(e,[0]);for(let a=0;a<s.rows;a++)Math.abs(s.get(a,0))<n&&s.set(a,0,0);return s.to1DArray()}}function linearDependencies$1(t,r={}){const{thresholdValue:e=1e-9,thresholdError:n=1e-9}=r;t=Matrix$3.checkMatrix(t);let o=t.rows,s=new Matrix$3(o,o);for(let a=0;a<o;a++){let l=Matrix$3.columnVector(t.getRow(a)),c=t.subMatrixRow(xrange(o,a)).transpose(),f=new SingularValueDecomposition$1(c).solve(l),u=Matrix$3.sub(l,c.mmul(f)).abs().max();s.setRow(a,dependenciesOneRow(u,f,a,e,n))}return s}function pseudoInverse$1(t,r=Number.EPSILON){if(t=Matrix$3.checkMatrix(t),t.isEmpty())return t.transpose();let e=new SingularValueDecomposition$1(t,{autoTranspose:!0}),n=e.leftSingularVectors,o=e.rightSingularVectors,s=e.diagonal;for(let a=0;a<s.length;a++)Math.abs(s[a])>r?s[a]=1/s[a]:s[a]=0;return o.mmul(Matrix$3.diag(s).mmul(n.transpose()))}function covariance$1(t,r=t,e={}){t=new Matrix$3(t);let n=!1;if(typeof r=="object"&&!Matrix$3.isMatrix(r)&&!isAnyArray.isAnyArray(r)?(e=r,r=t,n=!0):r=new Matrix$3(r),t.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0}=e;o&&(t=t.center("column"),n||(r=r.center("column")));const s=t.transpose().mmul(r);for(let a=0;a<s.rows;a++)for(let l=0;l<s.columns;l++)s.set(a,l,s.get(a,l)*(1/(t.rows-1)));return s}function correlation$1(t,r=t,e={}){t=new Matrix$3(t);let n=!1;if(typeof r=="object"&&!Matrix$3.isMatrix(r)&&!isAnyArray.isAnyArray(r)?(e=r,r=t,n=!0):r=new Matrix$3(r),t.rows!==r.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0,scale:s=!0}=e;o&&(t.center("column"),n||r.center("column")),s&&(t.scale("column"),n||r.scale("column"));const a=t.standardDeviation("column",{unbiased:!0}),l=n?a:r.standardDeviation("column",{unbiased:!0}),c=t.transpose().mmul(r);for(let h=0;h<c.rows;h++)for(let f=0;f<c.columns;f++)c.set(h,f,c.get(h,f)*(1/(a[h]*l[f]))*(1/(t.rows-1)));return c}let EigenvalueDecomposition$1=class{constructor(r,e={}){const{assumeSymmetric:n=!1}=e;if(r=WrapperMatrix2D$1.checkMatrix(r),!r.isSquare())throw new Error("Matrix is not a square matrix");if(r.isEmpty())throw new Error("Matrix must be non-empty");let o=r.columns,s=new Matrix$3(o,o),a=new Float64Array(o),l=new Float64Array(o),c=r,h,f,u=!1;if(n?u=!0:u=r.isSymmetric(),u){for(h=0;h<o;h++)for(f=0;f<o;f++)s.set(h,f,c.get(h,f));tred2(o,l,a,s),tql2(o,l,a,s)}else{let d=new Matrix$3(o,o),g=new Float64Array(o);for(f=0;f<o;f++)for(h=0;h<o;h++)d.set(h,f,c.get(h,f));orthes(o,d,g,s),hqr2(o,l,a,s,d)}this.n=o,this.e=l,this.d=a,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let r=this.n,e=this.e,n=this.d,o=new Matrix$3(r,r),s,a;for(s=0;s<r;s++){for(a=0;a<r;a++)o.set(s,a,0);o.set(s,s,n[s]),e[s]>0?o.set(s,s+1,e[s]):e[s]<0&&o.set(s,s-1,e[s])}return o}};function tred2(t,r,e,n){let o,s,a,l,c,h,f,u;for(c=0;c<t;c++)e[c]=n.get(t-1,c);for(l=t-1;l>0;l--){for(u=0,a=0,h=0;h<l;h++)u=u+Math.abs(e[h]);if(u===0)for(r[l]=e[l-1],c=0;c<l;c++)e[c]=n.get(l-1,c),n.set(l,c,0),n.set(c,l,0);else{for(h=0;h<l;h++)e[h]/=u,a+=e[h]*e[h];for(o=e[l-1],s=Math.sqrt(a),o>0&&(s=-s),r[l]=u*s,a=a-o*s,e[l-1]=o-s,c=0;c<l;c++)r[c]=0;for(c=0;c<l;c++){for(o=e[c],n.set(c,l,o),s=r[c]+n.get(c,c)*o,h=c+1;h<=l-1;h++)s+=n.get(h,c)*e[h],r[h]+=n.get(h,c)*o;r[c]=s}for(o=0,c=0;c<l;c++)r[c]/=a,o+=r[c]*e[c];for(f=o/(a+a),c=0;c<l;c++)r[c]-=f*e[c];for(c=0;c<l;c++){for(o=e[c],s=r[c],h=c;h<=l-1;h++)n.set(h,c,n.get(h,c)-(o*r[h]+s*e[h]));e[c]=n.get(l-1,c),n.set(l,c,0)}}e[l]=a}for(l=0;l<t-1;l++){if(n.set(t-1,l,n.get(l,l)),n.set(l,l,1),a=e[l+1],a!==0){for(h=0;h<=l;h++)e[h]=n.get(h,l+1)/a;for(c=0;c<=l;c++){for(s=0,h=0;h<=l;h++)s+=n.get(h,l+1)*n.get(h,c);for(h=0;h<=l;h++)n.set(h,c,n.get(h,c)-s*e[h])}}for(h=0;h<=l;h++)n.set(h,l+1,0)}for(c=0;c<t;c++)e[c]=n.get(t-1,c),n.set(t-1,c,0);n.set(t-1,t-1,1),r[0]=0}function tql2(t,r,e,n){let o,s,a,l,c,h,f,u,d,g,m,y,_,w,S,v;for(a=1;a<t;a++)r[a-1]=r[a];r[t-1]=0;let b=0,k=0,C=Number.EPSILON;for(h=0;h<t;h++){for(k=Math.max(k,Math.abs(e[h])+Math.abs(r[h])),f=h;f<t&&!(Math.abs(r[f])<=C*k);)f++;if(f>h)do{for(o=e[h],u=(e[h+1]-o)/(2*r[h]),d=hypotenuse$1(u,1),u<0&&(d=-d),e[h]=r[h]/(u+d),e[h+1]=r[h]*(u+d),g=e[h+1],s=o-e[h],a=h+2;a<t;a++)e[a]-=s;for(b=b+s,u=e[f],m=1,y=m,_=m,w=r[h+1],S=0,v=0,a=f-1;a>=h;a--)for(_=y,y=m,v=S,o=m*r[a],s=m*u,d=hypotenuse$1(u,r[a]),r[a+1]=S*d,S=r[a]/d,m=u/d,u=m*e[a]-S*o,e[a+1]=s+S*(m*o+S*e[a]),c=0;c<t;c++)s=n.get(c,a+1),n.set(c,a+1,S*n.get(c,a)+m*s),n.set(c,a,m*n.get(c,a)-S*s);u=-S*v*_*w*r[h]/g,r[h]=S*u,e[h]=m*u}while(Math.abs(r[h])>C*k);e[h]=e[h]+b,r[h]=0}for(a=0;a<t-1;a++){for(c=a,u=e[a],l=a+1;l<t;l++)e[l]<u&&(c=l,u=e[l]);if(c!==a)for(e[c]=e[a],e[a]=u,l=0;l<t;l++)u=n.get(l,a),n.set(l,a,n.get(l,c)),n.set(l,c,u)}}function orthes(t,r,e,n){let o=0,s=t-1,a,l,c,h,f,u,d;for(u=o+1;u<=s-1;u++){for(d=0,h=u;h<=s;h++)d=d+Math.abs(r.get(h,u-1));if(d!==0){for(c=0,h=s;h>=u;h--)e[h]=r.get(h,u-1)/d,c+=e[h]*e[h];for(l=Math.sqrt(c),e[u]>0&&(l=-l),c=c-e[u]*l,e[u]=e[u]-l,f=u;f<t;f++){for(a=0,h=s;h>=u;h--)a+=e[h]*r.get(h,f);for(a=a/c,h=u;h<=s;h++)r.set(h,f,r.get(h,f)-a*e[h])}for(h=0;h<=s;h++){for(a=0,f=s;f>=u;f--)a+=e[f]*r.get(h,f);for(a=a/c,f=u;f<=s;f++)r.set(h,f,r.get(h,f)-a*e[f])}e[u]=d*e[u],r.set(u,u-1,d*l)}}for(h=0;h<t;h++)for(f=0;f<t;f++)n.set(h,f,h===f?1:0);for(u=s-1;u>=o+1;u--)if(r.get(u,u-1)!==0){for(h=u+1;h<=s;h++)e[h]=r.get(h,u-1);for(f=u;f<=s;f++){for(l=0,h=u;h<=s;h++)l+=e[h]*n.get(h,f);for(l=l/e[u]/r.get(u,u-1),h=u;h<=s;h++)n.set(h,f,n.get(h,f)+l*e[h])}}}function hqr2(t,r,e,n,o){let s=t-1,a=0,l=t-1,c=Number.EPSILON,h=0,f=0,u=0,d=0,g=0,m=0,y=0,_=0,w,S,v,b,k,C,R,A,$,E,I,B,P,Y,V;for(w=0;w<t;w++)for((w<a||w>l)&&(e[w]=o.get(w,w),r[w]=0),S=Math.max(w-1,0);S<t;S++)f=f+Math.abs(o.get(w,S));for(;s>=a;){for(b=s;b>a&&(m=Math.abs(o.get(b-1,b-1))+Math.abs(o.get(b,b)),m===0&&(m=f),!(Math.abs(o.get(b,b-1))<c*m));)b--;if(b===s)o.set(s,s,o.get(s,s)+h),e[s]=o.get(s,s),r[s]=0,s--,_=0;else if(b===s-1){if(R=o.get(s,s-1)*o.get(s-1,s),u=(o.get(s-1,s-1)-o.get(s,s))/2,d=u*u+R,y=Math.sqrt(Math.abs(d)),o.set(s,s,o.get(s,s)+h),o.set(s-1,s-1,o.get(s-1,s-1)+h),A=o.get(s,s),d>=0){for(y=u>=0?u+y:u-y,e[s-1]=A+y,e[s]=e[s-1],y!==0&&(e[s]=A-R/y),r[s-1]=0,r[s]=0,A=o.get(s,s-1),m=Math.abs(A)+Math.abs(y),u=A/m,d=y/m,g=Math.sqrt(u*u+d*d),u=u/g,d=d/g,S=s-1;S<t;S++)y=o.get(s-1,S),o.set(s-1,S,d*y+u*o.get(s,S)),o.set(s,S,d*o.get(s,S)-u*y);for(w=0;w<=s;w++)y=o.get(w,s-1),o.set(w,s-1,d*y+u*o.get(w,s)),o.set(w,s,d*o.get(w,s)-u*y);for(w=a;w<=l;w++)y=n.get(w,s-1),n.set(w,s-1,d*y+u*n.get(w,s)),n.set(w,s,d*n.get(w,s)-u*y)}else e[s-1]=A+u,e[s]=A+u,r[s-1]=y,r[s]=-y;s=s-2,_=0}else{if(A=o.get(s,s),$=0,R=0,b<s&&($=o.get(s-1,s-1),R=o.get(s,s-1)*o.get(s-1,s)),_===10){for(h+=A,w=a;w<=s;w++)o.set(w,w,o.get(w,w)-A);m=Math.abs(o.get(s,s-1))+Math.abs(o.get(s-1,s-2)),A=$=.75*m,R=-.4375*m*m}if(_===30&&(m=($-A)/2,m=m*m+R,m>0)){for(m=Math.sqrt(m),$<A&&(m=-m),m=A-R/(($-A)/2+m),w=a;w<=s;w++)o.set(w,w,o.get(w,w)-m);h+=m,A=$=R=.964}for(_=_+1,k=s-2;k>=b&&(y=o.get(k,k),g=A-y,m=$-y,u=(g*m-R)/o.get(k+1,k)+o.get(k,k+1),d=o.get(k+1,k+1)-y-g-m,g=o.get(k+2,k+1),m=Math.abs(u)+Math.abs(d)+Math.abs(g),u=u/m,d=d/m,g=g/m,!(k===b||Math.abs(o.get(k,k-1))*(Math.abs(d)+Math.abs(g))<c*(Math.abs(u)*(Math.abs(o.get(k-1,k-1))+Math.abs(y)+Math.abs(o.get(k+1,k+1))))));)k--;for(w=k+2;w<=s;w++)o.set(w,w-2,0),w>k+2&&o.set(w,w-3,0);for(v=k;v<=s-1&&(Y=v!==s-1,v!==k&&(u=o.get(v,v-1),d=o.get(v+1,v-1),g=Y?o.get(v+2,v-1):0,A=Math.abs(u)+Math.abs(d)+Math.abs(g),A!==0&&(u=u/A,d=d/A,g=g/A)),A!==0);v++)if(m=Math.sqrt(u*u+d*d+g*g),u<0&&(m=-m),m!==0){for(v!==k?o.set(v,v-1,-m*A):b!==k&&o.set(v,v-1,-o.get(v,v-1)),u=u+m,A=u/m,$=d/m,y=g/m,d=d/u,g=g/u,S=v;S<t;S++)u=o.get(v,S)+d*o.get(v+1,S),Y&&(u=u+g*o.get(v+2,S),o.set(v+2,S,o.get(v+2,S)-u*y)),o.set(v,S,o.get(v,S)-u*A),o.set(v+1,S,o.get(v+1,S)-u*$);for(w=0;w<=Math.min(s,v+3);w++)u=A*o.get(w,v)+$*o.get(w,v+1),Y&&(u=u+y*o.get(w,v+2),o.set(w,v+2,o.get(w,v+2)-u*g)),o.set(w,v,o.get(w,v)-u),o.set(w,v+1,o.get(w,v+1)-u*d);for(w=a;w<=l;w++)u=A*n.get(w,v)+$*n.get(w,v+1),Y&&(u=u+y*n.get(w,v+2),n.set(w,v+2,n.get(w,v+2)-u*g)),n.set(w,v,n.get(w,v)-u),n.set(w,v+1,n.get(w,v+1)-u*d)}}}if(f!==0){for(s=t-1;s>=0;s--)if(u=e[s],d=r[s],d===0)for(b=s,o.set(s,s,1),w=s-1;w>=0;w--){for(R=o.get(w,w)-u,g=0,S=b;S<=s;S++)g=g+o.get(w,S)*o.get(S,s);if(r[w]<0)y=R,m=g;else if(b=w,r[w]===0?o.set(w,s,R!==0?-g/R:-g/(c*f)):(A=o.get(w,w+1),$=o.get(w+1,w),d=(e[w]-u)*(e[w]-u)+r[w]*r[w],C=(A*m-y*g)/d,o.set(w,s,C),o.set(w+1,s,Math.abs(A)>Math.abs(y)?(-g-R*C)/A:(-m-$*C)/y)),C=Math.abs(o.get(w,s)),c*C*C>1)for(S=w;S<=s;S++)o.set(S,s,o.get(S,s)/C)}else if(d<0)for(b=s-1,Math.abs(o.get(s,s-1))>Math.abs(o.get(s-1,s))?(o.set(s-1,s-1,d/o.get(s,s-1)),o.set(s-1,s,-(o.get(s,s)-u)/o.get(s,s-1))):(V=cdiv(0,-o.get(s-1,s),o.get(s-1,s-1)-u,d),o.set(s-1,s-1,V[0]),o.set(s-1,s,V[1])),o.set(s,s-1,0),o.set(s,s,1),w=s-2;w>=0;w--){for(E=0,I=0,S=b;S<=s;S++)E=E+o.get(w,S)*o.get(S,s-1),I=I+o.get(w,S)*o.get(S,s);if(R=o.get(w,w)-u,r[w]<0)y=R,g=E,m=I;else if(b=w,r[w]===0?(V=cdiv(-E,-I,R,d),o.set(w,s-1,V[0]),o.set(w,s,V[1])):(A=o.get(w,w+1),$=o.get(w+1,w),B=(e[w]-u)*(e[w]-u)+r[w]*r[w]-d*d,P=(e[w]-u)*2*d,B===0&&P===0&&(B=c*f*(Math.abs(R)+Math.abs(d)+Math.abs(A)+Math.abs($)+Math.abs(y))),V=cdiv(A*g-y*E+d*I,A*m-y*I-d*E,B,P),o.set(w,s-1,V[0]),o.set(w,s,V[1]),Math.abs(A)>Math.abs(y)+Math.abs(d)?(o.set(w+1,s-1,(-E-R*o.get(w,s-1)+d*o.get(w,s))/A),o.set(w+1,s,(-I-R*o.get(w,s)-d*o.get(w,s-1))/A)):(V=cdiv(-g-$*o.get(w,s-1),-m-$*o.get(w,s),y,d),o.set(w+1,s-1,V[0]),o.set(w+1,s,V[1]))),C=Math.max(Math.abs(o.get(w,s-1)),Math.abs(o.get(w,s))),c*C*C>1)for(S=w;S<=s;S++)o.set(S,s-1,o.get(S,s-1)/C),o.set(S,s,o.get(S,s)/C)}for(w=0;w<t;w++)if(w<a||w>l)for(S=w;S<t;S++)n.set(w,S,o.get(w,S));for(S=t-1;S>=a;S--)for(w=a;w<=l;w++){for(y=0,v=a;v<=Math.min(S,l);v++)y=y+n.get(w,v)*o.get(v,S);n.set(w,S,y)}}}function cdiv(t,r,e,n){let o,s;return Math.abs(e)>Math.abs(n)?(o=n/e,s=e+o*n,[(t+o*r)/s,(r-o*t)/s]):(o=e/n,s=n+o*e,[(o*t+r)/s,(o*r-t)/s])}let CholeskyDecomposition$1=class{constructor(r){if(r=WrapperMatrix2D$1.checkMatrix(r),!r.isSymmetric())throw new Error("Matrix is not symmetric");let e=r,n=e.rows,o=new Matrix$3(n,n),s=!0,a,l,c;for(l=0;l<n;l++){let h=0;for(c=0;c<l;c++){let f=0;for(a=0;a<c;a++)f+=o.get(c,a)*o.get(l,a);f=(e.get(l,c)-f)/o.get(c,c),o.set(l,c,f),h=h+f*f}for(h=e.get(l,l)-h,s&&(s=h>0),o.set(l,l,Math.sqrt(Math.max(h,0))),c=l+1;c<n;c++)o.set(l,c,0)}this.L=o,this.positiveDefinite=s}isPositiveDefinite(){return this.positiveDefinite}solve(r){r=WrapperMatrix2D$1.checkMatrix(r);let e=this.L,n=e.rows;if(r.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let o=r.columns,s=r.clone(),a,l,c;for(c=0;c<n;c++)for(l=0;l<o;l++){for(a=0;a<c;a++)s.set(c,l,s.get(c,l)-s.get(a,l)*e.get(c,a));s.set(c,l,s.get(c,l)/e.get(c,c))}for(c=n-1;c>=0;c--)for(l=0;l<o;l++){for(a=c+1;a<n;a++)s.set(c,l,s.get(c,l)-s.get(a,l)*e.get(a,c));s.set(c,l,s.get(c,l)/e.get(c,c))}return s}get lowerTriangularMatrix(){return this.L}};class nipals{constructor(r,e={}){r=WrapperMatrix2D$1.checkMatrix(r);let{Y:n}=e;const{scaleScores:o=!1,maxIterations:s=1e3,terminationCriteria:a=1e-10}=e;let l;if(n){if(isAnyArray.isAnyArray(n)&&typeof n[0]=="number"?n=Matrix$3.columnVector(n):n=WrapperMatrix2D$1.checkMatrix(n),n.rows!==r.rows)throw new Error("Y should have the same number of rows as X");l=n.getColumnVector(0)}else l=r.getColumnVector(0);let c=1,h,f,u,d;for(let g=0;g<s&&c>a;g++)u=r.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),u=u.div(u.norm()),h=r.mmul(u).div(u.transpose().mmul(u).get(0,0)),g>0&&(c=h.clone().sub(d).pow(2).sum()),d=h.clone(),n?(f=n.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),f=f.div(f.norm()),l=n.mmul(f).div(f.transpose().mmul(f).get(0,0))):l=h;if(n){let g=r.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0));g=g.div(g.norm());let m=r.clone().sub(h.clone().mmul(g.transpose())),y=l.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),_=n.clone().sub(h.clone().mulS(y.get(0,0)).mmul(f.transpose()));this.t=h,this.p=g.transpose(),this.w=u.transpose(),this.q=f,this.u=l,this.s=h.transpose().mmul(h),this.xResidual=m,this.yResidual=_,this.betas=y}else this.w=u.transpose(),this.s=h.transpose().mmul(h).sqrt(),o?this.t=h.clone().div(this.s.get(0,0)):this.t=h,this.xResidual=r.sub(h.mmul(u.transpose()))}}var AbstractMatrix_1=matrix$2.AbstractMatrix=AbstractMatrix$1,CHO$1=matrix$2.CHO=CholeskyDecomposition$1,CholeskyDecomposition_1=matrix$2.CholeskyDecomposition=CholeskyDecomposition$1,DistanceMatrix_1=matrix$2.DistanceMatrix=DistanceMatrix$1,EVD$1=matrix$2.EVD=EigenvalueDecomposition$1,EigenvalueDecomposition_1=matrix$2.EigenvalueDecomposition=EigenvalueDecomposition$1,LU$1=matrix$2.LU=LuDecomposition$1,LuDecomposition_1=matrix$2.LuDecomposition=LuDecomposition$1,Matrix_1=matrix$2.Matrix=Matrix$3,MatrixColumnSelectionView_1=matrix$2.MatrixColumnSelectionView=MatrixColumnSelectionView$1,MatrixColumnView_1=matrix$2.MatrixColumnView=MatrixColumnView$1,MatrixFlipColumnView_1=matrix$2.MatrixFlipColumnView=MatrixFlipColumnView$1,MatrixFlipRowView_1=matrix$2.MatrixFlipRowView=MatrixFlipRowView$1,MatrixRowSelectionView_1=matrix$2.MatrixRowSelectionView=MatrixRowSelectionView$1,MatrixRowView_1=matrix$2.MatrixRowView=MatrixRowView$1,MatrixSelectionView_1=matrix$2.MatrixSelectionView=MatrixSelectionView$1,MatrixSubView_1=matrix$2.MatrixSubView=MatrixSubView$1,MatrixTransposeView_1=matrix$2.MatrixTransposeView=MatrixTransposeView$2,NIPALS$1=matrix$2.NIPALS=nipals,Nipals$1=matrix$2.Nipals=nipals,QR$1=matrix$2.QR=QrDecomposition$1,QrDecomposition_1=matrix$2.QrDecomposition=QrDecomposition$1,SVD$1=matrix$2.SVD=SingularValueDecomposition$1,SingularValueDecomposition_1=matrix$2.SingularValueDecomposition=SingularValueDecomposition$1,SymmetricMatrix_1=matrix$2.SymmetricMatrix=SymmetricMatrix$1,WrapperMatrix1D_1=matrix$2.WrapperMatrix1D=WrapperMatrix1D$1,WrapperMatrix2D_1=matrix$2.WrapperMatrix2D=WrapperMatrix2D$1,correlation_1=matrix$2.correlation=correlation$1,covariance_1=matrix$2.covariance=covariance$1,_default=matrix$2.default=Matrix$3,determinant_1=matrix$2.determinant=determinant$1,inverse_1=matrix$2.inverse=inverse$1,linearDependencies_1=matrix$2.linearDependencies=linearDependencies$1,pseudoInverse_1=matrix$2.pseudoInverse=pseudoInverse$1,solve_1=matrix$2.solve=solve$1,wrap_1=matrix$2.wrap=wrap$1;const AbstractMatrix=AbstractMatrix_1,CHO=CHO$1,CholeskyDecomposition=CholeskyDecomposition_1,DistanceMatrix=DistanceMatrix_1,EVD=EVD$1,EigenvalueDecomposition=EigenvalueDecomposition_1,LU=LU$1,LuDecomposition=LuDecomposition_1,Matrix$2=Matrix_1,MatrixColumnSelectionView=MatrixColumnSelectionView_1,MatrixColumnView=MatrixColumnView_1,MatrixFlipColumnView=MatrixFlipColumnView_1,MatrixFlipRowView=MatrixFlipRowView_1,MatrixRowSelectionView=MatrixRowSelectionView_1,MatrixRowView=MatrixRowView_1,MatrixSelectionView=MatrixSelectionView_1,MatrixSubView=MatrixSubView_1,MatrixTransposeView$1=MatrixTransposeView_1,NIPALS=NIPALS$1,Nipals=Nipals$1,QR=QR$1,QrDecomposition=QrDecomposition_1,SVD=SVD$1,SingularValueDecomposition=SingularValueDecomposition_1,SymmetricMatrix=SymmetricMatrix_1,WrapperMatrix1D=WrapperMatrix1D_1,WrapperMatrix2D=WrapperMatrix2D_1,correlation=correlation_1,covariance=covariance_1,matrix=_default.Matrix?_default.Matrix:Matrix_1,determinant=determinant_1,inverse=inverse_1,linearDependencies=linearDependencies_1,pseudoInverse=pseudoInverse_1,solve=solve_1,wrap=wrap_1,matrix$1=Object.freeze(Object.defineProperty({__proto__:null,AbstractMatrix,CHO,CholeskyDecomposition,DistanceMatrix,EVD,EigenvalueDecomposition,LU,LuDecomposition,Matrix:Matrix$2,MatrixColumnSelectionView,MatrixColumnView,MatrixFlipColumnView,MatrixFlipRowView,MatrixRowSelectionView,MatrixRowView,MatrixSelectionView,MatrixSubView,MatrixTransposeView:MatrixTransposeView$1,NIPALS,Nipals,QR,QrDecomposition,SVD,SingularValueDecomposition,SymmetricMatrix,WrapperMatrix1D,WrapperMatrix2D,correlation,covariance,default:matrix,determinant,inverse,linearDependencies,pseudoInverse,solve,wrap},Symbol.toStringTag,{value:"Module"}));function getSeparatedKernel(t){const r=new SVD(t,{autoTranspose:!0});if(r.rank!==1)return null;const e=Math.sqrt(r.s[0]),n=r.U.to2DArray().map(s=>s[0]*e),o=r.V.to2DArray().map(s=>s[0]*e);return[n,o]}function convolution(t,r={}){let{channels:e,bitDepth:n,normalize:o=!1,divisor:s=1,border:a="copy",algorithm:l="auto"}=r,c={};n&&(c.bitDepth=n);let h=Image.createFrom(this,c);if(e=validateArrayOfChannels(this,e),l!=="separable")({kernel:t}=validateKernel(t));else if(!Array.isArray(t)||t.length!==2)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if(l==="auto"){let b=getSeparatedKernel(t);b!==null?(l="separable",t=b):(t.length>9||t[0].length>9)&&this.width<=4096&&this.height<=4096?l="fft":l="direct"}let f,u;l==="separable"?(f=Math.floor(t[0].length/2),u=Math.floor(t[1].length/2)):(f=Math.floor(t.length/2),u=Math.floor(t[0].length/2));let d=h.isClamped,g=new Array(this.height*this.width),m,y,_,w,S,v;for(w=0;w<e.length;w++){for(S=e[w],_=0;_<this.height;_++)for(y=0;y<this.width;y++)m=_*this.width+y,g[m]=this.data[m*this.channels+S];if(l==="direct")v=src$2.direct(g,t,{rows:this.height,cols:this.width,normalize:o,divisor:s});else if(l==="separable"){if(v=convolutionSeparable(g,t,this.width,this.height),o){s=0;for(let b=0;b<t[0].length;b++)for(let k=0;k<t[1].length;k++)s+=t[0][b]*t[1][k]}if(s!==1)for(let b=0;b<v.length;b++)v[b]/=s}else v=src$2.fft(g,t,{rows:this.height,cols:this.width,normalize:o,divisor:s});for(_=0;_<this.height;_++)for(y=0;y<this.width;y++)m=_*this.width+y,d?h.data[m*this.channels+S]=clamp$1(v[m],h):h.data[m*this.channels+S]=v[m]}if(this.alpha&&!e.includes(this.channels))for(y=this.components;y<this.data.length;y=y+this.channels)h.data[y]=this.data[y];return a!=="periodic"&&h.setBorder({size:[u,f],algorithm:a}),h}function gradientFilter(t={}){let{direction:r="xy",border:e="copy",kernelX:n,kernelY:o,channels:s,bitDepth:a=this.bitDepth}=t;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),r){case"x":if(!n)throw new Error("kernelX option is missing");return convolution.call(this,n,{channels:s,border:e,bitDepth:a});case"y":if(!o)throw new Error("kernelY option is missing");return convolution.call(this,o,{channels:s,border:e,bitDepth:a});case"xy":{if(!n)throw new Error("kernelX option is missing");if(!o)throw new Error("kernelY option is missing");const l=convolution.call(this,n,{channels:s,border:e,bitDepth:32}),c=convolution.call(this,o,{channels:s,border:e,bitDepth:32});return l.hypotenuse(c,{bitDepth:a,channels:s})}default:throw new Error(`Unknown parameter direction: ${r}`)}}function sobelFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray;function newArray(t,r){t=t||0;for(var e=new Array(t),n=0;n<t;n++)e[n]=r;return e}const newArray$1=getDefaultExportFromCjs(newArray_1);function level(t={}){let{algorithm:r="range",channels:e,min:n=this.min,max:o=this.max}=t;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),e=validateArrayOfChannels(this,{channels:e}),e.length!==this.channel&&(Array.isArray(n)&&n.length===this.channels&&(n=n.filter((s,a)=>e.includes(a))),Array.isArray(o)&&o.length===this.channels&&(o=o.filter((s,a)=>e.includes(a)))),r){case"range":n<0&&(n=0),o>this.maxValue&&(o=this.maxValue),Array.isArray(n)||(n=newArray$1(e.length,n)),Array.isArray(o)||(o=newArray$1(e.length,o)),processImage(this,n,o,e);break;default:throw new Error(`level: algorithm not implement: ${r}`)}return this}function processImage(t,r,e,n){let o=1e-5,s=new Array(n.length);for(let a=0;a<n.length;a++)r[a]===0&&e[a]===t.maxValue||e[a]===r[a]?s[a]=0:s[a]=(t.maxValue+1-o)/(e[a]-r[a]),r[a]+=(.5-o/2)/s[a];for(let a=0;a<n.length;a++){let l=n[a];if(s[a]!==0)for(let c=0;c<t.data.length;c+=t.channels)t.data[c+l]=Math.min(Math.max(0,(t.data[c+l]-r[a])*s[a]+.5|0),t.maxValue)}}var toString=Object.prototype.toString,isArrayType=function t(r){return toString.call(r).substr(-6,5)==="Array"};const isArray=getDefaultExportFromCjs(isArrayType);function checkNumberArray(t){if(isNaN(t)){if(t instanceof Image)return t.data;if(!isArray(t))throw new Error("checkNumberArray: the value should be either a number, array or Image");return t}else{if(t<=0)throw new Error("checkNumberArray: the value must be greater than 0");return t}}function add(t,r={}){let{channels:e}=r;if(this.checkProcessable("add",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("add: the data size is different");for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]+t[s+o]>>0))}}else for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.min(this.maxValue,this.data[s+o]+t>>0)}return this}function subtract(t,r={}){let{channels:e}=r;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("subtract: the data size is different");for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]-t[s+o]>>0))}}else for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,this.data[s+o]-t>>0)}return this}function subtractImage(t,r={}){let{channels:e,absolute:n=!1}=r;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==t.width||this.height!==t.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("subtractImage: both images must have the same number of channels");let o=this.clone();e=validateArrayOfChannels(this,{channels:e});for(let s=0;s<e.length;s++){let a=e[s];for(let l=a;l<this.data.length;l+=this.channels){let c=this.data[l]-t.data[l];n?o.data[l]=Math.abs(c):o.data[l]=Math.max(c,0)}}return o}function hypotenuse(t,r={}){let{bitDepth:e=this.bitDepth,channels:n}=r;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==t.width||this.height!==t.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("hypotenuse: both images must have the same number of channels");let o=Image.createFrom(this,{bitDepth:e});n=validateArrayOfChannels(this,{channels:n});let s=o.isClamped;for(let a=0;a<n.length;a++){let l=n[a];for(let c=l;c<this.data.length;c+=this.channels){let h=Math.hypot(this.data[c],t.data[c]);s?o.data[c]=Math.min(Math.max(Math.round(h),0),o.maxValue):o.data[c]=h}}return o}function multiply(t,r={}){let{channels:e}=r;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),t<=0)throw new Error("multiply: the value must be greater than 0");if(e=validateArrayOfChannels(this,{channels:e}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("multiply: the data size is different");for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]*t[s+o]>>0))}}else for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.min(this.maxValue,this.data[s+o]*t>>0)}return this}function divide(t,r={}){let{channels:e}=r;if(this.checkProcessable("divide",{bitDepth:[8,16]}),e=validateArrayOfChannels(this,{channels:e}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("divide: the: the data size is different");for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.max(0,Math.min(this.maxValue,this.data[s+o]/t[s+o]>>0))}}else for(let n=0;n<e.length;n++){let o=e[n];for(let s=0;s<this.data.length;s+=this.channels)this.data[s+o]=Math.min(this.maxValue,this.data[s+o]/t>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(r){if(typeof r=="number")return this._predict(r);if(isAnyArray$1(r)){const e=[];for(let n=0;n<r.length;n++)e.push(this._predict(r[n]));return e}else throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(r,e){if(!isAnyArray$1(r)||!isAnyArray$1(e)||r.length!==e.length)throw new Error("x and y must be arrays of the same length");const n=r.length,o=new Array(n);for(let g=0;g<n;g++)o[g]=this._predict(r[g]);let s=0,a=0,l=0,c=0,h=0,f=0,u=0;for(let g=0;g<n;g++)s+=o[g],a+=e[g],h+=o[g]*o[g],f+=e[g]*e[g],u+=o[g]*e[g],e[g]!==0&&(l+=(e[g]-o[g])*(e[g]-o[g])/e[g]),c+=(e[g]-o[g])*(e[g]-o[g]);const d=(n*u-s*a)/Math.sqrt((n*h-s*s)*(n*f-a*a));return{r:d,r2:d*d,chi2:l,rmsd:Math.sqrt(c/n)}}}const require$$0$2=getAugmentedNamespace(matrix$1);function squaredEuclidean$4(t,r){let e=0;for(let n=0;n<t.length;n++)e+=(t[n]-r[n])*(t[n]-r[n]);return e}function euclidean$2(t,r){return Math.sqrt(squaredEuclidean$4(t,r))}const euclidean$3=Object.freeze(Object.defineProperty({__proto__:null,euclidean:euclidean$2,squaredEuclidean:squaredEuclidean$4},Symbol.toStringTag,{value:"Module"})),require$$0$1=getAugmentedNamespace(euclidean$3),{squaredEuclidean:squaredEuclidean$3}=require$$0$1,defaultOptions$b={sigma:1};let GaussianKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$b,r),this.sigma=r.sigma,this.divisor=2*r.sigma*r.sigma}compute(r,e){const n=squaredEuclidean$3(r,e);return Math.exp(-n/this.divisor)}};var gaussianKernel=GaussianKernel$1;const defaultOptions$a={degree:1,constant:1,scale:1};let PolynomialKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$a,r),this.degree=r.degree,this.constant=r.constant,this.scale=r.scale}compute(r,e){for(var n=0,o=0;o<r.length;o++)n+=r[o]*e[o];return Math.pow(this.scale*n+this.constant,this.degree)}};var polynomialKernel=PolynomialKernel$1;const defaultOptions$9={alpha:.01,constant:-Math.E};let SigmoidKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$9,r),this.alpha=r.alpha,this.constant=r.constant}compute(r,e){for(var n=0,o=0;o<r.length;o++)n+=r[o]*e[o];return Math.tanh(this.alpha*n+this.constant)}};var sigmoidKernel=SigmoidKernel$1;const defaultOptions$8={sigma:1,degree:1};let ANOVAKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$8,r),this.sigma=r.sigma,this.degree=r.degree}compute(r,e){for(var n=0,o=Math.min(r.length,e.length),s=1;s<=o;++s)n+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(r[s-1],s)-Math.pow(e[s-1],s),2)),this.degree);return n}};var anovaKernel=ANOVAKernel$1;const{squaredEuclidean:squaredEuclidean$2}=require$$0$1,defaultOptions$7={sigma:1};let CauchyKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$7,r),this.sigma=r.sigma}compute(r,e){return 1/(1+squaredEuclidean$2(r,e)/(this.sigma*this.sigma))}};var cauchyKernel=CauchyKernel$1;const{euclidean:euclidean$1}=require$$0$1,defaultOptions$6={sigma:1};let ExponentialKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$6,r),this.sigma=r.sigma,this.divisor=2*r.sigma*r.sigma}compute(r,e){const n=euclidean$1(r,e);return Math.exp(-n/this.divisor)}};var exponentialKernel=ExponentialKernel$1;class HistogramIntersectionKernel{compute(r,e){for(var n=Math.min(r.length,e.length),o=0,s=0;s<n;++s)o+=Math.min(r[s],e[s]);return o}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean}=require$$0$1,defaultOptions$5={sigma:1};let LaplacianKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$5,r),this.sigma=r.sigma}compute(r,e){const n=euclidean(r,e);return Math.exp(-n/this.sigma)}};var laplacianKernel=LaplacianKernel$1;const{squaredEuclidean:squaredEuclidean$1}=require$$0$1,defaultOptions$4={constant:1};let MultiquadraticKernel$1=class{constructor(r){r=Object.assign({},defaultOptions$4,r),this.constant=r.constant}compute(r,e){return Math.sqrt(squaredEuclidean$1(r,e)+this.constant*this.constant)}};var multiquadraticKernel=MultiquadraticKernel$1;const{squaredEuclidean}=require$$0$1,defaultOptions$3={constant:1};class RationalQuadraticKernel{constructor(r){r=Object.assign({},defaultOptions$3,r),this.constant=r.constant}compute(r,e){const n=squaredEuclidean(r,e);return 1-n/(n+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView}=require$$0$2,GaussianKernel=gaussianKernel,PolynomialKernel=polynomialKernel,SigmoidKernel=sigmoidKernel,ANOVAKernel=anovaKernel,CauchyKernel=cauchyKernel,ExponentialKernel=exponentialKernel,HistogramKernel=histogramIntersectionKernel,LaplacianKernel=laplacianKernel,MultiquadraticKernel=multiquadraticKernel,RationalKernel=rationalQuadraticKernel,kernelType={gaussian:GaussianKernel,rbf:GaussianKernel,polynomial:PolynomialKernel,poly:PolynomialKernel,anova:ANOVAKernel,cauchy:CauchyKernel,exponential:ExponentialKernel,histogram:HistogramKernel,min:HistogramKernel,laplacian:LaplacianKernel,multiquadratic:MultiquadraticKernel,rational:RationalKernel,sigmoid:SigmoidKernel,mlp:SigmoidKernel};class Kernel{constructor(r,e){if(this.kernelType=r,r!=="linear")if(typeof r=="string"){r=r.toLowerCase();var n=kernelType[r];if(n)this.kernelFunction=new n(e);else throw new Error(`unsupported kernel type: ${r}`)}else if(typeof r=="object"&&typeof r.compute=="function")this.kernelFunction=r;else throw new TypeError("first argument must be a valid kernel type or instance")}compute(r,e){if(r=Matrix$1.checkMatrix(r),e===void 0?e=r:e=Matrix$1.checkMatrix(e),this.kernelType==="linear")return r.mmul(new MatrixTransposeView(e));const n=new Matrix$1(r.rows,e.rows);if(r===e)for(let o=0;o<r.rows;o++)for(let s=o;s<r.rows;s++){const a=this.kernelFunction.compute(r.getRow(o),r.getRow(s));n.set(o,s,a),n.set(s,o,a)}else for(let o=0;o<r.rows;o++)for(let s=0;s<e.rows;s++)n.set(o,s,this.kernelFunction.compute(r.getRow(o),e.getRow(s)));return n}}var kernel$1=Kernel;const Kernel$1=getDefaultExportFromCjs(kernel$1),defaultOptions$2={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(r,e,n){if(super(),r===!0)this.alpha=e.alpha,this.inputs=e.inputs,this.kernelType=e.kernelType,this.kernelOptions=e.kernelOptions,this.kernel=new Kernel$1(e.kernelType,e.kernelOptions);else{r=Matrix$2.checkMatrix(r),n=Object.assign({},defaultOptions$2,n);const o=new Kernel$1(n.kernelType,n.kernelOptions),s=o.compute(r),a=r.rows;s.add(Matrix$2.eye(a,a).mul(n.lambda)),this.alpha=solve(s,e),this.inputs=r,this.kernelType=n.kernelType,this.kernelOptions=n.kernelOptions,this.kernel=o}}_predict(r){return this.kernel.compute([r],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(r){if(r.name!=="kernelRidgeRegression")throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,r)}}function background$1(t,r,e){const n=new KernelRidgeRegression(t,r,e),o=new Array(this.size);for(let l=0;l<this.width;l++)for(let c=0;c<this.height;c++)o[c*this.width+l]=[l,c];const s=n.predict(o),a=Image.createFrom(this);for(let l=0;l<this.size;l++)a.data[l]=Math.min(this.maxValue,Math.max(0,s[l][0]));return a}function dilate(t={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=t;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of r)for(const a of s)if(a!==1){n=!1;break e}let o=this;for(let s=0;s<e;s++)if(this.bitDepth===1)if(n){const a=o.clone();o=dilateOnceBinaryOnlyOnes(o,a,r.length,r[0].length)}else{const a=Image.createFrom(o);o=dilateOnceBinary(o,a,r)}else if(n){const a=Image.createFrom(o);o=dilateOnceGreyOnlyOnes(o,a,r.length,r[0].length)}else{const a=Image.createFrom(o);o=dilateOnceGrey(o,a,r)}return o}function dilateOnceGrey(t,r,e){const n=e.length,o=e[0].length;let s=(n-1)/2,a=(o-1)/2;for(let l=0;l<t.height;l++)for(let c=0;c<t.width;c++){let h=0;for(let f=0;f<o;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-s+c,g=f-a+l;if(d<0||g<0||d>=t.width||g>=t.height)continue;const m=t.getValueXY(d,g,0);m>h&&(h=m)}r.setValueXY(c,l,0,h)}return r}function dilateOnceGreyOnlyOnes(t,r,e,n){const o=(e-1)/2,s=(n-1)/2,a=[];for(let l=0;l<t.width;l++)a.push(0);for(let l=0;l<t.height;l++){for(let c=0;c<t.width;c++){let h=0;for(let f=Math.max(0,l-s);f<Math.min(t.height,l+s+1);f++){const u=t.getValueXY(c,f,0);u>h&&(h=u)}a[c]=h}for(let c=0;c<t.width;c++){let h=0;for(let f=Math.max(0,c-o);f<Math.min(t.width,c+o+1);f++)a[f]>h&&(h=a[f]);r.setValueXY(c,l,0,h)}}return r}function dilateOnceBinary(t,r,e){const n=e.length,o=e[0].length;let s=(n-1)/2,a=(o-1)/2;for(let l=0;l<t.height;l++)for(let c=0;c<t.width;c++){let h=0;e:for(let f=0;f<o;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-s+c,g=f-a+l;if(g<0||d<0||d>=t.width||g>=t.height)continue;if(t.getBitXY(d,g)===1){h=1;break e}}h===1&&r.setBitXY(c,l)}return r}function dilateOnceBinaryOnlyOnes(t,r,e,n){const o=(e-1)/2,s=(n-1)/2,a=[];for(let l=0;l<t.width;l++)a.push(1);for(let l=0;l<t.height;l++){for(let c=0;c<t.width;c++){a[c]=0;for(let h=Math.max(0,l-s);h<Math.min(t.height,l+s+1);h++)if(t.getBitXY(c,h)===1){a[c]=1;break}}for(let c=0;c<t.width;c++)if(r.getBitXY(c,l)!==1){for(let h=Math.max(0,c-o);h<Math.min(t.width,c+o+1);h++)if(a[h]===1){r.setBitXY(c,l);break}}}return r}function erode(t={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=t;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let n=!0;e:for(const s of r)for(const a of s)if(a!==1){n=!1;break e}let o=this;for(let s=0;s<e;s++)if(this.bitDepth===1)if(n){const a=o.clone();o=erodeOnceBinaryOnlyOnes(o,a,r.length,r[0].length)}else{const a=Image.createFrom(o);o=erodeOnceBinary(o,a,r)}else if(n){const a=Image.createFrom(o);o=erodeOnceGreyOnlyOnes(o,a,r.length,r[0].length)}else{const a=Image.createFrom(o);o=erodeOnceGrey(o,a,r)}return o}function erodeOnceGrey(t,r,e){const n=e.length,o=e[0].length;let s=(n-1)/2,a=(o-1)/2;for(let l=0;l<t.height;l++)for(let c=0;c<t.width;c++){let h=t.maxValue;for(let f=0;f<o;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-s+c,g=f-a+l;if(d<0||g<0||d>=t.width||g>=t.height)continue;const m=t.getValueXY(d,g,0);m<h&&(h=m)}r.setValueXY(c,l,0,h)}return r}function erodeOnceGreyOnlyOnes(t,r,e,n){const o=(e-1)/2,s=(n-1)/2,a=[];for(let l=0;l<t.width;l++)a.push(0);for(let l=0;l<t.height;l++){for(let c=0;c<t.width;c++){let h=t.maxValue;for(let f=Math.max(0,l-s);f<Math.min(t.height,l+s+1);f++){const u=t.getValueXY(c,f,0);u<h&&(h=u)}a[c]=h}for(let c=0;c<t.width;c++){let h=t.maxValue;for(let f=Math.max(0,c-o);f<Math.min(t.width,c+o+1);f++)a[f]<h&&(h=a[f]);r.setValueXY(c,l,0,h)}}return r}function erodeOnceBinary(t,r,e){const n=e.length,o=e[0].length;let s=(n-1)/2,a=(o-1)/2;for(let l=0;l<t.height;l++)for(let c=0;c<t.width;c++){let h=1;e:for(let f=0;f<o;f++)for(let u=0;u<n;u++){if(e[u][f]!==1)continue;let d=u-s+c,g=f-a+l;if(g<0||d<0||d>=t.width||g>=t.height)continue;if(t.getBitXY(d,g)===0){h=0;break e}}h===1&&r.setBitXY(c,l)}return r}function erodeOnceBinaryOnlyOnes(t,r,e,n){const o=(e-1)/2,s=(n-1)/2,a=[];for(let l=0;l<t.width;l++)a.push(0);for(let l=0;l<t.height;l++){for(let c=0;c<t.width;c++){a[c]=1;for(let h=Math.max(0,l-s);h<Math.min(t.height,l+s+1);h++)if(t.getBitXY(c,h)===0){a[c]=0;break}}for(let c=0;c<t.width;c++)if(r.getBitXY(c,l)!==0){for(let h=Math.max(0,c-o);h<Math.min(t.width,c+o+1);h++)if(a[h]===0){r.clearBitXY(c,l);break}}}return r}function open(t={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=t;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<e;o++)n=n.erode({kernel:r}),n=n.dilate({kernel:r});return n}function close(t={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=t;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<e;o++)n=n.dilate({kernel:r}).erode({kernel:r});return n}function topHat(t={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=t;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),r.length%2===0||r[0].length%2===0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<e;o++)n=n.open({kernel:r}).subtractImage(n,{absolute:!0});return n}function blackHat(t={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=t;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<e;o++)n=n.close({kernel:r}).subtractImage(n,{absolute:!0});return n}function morphologicalGradient(t={}){let{kernel:r=[[1,1,1],[1,1,1],[1,1,1]],iterations:e=1}=t;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),r.columns%2===0||r.rows%2===0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let n=this;for(let o=0;o<e;o++){let s=n.dilate({kernel:r}),a=n.erode({kernel:r});n=s.subtractImage(a,{absolute:!0})}return n}function order4Points(t){let r=0,e=0,n=0,o=0,s=t[0][0],a=0;for(let h=1;h<t.length;h++)t[h][0]<s&&(s=t[h][0],a=h);let l=t[(a+1)%t.length][0],c=(a+1)%t.length;for(let h=1;h<t.length;h++)t[h][0]<l&&h!==a&&(l=t[h][0],c=h);return t[c][1]<t[a][1]?(r=t[c],o=t[a],a!==(c+1)%4?(e=t[(c+1)%4],n=t[(c+2)%4]):(e=t[(c+2)%4],n=t[(c+3)%4])):(o=t[c],r=t[a],c!==(a+1)%4?(e=t[(a+1)%4],n=t[(a+2)%4]):(e=t[(a+2)%4],n=t[(a+3)%4])),[r,e,n,o]}function distance2Points(t,r){return Math.sqrt(Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2))}function crossVect(t,r){return[t[1]*r[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0]]}function dotVect(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function computeWidthAndHeigth(t,r,e,n,o,s){let a=Math.max(distance2Points(t,r),distance2Points(n,e)),l=Math.max(distance2Points(t,n),distance2Points(r,e)),c=0,h=0,f=Math.ceil(o/2),u=Math.ceil(s/2),d=a/l,g=[t[0],t[1],1],m=[r[0],r[1],1],y=[n[0],n[1],1],_=[e[0],e[1],1],w=dotVect(crossVect(g,_),y)/dotVect(crossVect(m,_),y),S=dotVect(crossVect(g,_),m)/dotVect(crossVect(y,_),m),v=[w*m[0]-g[0],w*m[1]-g[1],w*m[2]-g[2]],b=[S*y[0]-g[0],S*y[1]-g[1],S*y[2]-g[2]],k=v[0],C=v[1],R=v[2],A=b[0],$=b[1],E=b[2],I=1/(R*E)*(k*A-(k*E+R*A)*f+R*E*f*f+(C*$-(C*E+R*$)*u+R*E*u*u));I>=0?I=Math.sqrt(I):I=Math.sqrt(-I);let B=new Matrix$2([[I,0,f],[0,I,u],[0,0,1]]),P=B.transpose(),Y=inverse(P),V=inverse(B),J=Matrix$2.rowVector(v),re=Matrix$2.rowVector(b),q=Math.sqrt(dotVect(J.mmul(Y).mmul(V).to1DArray(),v)/dotVect(re.mmul(Y).mmul(V).to1DArray(),b));return q===0||d===0?(c=Math.ceil(a),h=Math.ceil(l)):q<d?(c=Math.ceil(a),h=Math.ceil(c/q)):(h=Math.ceil(l),c=Math.ceil(q*h)),[c,h]}function projectionPoint(t,r,e,n,o,s,a,l,c,h,f,u){let[d,g]=[(e*t+n*r+o)/(c*t+h*r+1),(s*t+a*r+l)/(c*t+h*r+1)];return f.getValueXY(Math.floor(d),Math.floor(g),u)}function warpingFourPoints(t,r={}){let{calculateRatio:e=!0}=r;if(t.length!==4)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${t.length} elements`);let[n,o,s,a]=t,l=[n,o,s,a],[c,h,f,u]=order4Points(l),d,g;e?[d,g]=computeWidthAndHeigth(c,h,f,u,this.width,this.height):(d=Math.ceil(Math.max(distance2Points(c,h),distance2Points(u,f))),g=Math.ceil(Math.max(distance2Points(c,u),distance2Points(h,f))));let m=Image.createFrom(this,{width:d,height:g}),[y,_]=c,[w,S]=h,[v,b]=f,[k,C]=u,[R,A]=[0,0],[$,E]=[0,d-1],[I,B]=[g-1,d-1],[P,Y]=[g-1,0],V=new Matrix$2([[R,A,1,0,0,0,-R*y,-A*y],[$,E,1,0,0,0,-$*w,-E*w],[I,B,1,0,0,0,-I*v,-A*v],[P,Y,1,0,0,0,-P*k,-Y*k],[0,0,0,R,A,1,-R*_,-A*_],[0,0,0,$,E,1,-$*S,-E*S],[0,0,0,I,B,1,-I*b,-B*b],[0,0,0,P,Y,1,-P*C,-Y*C]]),J=Matrix$2.columnVector([y,w,v,k,_,S,b,C]),q=new SingularValueDecomposition(V).solve(J),[se,W,de,fe,Z,X,j,Q]=q.to1DArray(),oe=new Matrix$2(g,d);for(let Ee=0;Ee<this.channels;Ee++){for(let me=0;me<g;me++)for(let be=0;be<d;be++)oe.set(me,be,projectionPoint(me,be,se,W,de,fe,Z,X,j,Q,this,Ee));m.setMatrix(oe,{channel:Ee})}return m}function crop(t={}){let{x:r=0,y:e=0,width:n=this.width-r,height:o=this.height-e}=t;if(this.checkProcessable("crop",{bitDepth:[1,8,16]}),r=Math.round(r),e=Math.round(e),n=Math.round(n),o=Math.round(o),r>this.width-1||e>this.height-1)throw new RangeError(`crop: origin (x:${r}, y:${e}) out of range (${this.width-1}; ${this.height-1})`);if(n<=0||o<=0)throw new RangeError(`crop: width and height (width:${n}; height:${o}) must be positive numbers`);if(r<0||e<0)throw new RangeError(`crop: x and y (x:${r}, y:${e}) must be positive numbers`);if(n>this.width-r||o>this.height-e)throw new RangeError(`crop: (x: ${r}, y:${e}, width:${n}, height:${o}) size is out of range`);let s=this;if(this.bitDepth===1){const a=new Image(n,o,{kind:"BINARY",parent:this});s=cropBinary(this,a,r,e,n,o)}else{const a=Image.createFrom(this,{width:n,height:o,position:[r,e]});s=cropDefault(this,a,r,e,n,o)}return s}function cropDefault(t,r,e,n,o,s){let a=o*t.channels,l=n+s,c=0,h=e*t.channels;for(let f=n;f<l;f++){let u=f*t.width*t.channels+h,d=u+a;for(;u<d;u++)r.data[c++]=t.data[u]}return r}function cropBinary(t,r,e,n,o,s){let a=o*t.channels,l=n+s,c=0,h=e*t.channels;for(let f=n;f<l;f++){let u=f*t.width*t.channels+h,d=u+a;for(;u<d;u++)t.getBit(u)&&r.setBit(c),++c}return r}function cropAlpha(t={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:r=this.maxValue}=t;let e=findLeft(this,r,this.components);if(e===-1)throw new Error("Could not find new dimensions. Threshold may be too high.");let n=findTop(this,r,this.components,e),o=findBottom(this,r,this.components,e),s=findRight(this,r,this.components,e,n,o);return this.crop({x:e,y:n,width:s-e+1,height:o-n+1})}function findLeft(t,r,e){for(let n=0;n<t.width;n++)for(let o=0;o<t.height;o++)if(t.getValueXY(n,o,e)>=r)return n;return-1}function findTop(t,r,e,n){for(let o=0;o<t.height;o++)for(let s=n;s<t.width;s++)if(t.getValueXY(s,o,e)>=r)return o;return-1}function findBottom(t,r,e,n){for(let o=t.height-1;o>=0;o--)for(let s=n;s<t.width;s++)if(t.getValueXY(s,o,e)>=r)return o;return-1}function findRight(t,r,e,n,o,s){for(let a=t.width-1;a>=n;a--)for(let l=o;l<=s;l++)if(t.getValueXY(a,l,e)>=r)return a;return-1}function getFactor(t){if(typeof t=="string"){const r=t[t.length-1];t=parseFloat(t),r==="%"&&(t/=100)}return t}function getThreshold$1(t,r){if(!r)throw Error("getThreshold : the maxValue should be specified");if(typeof t=="string"){if(t[t.length-1]!=="%")throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(t)/100*r}else{if(typeof t=="number")return t<1?t*r:t;throw Error("getThreshold : the value is not valid")}}function factorDimensions(t,r,e){t=getFactor(t);let n=Math.round(t*r),o=Math.round(t*e);return n<=0&&(n=1),o<=0&&(o=1),{width:n,height:o}}function checkRow(t,r){if(r<0||r>=t.height)throw new RangeError(`row must be included between 0 and ${t.height-1}. Current value: ${r}`)}function checkColumn(t,r){if(r<0||r>=t.width)throw new RangeError(`column must be included between 0 and ${t.width-1}. Current value: ${r}`)}function checkChannel(t,r){if(r<0||r>=t.channels)throw new RangeError(`channel must be included between 0 and ${t.channels-1}. Current value: ${r}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(t){if(typeof t!="string")throw new TypeError("interpolation must be a string");if(t=t.toLowerCase(),!validInterpolations[t])throw new RangeError(`invalid interpolation algorithm: ${t}`);return validInterpolations[t]}function nearestNeighbor(t,r,e){const n=this.width/r,o=this.height/e;if(this.bitDepth>1)for(let s=0;s<r;s++){const a=Math.floor((s+.5)*n);for(let l=0;l<e;l++){const c=Math.floor((l+.5)*o);for(let h=0;h<this.channels;h++)t.setValueXY(s,l,h,this.getValueXY(a,c,h))}}else for(let s=0;s<r;s++){const a=Math.floor((s+.5)*n);for(let l=0;l<e;l++){const c=Math.floor((l+.5)*o);this.getBitXY(a,c)&&t.setBitXY(s,l)}}}function resize(t={}){const{factor:r=1,interpolation:e=validInterpolations.nearestneighbor,preserveAspectRatio:n=!0}=t,o=checkInterpolation(e);let s=t.width,a=t.height;if(s||(a&&n?s=Math.round(a*(this.width/this.height)):s=this.width),a||(n?a=Math.round(s*(this.height/this.width)):a=this.height),{width:s,height:a}=factorDimensions(r,s,a),s===this.width&&a===this.height){const f=this.clone();return f.position=[0,0],f}let l=Math.round((this.width-s)/2),c=Math.round((this.height-a)/2);const h=Image.createFrom(this,{width:s,height:a,position:[l,c]});switch(o){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,h,s,a);break;default:throw new Error(`unsupported resize interpolation: ${o}`)}return h}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let t=Image.createFrom(this,{colorModel:HSV}),r=0,e=this.data;for(let n=0;n<e.length;n+=this.channels){let o=e[n],s=e[n+1],a=e[n+2],l=Math.min(o,s,a),c=Math.max(o,s,a),h=c-l,f=0,u=c===0?0:h/c,d=c;if(c!==l){switch(c){case o:f=(s-a)/h+(s<a?6:0);break;case s:f=(a-o)/h+2;break;case a:f=(o-s)/h+4;break;default:throw new Error("unreachable")}f/=6}t.data[r++]=f*this.maxValue,t.data[r++]=u*this.maxValue,t.data[r++]=d,this.alpha&&(t.data[r++]=e[n+3])}return t}function hsl$1(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let t=Image.createFrom(this,{colorModel:HSL}),r=Math.floor(this.maxValue/2),e=0,n=this.data;for(let o=0;o<n.length;o+=this.channels){let s=n[o],a=n[o+1],l=n[o+2],c=Math.max(s,a,l),h=Math.min(s,a,l),f=0,u=0,d=(c+h)/2;if(c!==h){let g=c-h;switch(u=d>r?g/(2-c-h):g/(c+h),c){case s:f=(a-l)/g+(a<l?6:0);break;case a:f=(l-s)/g+2;break;case l:f=(s-a)/g+4;break;default:throw new Error("unreachable")}f/=6}t.data[e++]=f*this.maxValue,t.data[e++]=u*this.maxValue,t.data[e++]=d,this.alpha&&(t.data[e++]=n[o+3])}return t}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB$1]});let t=Image.createFrom(this,{components:4,colorModel:CMYK$1}),r=0,e=this.data;for(let n=0;n<e.length;n+=this.channels){let o=e[n],s=e[n+1],a=e[n+2],l=Math.min(this.maxValue-o,this.maxValue-s,this.maxValue-a),c=(this.maxValue-o-l)/(1-l/this.maxValue),h=(this.maxValue-s-l)/(1-l/this.maxValue),f=(this.maxValue-a-l)/(1-l/this.maxValue);t.data[r++]=Math.round(c),t.data[r++]=Math.round(h),t.data[r++]=Math.round(f),t.data[r++]=Math.round(l),this.alpha&&(t.data[r++]=e[n+3])}return t}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods$1={luma709(t,r,e){return t*6966+r*23436+e*2366>>15},luma601(t,r,e){return t*9798+r*19235+e*3735>>15},maximum(t,r,e){return Math.max(t,r,e)},minimum(t,r,e){return Math.min(t,r,e)},average(t,r,e){return(t+r+e)/3>>0},minmax(t,r,e){return(Math.max(t,r,e)+Math.min(t,r,e))/2},red(t){return t},green(t,r){return r},blue(t,r,e){return e},cyan(t,r,e,n){let o=methods$1.black(t,r,e,n);return(n.maxValue-t-o)/(1-o/n.maxValue)>>0},magenta(t,r,e,n){let o=methods$1.black(t,r,e,n);return(n.maxValue-r-o)/(1-o/n.maxValue)>>0},yellow(t,r,e,n){let o=methods$1.black(t,r,e,n);return(n.maxValue-e-o)/(1-o/n.maxValue)>>0},black(t,r,e,n){return Math.min(n.maxValue-t,n.maxValue-r,n.maxValue-e)},hue(t,r,e,n){let o=methods$1.min(t,r,e),s=methods$1.max(t,r,e);if(s===o)return 0;let a=0,l=s-o;switch(s){case t:a=(r-e)/l+(r<e?6:0);break;case r:a=(e-t)/l+2;break;case e:a=(t-r)/l+4;break;default:throw new Error("unreachable")}return a/6*n.maxValue>>0},saturation(t,r,e,n){let o=methods$1.min(t,r,e),s=methods$1.max(t,r,e),a=s-o;return s===0?0:a/s*n.maxValue},lightness(t,r,e){let n=methods$1.min(t,r,e);return(methods$1.max(t,r,e)+n)/2}};Object.defineProperty(methods$1,"luminosity",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"luminance",{enumerable:!1,value:methods$1.lightness});Object.defineProperty(methods$1,"min",{enumerable:!1,value:methods$1.minimum});Object.defineProperty(methods$1,"max",{enumerable:!1,value:methods$1.maximum});Object.defineProperty(methods$1,"brightness",{enumerable:!1,value:methods$1.maximum});const names$1={};Object.keys(methods$1).forEach(t=>{names$1[t]=t});function grey(t={}){let{algorithm:r="luma709",keepAlpha:e=!1,mergeAlpha:n=!0}=t;if(typeof r!="string"&&typeof r!="function")throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),this.components===1&&(r="red"),e&=this.alpha,n&=this.alpha,e&&(n=!1);let o=getOutputImage(this,t,{components:1,alpha:e,colorModel:GREY$1}),s;if(typeof r=="function")s=r;else if(s=methods$1[r.toLowerCase()],!s)throw new Error(`unsupported grey algorithm: ${r}`);let a=0;for(let l=0;l<this.data.length;l+=this.channels)n?o.data[a++]=clamp$1(s(this.data[l],this.data[l+1],this.data[l+2],this)*this.data[l+this.components]/this.maxValue,this):(o.data[a++]=clamp$1(s(this.data[l],this.data[l+1],this.data[l+2],this),this),o.alpha&&(o.data[a++]=this.data[l+this.components]));return o}function huang(t){let r=0;for(let f=0;f<t.length;f++)if(t[f]!==0){r=f;break}let e=t.length-1;for(let f=t.length-1;f>=r;f--)if(t[f]!==0){e=f;break}let n=1/(e-r),o=new Array(t.length),s=0,a=0;for(let f=r;f<t.length;f++)s+=f*t[f],a+=t[f],o[f]=s/a;let l=new Array(t.length);s=a=0;for(let f=e;f>0;f--)s+=f*t[f],a+=t[f],l[f-1]=s/a;let c=-1,h=Number.MAX_VALUE;for(let f=0;f<t.length;f++){let u=0,d;for(let g=0;g<=f;g++)d=1/(1+n*Math.abs(g-o[f])),d<1e-6||d>.999999||(u+=t[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));for(let g=f+1;g<t.length;g++)d=1/(1+n*Math.abs(g-l[f])),d<1e-6||d>.999999||(u+=t[g]*(-d*Math.log(d)-(1-d)*Math.log(1-d)));u<h&&(h=u,c=f)}return c}function intermodes(t){let r=t.slice(),e=0;for(;!bimodalTest$1(r);){let o=0,s=0,a=r[0];for(let l=0;l<t.length-1;l++)o=s,s=a,a=r[l+1],r[l]=(o+s+a)/3;if(r[t.length-1]=(s+a)/3,e++,e>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let n=0;for(let o=1;o<t.length-1;o++)r[o-1]<r[o]&&r[o+1]<r[o]&&(n+=o);return Math.floor(n/2)}function bimodalTest$1(t){let r=!1,e=0;for(let n=1;n<t.length-1;n++)if(t[n-1]<t[n]&&t[n+1]<t[n]&&(e++,e>2))return!1;return e===2&&(r=!0),r}function isodata(t){let r,e,n,o,s=0;for(let a=1;a<t.length;a++)if(t[a]>0){s=a+1;break}for(;;){r=0,n=0;for(let a=0;a<s;a++)n=n+t[a],r=r+t[a]*a;o=0,e=0;for(let a=s+1;a<t.length;a++)e+=t[a],o+=t[a]*a;if(n>0&&e>0&&(r/=n,o/=e,s===Math.round((r+o)/2)))break;if(s++,s>t.length-2)throw new Error("Threshold not found")}return s}function li(t,r){let e,n,o,s,a,l,c,h,f,u,d,g;d=.5,u=0;for(let m=0;m<t.length;m++)u+=m*t[m];u/=r,c=u;do{l=c,e=l+.5|0,n=0,s=0;for(let m=0;m<=e;m++)n+=m*t[m],s+=t[m];h=s===0?0:n/s,o=0,a=0;for(let m=e+1;m<t.length;m++)o+=m*t[m],a+=t[m];f=a===0?0:o/a,g=(h-f)/(Math.log(h)-Math.log(f)),g<-Number.EPSILON?c=g-.5|0:c=g+.5|0}while(Math.abs(c-l)>d);return e}function maxEntropy(t,r){let e=new Array(t.length);for(let d=0;d<t.length;d++)e[d]=t[d]/r;let n=new Array(t.length),o=new Array(t.length);n[0]=e[0],o[0]=1-n[0];for(let d=1;d<t.length;d++)n[d]=n[d-1]+e[d],o[d]=1-n[d];let s=0;for(let d=0;d<t.length;d++)if(Math.abs(n[d])>=Number.EPSILON){s=d;break}let a=t.length-1;for(let d=t.length-1;d>=s;d--)if(Math.abs(o[d])>=Number.EPSILON){a=d;break}let l=-1,c,h=Number.MIN_VALUE,f,u;for(let d=s;d<=a;d++){f=0;for(let g=0;g<=d;g++)t[g]!==0&&(f-=e[g]/n[d]*Math.log(e[g]/n[d]));u=0;for(let g=d+1;g<t.length;g++)t[g]!==0&&(u-=e[g]/o[d]*Math.log(e[g]/o[d]));c=f+u,h<c&&(h=c,l=d)}return l}function mean$1(t,r){let e=0;for(let n=0;n<t.length;n++)e+=n*t[n];return Math.floor(e/r)}function minError(t,r){let e,n=-2,o,s,a,l,c,h,f,u,d,g,m,y=0;for(let _=0;_<t.length;_++)y+=_*t[_];for(y/=r,e=y;e!==n;){let _=sumA(t,e),w=sumA(t,t.length-1),S=sumB(t,e),v=sumB(t,t.length-1),b=sumC(t,e),k=sumC(t,t.length-1);if(o=S/_,s=(v-S)/(w-_),a=_/w,l=(w-_)/w,c=b/_-o*o,h=(k-b)/(w-_)-s*s,f=1/c-1/h,u=o/c-s/h,d=o*o/c-s*s/h+Math.log10(c*(l*l)/(h*(a*a))),g=u*u-f*d,g<0)return e;n=e,m=(u+Math.sqrt(g))/f,isNaN(m)?e=n:e=Math.floor(m)}return e}function sumA(t,r){let e=0;for(let n=0;n<=r;n++)e+=t[n];return e}function sumB(t,r){let e=0;for(let n=0;n<=r;n++)e+=n*t[n];return e}function sumC(t,r){let e=0;for(let n=0;n<=r;n++)e+=n*n*t[n];return e}function minimum(t){if(t.length<2)return 0;let r=0,e=-1,n=-1,o=new Array(t.length);for(let s=0;s<t.length;s++)o[s]=t[s],t[s]>0&&(n=s);for(;!bimodalTest(o);)if(o=smoothed(o),r++,r>1e4)return e;return e=minimumBetweenPeeks(o,n),e}function smoothed(t){let r=new Array(t.length);for(let e=1;e<t.length-1;e++)r[e]=(t[e-1]+t[e]+t[e+1])/3;return r[0]=(t[0]+t[1])/3,r[t.length-1]=(t[t.length-2]+t[t.length-1])/3,r}function minimumBetweenPeeks(t,r){let e;for(let n=1;n<r;n++)if(t[n-1]>t[n]&&t[n+1]>=t[n]){e=n;break}return e}function bimodalTest(t){let r=t.length,e=!1,n=0;for(let o=1;o<r-1;o++)if(t[o-1]<t[o]&&t[o+1]<t[o]&&(n++,n>2))return!1;return n===2&&(e=!0),e}function moments(t,r){let e=1,n=0,o=0,s=0,a=0,l,c,h,f,u,d,g=-1,m=t.length,y=new Array(m);for(let _=0;_<m;_++)y[_]=t[_]/r;for(let _=0;_<m;_++)n+=_*y[_],o+=_*_*y[_],s+=_*_*_*y[_];c=e*o-n*n,h=(-o*o+n*s)/c,f=(e*-s+o*n)/c,u=.5*(-f-Math.sqrt(f*f-4*h)),d=.5*(-f+Math.sqrt(f*f-4*h)),l=(d-n)/(d-u);for(let _=0;_<m;_++)if(a+=y[_],a>l){g=_;break}return g}function otsu(t,r){let e=0,n=0,o=0,s=0,a=0;for(let l=0;l<t.length;l++)a+=l*t[l];for(let l=0;l<t.length;l++){n=n+t[l];const c=r-n;if(n===0||c===0)continue;e=e+l*t[l];const h=(a-e)/c,f=n*c*(e/n-h)*(e/n-h);f>=o&&(s=l,o=f)}return s}function percentile(t){let r=-1,e=.5,n=new Array(t.length),o=partialSum(t,t.length-1),s=1;for(let a=0;a<t.length;a++)n[a]=Math.abs(partialSum(t,a)/o-e),n[a]<s&&(s=n[a],r=a);return r}function partialSum(t,r){let e=0;for(let n=0;n<=r;n++)e+=t[n];return e}function renyiEntropy(t,r){let e,n,o,s=new Array(t.length),a=new Array(t.length),l=new Array(t.length),c=0,h=0,f=0,u=0,d=0,g=0,y=1/(1-.5),w=1/(1-2);for(let k=0;k<t.length;k++)s[k]=t[k]/r;a[0]=s[0],l[0]=1-a[0];for(let k=1;k<t.length;k++)a[k]=a[k-1]+s[k],l[k]=1-a[k];n=0;for(let k=0;k<t.length;k++)if(Math.abs(a[k])>=Number.EPSILON){n=k;break}o=t.length-1;for(let k=t.length-1;k>=n;k--)if(Math.abs(l[k])>=Number.EPSILON){o=k;break}for(let k=n;k<=o;k++){let C=0,R=0,A=0;for(let V=0;V<=k;V++)t[V]!==0&&(C-=s[V]/a[k]*Math.log(s[V]/a[k])),R+=Math.sqrt(s[V]/a[k]),A+=s[V]*s[V]/(a[k]*a[k]);let $=0,E=0,I=0;for(let V=k+1;V<t.length;V++)t[V]!==0&&($-=s[V]/l[k]*Math.log(s[V]/l[k])),E+=Math.sqrt(s[V]/l[k]),I+=s[V]*s[V]/(l[k]*l[k]);let B=C+$,P=y*(R*E>0?Math.log(R*E):0),Y=w*(A*I>0?Math.log(A*I):0);B>u&&(u=B,c=k),P>d&&(d=P,h=k),Y>g&&(g=Y,f=k)}let S=[c,h,f];S.sort((k,C)=>k-C);let v;Math.abs(S[0]-S[1])<=5?Math.abs(S[1]-S[2])<=5?v=[1,2,1]:v=[0,1,3]:Math.abs(S[1]-S[2])<=5?v=[3,1,0]:v=[1,2,1];let b=a[S[2]]-a[S[0]];return e=Math.round(S[0]*(a[S[0]]+.25*b*v[0])+.25*S[1]*b*v[1]+S[2]*(l[S[2]]+.25*b*v[2])),e}function shanbhag(t,r){let e=new Array(t.length);for(let g=0;g<t.length;g++)e[g]=t[g]/r;let n=new Array(t.length),o=new Array(t.length);n[0]=e[0],o[0]=1-n[0];for(let g=1;g<t.length;g++)n[g]=n[g-1]+e[g],o[g]=1-n[g];let s=0;for(let g=0;g<t.length;g++)if(Math.abs(n[g])>=Number.EPSILON){s=g;break}let a=t.length-1;for(let g=t.length-1;g>=s;g--)if(Math.abs(o[g])>=Number.EPSILON){a=g;break}let l=-1,c=Number.MAX_VALUE,h,f,u,d;for(let g=s;g<=a;g++){u=0,h=.5/n[g];for(let m=1;m<=g;m++)u-=e[m]*Math.log(1-h*n[m-1]);u*=h,d=0,h=.5/o[g];for(let m=g+1;m<t.length;m++)d-=e[m]*Math.log(1-h*o[m]);d*=h,f=Math.abs(u-d),f<c&&(c=f,l=g)}return l}function triangle$1(t){let r=0,e=0,n=0,o=0;for(let u=0;u<t.length;u++)if(t[u]>0){r=u;break}r>0&&r--;for(let u=t.length-1;u>0;u--)if(t[u]>0){o=u;break}o<t.length-1&&o++;for(let u=0;u<t.length;u++)t[u]>e&&(n=u,e=t[u]);let s=!1;if(n-r<o-n){s=!0;let u=0,d=t.length-1;for(;u<d;){let g=t[u];t[u]=t[d],t[d]=g,u++,d--}r=t.length-1-o,n=t.length-1-n}if(r===n)return r;let a,l,c;a=t[n],l=r-n,c=Math.sqrt(a*a+l*l),a/=c,l/=c,c=a*r+l*t[r];let h=r,f=0;for(let u=r+1;u<=n;u++){let d=a*u+l*t[u]-c;d>f&&(h=u,f=d)}if(h--,s){let u=0,d=t.length-1;for(;u<d;){let g=t[u];t[u]=t[d],t[d]=g,u++,d--}return t.length-1-h}else return h}function yen(t,r){let e=new Array(t.length);for(let h=0;h<t.length;h++)e[h]=t[h]/r;let n=new Array(t.length);n[0]=e[0];for(let h=1;h<t.length;h++)n[h]=n[h-1]+e[h];let o=new Array(t.length);o[0]=e[0]*e[0];for(let h=1;h<t.length;h++)o[h]=o[h-1]+e[h]*e[h];let s=new Array(t.length);s[t.length-1]=0;for(let h=t.length-2;h>=0;h--)s[h]=s[h+1]+e[h+1]*e[h+1];let a=-1,l=Number.MIN_VALUE,c;for(let h=0;h<t.length;h++)c=-1*(o[h]*s[h]>0?Math.log(o[h]*s[h]):0)+2*(n[h]*(1-n[h])>0?Math.log(n[h]*(1-n[h])):0),c>l&&(l=c,a=h);return a}const methods={huang,intermodes,isodata,li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum,moments,otsu,percentile,renyientropy:renyiEntropy,shanbhag,triangle:triangle$1,yen},names={};Object.keys(methods).forEach(t=>{names[t]=t});function getThreshold(t={}){let{algorithm:r=names.otsu}=t;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let e=methods[r.toLowerCase()];if(e){let n=this.getHistogram();return e(n,this.size)}else throw new Error(`unknown thresholding algorithm: ${r}`)}const THRESHOLD="threshold";function mask(t={}){let{algorithm:r=THRESHOLD,threshold:e=.5,useAlpha:n=!0,invert:o=!1}=t;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),r===THRESHOLD?e=getThreshold$1(e,this.maxValue):e=getThreshold.call(this,t);let s=new Image(this.width,this.height,{kind:"BINARY",parent:this}),a=0;if(this.alpha&&n)for(let l=0;l<this.data.length;l+=this.channels){let c=this.data[l]+(this.maxValue-this.data[l])*(this.maxValue-this.data[l+1])/this.maxValue;(o&&c<=e||!o&&c>=e)&&s.setBit(a),a++}else for(let l=0;l<this.data.length;l+=this.channels)(o&&this.data[l]<=e||!o&&this.data[l]>=e)&&s.setBit(a),a++;return s}function copyImage(t,r,e,n){let o=t.width,s=t.height,a=r.width,l=t.channels;for(let c=0;c<o;c++)for(let h=0;h<s;h++)for(let f=0;f<l;f++){let u=(h*o+c)*l+f,d=((n+h)*a+e+c)*l+f;r.data[d]=t.data[u]}}function pad(t={}){let{size:r=0,algorithm:e="copy",color:n}=t;if(this.checkProcessable("pad",{bitDepth:[8,16]}),e==="set"){if(n.length!==this.channels)throw new Error(`pad: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let c=0;c<n.length;c++)n[c]===0&&(n[c]=.001)}else n=newArray$1(this.channels,null);Array.isArray(r)||(r=[r,r]);let o=this.width+r[0]*2,s=this.height+r[1]*2,a=this.channels,l=Image.createFrom(this,{width:o,height:s});copyImage(this,l,r[0],r[1]);for(let c=r[0];c<o-r[0];c++)for(let h=0;h<a;h++){let f=n[h]||l.data[(r[1]*o+c)*a+h];for(let u=0;u<r[1];u++)l.data[(u*o+c)*a+h]=f;f=n[h]||l.data[((s-r[1]-1)*o+c)*a+h];for(let u=s-r[1];u<s;u++)l.data[(u*o+c)*a+h]=f}for(let c=0;c<s;c++)for(let h=0;h<a;h++){let f=n[h]||l.data[(c*o+r[0])*a+h];for(let u=0;u<r[0];u++)l.data[(c*o+u)*a+h]=f;f=n[h]||l.data[(c*o+o-r[0]-1)*a+h];for(let u=o-r[0];u<o;u++)l.data[(c*o+u)*a+h]=f}return l}function colorDepth(t=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(t))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===t)return this.clone();let r=Image.createFrom(this,{bitDepth:t});switch(t){case 8:if(this.bitDepth===1)for(let e=0;e<this.size;e++)this.getBit(e)&&(r.data[e]=255);else for(let e=0;e<this.data.length;e++)r.data[e]=this.data[e]>>8;break;case 16:if(this.bitDepth===1)for(let e=0;e<this.size;e++)this.getBit(e)&&(r.data[e]=65535);else for(let e=0;e<this.data.length;e++)r.data[e]=this.data[e]<<8|this.data[e];break;default:throw new Error("colorDepth conversion unexpected case")}return r}function rotateFree(t,r={}){const{interpolation:e=validInterpolations.nearestneighbor,width:n=this.width,height:o=this.height}=r;if(typeof t!="number")throw new TypeError("degrees must be a number");const s=checkInterpolation(e),a=t*Math.PI/180,l=Math.floor(Math.abs(n*Math.cos(a))+Math.abs(o*Math.sin(a))),c=Math.floor(Math.abs(o*Math.cos(a))+Math.abs(n*Math.sin(a))),h=Math.cos(-a),f=Math.sin(-a);let u=l/2,d=c/2;l%2===0?(u=u-.5,c%2===0?d=d-.5:d=Math.floor(d)):(u=Math.floor(u),c%2===0?d=d-.5:d=Math.floor(d));const g=Math.floor(n/2-u),m=Math.floor(o/2-d);if(this.bitDepth===1){const y=new Image(l,c,{kind:"BINARY",parent:this});switch(s){case validInterpolations.nearestneighbor:return rotateBinaryNearestNeighbor(this,y,g,m,u,d,h,f);case validInterpolations.bilinear:return rotateBinaryBilinear(this,y,g,m,u,d,h,f);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}else{const y=Image.createFrom(this,{width:l,height:c});switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,y,g,m,u,d,h,f);case validInterpolations.bilinear:return rotateBilinear(this,y,g,m,u,d,h,f);default:throw new Error(`unsupported rotate interpolation: ${s}`)}}}function rotateNearestNeighbor(t,r,e,n,o,s,a,l){for(let c=0;c<r.width;c+=1)for(let h=0;h<r.height;h+=1)for(let f=0;f<t.channels;f++){let u=Math.round((c-o)*a-(h-s)*l+o)+e,d=Math.round((h-s)*a+(c-o)*l+s)+n;u<0||u>=t.width||d<0||d>=t.height?t.alpha===1&&f===t.channels-1?r.setValueXY(c,h,f,0):r.setValueXY(c,h,f,t.maxValue):r.setValueXY(c,h,f,t.getValueXY(u,d,f))}return r}function rotateBinaryNearestNeighbor(t,r,e,n,o,s,a,l){for(let c=0;c<r.width;c+=1)for(let h=0;h<r.height;h+=1){let f=Math.round((c-o)*a-(h-s)*l+o)+e,u=Math.round((h-s)*a+(c-o)*l+s)+n;(f<0||f>=t.width||u<0||u>=t.height||t.getBitXY(f,u))&&r.setBitXY(c,h)}return r}function rotateBilinear(t,r,e,n,o,s,a,l){let c=t.width*t.channels;for(let h=0;h<r.height;h++)for(let f=0;f<r.width;f++){let u=(f-o)*a-(h-s)*l+o+e,d=(h-s)*a+(f-o)*l+s+n,g=u|0,m=d|0,y=u-g,_=d-m;for(let w=0;w<t.channels;w++)if(u<0||u>=t.width||d<0||d>=t.height)t.alpha===1&&w===t.channels-1?r.setValueXY(f,h,w,0):r.setValueXY(f,h,w,t.maxValue);else{let S=(m*t.width+g)*t.channels+w,v=t.data[S],b=t.data[S+t.channels],k=t.data[S+c],C=t.data[S+c+t.channels],R=v+y*(b-v)+_*(k-v)+y*_*(v-b-k+C)|0;r.setValueXY(f,h,w,R)}}return r}function rotateBinaryBilinear(t,r,e,n,o,s,a,l){let c=t.width;for(let h=0;h<r.height;h++)for(let f=0;f<r.width;f++){let u=(f-o)*a-(h-s)*l+o+e,d=(h-s)*a+(f-o)*l+s+n,g=u|0,m=d|0,y=u-g,_=d-m;if(u<0||u>=t.width||d<0||d>=t.height)r.setBitXY(f,h);else{let w=m*t.width+g,S=t.getBit(w),v=t.getBit(w+1),b=t.getBit(w+c),k=t.getBit(w+1+c);(S|y&v-S|_&b-S|y&_&S-v-b+k)>0&&r.setBitXY(f,h)}}return r}function rotate$1(t,r){if(this.checkProcessable("rotate",{bitDepth:[1,8,16]}),typeof t!="number")throw new TypeError("angle must be a number");switch(t<0&&(t=Math.ceil(-t/360)*360+t),t%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,t,r)}}function rotateLeft(){if(this.bitDepth===1){const t=new Image(this.height,this.width,{kind:"BINARY",parent:this}),r=t.height-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)this.getBitXY(n,e)&&t.setBitXY(e,r-n);return t}else{const t=Image.createFrom(this,{width:this.height,height:this.width}),r=t.height-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)for(let o=0;o<this.channels;o++)t.setValueXY(e,r-n,o,this.getValueXY(n,e,o));return t}}function rotateRight(){if(this.bitDepth===1){const t=new Image(this.height,this.width,{kind:"BINARY",parent:this}),r=t.width-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)this.getBitXY(n,e)&&t.setBitXY(r-e,n);return t}else{const t=Image.createFrom(this,{width:this.height,height:this.width}),r=t.width-1;for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++)for(let o=0;o<this.channels;o++)t.setValueXY(r-e,n,o,this.getValueXY(n,e,o));return t}}function rotate180(){if(this.bitDepth===1){const t=new Image(this.width,this.height,{kind:"BINARY",parent:this}),r=t.width-1,e=t.height-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)this.getBitXY(o,n)&&t.setBitXY(r-o,e-n);return t}else{const t=Image.createFrom(this),r=t.width-1,e=t.height-1;for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)for(let s=0;s<this.channels;s++)t.setValueXY(r-o,e-n,s,this.getValueXY(o,n,s));return t}}function insert(t,r={}){const e=getImageParameters(t);this.checkProcessable("insert",e);let{x:n=0,y:o=0}=r;const s=getOutputImageOrInPlace(this,r,{copy:!0}),a=Math.min(s.height,o+t.height),l=Math.min(s.width,n+t.width);if(s.bitDepth===1)for(let c=o;c<a;c++)for(let h=n;h<l;h++)t.getBitXY(h-n,c-o)?s.setBitXY(h,c):s.clearBitXY(h,c);else for(let c=o;c<a;c++)for(let h=n;h<l;h++)s.setPixelXY(h,c,t.getPixelXY(h-n,c-o));return s}function setBorder(t={}){let{size:r=0,algorithm:e="copy",color:n}=t;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),e==="set"){if(n.length!==this.channels)throw new Error(`setBorder: the color array must have the same length as the number of channels. Here: ${this.channels}`);for(let l=0;l<n.length;l++)n[l]===0&&(n[l]=.001)}else n=newArray$1(this.channels,null);Array.isArray(r)||(r=[r,r]);let o=r[0],s=r[1],a=this.channels;for(let l=o;l<this.width-o;l++)for(let c=0;c<a;c++){let h=n[c]||this.data[(l+this.width*s)*a+c];for(let f=0;f<s;f++)this.data[(f*this.width+l)*a+c]=h;h=n[c]||this.data[(l+this.width*(this.height-s-1))*a+c];for(let f=this.height-s;f<this.height;f++)this.data[(f*this.width+l)*a+c]=h}for(let l=0;l<this.height;l++)for(let c=0;c<a;c++){let h=n[c]||this.data[(l*this.width+o)*a+c];for(let f=0;f<o;f++)this.data[(l*this.width+f)*a+c]=h;h=n[c]||this.data[(l*this.width+this.width-o-1)*a+c];for(let f=this.width-o;f<this.width;f++)this.data[(l*this.width+f)*a+c]=h}return this}function split(t={}){let{preserveAlpha:r=!0}=t;if(this.checkProcessable("split",{bitDepth:[8,16]}),this.components===1)return new Stack([this.clone()]);let e=new Stack,n=this.data;if(this.alpha&&r)for(let o=0;o<this.components;o++){let s=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY$1}),a=0;for(let l=0;l<n.length;l+=this.channels)s.data[a++]=n[l+o],s.data[a++]=n[l+this.components];e.push(s)}else for(let o=0;o<this.channels;o++){let s=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY$1}),a=0;for(let l=0;l<n.length;l+=this.channels)s.data[a++]=n[l+o];e.push(s)}return e}function getChannel(t,r={}){let{keepAlpha:e=!1,mergeAlpha:n=!1}=r;e&=this.alpha,n&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),t=validateChannel(this,t);let o=Image.createFrom(this,{components:1,alpha:e,colorModel:GREY$1}),s=0;for(let a=0;a<this.data.length;a+=this.channels)n?o.data[s++]=this.data[a+t]*this.data[a+this.components]/this.maxValue:(o.data[s++]=this.data[a+t],e&&(o.data[s++]=this.data[a+this.components]));return o}function combineChannels(t=defaultCombineMethod,r={}){let{mergeAlpha:e=!1,keepAlpha:n=!1}=r;e&=this.alpha,n&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let o=Image.createFrom(this,{components:1,alpha:n,colorModel:GREY$1}),s=0;for(let a=0;a<this.size;a++){let l=t(this.getPixel(a));e?o.data[s++]=l*this.data[a*this.channels+this.components]/this.maxValue:(o.data[s++]=l,n&&(o.data[s++]=this.data[a*this.channels+this.components]))}return o}function defaultCombineMethod(t){return(t[0]+t[1]+t[2])/3}function setChannel(t,r){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),r.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),r.width!==this.width||r.height!==this.height)throw new Error("Images must have exactly the same width and height");t=validateChannel(this,t);let e=t;for(let n=0;n<r.data.length;n++)this.data[e]=r.data[n],e+=this.channels;return this}function getSimilarity(t,r={}){let{shift:e=[0,0],average:n,channels:o,defaultAlpha:s,normalize:a,border:l=[0,0]}=r;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(l)||(l=[l,l]),o=validateArrayOfChannels(this,{channels:o,defaultAlpha:s}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");typeof n>"u"&&(n=!0);let c=Math.max(l[0],-e[0]),h=Math.min(this.width-l[0],this.width-e[0]),f=Math.max(l[1],-e[1]),u=Math.min(this.height-l[1],this.height-e[1]),d=newArray$1(o.length,0);for(let g=0;g<o.length;g++){let m=o[g],y=a?this.sum[m]:Math.max(this.sum[m],t.sum[m]),_=a?t.sum[m]:Math.max(this.sum[m],t.sum[m]);if(y!==0&&_!==0)for(let w=c;w<h;w++)for(let S=f;S<u;S++){let v=w*this.multiplierX+S*this.multiplierY+m,b=v+e[0]*this.multiplierX+e[1]*this.multiplierY;d[g]+=Math.min(this.data[v]/y,t.data[b]/_)}}return n?d.reduce((g,m)=>g+m)/d.length:d}function getPixelsGrid(t={}){let{sampling:r=[10,10],painted:e=!1,mask:n}=t;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(r)||(r=[r,r]);const o=r[0],s=r[1],a=[],l=[],c=this.width/o,h=this.height/s;let f=Math.floor(c/2);for(let d=0;d<o;d++){let g=Math.floor(h/2);for(let m=0;m<s;m++){let y=Math.round(f),_=Math.round(g);(!n||n.getBitXY(y,_))&&(a.push([y,_]),l.push(this.getPixelXY(y,_))),g+=h}f+=c}const u={xyS:a,zS:l};return e&&(u.painted=this.rgba8().paintPoints(a)),u}function Matrix(t,r,e){const n=new Array(t);for(let o=0;o<t;o++)n[o]=new Array(r);if(e)for(let o=0;o<t;o++)for(let s=0;s<r;s++)n[o][s]=e;return n.width=t,n.height=r,Object.setPrototypeOf(n,Matrix.prototype),n}Matrix.prototype.localMin=function(t,r){let e=this[t][r],n=[t,r];for(let o=Math.max(0,t-1);o<Math.min(this.length,t+2);o++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[o][s]<e&&(e=this[o][s],n=[o,s]);return{position:n,value:e}};Matrix.prototype.localMax=function(t,r){let e=this[t][r],n=[t,r];for(let o=Math.max(0,t-1);o<Math.min(this.length,t+2);o++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[o][s]>e&&(e=this[o][s],n=[o,s]);return{position:n,value:e}};Matrix.prototype.localSearch=function(t,r,e){let n=[];for(let o=Math.max(0,t-1);o<Math.min(this.length,t+2);o++)for(let s=Math.max(0,r-1);s<Math.min(this[0].length,r+2);s++)this[o][s]===e&&n.push([o,s]);return n};function getBestMatch(t,r={}){let{border:e}=r;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");let n=new Matrix(t.width,t.height,-1/0),o=Math.floor(t.width/2),s=Math.floor(t.height/2),a=o,l=s,c=!1;for(;!c;){let h=n.localSearch(o,s,-1/0);for(let u=0;u<h.length;u++){let d=h[u],g=this.getSimilarity(t,{border:e,shift:[a-d[0],l-d[1]]});n[d[0]][d[1]]=g}let f=n.localMax(o,s);f.position[0]!==o||f.position[1]!==s?(o=f.position[0],s=f.position[1]):c=!0}return[o-a,s-l]}function getRow(t,r=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,t),checkChannel(this,r);let e=new Array(this.width),n=0,o=t*this.width*this.channels+r,s=o+this.width*this.channels;for(let a=o;a<s;a+=this.channels)e[n++]=this.data[a];return e}function getColumn(t,r=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,t),checkChannel(this,r);let e=new Array(this.height),n=0,o=this.width*this.channels;for(let s=r+t*this.channels;s<this.data.length;s+=o)e[n++]=this.data[s];return e}function getMatrix(t={}){let{channel:r}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),r===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}let e=new Matrix$2(this.height,this.width);for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)e.set(n,o,this.getValueXY(o,n,r));return e}function setMatrix(t,r={}){t=new Matrix$2(t);let{channel:e}=r;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}if(this.width!==t.columns||this.height!==t.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let n=0;n<this.height;n++)for(let o=0;o<this.width;o++)this.setValueXY(o,n,e,t.get(n,o));return this}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let t=new Array(this.size),r=0;for(let e=0;e<this.data.length;e+=this.channels){let n=new Array(this.components);for(let o=0;o<this.components;o++)n[o]=this.data[e+o];t[r++]=n}return t}function getIntersection(t){let r=this,e=r.getClosestCommonParent(t),n=r.getRelativePosition(e,{defaultFurther:!0}),o=getRelativePositionForAllPixels(r,n),s=t.getRelativePosition(e,{defaultFurther:!0}),a=getRelativePositionForAllPixels(t,s),l=getCommonSurface(o,a),c={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let h=0;h<l.length;h++){let f=l[h],u=[f[0]-n[0],f[1]-n[1]],d=[f[0]-s[0],f[1]-s[1]],g=r.getBitXY(u[0],u[1]),m=t.getBitXY(d[0],d[1]);g===1&&m===1&&c.commonWhitePixels.push(f)}for(let h=0;h<o.length;h++){let f,u;h!==0&&(f=Math.floor(h/r.width),u=h%r.width),r.getBitXY(f,u)===1&&c.whitePixelsMask1.push(o[h])}for(let h=0;h<a.length;h++){let f=0,u=0;h!==0&&(f=Math.floor(h/t.width),u=h%t.width),t.getBitXY(f,u)===1&&c.whitePixelsMask2.push(a[h])}return c}function getRelativePositionForAllPixels(t,r){let e=[];for(let n=0;n<t.height;n++)for(let o=0;o<t.width;o++){let s=[n,o];e.push([s[0]+r[0],s[1]+r[1]])}return e}function getCommonSurface(t,r){let e=0,n=0,o=[];for(;e<t.length&&n<r.length;)t[e][0]===r[n][0]&&t[e][1]===r[n][1]?(o.push(t[e]),e++,n++):t[e][0]<r[n][0]||t[e][0]===r[n][0]&&t[e][1]<r[n][1]?e++:n++;return o}function getClosestCommonParent(t){let r=getDepth(this),e=getDepth(t),n;if(r>=e?n=getFurthestParent(this,r):n=getFurthestParent(t,e),r===0||e===0)return n;let o=this,s=t;for(;r!==e;)if(r>e){if(o=o.parent,o===null)return n;r=r-1}else{if(s=s.parent,s===null)return n;e=e-1}for(;o!==s&&o!==null&&s!==null;)if(o=o.parent,s=s.parent,o===null||s===null)return n;return o!==s?n:o}function getDepth(t){let r=0,e=t;for(;e.parent!=null;)e=e.parent,r++;return r}function getFurthestParent(t,r){let e=t;for(;r>0;)e=e.parent,r=r-1;return e}const defaultOptions$1={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(t,r){t.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),r=Object.assign({},defaultOptions$1,r);const e=t.width,n=t.height,o=t.maxValue,s={sigma:r.gaussianBlur,radius:3},a=t.gaussianFilter(s),l=a.convolution(Gy,convOptions),c=a.convolution(Gx,convOptions),h=c.hypotenuse(l),f=t.constructor,u=new f(e,n,{kind:"GREY",bitDepth:32}),d=new f(e,n,{kind:"GREY",bitDepth:32}),g=new f(e,n,{kind:"GREY"});for(var m=1;m<e-1;m++)for(var y=1;y<n-1;y++){var _=(Math.round(Math.atan2(c.getValueXY(m,y,0),l.getValueXY(m,y,0))*(5/Math.PI))+5)%5;_===0&&(h.getValueXY(m,y,0)<=h.getValueXY(m,y-1,0)||h.getValueXY(m,y,0)<=h.getValueXY(m,y+1,0))||_===1&&(h.getValueXY(m,y,0)<=h.getValueXY(m-1,y+1,0)||h.getValueXY(m,y,0)<=h.getValueXY(m+1,y-1,0))||_===2&&(h.getValueXY(m,y,0)<=h.getValueXY(m-1,y,0)||h.getValueXY(m,y,0)<=h.getValueXY(m+1,y,0))||_===3&&(h.getValueXY(m,y,0)<=h.getValueXY(m-1,y-1,0)||h.getValueXY(m,y,0)<=h.getValueXY(m+1,y+1,0))||u.setValueXY(m,y,0,h.getValueXY(m,y,0))}for(m=0;m<e*n;++m){var w=u.data[m],S=0;w>r.highThreshold&&(S++,g.data[m]=o),w>r.lowThreshold&&S++,d.data[m]=S}var v=[];for(m=1;m<e-1;++m)for(y=1;y<n-1;++y)if(d.getValueXY(m,y,0)===1){e:for(var b=m-1;b<m+2;++b)for(var k=y-1;k<y+2;++k)if(d.getValueXY(b,k,0)===2){v.push([m,y]),g.setValueXY(m,y,0,o);break e}}for(;v.length>0;){var C=[];for(m=0;m<v.length;++m)for(y=-1;y<2;++y)for(b=-1;b<2;++b)if(!(y===0&&b===0)){var R=v[m][0]+y,A=v[m][1]+b;d.getValueXY(R,A,0)===1&&g.getValueXY(R,A,0)===0&&(C.push([R,A]),g.setValueXY(R,A,0,o))}v=C}return g}function cannyEdge(t){return cannyEdgeDetector(this,t)}function extract(t,r={}){let{position:e}=r;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!e&&(e=t.getRelativePosition(this),!e))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let n=Image.createFrom(this,{width:t.width,height:t.height,alpha:1,position:e,parent:this});for(let o=0;o<t.width;o++)for(let s=0;s<t.height;s++){for(let a=0;a<this.channels;a++){let l=this.getValueXY(o+e[0],s+e[1],a);n.setValueXY(o,s,a,l)}t.getBitXY(o,s)||n.setValueXY(o,s,this.components,0)}return n}else{let n=Image.createFrom(this,{width:t.width,height:t.height,position:e,parent:this});for(let o=0;o<t.height;o++)for(let s=0;s<t.width;s++)t.getBitXY(s,o)&&this.getBitXY(s+e[0],o+e[1])&&n.setBitXY(s,o);return n}}var fastList={exports:{}};(function(t,r){(function(){function e(o,s,a){this.next=a,a&&(a.prev=this),this.prev=s,s&&(s.next=this),this.data=o}function n(){if(!(this instanceof n))return new n;this._head=null,this._tail=null,this.length=0}n.prototype={push:function(o){this._tail=new e(o,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(this.length!==0){var o=this._tail;return this._tail=o.prev,o.prev&&(o.prev=this._tail.next=null),this.length--,this.length===1?this._head=this._tail:this.length===0&&(this._head=this._tail=null),o.data}},unshift:function(o){this._head=new e(o,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(this.length!==0){var o=this._head;return this._head=o.next,o.next&&(o.next=this._head.prev=null),this.length--,this.length===1?this._tail=this._head:this.length===0&&(this._head=this._tail=null),o.data}},item:function(o){o<0&&(o=this.length+o);for(var s=this._head;o-- >0&&s;)s=s.next;return s?s.data:void 0},slice:function(o,s){if(o||(o=0),s||(s=this.length),s<0&&(s=this.length+s),o<0&&(o=this.length+o),s===o)return[];if(s<o)throw new Error("invalid offset: "+o+","+s+" (length="+this.length+")");for(var a=s-o,l=new Array(a),c=0,h=this._head;o-- >0&&h;)h=h.next;for(;c<a&&h;)l[c++]=h.data,h=h.next;return l},drop:function(){n.call(this)},forEach:function(o,s){for(var a=this._head,l=0,c=this.length;l<c&&a;)o.call(s||this,a.data,l,this),a=a.next,l++},map:function(o,s){var a=new n;return this.forEach(function(l,c,h){a.push(o.call(s||h,l,c,h))}),a},filter:function(o,s){var a=new n;return this.forEach(function(l,c,h){o.call(s||h,l,c,h)&&a.push(l)}),a},reduce:function(o,s,a){var l=0,c=this._head,h=this.length;for(s||(l=1,s=c&&c.data,c=c&&c.next);l<h&&c;)s=o.call(a||this,s,c.data,this),l++,c=c.next;return s}},t.exports=n})()})(fastList);var fastListExports=fastList.exports;const LinkedList=getDefaultExportFromCjs(fastListExports);function floodFill(t={}){const{x:r=0,y:e=0,inPlace:n=!0}=t,o=n?this:Image.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(r,e))return o;const a=new LinkedList;for(a.push(new Node(r,e));a.length>0;){const l=a.shift();o.setBitXY(l.x,l.y);for(let c=l.x+1;c<this.width&&(!o.getBitXY(c,l.y)&&!this.getBitXY(c,l.y));c++)o.setBitXY(c,l.y),l.y+1<this.height&&!this.getBitXY(c,l.y+1)&&a.push(new Node(c,l.y+1)),l.y-1>=0&&!this.getBitXY(c,l.y-1)&&a.push(new Node(c,l.y-1));for(let c=l.x-1;c>=0&&(!o.getBitXY(c,l.y)&&!this.getBitXY(c,l.y));c++)o.setBitXY(c,l.y),l.y+1<this.height&&!this.getBitXY(c,l.y+1)&&a.push(new Node(c,l.y+1)),l.y-1>=0&&!this.getBitXY(c,l.y-1)&&a.push(new Node(c,l.y-1))}return o}function Node(t,r){this.x=t,this.y=r}function _extends(){return _extends=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)({}).hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},_extends.apply(null,arguments)}function hsv2rgb(t,r,e){r=r/100,e=e/100;var n=[],o=e*r,s=t/60,a=o*(1-Math.abs(s%2-1)),l=e-o;return s>=0&&s<1?n=[o,a,0]:s>=1&&s<2?n=[a,o,0]:s>=2&&s<3?n=[0,o,a]:t>=3&&s<4?n=[0,a,o]:t>=4&&s<5?n=[a,0,o]:t>=5&&s<=6?n=[o,0,a]:n=[0,0,0],{r:Math.round(255*(n[0]+l)),g:Math.round(255*(n[1]+l)),b:Math.round(255*(n[2]+l))}}function hsl2hsv(t,r,e){return r*=(e<50?e:100-e)/100,{h:t,s:2*r/(e+r)*100,v:e+r}}function hsl2rgb$1(t,r,e){var n=hsl2hsv(t,r,e);return hsv2rgb(n.h,n.s,n.v)}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(t){return named(t)||hex3(t)||hex6(t)||rgb(t)||rgba$1(t)||hsl(t)||hsla(t)}function named(t){var r=colors[t.toLowerCase()];if(r)return{r:r[0],g:r[1],b:r[2],a:100}}function rgb(t){var r=t.match(/rgb\(([^)]+)\)/);if(r){var e=r[1].split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:100}}}function rgba$1(t){var r=t.match(/rgba\(([^)]+)\)/);if(r){var e=r[1].split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:e[3]*100}}}function hex6(t){if(t[0]==="#"&&t.length===7)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:100}}function hex3(t){if(t[0]==="#"&&t.length===4)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:100}}function hsl(t){var r=t.match(/hsl\(([^)]+)\)/);if(r){var e=r[1].split(/ *, */),n=parseInt(e[0],10),o=parseInt(e[1],10),s=parseInt(e[2],10),a=hsl2rgb$1(n,o,s);return _extends({},a,{a:100})}}function hsla(t){var r=t.match(/hsla\(([^)]+)\)/);if(r){var e=r[1].split(/ *, */),n=parseInt(e[0],10),o=parseInt(e[1],10),s=parseInt(e[2],10),a=parseInt(parseFloat(e[3])*100,10),l=hsl2rgb$1(n,o,s);return _extends({},l,{a})}}function css2array(t){let r=parse(t);return[r.r,r.g,r.b,Math.round(r.a*255/100)]}function hue2rgb(t,r,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?t+(r-t)*6*e:e<1/2?r:e<2/3?t+(r-t)*(2/3-e)*6:t}function hsl2rgb(t,r,e){let n,o,s,a,l,c;return r/=100,e/=100,r===0?a=l=c=e*255:(e<=.5?o=e*(r+1):o=e+r-e*r,n=e*2-o,s=t/360,a=hue2rgb(n,o,s+1/3),l=hue2rgb(n,o,s),c=hue2rgb(n,o,s-1/3)),{r:a,g:l,b:c}}function getDistinctColors(t){let r=new Array(t),e=0;for(let n=0;n<360;n+=360/t){e++;let o=hsl2rgb(n,100,30+e%4*15);r[e-1]=[Math.round(o.r*255),Math.round(o.g*255),Math.round(o.b*255)]}return r}function getRandomColor(){return[Math.floor(Math.random()*256),Math.floor(Math.random()*256),Math.floor(Math.random()*256)]}function getColors(t){let{color:r,colors:e,randomColors:n,numberColors:o=50}=t;if(r&&!Array.isArray(r)&&(r=css2array(r)),r)return[r];if(e)return e=e.map(function(s){return Array.isArray(s)?s:css2array(s)}),e;if(n){e=new Array(o);for(let s=0;s<o;s++)e[s]=getRandomColor()}return getDistinctColors(o)}function paintLabels(t,r,e={}){let{color:n="blue",colors:o,font:s="12px Helvetica",rotate:a=0}=e;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1}),!Array.isArray(t))throw Error("paintLabels: labels must be an array");if(!Array.isArray(r))throw Error("paintLabels: positions must be an array");if(n&&!Array.isArray(n)&&(n=css2array(n)),o?o=o.map(function(h){return Array.isArray(h)?h:css2array(h)}):o=[n],t.length!==r.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(a)||(a=[a]);let c=this.getCanvas().getContext("2d");for(let h=0;h<t.length;h++){c.save();let f=o[h%o.length];c.fillStyle=`rgba(${f[0]},${f[1]},${f[2]},${f[3]/this.maxValue})`,c.font=s[h%s.length];let u=r[h];c.translate(u[0],u[1]),c.rotate(a[h%a.length]/180*Math.PI),c.fillText(t[h],0,0),c.restore()}return this.data=Uint8Array.from(c.getImageData(0,0,this.width,this.height).data),this}function paintMasks(t,r={}){let{alpha:e=255,labels:n=[],labelsPosition:o=[],labelColor:s="blue",labelFont:a="12px Helvetica"}=r;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB$1});let l=getColors(Object.assign({},r,{numberColors:t.length}));Array.isArray(t)||(t=[t]);for(let c=0;c<t.length;c++){let h=t[c],f=l[c%l.length];for(let u=0;u<h.width;u++)for(let d=0;d<h.height;d++)if(h.getBitXY(u,d))for(let g=0;g<Math.min(this.components,f.length);g++)if(e===255)this.setValueXY(u+h.position[0],d+h.position[1],g,f[g]);else{let m=this.getValueXY(u+h.position[0],d+h.position[1],g);m=Math.round((m*(255-e)+f[g]*e)/255),this.setValueXY(u+h.position[0],d+h.position[1],g,m)}}if(Array.isArray(n)&&n.length>0){let h=this.getCanvas().getContext("2d");h.fillStyle=s,h.font=a;for(let f=0;f<Math.min(t.length,n.length);f++){let u=o[f]?o[f]:t[f].position;h.fillText(n[f],u[0],u[1])}this.data=Uint8Array.from(h.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(t,r){let e=new Array(t);for(let n=0;n<t;n++)e[n]=new Array(r).fill(0);return e}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(r={}){let{kind:e="cross",shape:n,size:o,width:s,height:a,filled:l=!0}=r;if(o&&(s=o,a=o),n)switch(n.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(s,a,{filled:l});break;case"circle":case"ellipse":this.matrix=ellipse(s,a,{filled:l});break;case"triangle":this.matrix=triangle(s,a,{filled:l});break;default:throw new Error(`Shape: unexpected shape: ${n}`)}else if(e)switch(e.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error(`Shape: unexpected kind: ${e}`)}else throw new Error("Shape: expected a kind or a shape option");this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let r=this.matrix,e=[];for(let n=0;n<r.length;n++)for(let o=0;o<r[0].length;o++)r[n][o]&&e.push([o-this.halfWidth,n-this.halfHeight]);return e}getMask(){let r=new Image(this.width,this.height,{kind:BINARY});for(let e=0;e<this.matrix.length;e++)for(let n=0;n<this.matrix[0].length;n++)this.matrix[e][n]&&r.setBitXY(n,e);return r}}function rectangle(t,r,e){const n=zerosMatrix(r,t);if(e.filled)for(let o=0;o<r;o++)for(let s=0;s<t;s++)n[o][s]=1;else{for(let o of[0,r-1])for(let s=0;s<t;s++)n[o][s]=1;for(let o=0;o<r;o++)for(let s of[0,t-1])n[o][s]=1}return n}function ellipse(t,r,e){const n=zerosMatrix(r,t);let o=1-r%2,s=1-t%2,a=Math.floor((t-1)/2),l=Math.floor((r-1)/2),c=a*a,h=l*l;if(e.filled)for(let f=0;f<=l;f++){let u=Math.floor(Math.sqrt(c-c*f*f/h));for(let d=a-u;d<=a;d++)n[l-f][d]=1,n[l+f+o][d]=1,n[l-f][t-d-1]=1,n[l+f+o][t-d-1]=1}else{for(let f=0;f<=l;f++){let u=Math.floor(Math.sqrt(c-c*f*f/h)),d=a-u;n[l-f][d]=1,n[l+f+o][d]=1,n[l-f][t-d-1]=1,n[l+f+o][t-d-1]=1}for(let f=0;f<=a;f++){let u=Math.floor(Math.sqrt(h-h*f*f/c)),d=l-u;n[d][a-f]=1,n[d][a+f+s]=1,n[r-d-1][a-f]=1,n[r-d-1][a+f+s]=1}}return n}function triangle(t,r,e){if(!e.filled)throw new Error("Non filled triangle is not implemented");const n=zerosMatrix(r,t);for(let o=0;o<r;o++){let s=Math.floor((1-o/r)*t/2);for(let a=s;a<t-s;a++)n[o][a]=1}return n}function paintPoints(t,r={}){let{shape:e}=r;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let n=getColors(Object.assign({},r,{numberColors:t.length})),o=new Shape(e).getPoints(),s=Math.min(this.channels,n[0].length);for(let a=0;a<t.length;a++){let l=n[a%n.length],c=t[a][0],h=t[a][1];for(let f=0;f<o.length;f++){let u=o[f][0],d=o[f][1];if(c+u>=0&&h+d>=0&&c+u<this.width&&h+d<this.height){let g=(c+u+(h+d)*this.width)*this.channels;for(let m=0;m<s;m++)this.data[g+m]=l[m]}}}return this}function paintPolyline(t,r={}){let{color:e=[this.maxValue,0,0],closed:n=!1}=r;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let o=Math.min(this.channels,e.length);for(let s=0;s<t.length-1+n;s++){let a=t[s],l=t[(s+1)%t.length],c=l[0]-a[0],h=l[1]-a[1],f=Math.max(Math.abs(c),Math.abs(h)),u=c/f,d=h/f,g=a[0],m=a[1];for(let y=0;y<=f;y++){let _=Math.round(g),w=Math.round(m);if(_>=0&&w>=0&&_<this.width&&w<this.height)if(this.bitDepth===1)this.setBitXY(_,w);else{let S=(_+w*this.width)*this.channels;for(let v=0;v<o;v++)this.data[S+v]=e[v]}g=g+u,m=m+d}}return this}function paintPolylines(t,r={}){let e=Object.assign({},r);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let n=getColors(Object.assign({},r,{numberColors:t.length}));for(let o=0;o<t.length;o++)e.color=n[o%n.length],this.paintPolyline(t[o],e);return this}function paintPolygon(t,r={}){let{color:e=[this.maxValue,0,0],filled:n=!1}=r;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),r.closed=!0;let o=deleteDouble(t);if(n===!1)return this.paintPolyline(t,r);{let s=Array(this.height);for(let a=0;a<this.height;a++){s[a]=[];for(let l=0;l<this.width;l++)s[a].push(0)}for(let a=0;a<o.length;a++){const l=lineBetweenTwoPoints(o[a],o[(a+1)%o.length]);for(let c=0;c<this.height;c++)for(let h=0;h<this.width;h++)isAtTheRightOfTheLine(h,c,l,this.height)&&(s[c][h]=s[c][h]===0?1:0)}for(let a=0;a<this.height;a++)for(let l=0;l<this.width;l++)if(s[a][l]===1)if(this.bitDepth===1)this.setBitXY(l,a);else{let c=Math.min(this.channels,e.length),h=(l+a*this.width)*this.channels;for(let f=0;f<c;f++)this.data[h+f]=e[f]}return this.paintPolyline(t,r)}}function deleteDouble(t){let r=[];for(let e=0;e<t.length;e++)if(!(t[e][0]===t[(e+1)%t.length][0]&&t[e][1]===t[(e+1)%t.length][1])){if(t[e][0]===t[(e-1+t.length)%t.length][0]&&t[e][1]===t[(e-1+t.length)%t.length][1])continue;if(t[(e+1)%t.length][0]===t[(e-1+t.length)%t.length][0]&&t[(e-1+t.length)%t.length][1]===t[(e+1)%t.length][1])continue;r.push(t[e])}return r}function lineBetweenTwoPoints(t,r){if(t[0]===r[0])return{a:0,b:t[0],vertical:!0};{const e=(r[1]-t[1])/(r[0]-t[0]),n=t[1]-e*t[0];return{a:e,b:n,vertical:!1}}}function isAtTheRightOfTheLine(t,r,e,n){if(e.vertical===!0)return e.b<=t;if(e.a===0)return!1;{const o=(r-e.b)/e.a;return o<t&&o>=0&&o<=n}}function paintPolygons(t,r={}){let e=Object.assign({},r);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let n=getColors(Object.assign({},r,{numberColors:t.length}));for(let o=0;o<t.length;o++)e.color=n[o%n.length],this.paintPolygon(t[o],e);return this}function getHistogram(t={}){let{maxSlots:r=256,channel:e,useAlpha:n=!0}=t;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),e===void 0){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}return getChannelHistogram.call(this,e,{useAlpha:n,maxSlots:r})}function getHistograms(t={}){const{maxSlots:r=256,useAlpha:e=!0}=t;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let n=new Array(e?this.components:this.channels);for(let o=0;o<n.length;o++)n[o]=getChannelHistogram.call(this,o,{useAlpha:e,maxSlots:r});return n}function getChannelHistogram(t,r){let{useAlpha:e,maxSlots:n}=r;if(this.bitDepth===1){let c=[0,0];for(let h=0;h<this.height;h++)for(let f=0;f<this.width;f++){let u=this.getBitXY(h,f);u===0?c[0]+=1:u===1&&(c[1]+=1)}return c}let o=Math.log2(n);if(!isInteger$1(o))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>o&&(s=this.bitDepth-o);let a=this.data,l=newArray$1(Math.pow(2,Math.min(this.bitDepth,o)),0);if(e&&this.alpha){let c=this.channels-t-1;for(let h=t;h<a.length;h+=this.channels)l[a[h]>>s]+=a[h+c]/this.maxValue}else for(let c=t;c<a.length;c+=this.channels)l[a[c]>>s]++;return l}function getColorHistogram(t={}){let{useAlpha:r=!0,nbSlots:e=512}=t;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let n=Math.log(e)/Math.log(8);if(n!==Math.floor(n))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let o=this.bitDepth-n,s=this.data,a=newArray$1(Math.pow(8,n),0),l=Math.pow(2,n*2),c=Math.pow(2,n);for(let h=0;h<s.length;h+=this.channels){let f=(s[h]>>o)*l+(s[h+1]>>o)*c+(s[h+2]>>o);r&&this.alpha?a[f]+=s[h+this.channels-1]/this.maxValue:a[f]++}return a}function min(){this.checkProcessable("min",{bitDepth:[8,16,32]});let t=newArray$1(this.channels,1/0);for(let r=0;r<this.data.length;r+=this.channels)for(let e=0;e<this.channels;e++)this.data[r+e]<t[e]&&(t[e]=this.data[r+e]);return t}function max(){this.checkProcessable("max",{bitDepth:[8,16,32]});let t=newArray$1(this.channels,-1/0);for(let r=0;r<this.data.length;r+=this.channels)for(let e=0;e<this.channels;e++)this.data[r+e]>t[e]&&(t[e]=this.data[r+e]);return t}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let t=newArray$1(this.channels,0);for(let r=0;r<this.data.length;r+=this.channels)for(let e=0;e<this.channels;e++)t[e]+=this.data[r+e];return t}function getMoment(t=0,r=0){this.checkProcessable("getMoment",{bitDepth:[1]});let e=0;for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)this.getBitXY(n,o)===1&&(e+=n**t*o**r);return e}function localMaxima(t={}){let{mask:r,region:e=3,removeClosePoints:n=0,invert:o=!1,maxEquals:s=2}=t,a=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),e*=4;let l=o?0:1,c=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],h=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],f=e<=8?1:2,u=[];for(let d=f;d<a.height-f;d++)for(let g=f;g<a.width-f;g++){if(r&&r.getBitXY(g,d)!==l)continue;let m=0,y=0,_=a.data[g+d*a.width];for(let w=0;w<e;w++)o?a.data[g+c[w]+(d+h[w])*a.width]>_&&m++:a.data[g+c[w]+(d+h[w])*a.width]<_&&m++,a.data[g+c[w]+(d+h[w])*a.width]===_&&y++;m+y===e&&y<=s&&u.push([g,d])}if(n>0)for(let d=0;d<u.length;d++)for(let g=d+1;g<u.length;g++)Math.sqrt(Math.pow(u[d][0]-u[g][0],2)+Math.pow(u[d][1]-u[g][1],2))<n&&(u[d][0]=u[d][0]+u[g][0]>>1,u[d][1]=u[d][1]+u[g][1]>>1,u.splice(g,1),g--);return u}function mean(){let t=this.getHistograms({maxSlots:this.maxValue+1}),r=new Array(t.length);for(let e=0;e<t.length;e++){let n=t[e];r[e]=mean$2(n)}return r}function median(){let t=this.getHistograms({maxSlots:this.maxValue+1}),r=new Array(t.length);for(let e=0;e<t.length;e++){let n=t[e];r[e]=median$2(n)}return r}function points(){this.checkProcessable("points",{bitDepth:[1]});const t=[];for(let r=0;r<this.width;r++)for(let e=0;e<this.height;e++)this.getBitXY(r,e)===1&&t.push([r,e]);return t}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const t=[];for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)if(this.getBitXY(e,r)===1)for(t.push([e,r]),this.getBitXY(e+1,r)!==1?(t.push([e+1,r]),t.push([e+1,r+1]),this.getBitXY(e,r+1)!==1&&t.push([e,r+1])):this.getBitXY(e,r+1)!==1&&(t.push([e,r+1]),t.push([e+1,r+1]));e<this.width-2&&this.getBitXY(e+1,r)===1&&this.getBitXY(e+2,r)===1;)e++;return t}function getRelativePosition(t,r={}){if(this===t)return[0,0];let e=[0,0],n=this;for(;n;){if(n===t)return e;n.position&&(e[0]+=n.position[0],e[1]+=n.position[1]),n=n.parent}return r.defaultFurther?e:!1}function countAlphaPixels(t={}){let{alpha:r=1}=t;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let e=0;if(r!==void 0){for(let n=this.components;n<this.data.length;n+=this.channels)this.data[n]===r&&e++;return e}else return this.size}function monotoneChainConvexHull$1(t,r={}){const{sorted:e}=r;e||(t=t.slice().sort(byXThenY));const n=t.length,o=new Array(n*2);let s=0;for(let l=0;l<n;l++){const c=t[l];for(;s>=2&&cw(o[s-2],o[s-1],c)<=0;)s--;o[s++]=c}const a=s+1;for(let l=n-2;l>=0;l--){const c=t[l];for(;s>=a&&cw(o[s-2],o[s-1],c)<=0;)s--;o[s++]=c}return o.slice(0,s-1)}function cw(t,r,e){return(r[1]-t[1])*(e[0]-t[0])-(r[0]-t[0])*(e[1]-t[1])}function byXThenY(t,r){return t[0]===r[0]?t[1]-r[1]:t[0]-r[0]}function monotoneChainConvexHull(){return monotoneChainConvexHull$1(this.extendedPoints,{sorted:!1})}function round(t){for(let r=0;r<t.length;r++)t[r][0]=Math.round(t[r][0]),t[r][1]=Math.round(t[r][1]);return t}function difference(t,r){return[t[0]-r[0],t[1]-r[1]]}function normalize(t){let r=Math.sqrt(t[0]**2+t[1]**2);return[t[0]/r,t[1]/r]}function rotate(t,r,e){e===void 0&&(e=new Array(r.length));let n=Math.cos(t),o=Math.sin(t);for(let s=0;s<e.length;++s)e[s]=[n*r[s][0]-o*r[s][1],o*r[s][0]+n*r[s][1]];return e}function perimeter(t){let r=0;for(let e=0;e<t.length;e++){let n=t[e][0],o=t[e][1],s=t[e===t.length-1?0:e+1][0],a=t[e===t.length-1?0:e+1][1];r+=Math.sqrt((s-n)**2+(a-o)**2)}return r}function surface(t){let r=0;for(let e=0;e<t.length;e++){let n=t[e][0],o=t[e===t.length-1?0:e+1][1],s=t[e===t.length-1?0:e+1][0],a=t[e][1];r+=n*o*.5,r-=s*a*.5}return Math.abs(r)}function minMax(t){let r=1/0,e=1/0,n=-1/0,o=-1/0;for(let s=0;s<t.length;s++)t[s][0]<r&&(r=t[s][0]),t[s][0]>n&&(n=t[s][0]),t[s][1]<e&&(e=t[s][1]),t[s][1]>o&&(o=t[s][1]);return[[r,e],[n,o]]}function moveToZeroZero(t,r){r===void 0&&(r=new Array(t.length).fill(0).map(()=>[]));let e=minMax(t),n=e[0][0],o=e[0][1];for(let s=0;s<t.length;s++)r[s][0]=t[s][0]-n,r[s][1]=t[s][1]-o;return r}function minimalBoundingRectangle(t={}){const{originalPoints:r=monotoneChainConvexHull.call(this)}=t;if(r.length===0)return[];if(r.length===1)return[r[0],r[0],r[0],r[0]];const e=new Array(r.length);let n=1/0,o=0,s;for(let a=0;a<e.length;a++){let l=getAngle$1(r[a],r[(a+1)%e.length]);rotate(-l,r,e);let c=e[a][0],h=e[a][1],f=e[(a+1)%e.length][0],u=e[(a+1)%e.length][1],d=!0,g=0,m=0,y=0;for(let v=0;v<e.length;v++){let b=e[v][0],k=e[v][1],C=(b-c)/(f-c);d===!0?(d=!1,g=C,m=C):(C<g&&(g=C),C>m&&(m=C));let R=(-(f-c)*k+f*h-u*c)/(f-c);Math.abs(R)>Math.abs(y)&&(y=R)}let _=[c+g*(f-c),h],w=[c+m*(f-c),h],S=Math.abs(y*(g-m)*(f-c));S<n&&(o=l,n=S,s=[_,w,[w[0],w[1]-y],[_[0],_[1]-y]])}return rotate(o,s,s),s}function getAngle$1(t,r){let e=difference(r,t),n=normalize(e),o=Math.acos(n[0]);return n[1]<0?-o:o}function extend$1(t){let r={inPlace:!0};t.extendMethod("invert",invert),t.extendMethod("abs",abs),t.extendMethod("level",level,r),t.extendMethod("add",add,r),t.extendMethod("subtract",subtract,r),t.extendMethod("subtractImage",subtractImage),t.extendMethod("multiply",multiply,r),t.extendMethod("divide",divide,r),t.extendMethod("hypotenuse",hypotenuse),t.extendMethod("background",background$1),t.extendMethod("flipX",flipX),t.extendMethod("flipY",flipY),t.extendMethod("blurFilter",blurFilter),t.extendMethod("medianFilter",medianFilter),t.extendMethod("gaussianFilter",gaussianFilter),t.extendMethod("sobelFilter",sobelFilter),t.extendMethod("gradientFilter",gradientFilter),t.extendMethod("scharrFilter",scharrFilter),t.extendMethod("dilate",dilate),t.extendMethod("erode",erode),t.extendMethod("open",open),t.extendMethod("close",close),t.extendMethod("topHat",topHat),t.extendMethod("blackHat",blackHat),t.extendMethod("morphologicalGradient",morphologicalGradient),t.extendMethod("warpingFourPoints",warpingFourPoints),t.extendMethod("crop",crop),t.extendMethod("cropAlpha",cropAlpha),t.extendMethod("resize",resize).extendMethod("scale",resize),t.extendMethod("hsv",hsv),t.extendMethod("hsl",hsl$1),t.extendMethod("cmyk",cmyk),t.extendMethod("rgba8",rgba8),t.extendMethod("grey",grey).extendMethod("gray",grey),t.extendMethod("mask",mask),t.extendMethod("pad",pad),t.extendMethod("colorDepth",colorDepth),t.extendMethod("setBorder",setBorder,r),t.extendMethod("rotate",rotate$1),t.extendMethod("rotateLeft",rotateLeft),t.extendMethod("rotateRight",rotateRight),t.extendMethod("insert",insert),t.extendMethod("getRow",getRow),t.extendMethod("getColumn",getColumn),t.extendMethod("getMatrix",getMatrix),t.extendMethod("setMatrix",setMatrix),t.extendMethod("getPixelsArray",getPixelsArray),t.extendMethod("getIntersection",getIntersection),t.extendMethod("getClosestCommonParent",getClosestCommonParent),t.extendMethod("getThreshold",getThreshold),t.extendMethod("split",split),t.extendMethod("getChannel",getChannel),t.extendMethod("combineChannels",combineChannels),t.extendMethod("setChannel",setChannel),t.extendMethod("getSimilarity",getSimilarity),t.extendMethod("getPixelsGrid",getPixelsGrid),t.extendMethod("getBestMatch",getBestMatch),t.extendMethod("cannyEdge",cannyEdge),t.extendMethod("convolution",convolution),t.extendMethod("extract",extract),t.extendMethod("floodFill",floodFill),t.extendMethod("paintLabels",paintLabels,r),t.extendMethod("paintMasks",paintMasks,r),t.extendMethod("paintPoints",paintPoints,r),t.extendMethod("paintPolyline",paintPolyline,r),t.extendMethod("paintPolylines",paintPolylines,r),t.extendMethod("paintPolygon",paintPolygon,r),t.extendMethod("paintPolygons",paintPolygons,r),t.extendMethod("countAlphaPixels",countAlphaPixels),t.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull),t.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),t.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),t.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),t.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),t.extendMethod("getMin",min).extendProperty("min",min),t.extendMethod("getMax",max).extendProperty("max",max),t.extendMethod("getSum",sum).extendProperty("sum",sum),t.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),t.extendMethod("getLocalMaxima",localMaxima),t.extendMethod("getMedian",median).extendProperty("median",median),t.extendMethod("getMean",mean).extendProperty("mean",mean),t.extendMethod("getPoints",points).extendProperty("points",points),t.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),t.extendMethod("getRelativePosition",getRelativePosition)}var quantities={exports:{}};(function(t,r){(function(e,n){t.exports=n()})(commonjsGlobal,function(){function e(D){return typeof D=="string"||D instanceof String}var n=Number.isFinite||window.isFinite;function o(D){return n(D)}function s(D){return D}function a(D){var O={};return D.filter(function(L){return O.hasOwnProperty(L)?!1:O[L]=!0})}function l(D,O){if(O.length!==D.length)return!1;for(var L=0;L<D.length;L++)if(O[L].compareArray&&!O[L].compareArray(D[L])||O[L]!==D[L])return!1;return!0}function c(D,O){Object.keys(O).forEach(function(L){D[L]=O[L]})}function h(){for(var D=1,O=0,L=0;L<arguments.length;L++){var G=arguments[L];O=O+d(G),D*=G}return O!==0?u(D,O):D}function f(D,O){if(O===0)throw new Error("Divide by zero");var L=Math.pow(10,d(O)),G=L/(L*O);return h(D,G)}function u(D,O){return Math.round(D*Math.pow(10,O))/Math.pow(10,O)}function d(D){if(!isFinite(D))return 0;for(var O=0;D%1!==0;)D*=10,O++;return O}function g(){var D;if(!this)return D=Object.create(g.prototype),g.apply(D,arguments),D;D=Error.apply(this,arguments),this.name="QtyError",this.message=D.message,this.stack=D.stack}g.prototype=Object.create(Error.prototype,{constructor:{value:g}});function m(D,O){throw new g("Incompatible units: "+D+" and "+O)}var y={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","","","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["t","tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oilbarrel","oilbarrels","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beerbarrel","beerbarrels","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beerbarrel-imp","beerbarrels-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<Gal>":[["Gal"],.01,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],3600*24,"time",["<second>"]],"<week>":[["wk","week","weeks"],7*3600*24,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"molar_concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"molar_concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","",""],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules","Joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<electronvolt>":[["eV","electronvolt","electronvolts"],1602176634e-28,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<arcminute>":[["arcmin","arcminute","arcminutes"],Math.PI/10800,"angle",["<radian>"]],"<arcsecond>":[["arcsec","arcsecond","arcseconds"],Math.PI/648e3,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppb>":[["ppb"],1e-9,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-12,"prefix_only",["<1>"]],"<ppq>":[["ppq"],1e-15,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},_=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],w="<1>",S=[w];function v(D,O){var L=O[1],G=O[3]||[],te=O[4]||[];if(!o(L))throw new g(D+": Invalid unit definition. 'scalar' must be a number");G.forEach(function(he){if(y[he]===void 0)throw new g(D+": Invalid unit definition. Unit "+he+" in 'numerator' is not recognized")}),te.forEach(function(he){if(y[he]===void 0)throw new g(D+": Invalid unit definition. Unit "+he+" in 'denominator' is not recognized")})}var b={},k={},C={},R={},A={};for(var $ in y)if(y.hasOwnProperty($)){var E=y[$];if(E[2]==="prefix"){b[$]=E[1];for(var I=0;I<E[0].length;I++)k[E[0][I]]=$}else{v($,E),C[$]={scalar:E[1],numerator:E[3],denominator:E[4]};for(var B=0;B<E[0].length;B++)R[E[0][B]]=$}A[$]=E[0][0]}function P(D){var O,L=[],G=Object.keys(y);if(typeof D>"u")for(O=0;O<G.length;O++)["","prefix"].indexOf(y[G[O]][2])===-1&&L.push(G[O].substr(1,G[O].length-2));else{if(this.getKinds().indexOf(D)===-1)throw new g("Kind not recognized");for(O=0;O<G.length;O++)y[G[O]][2]===D&&L.push(G[O].substr(1,G[O].length-2))}return L.sort(function(te,he){return te.toLowerCase()<he.toLowerCase()?-1:te.toLowerCase()>he.toLowerCase()?1:0})}function Y(D){if(!R[D])throw new g("Unit not recognized");return y[R[D]][0]}var V=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function J(){if(this.signature)return this.signature;for(var D=re.call(this),O=0;O<D.length;O++)D[O]*=Math.pow(20,O);return D.reduce(function(L,G){return L+G},0)}function re(){if(!this.isBase())return re.call(this.toBase());for(var D=new Array(V.length),O=0;O<D.length;O++)D[O]=0;for(var L,G,te=0;te<this.numerator.length;te++)(L=y[this.numerator[te]])&&(G=V.indexOf(L[2]),G>=0&&(D[G]=D[G]+1));for(var he=0;he<this.denominator.length;he++)(L=y[this.denominator[he]])&&(G=V.indexOf(L[2]),G>=0&&(D[G]=D[G]-1));return D}var q="[+-]",se="\\d+",W=q+"?"+se,de="\\."+se,fe="(?:"+se+"(?:"+de+")?)|(?:"+de+")",Z="[Ee]"+W,X="(?:"+fe+")(?:"+Z+")?",j=q+"?\\s*"+X,Q="("+j+")?\\s*([^/]*)(?:/(.+))?",oe=new RegExp("^"+Q+"$"),Ee="\\^|\\*{2}",me="[01234]",be=new RegExp("([^ \\*\\d]+?)(?:"+Ee+")?(-?"+me+"(?![a-zA-Z]))"),we=new RegExp("([^ \\*\\d]+?)(?:"+Ee+")?("+me+"(?![a-zA-Z]))");function Ae(D){e(D)||(D=D.toString()),D=D.trim();var O=oe.exec(D);if(!O)throw new g(D+": Quantity not recognized");var L=O[1];L?(L=L.replace(/\s/g,""),this.scalar=parseFloat(L)):this.scalar=1;for(var G=O[2],te=O[3],he,Re,$e;O=be.exec(G);){if(he=parseFloat(O[2]),isNaN(he))throw new g("Unit exponent is not a number");if(he===0&&!pe.test(O[1]))throw new g("Unit not recognized");Re=O[1]+" ",$e="";for(var Be=0;Be<Math.abs(he);Be++)$e+=Re;he>=0?G=G.replace(O[0],$e):(te=te?te+$e:$e,G=G.replace(O[0],""))}for(;O=we.exec(te);){if(he=parseFloat(O[2]),isNaN(he))throw new g("Unit exponent is not a number");if(he===0&&!pe.test(O[1]))throw new g("Unit not recognized");Re=O[1]+" ",$e="";for(var Oe=0;Oe<he;Oe++)$e+=Re;te=te.replace(O[0],$e)}G&&(this.numerator=le(G.trim())),te&&(this.denominator=le(te.trim()))}var Me=Object.keys(k).sort(function(D,O){return O.length-D.length}).join("|"),ie=Object.keys(R).sort(function(D,O){return O.length-D.length}).join("|"),K="\\b|$",_e="("+Me+")??("+ie+")(?:"+K+")",pe=new RegExp("^\\s*("+_e+"[\\s\\*]*)+$"),ve=new RegExp(_e,"g"),U={};function le(D){var O=U[D];if(O)return O;var L,G=[];if(!pe.test(D))throw new g("Unit not recognized");for(;L=ve.exec(D);)G.push(L.slice(1));return G=G.map(function(te){return k[te[0]]?[k[te[0]],R[te[1]]]:[R[te[1]]]}),G=G.reduce(function(te,he){return te.concat(he)},[]),G=G.filter(function(te){return te}),U[D]=G,G}function ue(D){if(!e(D))throw new g("Argument should be a string");try{return this(D)}catch{return null}}function xe(D){return D instanceof H}function H(D,O){if(Se.apply(null,arguments),!xe(this))return new H(D,O);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=S,this.denominator=S,ye(D)?(this.scalar=D.scalar,this.numerator=D.numerator&&D.numerator.length!==0?D.numerator:S,this.denominator=D.denominator&&D.denominator.length!==0?D.denominator:S):O?(Ae.call(this,O),this.scalar=D):Ae.call(this,D),this.denominator.join("*").indexOf("temp")>=0)throw new g("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new g("Cannot multiply by temperatures");if(!l(this.denominator,S))throw new g("Cannot divide with temperatures")}if(this.initValue=D,ee.call(this),this.isTemperature()&&this.baseScalar<0)throw new g("Temperatures must not be less than absolute zero")}H.prototype={constructor:H};function Se(D,O){if(O){if(!(o(D)&&e(O)))throw new g("Only number accepted as initialization value when units are explicitly provided")}else if(!(e(D)||o(D)||xe(D)||ye(D)))throw new g("Only string, number or quantity accepted as single initialization value")}function ye(D){return D&&typeof D=="object"&&D.hasOwnProperty("scalar")}function ee(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=J.call(this);else{var D=this.toBase();this.baseScalar=D.scalar,this.signature=D.signature}}var ae={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency","25599999980":"information_rate","25600000000":"information","511999999980":"angular_velocity","512000000000":"angle"};function ce(){return a(Object.keys(ae).map(function(D){return ae[D]}))}H.prototype.kind=function(){return ae[this.signature.toString()]},c(H.prototype,{isDegrees:function(){return(this.signature===null||this.signature===400)&&this.numerator.length===1&&l(this.denominator,S)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}});function ne(D,O){var L=D.units(),G=O.to(L),te=H(x(L));return H({scalar:D.scalar-G.scalar,numerator:te.numerator,denominator:te.denominator})}function M(D,O){var L=O.to(x(D.units()));return H({scalar:D.scalar-L.scalar,numerator:D.numerator,denominator:D.denominator})}function p(D,O){var L=O.to(x(D.units()));return H({scalar:D.scalar+L.scalar,numerator:D.numerator,denominator:D.denominator})}function x(D){if(D==="tempK")return"degK";if(D==="tempC")return"degC";if(D==="tempF")return"degF";if(D==="tempR")return"degR";throw new g("Unknown type for temp conversion from: "+D)}function T(D,O){var L=F(D),G=O.units(),te;if(G==="degK")te=L.scalar;else if(G==="degC")te=L.scalar;else if(G==="degF")te=L.scalar*9/5;else if(G==="degR")te=L.scalar*9/5;else throw new g("Unknown type for degree conversion to: "+G);return H({scalar:te,numerator:O.numerator,denominator:O.denominator})}function F(D){var O=D.units(),L;if(O.match(/(deg)[CFRK]/))L=D.baseScalar;else if(O==="tempK")L=D.scalar;else if(O==="tempC")L=D.scalar;else if(O==="tempF")L=D.scalar*5/9;else if(O==="tempR")L=D.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+O);return H({scalar:L,numerator:["<kelvin>"],denominator:S})}function N(D,O){var L=O.units(),G;if(L==="tempK")G=D.baseScalar;else if(L==="tempC")G=D.baseScalar-273.15;else if(L==="tempF")G=D.baseScalar*9/5-459.67;else if(L==="tempR")G=D.baseScalar*9/5;else throw new g("Unknown type for temp conversion to: "+L);return H({scalar:G,numerator:O.numerator,denominator:O.denominator})}function z(D){var O=D.units(),L;if(O.match(/(deg)[CFRK]/))L=D.baseScalar;else if(O==="tempK")L=D.scalar;else if(O==="tempC")L=D.scalar+273.15;else if(O==="tempF")L=(D.scalar+459.67)*5/9;else if(O==="tempR")L=D.scalar*5/9;else throw new g("Unknown type for temp conversion from: "+O);return H({scalar:L,numerator:["<temp-K>"],denominator:S})}c(H.prototype,{to:function(D){var O,L;if(D==null)return this;if(!e(D))return this.to(D.units());if(O=this._conversionCache[D],O)return O;if(L=H(D),L.units()===this.units())return this;if(!this.isCompatible(L))this.isInverse(L)?L=this.inverse().to(D):m(this.units(),L.units());else if(L.isTemperature())L=N(this,L);else if(L.isDegrees())L=T(this,L);else{var G=f(this.baseScalar,L.baseScalar);L=H({scalar:G,numerator:L.numerator,denominator:L.denominator})}return this._conversionCache[D]=L,L},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return z(this);var D=Ie[this.units()];return D||(D=Te(this.numerator,this.denominator),Ie[this.units()]=D),D.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new g("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(D){if(e(D)&&(D=H(D)),o(D)&&(D=H(D+" "+this.units())),this.isUnitless()?D.isUnitless()||m(this.units(),D.units()):D=D.to(this.units()),D.scalar===0)throw new g("Divide by zero");var O=h(Math.round(this.scalar/D.scalar),D.scalar);return H(O+this.units())}});function ge(D,O){var L=H(D),G=H(O);if(L.eq(G))return s;var te;return L.isTemperature()?te=function(he){return L.mul(he).to(G).scalar}:te=function(he){return he*L.baseScalar/G.baseScalar},function(Re){var $e,Be,Oe;if(Array.isArray(Re)){for(Be=Re.length,Oe=[],$e=0;$e<Be;$e++)Oe.push(te(Re[$e]));return Oe}else return te(Re)}}var Ie={};function Te(D,O){for(var L=[],G=[],te=1,he,Re=0;Re<D.length;Re++)he=D[Re],b[he]?te=h(te,b[he]):C[he]&&(te*=C[he].scalar,C[he].numerator&&L.push(C[he].numerator),C[he].denominator&&G.push(C[he].denominator));for(var $e=0;$e<O.length;$e++)he=O[$e],b[he]?te/=b[he]:C[he]&&(te/=C[he].scalar,C[he].numerator&&G.push(C[he].numerator),C[he].denominator&&L.push(C[he].denominator));return L=L.reduce(function(Be,Oe){return Be.concat(Oe)},[]),G=G.reduce(function(Be,Oe){return Be.concat(Oe)},[]),H({scalar:te,numerator:L,denominator:G})}H.parse=ue,H.getUnits=P,H.getAliases=Y,H.mulSafe=h,H.divSafe=f,H.getKinds=ce,H.swiftConverter=ge,H.Error=g,c(H.prototype,{add:function(D){if(e(D)&&(D=H(D)),this.isCompatible(D)||m(this.units(),D.units()),this.isTemperature()&&D.isTemperature())throw new g("Cannot add two temperatures");return this.isTemperature()?p(this,D):D.isTemperature()?p(D,this):H({scalar:this.scalar+D.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(D){if(e(D)&&(D=H(D)),this.isCompatible(D)||m(this.units(),D.units()),this.isTemperature()&&D.isTemperature())return ne(this,D);if(this.isTemperature())return M(this,D);if(D.isTemperature())throw new g("Cannot subtract a temperature from a differential degree unit");return H({scalar:this.scalar-D.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(D){if(o(D))return H({scalar:h(this.scalar,D),numerator:this.numerator,denominator:this.denominator});if(e(D)&&(D=H(D)),(this.isTemperature()||D.isTemperature())&&!(this.isUnitless()||D.isUnitless()))throw new g("Cannot multiply by temperatures");var O=this,L=D;O.isCompatible(L)&&O.signature!==400&&(L=L.to(O));var G=De(O.numerator,O.denominator,L.numerator,L.denominator);return H({scalar:h(O.scalar,L.scalar,G[2]),numerator:G[0],denominator:G[1]})},div:function(D){if(o(D)){if(D===0)throw new g("Divide by zero");return H({scalar:this.scalar/D,numerator:this.numerator,denominator:this.denominator})}else e(D)&&(D=H(D));if(D.scalar===0)throw new g("Divide by zero");if(D.isTemperature())throw new g("Cannot divide with temperatures");if(this.isTemperature()&&!D.isUnitless())throw new g("Cannot divide with temperatures");var O=this,L=D;O.isCompatible(L)&&O.signature!==400&&(L=L.to(O));var G=De(O.numerator,O.denominator,L.denominator,L.numerator);return H({scalar:h(O.scalar,G[2])/L.scalar,numerator:G[0],denominator:G[1]})},inverse:function(){if(this.isTemperature())throw new g("Cannot divide with temperatures");if(this.scalar===0)throw new g("Divide by zero");return H({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}});function De(D,O,L,G){function te(Pe){return Pe!==w}D=D.filter(te),L=L.filter(te),O=O.filter(te),G=G.filter(te);var he={};function Re(Pe,Ue){for(var Ne,Xe,Qe,Ve=0;Ve<Pe.length;Ve++)if(b[Pe[Ve]]?(Ne=Pe[Ve+1],Xe=Pe[Ve],Qe=b[Xe],Ve++):(Ne=Pe[Ve],Xe=null,Qe=1),Ne&&Ne!==w)if(he[Ne]){he[Ne][0]+=Ue;var tt=he[Ne][2]?b[he[Ne][2]]:1;he[Ne][Ue===1?3:4]*=f(Qe,tt)}else he[Ne]=[Ue,Ne,Xe,1,1]}Re(D,1),Re(O,-1),Re(L,1),Re(G,-1);var $e=[],Be=[],Oe=1;for(var Je in he)if(he.hasOwnProperty(Je)){var Fe=he[Je],He;if(Fe[0]>0)for(He=0;He<Fe[0];He++)$e.push(Fe[2]===null?Fe[1]:[Fe[2],Fe[1]]);else if(Fe[0]<0)for(He=0;He<-Fe[0];He++)Be.push(Fe[2]===null?Fe[1]:[Fe[2],Fe[1]]);Oe*=f(Fe[3],Fe[4])}return $e.length===0&&($e=S),Be.length===0&&(Be=S),$e=$e.reduce(function(Pe,Ue){return Pe.concat(Ue)},[]),Be=Be.reduce(function(Pe,Ue){return Pe.concat(Ue)},[]),[$e,Be,Oe]}c(H.prototype,{eq:function(D){return this.compareTo(D)===0},lt:function(D){return this.compareTo(D)===-1},lte:function(D){return this.eq(D)||this.lt(D)},gt:function(D){return this.compareTo(D)===1},gte:function(D){return this.eq(D)||this.gt(D)},compareTo:function(D){if(e(D))return this.compareTo(H(D));if(this.isCompatible(D)||m(this.units(),D.units()),this.baseScalar<D.baseScalar)return-1;if(this.baseScalar===D.baseScalar)return 0;if(this.baseScalar>D.baseScalar)return 1},same:function(D){return this.scalar===D.scalar&&this.units()===D.units()}}),c(H.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every(function(D){return l(D,S)})},isCompatible:function(D){return e(D)?this.isCompatible(H(D)):xe(D)&&D.signature!==void 0?this.signature===D.signature:!1},isInverse:function(D){return this.inverse().isCompatible(D)},isBase:function(){return this._isBase!==void 0?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach(function(D){D!==w&&_.indexOf(D)===-1&&(this._isBase=!1)},this),this._isBase===!1?this._isBase:(this._isBase=!0,this._isBase))}});function ke(){}ke.prototype.get=function(D){return arguments.length>1&&(D=Array.apply(null,arguments)),D.reduce(function(O,L,G){if(O){var te=O[L];return G===D.length-1?te?te.data:void 0:te}},this)},ke.prototype.set=function(D,O){return arguments.length>2&&(D=Array.prototype.slice.call(arguments,0,-1),O=arguments[arguments.length-1]),D.reduce(function(L,G,te){var he=L[G];return he===void 0&&(he=L[G]={}),te===D.length-1?(he.data=O,O):he},this)};function Ge(D,O){return(D+" "+O).trim()}H.formatter=Ge,c(H.prototype,{units:function(){if(this._units!==void 0)return this._units;var D=l(this.numerator,S),O=l(this.denominator,S);if(D&&O)return this._units="",this._units;var L=ze(this.numerator),G=ze(this.denominator);return this._units=L+(O?"":"/"+G),this._units},toString:function(D,O){var L;if(o(D))L=this.units(),O=D;else if(e(D))L=D;else if(xe(D))return this.toPrec(D).toString(O);var G=this.to(L),te=O!==void 0?u(G.scalar,O):G.scalar;return G=(te+" "+G.units()).trim(),G},format:function(D,O){arguments.length===1&&typeof D=="function"&&(O=D,D=void 0),O=O||H.formatter;var L=this.to(D);return O.call(this,L.scalar,L.units())}});var je=new ke;function ze(D){var O=je.get(D);if(O)return O;var L=l(D,S);return L?O="1":O=Ze(Ke(D)).join("*"),je.set(D,O),O}function Ke(D){for(var O=[],L,G,te=0;te<D.length;te++)L=D[te],G=D[te+1],b[L]?(O.push(A[L]+A[G]),te++):O.push(A[L]);return O}function Ze(D){var O=D.reduce(function(L,G){var te=L[G];return te||L.push(te=L[G]=[G,0]),te[1]++,L},[]);return O.map(function(L){return L[0]+(L[1]>1?L[1]:"")})}return H.version="1.8.0",H})})(quantities);var quantitiesExports=quantities.exports;const Qty=getDefaultExportFromCjs(quantitiesExports);function deepValue(t,r=""){let e=r.split(".");for(let n of e){if(t[n]===void 0)return;t=t[n]}return t}var orientation={exports:{}},twoProduct_1=twoProduct$1,SPLITTER=+(Math.pow(2,27)+1);function twoProduct$1(t,r,e){var n=t*r,o=SPLITTER*t,s=o-t,a=o-s,l=t-a,c=SPLITTER*r,h=c-r,f=c-h,u=r-f,d=n-a*f,g=d-l*f,m=g-a*u,y=l*u-m;return e?(e[0]=y,e[1]=n,e):[y,n]}var robustSum=linearExpansionSum;function scalarScalar$1(t,r){var e=t+r,n=e-t,o=e-n,s=r-n,a=t-o,l=a+s;return l?[l,e]:[e]}function linearExpansionSum(t,r){var e=t.length|0,n=r.length|0;if(e===1&&n===1)return scalarScalar$1(t[0],r[0]);var o=e+n,s=new Array(o),a=0,l=0,c=0,h=Math.abs,f=t[l],u=h(f),d=r[c],g=h(d),m,y;u<g?(y=f,l+=1,l<e&&(f=t[l],u=h(f))):(y=d,c+=1,c<n&&(d=r[c],g=h(d))),l<e&&u<g||c>=n?(m=f,l+=1,l<e&&(f=t[l],u=h(f))):(m=d,c+=1,c<n&&(d=r[c],g=h(d)));for(var _=m+y,w=_-m,S=y-w,v=S,b=_,k,C,R,A,$;l<e&&c<n;)u<g?(m=f,l+=1,l<e&&(f=t[l],u=h(f))):(m=d,c+=1,c<n&&(d=r[c],g=h(d))),y=v,_=m+y,w=_-m,S=y-w,S&&(s[a++]=S),k=b+_,C=k-b,R=k-C,A=_-C,$=b-R,v=$+A,b=k;for(;l<e;)m=f,y=v,_=m+y,w=_-m,S=y-w,S&&(s[a++]=S),k=b+_,C=k-b,R=k-C,A=_-C,$=b-R,v=$+A,b=k,l+=1,l<e&&(f=t[l]);for(;c<n;)m=d,y=v,_=m+y,w=_-m,S=y-w,S&&(s[a++]=S),k=b+_,C=k-b,R=k-C,A=_-C,$=b-R,v=$+A,b=k,c+=1,c<n&&(d=r[c]);return v&&(s[a++]=v),b&&(s[a++]=b),a||(s[a++]=0),s.length=a,s}var twoSum$1=fastTwoSum;function fastTwoSum(t,r,e){var n=t+r,o=n-t,s=n-o,a=r-o,l=t-s;return e?(e[0]=l+a,e[1]=n,e):[l+a,n]}var twoProduct=twoProduct_1,twoSum=twoSum$1,robustScale=scaleLinearExpansion;function scaleLinearExpansion(t,r){var e=t.length;if(e===1){var n=twoProduct(t[0],r);return n[0]?n:[n[1]]}var o=new Array(2*e),s=[.1,.1],a=[.1,.1],l=0;twoProduct(t[0],r,s),s[0]&&(o[l++]=s[0]);for(var c=1;c<e;++c){twoProduct(t[c],r,a);var h=s[1];twoSum(h,a[0],s),s[0]&&(o[l++]=s[0]);var f=a[1],u=s[1],d=f+u,g=d-f,m=u-g;s[1]=d,m&&(o[l++]=m)}return s[1]&&(o[l++]=s[1]),l===0&&(o[l++]=0),o.length=l,o}var robustDiff=robustSubtract;function scalarScalar(t,r){var e=t+r,n=e-t,o=e-n,s=r-n,a=t-o,l=a+s;return l?[l,e]:[e]}function robustSubtract(t,r){var e=t.length|0,n=r.length|0;if(e===1&&n===1)return scalarScalar(t[0],-r[0]);var o=e+n,s=new Array(o),a=0,l=0,c=0,h=Math.abs,f=t[l],u=h(f),d=-r[c],g=h(d),m,y;u<g?(y=f,l+=1,l<e&&(f=t[l],u=h(f))):(y=d,c+=1,c<n&&(d=-r[c],g=h(d))),l<e&&u<g||c>=n?(m=f,l+=1,l<e&&(f=t[l],u=h(f))):(m=d,c+=1,c<n&&(d=-r[c],g=h(d)));for(var _=m+y,w=_-m,S=y-w,v=S,b=_,k,C,R,A,$;l<e&&c<n;)u<g?(m=f,l+=1,l<e&&(f=t[l],u=h(f))):(m=d,c+=1,c<n&&(d=-r[c],g=h(d))),y=v,_=m+y,w=_-m,S=y-w,S&&(s[a++]=S),k=b+_,C=k-b,R=k-C,A=_-C,$=b-R,v=$+A,b=k;for(;l<e;)m=f,y=v,_=m+y,w=_-m,S=y-w,S&&(s[a++]=S),k=b+_,C=k-b,R=k-C,A=_-C,$=b-R,v=$+A,b=k,l+=1,l<e&&(f=t[l]);for(;c<n;)m=d,y=v,_=m+y,w=_-m,S=y-w,S&&(s[a++]=S),k=b+_,C=k-b,R=k-C,A=_-C,$=b-R,v=$+A,b=k,c+=1,c<n&&(d=-r[c]);return v&&(s[a++]=v),b&&(s[a++]=b),a||(s[a++]=0),s.length=a,s}(function(t){var r=twoProduct_1,e=robustSum,n=robustScale,o=robustDiff,s=5,a=11102230246251565e-32,l=(3+16*a)*a,c=(7+56*a)*a;function h(v,b,k,C){return function(A,$,E){var I=v(v(b($[1],E[0]),b(-E[1],$[0])),v(b(A[1],$[0]),b(-$[1],A[0]))),B=v(b(A[1],E[0]),b(-E[1],A[0])),P=C(I,B);return P[P.length-1]}}function f(v,b,k,C){return function(A,$,E,I){var B=v(v(k(v(b(E[1],I[0]),b(-I[1],E[0])),$[2]),v(k(v(b($[1],I[0]),b(-I[1],$[0])),-E[2]),k(v(b($[1],E[0]),b(-E[1],$[0])),I[2]))),v(k(v(b($[1],I[0]),b(-I[1],$[0])),A[2]),v(k(v(b(A[1],I[0]),b(-I[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),I[2])))),P=v(v(k(v(b(E[1],I[0]),b(-I[1],E[0])),A[2]),v(k(v(b(A[1],I[0]),b(-I[1],A[0])),-E[2]),k(v(b(A[1],E[0]),b(-E[1],A[0])),I[2]))),v(k(v(b($[1],E[0]),b(-E[1],$[0])),A[2]),v(k(v(b(A[1],E[0]),b(-E[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),E[2])))),Y=C(B,P);return Y[Y.length-1]}}function u(v,b,k,C){return function(A,$,E,I,B){var P=v(v(v(k(v(k(v(b(I[1],B[0]),b(-B[1],I[0])),E[2]),v(k(v(b(E[1],B[0]),b(-B[1],E[0])),-I[2]),k(v(b(E[1],I[0]),b(-I[1],E[0])),B[2]))),$[3]),v(k(v(k(v(b(I[1],B[0]),b(-B[1],I[0])),$[2]),v(k(v(b($[1],B[0]),b(-B[1],$[0])),-I[2]),k(v(b($[1],I[0]),b(-I[1],$[0])),B[2]))),-E[3]),k(v(k(v(b(E[1],B[0]),b(-B[1],E[0])),$[2]),v(k(v(b($[1],B[0]),b(-B[1],$[0])),-E[2]),k(v(b($[1],E[0]),b(-E[1],$[0])),B[2]))),I[3]))),v(k(v(k(v(b(E[1],I[0]),b(-I[1],E[0])),$[2]),v(k(v(b($[1],I[0]),b(-I[1],$[0])),-E[2]),k(v(b($[1],E[0]),b(-E[1],$[0])),I[2]))),-B[3]),v(k(v(k(v(b(I[1],B[0]),b(-B[1],I[0])),$[2]),v(k(v(b($[1],B[0]),b(-B[1],$[0])),-I[2]),k(v(b($[1],I[0]),b(-I[1],$[0])),B[2]))),A[3]),k(v(k(v(b(I[1],B[0]),b(-B[1],I[0])),A[2]),v(k(v(b(A[1],B[0]),b(-B[1],A[0])),-I[2]),k(v(b(A[1],I[0]),b(-I[1],A[0])),B[2]))),-$[3])))),v(v(k(v(k(v(b($[1],B[0]),b(-B[1],$[0])),A[2]),v(k(v(b(A[1],B[0]),b(-B[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),B[2]))),I[3]),v(k(v(k(v(b($[1],I[0]),b(-I[1],$[0])),A[2]),v(k(v(b(A[1],I[0]),b(-I[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),I[2]))),-B[3]),k(v(k(v(b(E[1],I[0]),b(-I[1],E[0])),$[2]),v(k(v(b($[1],I[0]),b(-I[1],$[0])),-E[2]),k(v(b($[1],E[0]),b(-E[1],$[0])),I[2]))),A[3]))),v(k(v(k(v(b(E[1],I[0]),b(-I[1],E[0])),A[2]),v(k(v(b(A[1],I[0]),b(-I[1],A[0])),-E[2]),k(v(b(A[1],E[0]),b(-E[1],A[0])),I[2]))),-$[3]),v(k(v(k(v(b($[1],I[0]),b(-I[1],$[0])),A[2]),v(k(v(b(A[1],I[0]),b(-I[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),I[2]))),E[3]),k(v(k(v(b($[1],E[0]),b(-E[1],$[0])),A[2]),v(k(v(b(A[1],E[0]),b(-E[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),E[2]))),-I[3]))))),Y=v(v(v(k(v(k(v(b(I[1],B[0]),b(-B[1],I[0])),E[2]),v(k(v(b(E[1],B[0]),b(-B[1],E[0])),-I[2]),k(v(b(E[1],I[0]),b(-I[1],E[0])),B[2]))),A[3]),k(v(k(v(b(I[1],B[0]),b(-B[1],I[0])),A[2]),v(k(v(b(A[1],B[0]),b(-B[1],A[0])),-I[2]),k(v(b(A[1],I[0]),b(-I[1],A[0])),B[2]))),-E[3])),v(k(v(k(v(b(E[1],B[0]),b(-B[1],E[0])),A[2]),v(k(v(b(A[1],B[0]),b(-B[1],A[0])),-E[2]),k(v(b(A[1],E[0]),b(-E[1],A[0])),B[2]))),I[3]),k(v(k(v(b(E[1],I[0]),b(-I[1],E[0])),A[2]),v(k(v(b(A[1],I[0]),b(-I[1],A[0])),-E[2]),k(v(b(A[1],E[0]),b(-E[1],A[0])),I[2]))),-B[3]))),v(v(k(v(k(v(b(E[1],B[0]),b(-B[1],E[0])),$[2]),v(k(v(b($[1],B[0]),b(-B[1],$[0])),-E[2]),k(v(b($[1],E[0]),b(-E[1],$[0])),B[2]))),A[3]),k(v(k(v(b(E[1],B[0]),b(-B[1],E[0])),A[2]),v(k(v(b(A[1],B[0]),b(-B[1],A[0])),-E[2]),k(v(b(A[1],E[0]),b(-E[1],A[0])),B[2]))),-$[3])),v(k(v(k(v(b($[1],B[0]),b(-B[1],$[0])),A[2]),v(k(v(b(A[1],B[0]),b(-B[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),B[2]))),E[3]),k(v(k(v(b($[1],E[0]),b(-E[1],$[0])),A[2]),v(k(v(b(A[1],E[0]),b(-E[1],A[0])),-$[2]),k(v(b(A[1],$[0]),b(-$[1],A[0])),E[2]))),-B[3])))),V=C(P,Y);return V[V.length-1]}}function d(v){var b=v===3?h:v===4?f:u;return b(e,r,n,o)}var g=d(3),m=d(4),y=[function(){return 0},function(){return 0},function(b,k){return k[0]-b[0]},function(b,k,C){var R=(b[1]-C[1])*(k[0]-C[0]),A=(b[0]-C[0])*(k[1]-C[1]),$=R-A,E;if(R>0){if(A<=0)return $;E=R+A}else if(R<0){if(A>=0)return $;E=-(R+A)}else return $;var I=l*E;return $>=I||$<=-I?$:g(b,k,C)},function(b,k,C,R){var A=b[0]-R[0],$=k[0]-R[0],E=C[0]-R[0],I=b[1]-R[1],B=k[1]-R[1],P=C[1]-R[1],Y=b[2]-R[2],V=k[2]-R[2],J=C[2]-R[2],re=$*P,q=E*B,se=E*I,W=A*P,de=A*B,fe=$*I,Z=Y*(re-q)+V*(se-W)+J*(de-fe),X=(Math.abs(re)+Math.abs(q))*Math.abs(Y)+(Math.abs(se)+Math.abs(W))*Math.abs(V)+(Math.abs(de)+Math.abs(fe))*Math.abs(J),j=c*X;return Z>j||-Z>j?Z:m(b,k,C,R)}];function _(v){var b=y[v.length];return b||(b=y[v.length]=d(v.length)),b.apply(void 0,v)}function w(v,b,k,C,R,A,$){return function(I,B,P,Y,V){switch(arguments.length){case 0:case 1:return 0;case 2:return C(I,B);case 3:return R(I,B,P);case 4:return A(I,B,P,Y);case 5:return $(I,B,P,Y,V)}for(var J=new Array(arguments.length),re=0;re<arguments.length;++re)J[re]=arguments[re];return v(J)}}function S(){for(;y.length<=s;)y.push(d(y.length));t.exports=w.apply(void 0,[_].concat(y));for(var v=0;v<=s;++v)t.exports[v]=y[v]}S()})(orientation);var orientationExports=orientation.exports,robustPnp=robustPointInPolygon,orient=orientationExports;function robustPointInPolygon(t,r){for(var e=r[0],n=r[1],o=t.length,s=1,a=o,l=0,c=o-1;l<a;c=l++){var h=t[l],f=t[c],u=h[1],d=f[1];if(d<u){if(d<n&&n<u){var g=orient(h,f,r);if(g===0)return 0;s^=0<g|0}else if(n===u){var m=t[(l+1)%o],y=m[1];if(u<y){var g=orient(h,f,r);if(g===0)return 0;s^=0<g|0}}}else if(u<d){if(u<n&&n<d){var g=orient(h,f,r);if(g===0)return 0;s^=g<0|0}else if(n===u){var m=t[(l+1)%o],y=m[1];if(y<u){var g=orient(h,f,r);if(g===0)return 0;s^=g<0|0}}}else if(n===u){var _=Math.min(h[0],f[0]),w=Math.max(h[0],f[0]);if(l===0){for(;c>0;){var S=(c+o-1)%o,v=t[S];if(v[1]!==n)break;var b=v[0];_=Math.min(_,b),w=Math.max(w,b),c=S}if(c===0)return _<=e&&e<=w?0:1;a=c+1}for(var k=t[(c+o-1)%o][1];l+1<a;){var v=t[l+1];if(v[1]!==n)break;var b=v[0];_=Math.min(_,b),w=Math.max(w,b),l+=1}if(_<=e&&e<=w)return 0;var C=t[(l+1)%o][1];e<_&&k<n!=C<n&&(s^=1)}}return 2*s-1}const robustPointInPolygon$1=getDefaultExportFromCjs(robustPnp);function feretDiameters(t={}){const{originalPoints:r=monotoneChainConvexHull.call(this)}=t;if(r.length===0)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(r.length===1)return{min:1,max:1,minLine:[r[0],r[0]],maxLine:[r[0],r[0]],aspectRatio:1};const e=new Array(r.length);let n=1/0,o=0,s=[];for(let h=0;h<r.length;h++){let f=getAngle(r[h],r[(h+1)%r.length]);rotate(-f,r,e);let u=0,d=[];for(let g=0;g<r.length;g++){let m=Math.abs(e[h][1]-e[g][1]);m>u&&(u=m,d=[],d.push([e[g][0],e[h][1]],[e[g][0],e[g][1]]))}u<n&&(n=u,o=f,s=d)}rotate(o,s,s);let a=0,l=[],c=0;for(let h=0;h<r.length-1;h++)for(let f=h+1;f<r.length;f++){let u=(r[h][0]-r[f][0])**2+(r[h][1]-r[f][1])**2;u>c&&(c=u,a=Math.sqrt(u),l=[r[h],r[f]])}return{min:n,minLine:s,max:a,maxLine:l,aspectRatio:n/a}}function getAngle(t,r){let e=difference(r,t),n=normalize(e),o=Math.acos(n[0]);return n[1]<0?-o:o}class Roi{constructor(r,e){this.map=r,this.id=e,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(r={}){const{scale:e=1,kind:n=""}=r;let o;switch(n){case"contour":o=this.contourMask;break;case"box":o=this.boxMask;break;case"filled":o=this.filledMask;break;case"center":o=this.centerMask;break;case"mbr":o=this.mbrFilledMask;break;case"hull":o=this.convexHullFilledMask;break;case"hullContour":o=this.convexHullMask;break;case"mbrContour":o=this.mbrMask;break;case"feret":o=this.feretMask;break;default:o=this.mask}return e<1&&(o=o.resize({factor:e}),o.parent=this.mask.parent,o.position[0]+=this.minX,o.position[1]+=this.minY),o}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let r=this.borderIDs,e=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let n=this.internalIDs;for(let o=0;o<r.length;o++)n.includes(r[o])||(this.computed.externalIDs.push(r[o]),this.computed.externalLengths.push(e[o]))}get externalIDs(){return this.computed.externalIDs?this.computed.externalIDs:(this._computExternalIDs(),this.computed.externalIDs)}get externalLengths(){return this.computed.externalLengths?this.computed.externalLengths:(this._computExternalIDs(),this.computed.externalLengths)}_computeBorderIDs(){let r=getBorders(this);this.computed.borderIDs=r.ids,this.computed.borderLengths=r.lengths}get borderIDs(){return this.computed.borderIDs?this.computed.borderIDs:(this._computeBorderIDs(),this.computed.borderIDs)}get borderLengths(){return this.computed.borderLengths?this.computed.borderLengths:(this._computeBorderIDs(),this.computed.borderLengths)}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get holesInfo(){return this.computed.holesInfo||(this.computed.holesInfo=getHolesInfo(this)),this.computed.holesInfo}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++)this.map.data[e+this.minX+(n+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&n>0&&n<this.height-1?(this.map.data[e-1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[e+1+this.minX+(n+this.minY)*this.map.width]!==this.id||this.map.data[e+this.minX+(n-1+this.minY)*this.map.width]!==this.id||this.map.data[e+this.minX+(n+1+this.minY)*this.map.width]!==this.id)&&r.setBitXY(e,n):r.setBitXY(e,n));this.computed.contourMask=r}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)r.setBitXY(e,0),r.setBitXY(e,this.height-1);for(let e=0;e<this.height;e++)r.setBitXY(0,e),r.setBitXY(this.width-1,e);this.computed.boxMask=r}return this.computed.boxMask}get mask(){if(!this.computed.mask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++)this.map.data[e+this.minX+(n+this.minY)*this.map.width]===this.id&&r.setBitXY(e,n);this.computed.mask=r}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){let o=e+this.minX+(n+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[o])&&r.setBitXY(e,n)}this.computed.filledMask=r}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let r=new Shape({kind:"smallCross"}).getMask();r.parent=this.map.parent,r.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=r}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const r=[];for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)this.map.data[n+this.minX+(o+this.minY)*this.map.width]===this.id&&(n>0&&n<this.width-1&&o>0&&o<this.height-1?(this.map.data[n-1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[n+1+this.minX+(o+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(o-1+this.minY)*this.map.width]!==this.id||this.map.data[n+this.minX+(o+1+this.minY)*this.map.width]!==this.id)&&(r.push([n,o]),r.push([n+1,o]),r.push([n,o+1]),r.push([n+1,o+1])):(r.push([n,o]),r.push([n+1,o]),r.push([n,o+1]),r.push([n+1,o+1])));const e=monotoneChainConvexHull$1(r);this.computed.convexHull={polyline:e,surface:surface(e),perimeter:perimeter(e)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const r=this.convexHull,e=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(r.polyline,{closed:!0}),this.computed.convexHullMask=e}return this.computed.convexHullMask}get convexHullFilledMask(){if(!this.computed.convexHullFilledMask){const r=this.convexHull,e=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)robustPointInPolygon$1(r.polyline,[n,o])!==1&&e.setBitXY(n,o);this.computed.convexHullFilledMask=e}return this.computed.convexHullFilledMask}get mbr(){if(!this.computed.mbr){let r=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(r.length===0)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:r};else{let e=r[0],n=r[1],o=r[2],s=Math.sqrt((e[0]-n[0])**2+(e[1]-n[1])**2),a=Math.sqrt((o[0]-n[0])**2+(o[1]-n[1])**2);this.computed.mbr={width:s,height:a,elongation:1-s/a,aspectRatio:s/a,surface:s*a,perimeter:(s+a)*2,rectangle:r}}}return this.computed.mbr}get fillRatio(){return this.surface/(this.surface+this.holesInfo.surface)}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let r=this.perimeterInfo,e=2-Math.sqrt(2);return r.one+r.two*2+r.three*3+r.four*4-e*(r.two+r.three*2+r.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const r=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});r.paintPolyline(this.feretDiameters.minLine),r.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=r}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let r=round(this.mbr.rectangle);if(r.length>0){const e=minMax(r),n=new Image(e[1][0]-e[0][0]+1,e[1][1]-e[0][1]+1,{kind:BINARY,position:[this.minX+e[0][0],this.minY+e[0][1]],parent:this.map.parent});r=moveToZeroZero(r),n.paintPolyline(r,{closed:!0}),this.computed.mbrMask=n}else this.computed.mbrMask=new Image(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get mbrFilledMask(){if(!this.computed.mbrFilledMask){const r=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent}),e=this.mask.minimalBoundingRectangle();for(let n=0;n<this.width;n++)for(let o=0;o<this.height;o++)robustPointInPolygon$1(e,[n,o])!==1&&r.setBitXY(n,o);this.computed.mbrFilledMask=r}return this.computed.mbrFilledMask}get points(){if(!this.computed.points){let r=[];for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++){let o=(e+this.minY)*this.map.width+n+this.minX;this.map.data[o]===this.id&&r.push([n,e])}this.computed.points=r}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let r=0,e;const n=this.points;for(let o=0;o<n.length;o++)for(let s=o+1;s<n.length;s++){let a=Math.pow(n[o][0]-n[s][0],2)+Math.pow(n[o][1]-n[s][1],2);a>=r&&(r=a,e=[n[o],n[s]])}this.computed.maxLengthPoints=e}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let r=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=r}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max**2)}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get solidity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let r=this.maxLengthPoints,e=-Math.atan2(r[0][1]-r[1][1],r[0][0]-r[1][0])*180/Math.PI;this.computed.angle=e}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,fillRatio:this.fillRatio,sphericity:this.sphericity,roundness:this.roundness,solidity:this.solidity,perimeter:this.perimeter}}}function getBorders(t){let r=t.map,e=r.data,n=new Set,o=new Map,s=new Set,a=[1,0,-1,0],l=[0,1,0,-1];for(let f=t.minX;f<=t.maxX;f++)for(let u=t.minY;u<=t.maxY;u++){let d=f+u*r.width;if(e[d]===t.id)for(let g=0;g<4;g++){let m=f+a[g],y=u+l[g];if(m>=0&&y>=0&&m<r.width&&y<r.height){let _=m+y*r.width;if(e[_]!==t.id&&!s.has(_)){s.add(_),n.add(e[_]);let w=o.get(e[_]);w?o.set(e[_],++w):o.set(e[_],1)}}}}let c=Array.from(n),h=c.map(function(f){return o.get(f)});return{ids:c,lengths:h}}function getBoxIDs(t){let r=new Set,e=t.map,n=e.data;for(let o of[0,t.height-1])for(let s=0;s<t.width;s++){let a=(o+t.minY)*e.width+s+t.minX;if(s-t.minX>0&&n[a]===t.id&&n[a-1]!==t.id){let l=n[a-1];r.add(l)}if(e.width-s-t.minX>1&&n[a]===t.id&&n[a+1]!==t.id){let l=n[a+1];r.add(l)}}for(let o of[0,t.width-1])for(let s=0;s<t.height;s++){let a=(s+t.minY)*e.width+o+t.minX;if(s-t.minY>0&&n[a]===t.id&&n[a-e.width]!==t.id){let l=n[a-e.width];r.add(l)}if(e.height-s-t.minY>1&&n[a]===t.id&&n[a+e.width]!==t.id){let l=n[a+e.width];r.add(l)}}return Array.from(r)}function getBox(t){let r=0,e=t.map,n=e.data,o=[0];t.height>1&&(o[1]=t.height-1);for(let a of o)for(let l=1;l<t.width-1;l++){let c=(a+t.minY)*e.width+l+t.minX;n[c]===t.id&&r++}let s=[0];t.width>1&&(s[1]=t.width-1);for(let a of s)for(let l=0;l<t.height;l++){let c=(l+t.minY)*e.width+a+t.minX;n[c]===t.id&&r++}return r}function getBorder(t){let r=0,e=t.map,n=e.data;for(let o=1;o<t.width-1;o++)for(let s=1;s<t.height-1;s++){let a=(s+t.minY)*e.width+o+t.minX;n[a]===t.id&&(n[a-1]!==t.id||n[a+1]!==t.id||n[a-e.width]!==t.id||n[a+e.width]!==t.id)&&r++}return r+t.box}function getPerimeterInfo(t){let r=t.map,e=r.data,n=0,o=0,s=0,a=0;for(let l=0;l<t.width;l++)for(let c=0;c<t.height;c++){let h=(c+t.minY)*r.width+l+t.minX;if(e[h]===t.id){let f=0;switch((l===0||t.externalIDs.includes(e[h-1]))&&f++,(l===t.width-1||t.externalIDs.includes(e[h+1]))&&f++,(c===0||t.externalIDs.includes(e[h-r.width]))&&f++,(c===t.height-1||t.externalIDs.includes(e[h+r.width]))&&f++,f){case 1:n++;break;case 2:o++;break;case 3:s++;break;case 4:a++;break}}}return{one:n,two:o,three:s,four:a}}function getExternal(t){let r=0,e=t.map,n=e.data;for(let o=1;o<t.width-1;o++)for(let s=1;s<t.height-1;s++){let a=(s+t.minY)*e.width+o+t.minX;n[a]===t.id&&(t.externalIDs.includes(n[a-1])||t.externalIDs.includes(n[a+1])||t.externalIDs.includes(n[a-e.width])||t.externalIDs.includes(n[a+e.width]))&&r++}return r+t.box}function getHolesInfo(t){let r=0,e=t.map.width,n=t.map.data;for(let o=1;o<t.width-1;o++)for(let s=1;s<t.height-1;s++){let a=(s+t.minY)*e+o+t.minX;t.internalIDs.includes(n[a])&&n[a]!==t.id&&r++}return{number:t.internalIDs.length-1,surface:r}}function getInternalIDs(t){let r=[t.id],e=t.map,n=e.data;if(t.height>2)for(let s=0;s<t.width;s++){let a=t.minY*e.width+s+t.minX;if(r.includes(n[a])){let l=n[a+e.width];!r.includes(l)&&!t.boxIDs.includes(l)&&r.push(l)}}let o=new Array(4);for(let s=1;s<t.width-1;s++)for(let a=1;a<t.height-1;a++){let l=(a+t.minY)*e.width+s+t.minX;if(r.includes(n[l])){o[0]=n[l-1],o[1]=n[l+1],o[2]=n[l-e.width],o[3]=n[l+e.width];for(let c=0;c<4;c++){let h=o[c];!r.includes(h)&&!t.boxIDs.includes(h)&&r.push(h)}}}return r}class RoiLayer{constructor(r,e){this.roiMap=r,this.options=e,this.roi=this.createRoi()}createRoi(){let r=this.roiMap.data,e={};this.roiMap.positive=0,this.roiMap.negative=0;for(let l=0;l<r.length;l++)r[l]&&!e[r[l]]&&(e[r[l]]=!0,r[l]>0?this.roiMap.positive++:this.roiMap.negative++);let n={};for(let l in e)n[l]=new Roi(this.roiMap,l*1);let o=this.roiMap.width,s=this.roiMap.height;for(let l=0;l<s;l++)for(let c=0;c<o;c++){let h=l*o+c;if(r[h]!==0){const f=r[h],u=n[f];c<u.minX&&(u.minX=c),c>u.maxX&&(u.maxX=c),l<u.minY&&(u.minY=l),l>u.maxY&&(u.maxY=l),u.meanX+=c,u.meanY+=l,u.surface++}}let a=[];for(let l in e)n[l].meanX/=n[l].surface,n[l].meanY/=n[l].surface,a.push(n[l]);return a}}function commonBorderLength(t){let r=t.data,e=[1,0,-1,0],n=[0,1,0,-1],o=t.minMax,s=-o.min,a=o.max+s,l=[];for(let h=0;h<=a;h++)l.push(Object.create(null));for(let h=0;h<t.width;h++)for(let f=0;f<t.height;f++){let u=h+f*t.width,d=r[u];if(d!==0){let g=Object.create(null),m=!1;for(let y=0;y<4;y++){let _=h+e[y],w=f+n[y];if(_>=0&&w>=0&&_<t.width&&w<t.height){let S=r[_+w*t.width];d!==S&&(m=!0,S!==0&&g[S]===void 0&&(g[S]=!0,l[S+s][d]?l[S+s][d]++:l[S+s][d]=1))}else m=!0}m&&(l[d+s][d]?l[d+s][d]++:l[d+s][d]=1)}}let c={};for(let h=0;h<l.length;h++)Object.keys(l[h]).length>0&&(c[h-s]=l[h]);return c}function mergeRoi(t={}){const{algorithm:r="commonBorderLength",minCommonBorderLength:e=5,maxCommonBorderLength:n=100,minCommonBorderRatio:o=.3,maxCommonBorderRatio:s=1}=t;let a=function(_,w,S){return _[S]>=e&&_[S]<=n};typeof r=="function"&&(a=r),r.toLowerCase()==="commonborderratio"&&(a=function(_,w,S){let v=Math.min(_[S]/_[w],1);return v>=o&&v<=s});const l=this,c=l.commonBorderLength;let h={},f={};for(let _ of Object.keys(c)){let w=c[_],S=Object.keys(w);for(let v of S)if(v!==_&&a(w,_,v)){let b=v;f[v]&&(b=f[v]);let k=_;if(f[_]&&(k=f[_]),Number(b)!==k){let C=Math.min(b,k),R=Math.max(b,k);if(h[C]||(h[C]={}),h[C][R]=!0,f[R]=C,h[R]){for(let A of Object.keys(h[R]))h[C][A]=!0,f[A]=C;delete h[R]}}}}let u=l.minMax,d=-u.min,g=u.max+d,m=new Array(g+1).fill(0);for(let _ of Object.keys(f))m[Number(_)+d]=f[_];let y=l.data;for(let _=0;_<y.length;_++){let w=y[_];if(w!==0){let S=m[w+d];S!==0&&(y[_]=S)}}return l.computed={},l}class RoiMap{constructor(r,e){this.parent=r,this.width=r.width,this.height=r.height,this.data=e,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let r=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;for(let n=0;n<this.data.length;n++)this.data[n]<r&&(r=this.data[n]),this.data[n]>e&&(e=this.data[n]);return{min:r,max:e}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(r={}){return mergeRoi.call(this,r)}mergeRois(r){const e=r[0],n=r.slice(1);for(let o=0;o<this.data.length;o++)n.includes(this.data[o])&&(this.data[o]=e)}rowsInfo(){let r=new Array(this.height),e=0;for(let n=0;n<this.data.length;n+=this.width){let o={row:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};r[e++]=o;let s={},a={},l=[],c=this.data[n],h=0;for(let f=n;f<n+this.width;f++){let u=this.data[f];c!==u&&(c=u,l.push(h),h=0),h++,u>0?(o.positivePixel++,s[u]||(s[u]=!0)):u<0?(o.negativePixel++,a[u]||(a[u]=!0)):o.zeroPixel++}l.push(h),o.medianChange=l.sort((f,u)=>f-u)[Math.floor(l.length/2)],o.positiveRoiIDs=Object.keys(s),o.negativeRoiIDs=Object.keys(a),o.positiveRoi=o.positiveRoiIDs.length,o.negativeRoi=o.negativeRoiIDs.length}return r}colsInfo(){let r=new Array(this.width),e=0;for(let n=0;n<this.width;n++){let o={col:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};r[e++]=o;let s={},a={},l=[],c=this.data[n],h=0;for(let f=n;f<n+this.data.length;f+=this.width){let u=this.data[f];c!==u&&(c=u,l.push(h),h=0),h++,u>0?(o.positivePixel++,s[u]||(s[u]=!0)):u<0?(o.negativePixel++,a[u]||(a[u]=!0)):o.zeroPixel++}l.push(h),o.medianChange=l.sort((f,u)=>f-u)[Math.floor(l.length/2)],o.positiveRoiIDs=Object.keys(s),o.negativeRoiIDs=Object.keys(a),o.positiveRoi=o.positiveRoiIDs.length,o.negativeRoi=o.negativeRoiIDs.length}return r}}function fromMask(t,r={}){const{allowCorners:e=!1}=r,n=65535;let o=new Int16Array(t.size),s=0,a=0,l=new Uint16Array(n+1),c=new Uint16Array(n+1);for(let f=0;f<t.width;f++)for(let u=0;u<t.height;u++)o[u*t.width+f]===0&&h(f,u);function h(f,u){let d=0,g=0,m=t.getBitXY(f,u),y=m?++s:--a;if(s>32767||a<-32768)throw new Error("Too many regions of interest");for(l[0]=f,c[0]=u;d<=g;){let _=l[d&n],w=c[d&n];if(o[w*t.width+_]=y,_>0&&o[w*t.width+_-1]===0&&t.getBitXY(_-1,w)===m&&(g++,l[g&n]=_-1,c[g&n]=w,o[w*t.width+_-1]=-32768),w>0&&o[(w-1)*t.width+_]===0&&t.getBitXY(_,w-1)===m&&(g++,l[g&n]=_,c[g&n]=w-1,o[(w-1)*t.width+_]=-32768),_<t.width-1&&o[w*t.width+_+1]===0&&t.getBitXY(_+1,w)===m&&(g++,l[g&n]=_+1,c[g&n]=w,o[w*t.width+_+1]=-32768),w<t.height-1&&o[(w+1)*t.width+_]===0&&t.getBitXY(_,w+1)===m&&(g++,l[g&n]=_,c[g&n]=w+1,o[(w+1)*t.width+_]=-32768),e&&(_>0&&w>0&&o[(w-1)*t.width+_-1]===0&&t.getBitXY(_-1,w-1)===m&&(g++,l[g&n]=_-1,c[g&n]=w-1,o[(w-1)*t.width+_-1]=-32768),_<t.width-1&&w>0&&o[(w-1)*t.width+_+1]===0&&t.getBitXY(_+1,w-1)===m&&(g++,l[g&n]=_+1,c[g&n]=w-1,o[(w-1)*t.width+_+1]=-32768),_>0&&w<t.height-1&&o[(w+1)*t.width+_-1]===0&&t.getBitXY(_-1,w+1)===m&&(g++,l[g&n]=_-1,c[g&n]=w+1,o[(w+1)*t.width+_-1]=-32768),_<t.width-1&&w<t.height-1&&o[(w+1)*t.width+_+1]===0&&t.getBitXY(_+1,w+1)===m&&(g++,l[g&n]=_+1,c[g&n]=w+1,o[(w+1)*t.width+_+1]=-32768)),d++,g-d>n)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(t,o)}class DisjointSet{constructor(){this.nodes=new Map}add(r){var e=this.nodes.get(r);return e||(e=new DisjointSetNode(r),this.nodes.set(r,e)),e}union(r,e){const n=this.find(r),o=this.find(e);n!==o&&(n.rank<o.rank?n.parent=o:n.rank>o.rank?o.parent=n:(o.parent=n,n.rank++))}find(r){for(var e=r;e.parent!==null;)e=e.parent;for(var n=r;n.parent!==null;){var o=n;n=n.parent,o.parent=e}return e}connected(r,e){return this.find(r)===this.find(e)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(t){this.value=t,this.parent=null,this.rank=0}const DisjointSet$1=getDefaultExportFromCjs(DisjointSet_1),direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(t,r={}){const{allowCorners:e=!1}=r;let n=4;e&&(n=8);let o,s,a;if(n===8)o=direction8X,s=direction8Y,a=neighbours8;else if(n===4)o=direction4X,s=direction4Y,a=neighbours4;else throw new RangeError(`unsupported neighbours count: ${n}`);const l=t.size,c=t.width,h=t.height,f=new Array(l),u=new Uint32Array(l),d=new DisjointSet$1;let g=1;for(let m=0;m<h;m++)for(let y=0;y<c;y++){const _=y+m*c;if(t.getBit(_)){let w=null;for(let S=0;S<a.length;S++){const v=y+o[S],b=m+s[S];if(v>=0&&b>=0&&v<c&&b<h){const k=v+b*c;let C=f[k];C?(a[S]=C,(!w||a[S].value<w.value)&&(w=a[S])):a[S]=null}}if(!w)f[_]=d.add(g++);else{f[_]=w;for(let S=0;S<a.length;S++)a[S]&&a[S]!==w&&d.union(w,a[S])}}}for(let m=0;m<h;m++)for(let y=0;y<c;y++){const _=y+m*c;t.getBit(_)&&(u[_]=d.find(f[_]).value)}return new RoiMap(t,u)}function fromMaxima(t={}){let{allowCorner:r=!0,onlyTop:e=!1,invert:n=!1}=t,o=this;o.checkProcessable("fromMaxima",{components:[1]});const s=1,a=2;let l=0,c=0,h=new Int16Array(o.size),f=new Int8Array(o.size),u=new Float32Array(o.size),d=1048575,g=new Uint16Array(d+1),m=new Uint16Array(d+1),y=0,_=0,w=new Uint16Array(d+1),S=new Uint16Array(d+1),v=0,b=0;for(k(o);y<_;){let A=g[y&d],$=m[y&d];R(A,$,a),y++}return new RoiMap(o,h);function k({maxima:A=!0}){for(let $=1;$<o.height-1;$++)for(let E=1;E<o.width-1;E++){let I=E+$*o.width;if(f[I]===0){let B=A?o.data[I]:-o.data[E+$*o.width];if(o.data[$*o.width+E-1]>B||o.data[$*o.width+E+1]>B||o.data[($-1)*o.width+E]>B||o.data[($+1)*o.width+E]>B||r&&(o.data[($-1)*o.width+E-1]>B||o.data[($-1)*o.width+E+1]>B||o.data[($+1)*o.width+E-1]>B||o.data[($+1)*o.width+E+1]>B))continue;h[I]=A?++l:--c,C(E,$)||(A?--l:++c)}}}function C(A,$){let E=_;v=0,b=1,w[0]=A,S[0]=$;let I=!0;for(;v<b;){let B=w[v&d],P=S[v&d];I&=R(B,P,s),v++}if(!I){for(let B=0;B<b;B++){let P=w[B&d],V=S[B&d]*o.width+P;h[V]=0}_=E}return I}function R(A,$,E){let I=h[$*o.width+A],B=o.data[$*o.width+A];for(let P=$-1;P<=$+1;P++)for(let Y=A-1;Y<=A+1;Y++){let V=P*o.width+Y;if(f[V]===0)switch(f[V]=1,u[V]=o.data[V]-B,E){case s:if(u[V]===0){if(Y===0||P===0||Y===o.width-1||P===o.height-1)return!1;h[V]=I,w[b&d]=Y,S[b&d]=P,b++}else{if(u[V]>0)return!1;e||(h[V]=I,g[_&d]=Y,m[_&d]=P,_++)}break;case a:u[V]<=0&&(h[V]=I,g[_&d]=Y,m[_&d]=P,_++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(t,r={}){let e=new Shape(r),n=new Int16Array(this.size),o=0,s=e.getPoints();for(let a=0;a<t.length;a++){o++;let l=t[a][0],c=t[a][1];for(let h=0;h<s.length;h++){let f=s[h][0],u=s[h][1];l+f>=0&&c+u>=0&&l+f<this.width&&c+u<this.height&&(n[l+f+(c+u)*this.width]=o)}}return new RoiMap(this,n)}function commonjsRequire(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var priorityQueue={exports:{}};(function(t,r){(function(e){t.exports=e()})(function(){return function e(n,o,s){function a(h,f){if(!o[h]){if(!n[h]){var u=typeof commonjsRequire=="function"&&commonjsRequire;if(!f&&u)return u(h,!0);if(l)return l(h,!0);var d=new Error("Cannot find module '"+h+"'");throw d.code="MODULE_NOT_FOUND",d}var g=o[h]={exports:{}};n[h][0].call(g.exports,function(m){var y=n[h][1][m];return a(y||m)},g,g.exports,e,n,o,s)}return o[h].exports}for(var l=typeof commonjsRequire=="function"&&commonjsRequire,c=0;c<s.length;c++)a(s[c]);return a}({1:[function(e,n,o){var s,a,l,c,h,f=function(d,g){for(var m in g)u.call(g,m)&&(d[m]=g[m]);function y(){this.constructor=d}return y.prototype=g.prototype,d.prototype=new y,d.__super__=g.prototype,d},u={}.hasOwnProperty;s=e("./PriorityQueue/AbstractPriorityQueue"),a=e("./PriorityQueue/ArrayStrategy"),c=e("./PriorityQueue/BinaryHeapStrategy"),l=e("./PriorityQueue/BHeapStrategy"),h=function(d){f(g,d);function g(m){m||(m={}),m.strategy||(m.strategy=c),m.comparator||(m.comparator=function(y,_){return(y||0)-(_||0)}),g.__super__.constructor.call(this,m)}return g}(s),h.ArrayStrategy=a,h.BinaryHeapStrategy=c,h.BHeapStrategy=l,n.exports=h},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,n,o){n.exports=function(){function s(a){var l;if((a!=null?a.strategy:void 0)==null)throw"Must pass options.strategy, a strategy";if((a!=null?a.comparator:void 0)==null)throw"Must pass options.comparator, a comparator";this.priv=new a.strategy(a),this.length=(a!=null&&(l=a.initialValues)!=null?l.length:void 0)||0}return s.prototype.queue=function(a){this.length++,this.priv.queue(a)},s.prototype.dequeue=function(a){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},s.prototype.peek=function(a){if(!this.length)throw"Empty queue";return this.priv.peek()},s.prototype.clear=function(){return this.length=0,this.priv.clear()},s}()},{}],3:[function(e,n,o){var s;s=function(a,l,c){var h,f,u;for(f=0,h=a.length;f<h;)u=f+h>>>1,c(a[u],l)>=0?f=u+1:h=u;return f},n.exports=function(){function a(l){var c;this.options=l,this.comparator=this.options.comparator,this.data=((c=this.options.initialValues)!=null?c.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return a.prototype.queue=function(l){var c;c=s(this.data,l,this.comparator),this.data.splice(c,0,l)},a.prototype.dequeue=function(){return this.data.pop()},a.prototype.peek=function(){return this.data[this.data.length-1]},a.prototype.clear=function(){this.data.length=0},a}()},{}],4:[function(e,n,o){n.exports=function(){function s(a){var l,c,h,f,u,d,g,m;for(this.comparator=(a!=null?a.comparator:void 0)||function(y,_){return y-_},this.pageSize=(a!=null?a.pageSize:void 0)||512,this.length=0,g=0;1<<g<this.pageSize;)g+=1;if(1<<g!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=g,this._emptyMemoryPageTemplate=l=[],c=0,u=this.pageSize;0<=u?c<u:c>u;0<=u?++c:--c)l.push(null);if(this._memory=[],this._mask=this.pageSize-1,a.initialValues)for(d=a.initialValues,h=0,f=d.length;h<f;h++)m=d[h],this.queue(m)}return s.prototype.queue=function(a){this.length+=1,this._write(this.length,a),this._bubbleUp(this.length,a)},s.prototype.dequeue=function(){var a,l;return a=this._read(1),l=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,l),this._bubbleDown(1,l)),a},s.prototype.peek=function(){return this._read(1)},s.prototype.clear=function(){this.length=0,this._memory.length=0},s.prototype._write=function(a,l){var c;for(c=a>>this._shift;c>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[c][a&this._mask]=l},s.prototype._read=function(a){return this._memory[a>>this._shift][a&this._mask]},s.prototype._bubbleUp=function(a,l){var c,h,f,u;for(c=this.comparator;a>1&&(h=a&this._mask,a<this.pageSize||h>3?f=a&~this._mask|h>>1:h<2?(f=a-this.pageSize>>this._shift,f+=f&~(this._mask>>1),f|=this.pageSize>>1):f=a-2,u=this._read(f),!(c(u,l)<0));)this._write(f,l),this._write(a,u),a=f},s.prototype._bubbleDown=function(a,l){var c,h,f,u,d;for(d=this.comparator;a<this.length;)if(a>this._mask&&!(a&this._mask-1)?c=h=a+2:a&this.pageSize>>1?(c=(a&~this._mask)>>1,c|=a&this._mask>>1,c=c+1<<this._shift,h=c+1):(c=a+(a&this._mask),h=c+1),c!==h&&h<=this.length)if(f=this._read(c),u=this._read(h),d(f,l)<0&&d(f,u)<=0)this._write(c,l),this._write(a,f),a=c;else if(d(u,l)<0)this._write(h,l),this._write(a,u),a=h;else break;else if(c<=this.length)if(f=this._read(c),d(f,l)<0)this._write(c,l),this._write(a,f),a=c;else break;else break},s}()},{}],5:[function(e,n,o){n.exports=function(){function s(a){var l;this.comparator=(a!=null?a.comparator:void 0)||function(c,h){return c-h},this.length=0,this.data=((l=a.initialValues)!=null?l.slice(0):void 0)||[],this._heapify()}return s.prototype._heapify=function(){var a,l,c;if(this.data.length>0)for(a=l=1,c=this.data.length;1<=c?l<c:l>c;a=1<=c?++l:--l)this._bubbleUp(a)},s.prototype.queue=function(a){this.data.push(a),this._bubbleUp(this.data.length-1)},s.prototype.dequeue=function(){var a,l;return l=this.data[0],a=this.data.pop(),this.data.length>0&&(this.data[0]=a,this._bubbleDown(0)),l},s.prototype.peek=function(){return this.data[0]},s.prototype.clear=function(){this.length=0,this.data.length=0},s.prototype._bubbleUp=function(a){for(var l,c;a>0&&(l=a-1>>>1,this.comparator(this.data[a],this.data[l])<0);)c=this.data[l],this.data[l]=this.data[a],this.data[a]=c,a=l},s.prototype._bubbleDown=function(a){var l,c,h,f,u;for(l=this.data.length-1;c=(a<<1)+1,f=c+1,h=a,c<=l&&this.comparator(this.data[c],this.data[h])<0&&(h=c),f<=l&&this.comparator(this.data[f],this.data[h])<0&&(h=f),h!==a;)u=this.data[h],this.data[h]=this.data[a],this.data[a]=u,a=h},s}()},{}]},{},[1])(1)})})(priorityQueue);var priorityQueueExports=priorityQueue.exports;const PriorityQueue=getDefaultExportFromCjs(priorityQueueExports),dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(t={}){let{points:r,mask:e,image:n,fillMaxValue:o=this.maxValue,invert:s=!1}=t,a=n||this;a.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,r||(r=a.getLocalMaxima({invert:s,mask:e}));let l=s?0:1,c=new Int16Array(a.size),h=a.width,f=a.height,u=new PriorityQueue({comparator:(d,g)=>d[2]-g[2],strategy:PriorityQueue.BinaryHeapStrategy});for(let d=0;d<r.length;d++){let g=r[d][0]+r[d][1]*h;c[g]=d+1;let m=a.data[g];(s&&m<=o||!s&&m>=o)&&u.queue([r[d][0],r[d][1],m])}for(;u.length>0;){let d=u.dequeue(),g=d[0]+d[1]*h;for(let m=0;m<4;m++){let y=d[0]+dxs[m],_=d[1]+dys[m];if(y>=0&&_>=0&&y<h&&_<f){let w=y+_*h;if(!e||e.getBit(w)===l){let S=a.data[w];(s&&S<=o||!s&&S>=o)&&c[w]===0&&(c[w]=c[g],u.queue([d[0]+dxs[m],d[1]+dys[m],S]))}}}}return new RoiMap(a,c)}class RoiManager{constructor(r,e={}){this._image=r,this._options=e,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(r={}){let e=Object.assign({},this._options,r),n=fromMaxima.call(this._image,r);this._layers[e.label]=new RoiLayer(n,e)}fromPoints(r,e={}){let n=Object.assign({},this._options,e),o=fromPoints.call(this._image,r,e);return this._layers[n.label]=new RoiLayer(o,n),this}putMap(r,e={}){let n=new RoiMap(this._image,r),o=Object.assign({},this._options,e);return this._layers[o.label]=new RoiLayer(n,o),this}fromWaterShed(r={}){let e=Object.assign({},this._options,r),n=fromWaterShed.call(this._image,r);this._layers[e.label]=new RoiLayer(n,e)}fromMask(r,e={}){let n=Object.assign({},this._options,e),o=fromMask.call(this._image,r,e);return this._layers[n.label]=new RoiLayer(o,n),this}fromMaskConnectedComponentLabelingAlgorithm(r,e={}){let n=Object.assign({},this._options,e),o=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,r,e);return this._layers[n.label]=new RoiLayer(o,n),this}getMap(r={}){let e=Object.assign({},this._options,r);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap}rowsInfo(r={}){return this.getMap(r).rowsInfo()}colsInfo(r={}){return this.getMap(r).rowsInfo()}getRoiIds(r={}){let e=this.getRois(r);if(e){let n=new Array(e.length);for(let o=0;o<e.length;o++)n[o]=e[o].id;return n}throw new Error("ROIs not found")}getRois(r={}){let{label:e=this._options.label,positive:n=!0,negative:o=!0,minSurface:s=0,maxSurface:a=Number.POSITIVE_INFINITY,minWidth:l=0,maxWidth:c=Number.POSITIVE_INFINITY,minHeight:h=0,maxHeight:f=Number.POSITIVE_INFINITY,minRatio:u=0,maxRatio:d=Number.POSITIVE_INFINITY}=r;if(!this._layers[e])throw new Error(`this Roi layer (${e}) does not exist`);const g=this._layers[e].roi,m=[];for(const y of g)(y.id<0&&o||y.id>0&&n)&&y.surface>=s&&y.surface<=a&&y.width>=l&&y.width<=c&&y.height>=h&&y.height<=f&&y.ratio>=u&&y.ratio<=d&&m.push(y);return m}getRoi(r,e={}){const{label:n=this._options.label}=e;if(!this._layers[n])throw new Error(`this Roi layer (${n}) does not exist`);const o=this._layers[n].roi.find(s=>s.id===r);if(!o)throw new Error(`found no Roi with id ${r}`);return o}getMasks(r={}){let e=this.getRois(r),n=new Array(e.length);for(let o=0;o<e.length;o++)n[o]=e[o].getMask(r);return n}getAnalysisMasks(r={}){const{analysisProperty:e}=r;let n=`${e}Mask`,o=this.getRois(r);return o.length===0||!o[0][n]?[]:o.map(s=>s[n])}getData(r={}){let e=Object.assign({},this._options,r);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap.data}paint(r={}){let{labelProperty:e,analysisProperty:n}=r;this._painted||(this._painted=this._image.rgba8());let o=this.getMasks(r);if(e){const s=this.getRois(r);r.labels=s.map(h=>deepValue(h,e));const a=Math.max(...r.labels);let l=!1,c=!1;if(e.includes("surface")?l=!0:/(?:perimeter|min|max|external|width|height|length)/.test(e)&&(c=!0),isFinite(a)){let h="";if(r.unit!=="pixel"&&r.pixelSize&&(c||l)){h=l?`${r.unit}^2`:r.unit;let f=l?"m^2":"m",u=l?r.pixelSize**2:r.pixelSize;const d=Qty.swiftConverter(f,h);r.labels=r.labels.map(g=>d(u*g))}a>50?r.labels=r.labels.map(f=>Math.round(f)+h):a>10?r.labels=r.labels.map(f=>f.toFixed(1)+h):r.labels=r.labels.map(f=>f.toFixed(2)+h)}r.labelsPosition=s.map(h=>[h.meanX,h.meanY])}if(this._painted.paintMasks(o,r),n){let s=this.getAnalysisMasks(r);this._painted.paintMasks(s,{color:r.analysisColor,alpha:r.analysisAlpha})}return this._painted}getMask(r={}){let e=new Image(this._image.width,this._image.height,{kind:"BINARY"}),n=this.getMasks(r);for(let o=0;o<n.length;o++){let s=n[o];for(let a=0;a<s.width;a++)for(let l=0;l<s.height;l++)s.getBitXY(a,l)&&e.setBitXY(a+s.position[0],l+s.position[1])}return e}resetPainted(r={}){const{image:e}=r;e?this._painted=this.image.rgba8():this._painted=this._image.rgba8()}mergeRoi(r={}){const e=this.getMap(r);return e.mergeRoi(r),this.putMap(e.data,r),this}mergeRois(r,e={}){if(!Array.isArray(r)||r.some(o=>!Number.isInteger(o)))throw new Error("Roi ids must be an array of integers");if(r.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(r).size!==r.length)throw new Error("Roi ids must be all different");r.forEach(o=>this.getRoi(o));const n=this.getMap(e);return n.mergeRois(r),this.putMap(n.data,e),this}findCorrespondingRoi(r,e={}){let n=this.getRois(e),o=[];for(let s=0;s<n.length;s++){let a=n[s],l=a.minX,c=a.minY,h=a.points,f=Math.sign(a.id),u=correspondingRoisInformation(l,c,h,r,f);o.push(u)}return o}_assertLayerWithLabel(r){if(!this._layers[r])throw new Error(`no layer with label ${r}`)}}function correspondingRoisInformation(t,r,e,n,o){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let a=0;a<e.length;a++){let l=e[a],c=l[0],h=l[1],f=c+t+(h+r)*n.width,u=n.data[f];(u>0||u<0)&&(s.id.includes(u)?s.surface[s.id.indexOf(u)]+=1:(s.id.push(u),s.surface.push(1)))}for(let a=0;a<s.id.length;a++)Math.sign(s.id[a])===o?s.same+=s.surface[a]:s.opposite+=s.surface[a],s.roiSurfaceCovered[a]=s.surface[a]/e.length;return s.total=s.opposite+s.same,s}const objectToString=Object.prototype.toString;class Image{constructor(r,e,n,o){if(arguments.length===1?(o=r,{width:r,height:e,data:n}=o):n&&!n.length&&(o=n,{data:n}=o),r===void 0&&(r=1),e===void 0&&(e=1),o===void 0&&(o={}),typeof o!="object"||o===null)throw new TypeError("options must be an object");if(!Number.isInteger(r)||r<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(e)||e<=0)throw new RangeError("height must be a positive integer");const{kind:s=RGBA}=o;if(typeof s!="string")throw new TypeError("kind must be a string");const a=getKind(s),l=Object.assign({},o);for(const y in a)l[y]===void 0&&(l[y]=a[y]);verifyKindDefinition(l);const{components:c,bitDepth:h,colorModel:f}=l,u=l.alpha+0,d=r*e,g=c+u,m=h===32?Number.MAX_VALUE:2**h-1;if(n===void 0)n=createPixelArray(d,c,u,g,h,m);else{const y=getTheoreticalPixelArraySize(d,g,h);if(n.length!==y)throw new RangeError(`incorrect data size: ${n.length}. Should be ${y}`)}this.width=r,this.height=e,this.data=n,this.size=d,this.components=c,this.alpha=u,this.bitDepth=h,this.maxValue=m,this.colorModel=f,this.channels=g,this.meta=o.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:o.parent||null}),this.position=o.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(r){return objectToString.call(r)==="[object IJSImage]"}static fromCanvas(r){const n=r.getContext("2d").getImageData(0,0,r.width,r.height);return new Image(n.width,n.height,n.data)}static createFrom(r,e){const n=getImageParameters(r);return Object.assign(n,{parent:r,position:[0,0]},e),new Image(n)}getRoiManager(r){return new RoiManager(this,r)}clone(){const r=this.data.slice();return new Image(this.width,this.height,r,this)}apply(r){for(let e=0;e<this.height;e++)for(let n=0;n<this.width;n++){let o=(e*this.width+n)*this.channels;r.call(this,o)}}}setValueMethods(Image);setBitMethods(Image);setExportMethods(Image);Image.prototype.checkProcessable=checkProcessable;Image.prototype.getRGBAData=getRGBAData;Image.load=load;Image.extendMethod=extendMethod;Image.extendProperty=extendProperty;extend$1(Image);function laplacianOfGaussian(t,r,e){let n=new Array(r),o,s,a,l;e||(e=100),e*=-1;let c=(r-1)/2,h=2*t*t;for(o=0;o<r;o++)for(n[o]=new Array(r),l=(o-c)*(o-c),s=0;s<r;s++)a=(s-c)*(s-c),n[o][s]=Math.round(e*(1-(a+l)/h)*Math.exp(-(a+l)/h));return n}const kernel=Object.freeze(Object.defineProperty({__proto__:null,DISCRETE_LAPLACE_4,DISCRETE_LAPLACE_8,SCHARR_X,SCHARR_Y,SECOND_DERIVATIVE,SECOND_DERIVATIVE_INV,SOBEL_X,SOBEL_Y,laplacianOfGaussian},Symbol.toStringTag,{value:"Module"}));var workerTemplate$1={},worker$2=function(){self.window=self;function t(){this._listeners={}}t.prototype.on=function(e,n){if(this._listeners[e])throw new RangeError("there is already a listener for "+e);if(typeof n!="function")throw new TypeError("callback argument must be a function");this._listeners[e]=n},t.prototype._send=function(e,n,o){o===void 0?o=[]:Array.isArray(o)||(o=[o]),self.postMessage({id:e,data:n},o)},t.prototype._trigger=function(e,n){if(!this._listeners[e])throw new Error("event "+e+" is not defined");this._listeners[e].apply(null,n)};var r=new t;self.onmessage=function(e){switch(e.data.action){case"exec":e.data.args.unshift(function(n,o){r._send(e.data.id,n,o)}),r._trigger(e.data.event,e.data.args);break;case"ping":r._send(e.data.id,"pong");break;default:throw new Error("unexpected action: "+e.data.action)}}},workerStr=worker$2.toString().split('"CODE";');workerTemplate$1.newWorkerURL=function t(r,e){var n=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(e)+`);
`,"(",r,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(n)};var workerTemplate=workerTemplate$1,CORES=navigator.hardwareConcurrency||1;function WorkerManager(t,r){if(typeof t!="string"&&typeof t!="function")throw new TypeError("func argument must be a function");if(r===void 0&&(r={}),typeof r!="object"||r===null)throw new TypeError("options argument must be an object");this._workerCode=t.toString(),r.maxWorkers===void 0||r.maxWorkers==="auto"?this._numWorkers=Math.min(CORES-1,1):r.maxWorkers>0?this._numWorkers=Math.min(r.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=r.timeout||0,this._terminateOnError=!!r.terminateOnError;var e=r.deps;typeof e=="string"&&(e=[e]),Array.isArray(e)||(e=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(e)}WorkerManager.prototype._init=function(t){for(var r=workerTemplate.newWorkerURL(this._workerCode,t),e=0;e<this._numWorkers;e++){var n=new Worker(r);n.onmessage=this._onmessage.bind(this,n),n.onerror=this._onerror.bind(this,n),n.running=!1,n.id=e,this._workers.set(n,null)}URL.revokeObjectURL(r)};WorkerManager.prototype._onerror=function(t,r){if(!this._terminated){this._working--,t.running=!1;var e=this._workers.get(t);e&&e[1](r.message),this._workers.set(t,null),this._terminateOnError?this.terminate():this._exec()}};WorkerManager.prototype._onmessage=function(t,r){if(!this._terminated){this._working--,t.running=!1;var e=this._workers.get(t);e&&e[0](r.data.data),this._workers.set(t,null),this._exec()}};WorkerManager.prototype._exec=function(){for(var t of this._workers.keys()){if(this._working===this._numWorkers||this._waiting.length===0)return;if(!t.running)for(var r=0;r<this._waiting.length;r++){var e=this._waiting[r];if(!(typeof e[4]=="number"&&e[4]!==t.id)){this._waiting.splice(r,1),t.postMessage({action:"exec",event:e[0],args:e[1]},e[2]),t.running=!0,t.time=Date.now(),this._workers.set(t,e[3]),this._working++;break}}}};WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var t of this._workers)t[0].terminate(),t[1]&&t[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}};WorkerManager.prototype.postAll=function(t,r){if(this._terminated)throw new Error("Cannot post (terminated)");var e=[];for(var n of this._workers.keys())e.push(this.post(t,r,[],n.id));return Promise.all(e)};WorkerManager.prototype.post=function(t,r,e,n){r===void 0&&(r=[]),e===void 0&&(e=[]),Array.isArray(r)||(r=[r]),Array.isArray(e)||(e=[e]);var o=this;return new Promise(function(s,a){if(o._terminated)throw new Error("Cannot post (terminated)");o._waiting.push([t,r,e,[s,a],n]),o._exec()})};var src$1=WorkerManager;const WorkerManager$1=getDefaultExportFromCjs(src$1),defaultOptions={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(t,r,e){r=Object.assign({},defaultOptions,r);const n=this.manager;return Array.isArray(t)?Promise.all(t.map(function(o){const s=runOnce(n,o,r);return typeof e=="function"&&s.then(e),s})):runOnce(n,t,r)}function runOnce(t,r,e){return t.post("data",[r,e]).then(function(n){for(let o in n)n[o]=new Image(n[o]);return n})}function work(){worker.on("data",function(t,r,e){r=new IJS(r);const n={},o=[],s=r.grey(),a=s.sobelFilter();g("sobel",a);const l=a.level().mask({threshold:e.threshold});g("mask",l);const c=a.getRoiManager();c.fromMask(l);const h=c.getMask(e.roi);g("realMask",h);const f=s.getPixelsGrid({sampling:e.sampling,mask:h}),u=r.getBackground(f.xyS,f.zS,e.regression);g("background",u);const d=r.subtract(u);n.result=d,o.push(d.data.buffer),t(n,o);function g(m,y){e.include.includes(m)&&(n[m]=y,o.push(y.data.buffer))}})}const background={run,work};function extend(t){t.extendMethod("background",background)}let Worker$1=class mt{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(this._url===null)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(r){if(typeof r!="string")throw new TypeError("worker URL must be a string");this._url=r,this._deps[0]=r}static extendMethod(r,e){let n,o,s={};function a(...l){return n||(this.checkUrl(),o=this.url,n=new WorkerManager$1(e.work,{deps:o}),s.manager=n),e.run.call(s,...l)}a.reset=function(){n&&(n.terminate(),n=new WorkerManager$1(e.work,{deps:o}),s.manager=n)},mt.prototype[r]=a}};extend(Worker$1);const worker$1=new Worker$1,Static={grey:names$1,threshold:names},src=Object.freeze(Object.defineProperty({__proto__:null,Image,Kernel:kernel,Shape,Stack,Static,Worker:worker$1,default:Image},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(src);var colorString$1={exports:{}},colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},simpleSwizzle={exports:{}},isArrayish$1=function t(r){return!r||typeof r=="string"?!1:r instanceof Array||Array.isArray(r)||r.length>=0&&(r.splice instanceof Function||Object.getOwnPropertyDescriptor(r,r.length-1)&&r.constructor.name!=="String")},isArrayish=isArrayish$1,concat=Array.prototype.concat,slice=Array.prototype.slice,swizzle$1=simpleSwizzle.exports=function t(r){for(var e=[],n=0,o=r.length;n<o;n++){var s=r[n];isArrayish(s)?e=concat.call(e,slice.call(s)):e.push(s)}return e};swizzle$1.wrap=function(t){return function(){return t(swizzle$1(arguments))}};var simpleSwizzleExports=simpleSwizzle.exports,colorNames=colorName,swizzle=simpleSwizzleExports,hasOwnProperty=Object.hasOwnProperty,reverseNames=Object.create(null);for(var name in colorNames)hasOwnProperty.call(colorNames,name)&&(reverseNames[colorNames[name]]=name);var cs=colorString$1.exports={to:{},get:{}};cs.get=function(t){var r=t.substring(0,3).toLowerCase(),e,n;switch(r){case"hsl":e=cs.get.hsl(t),n="hsl";break;case"hwb":e=cs.get.hwb(t),n="hwb";break;default:e=cs.get.rgb(t),n="rgb";break}return e?{model:n,value:e}:null};cs.get.rgb=function(t){if(!t)return null;var r=/^#([a-f0-9]{3,4})$/i,e=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i,n=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,o=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,s=/^(\w+)$/,a=[0,0,0,1],l,c,h;if(l=t.match(e)){for(h=l[2],l=l[1],c=0;c<3;c++){var f=c*2;a[c]=parseInt(l.slice(f,f+2),16)}h&&(a[3]=parseInt(h,16)/255)}else if(l=t.match(r)){for(l=l[1],h=l[3],c=0;c<3;c++)a[c]=parseInt(l[c]+l[c],16);h&&(a[3]=parseInt(h+h,16)/255)}else if(l=t.match(n)){for(c=0;c<3;c++)a[c]=parseInt(l[c+1],0);l[4]&&(l[5]?a[3]=parseFloat(l[4])*.01:a[3]=parseFloat(l[4]))}else if(l=t.match(o)){for(c=0;c<3;c++)a[c]=Math.round(parseFloat(l[c+1])*2.55);l[4]&&(l[5]?a[3]=parseFloat(l[4])*.01:a[3]=parseFloat(l[4]))}else return(l=t.match(s))?l[1]==="transparent"?[0,0,0,0]:hasOwnProperty.call(colorNames,l[1])?(a=colorNames[l[1]],a[3]=1,a):null:null;for(c=0;c<3;c++)a[c]=clamp(a[c],0,255);return a[3]=clamp(a[3],0,1),a};cs.get.hsl=function(t){if(!t)return null;var r=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,e=t.match(r);if(e){var n=parseFloat(e[4]),o=(parseFloat(e[1])%360+360)%360,s=clamp(parseFloat(e[2]),0,100),a=clamp(parseFloat(e[3]),0,100),l=clamp(isNaN(n)?1:n,0,1);return[o,s,a,l]}return null};cs.get.hwb=function(t){if(!t)return null;var r=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,e=t.match(r);if(e){var n=parseFloat(e[4]),o=(parseFloat(e[1])%360+360)%360,s=clamp(parseFloat(e[2]),0,100),a=clamp(parseFloat(e[3]),0,100),l=clamp(isNaN(n)?1:n,0,1);return[o,s,a,l]}return null};cs.to.hex=function(){var t=swizzle(arguments);return"#"+hexDouble(t[0])+hexDouble(t[1])+hexDouble(t[2])+(t[3]<1?hexDouble(Math.round(t[3]*255)):"")};cs.to.rgb=function(){var t=swizzle(arguments);return t.length<4||t[3]===1?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"};cs.to.rgb.percent=function(){var t=swizzle(arguments),r=Math.round(t[0]/255*100),e=Math.round(t[1]/255*100),n=Math.round(t[2]/255*100);return t.length<4||t[3]===1?"rgb("+r+"%, "+e+"%, "+n+"%)":"rgba("+r+"%, "+e+"%, "+n+"%, "+t[3]+")"};cs.to.hsl=function(){var t=swizzle(arguments);return t.length<4||t[3]===1?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"};cs.to.hwb=function(){var t=swizzle(arguments),r="";return t.length>=4&&t[3]!==1&&(r=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+r+")"};cs.to.keyword=function(t){return reverseNames[t.slice(0,3)]};function clamp(t,r,e){return Math.min(Math.max(r,t),e)}function hexDouble(t){var r=Math.round(t).toString(16).toUpperCase();return r.length<2?"0"+r:r}var colorStringExports=colorString$1.exports;const cssKeywords=colorName,reverseKeywords={};for(const t of Object.keys(cssKeywords))reverseKeywords[cssKeywords[t]]=t;const convert$2={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};var conversions$2=convert$2;for(const t of Object.keys(convert$2)){if(!("channels"in convert$2[t]))throw new Error("missing channels property: "+t);if(!("labels"in convert$2[t]))throw new Error("missing channel labels property: "+t);if(convert$2[t].labels.length!==convert$2[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:r,labels:e}=convert$2[t];delete convert$2[t].channels,delete convert$2[t].labels,Object.defineProperty(convert$2[t],"channels",{value:r}),Object.defineProperty(convert$2[t],"labels",{value:e})}convert$2.rgb.hsl=function(t){const r=t[0]/255,e=t[1]/255,n=t[2]/255,o=Math.min(r,e,n),s=Math.max(r,e,n),a=s-o;let l,c;s===o?l=0:r===s?l=(e-n)/a:e===s?l=2+(n-r)/a:n===s&&(l=4+(r-e)/a),l=Math.min(l*60,360),l<0&&(l+=360);const h=(o+s)/2;return s===o?c=0:h<=.5?c=a/(s+o):c=a/(2-s-o),[l,c*100,h*100]};convert$2.rgb.hsv=function(t){let r,e,n,o,s;const a=t[0]/255,l=t[1]/255,c=t[2]/255,h=Math.max(a,l,c),f=h-Math.min(a,l,c),u=function(d){return(h-d)/6/f+1/2};return f===0?(o=0,s=0):(s=f/h,r=u(a),e=u(l),n=u(c),a===h?o=n-e:l===h?o=1/3+r-n:c===h&&(o=2/3+e-r),o<0?o+=1:o>1&&(o-=1)),[o*360,s*100,h*100]};convert$2.rgb.hwb=function(t){const r=t[0],e=t[1];let n=t[2];const o=convert$2.rgb.hsl(t)[0],s=1/255*Math.min(r,Math.min(e,n));return n=1-1/255*Math.max(r,Math.max(e,n)),[o,s*100,n*100]};convert$2.rgb.cmyk=function(t){const r=t[0]/255,e=t[1]/255,n=t[2]/255,o=Math.min(1-r,1-e,1-n),s=(1-r-o)/(1-o)||0,a=(1-e-o)/(1-o)||0,l=(1-n-o)/(1-o)||0;return[s*100,a*100,l*100,o*100]};function comparativeDistance(t,r){return(t[0]-r[0])**2+(t[1]-r[1])**2+(t[2]-r[2])**2}convert$2.rgb.keyword=function(t){const r=reverseKeywords[t];if(r)return r;let e=1/0,n;for(const o of Object.keys(cssKeywords)){const s=cssKeywords[o],a=comparativeDistance(t,s);a<e&&(e=a,n=o)}return n};convert$2.keyword.rgb=function(t){return cssKeywords[t]};convert$2.rgb.xyz=function(t){let r=t[0]/255,e=t[1]/255,n=t[2]/255;r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92;const o=r*.4124+e*.3576+n*.1805,s=r*.2126+e*.7152+n*.0722,a=r*.0193+e*.1192+n*.9505;return[o*100,s*100,a*100]};convert$2.rgb.lab=function(t){const r=convert$2.rgb.xyz(t);let e=r[0],n=r[1],o=r[2];e/=95.047,n/=100,o/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;const s=116*n-16,a=500*(e-n),l=200*(n-o);return[s,a,l]};convert$2.hsl.rgb=function(t){const r=t[0]/360,e=t[1]/100,n=t[2]/100;let o,s,a;if(e===0)return a=n*255,[a,a,a];n<.5?o=n*(1+e):o=n+e-n*e;const l=2*n-o,c=[0,0,0];for(let h=0;h<3;h++)s=r+1/3*-(h-1),s<0&&s++,s>1&&s--,6*s<1?a=l+(o-l)*6*s:2*s<1?a=o:3*s<2?a=l+(o-l)*(2/3-s)*6:a=l,c[h]=a*255;return c};convert$2.hsl.hsv=function(t){const r=t[0];let e=t[1]/100,n=t[2]/100,o=e;const s=Math.max(n,.01);n*=2,e*=n<=1?n:2-n,o*=s<=1?s:2-s;const a=(n+e)/2,l=n===0?2*o/(s+o):2*e/(n+e);return[r,l*100,a*100]};convert$2.hsv.rgb=function(t){const r=t[0]/60,e=t[1]/100;let n=t[2]/100;const o=Math.floor(r)%6,s=r-Math.floor(r),a=255*n*(1-e),l=255*n*(1-e*s),c=255*n*(1-e*(1-s));switch(n*=255,o){case 0:return[n,c,a];case 1:return[l,n,a];case 2:return[a,n,c];case 3:return[a,l,n];case 4:return[c,a,n];case 5:return[n,a,l]}};convert$2.hsv.hsl=function(t){const r=t[0],e=t[1]/100,n=t[2]/100,o=Math.max(n,.01);let s,a;a=(2-e)*n;const l=(2-e)*o;return s=e*o,s/=l<=1?l:2-l,s=s||0,a/=2,[r,s*100,a*100]};convert$2.hwb.rgb=function(t){const r=t[0]/360;let e=t[1]/100,n=t[2]/100;const o=e+n;let s;o>1&&(e/=o,n/=o);const a=Math.floor(6*r),l=1-n;s=6*r-a,a&1&&(s=1-s);const c=e+s*(l-e);let h,f,u;switch(a){default:case 6:case 0:h=l,f=c,u=e;break;case 1:h=c,f=l,u=e;break;case 2:h=e,f=l,u=c;break;case 3:h=e,f=c,u=l;break;case 4:h=c,f=e,u=l;break;case 5:h=l,f=e,u=c;break}return[h*255,f*255,u*255]};convert$2.cmyk.rgb=function(t){const r=t[0]/100,e=t[1]/100,n=t[2]/100,o=t[3]/100,s=1-Math.min(1,r*(1-o)+o),a=1-Math.min(1,e*(1-o)+o),l=1-Math.min(1,n*(1-o)+o);return[s*255,a*255,l*255]};convert$2.xyz.rgb=function(t){const r=t[0]/100,e=t[1]/100,n=t[2]/100;let o,s,a;return o=r*3.2406+e*-1.5372+n*-.4986,s=r*-.9689+e*1.8758+n*.0415,a=r*.0557+e*-.204+n*1.057,o=o>.0031308?1.055*o**(1/2.4)-.055:o*12.92,s=s>.0031308?1.055*s**(1/2.4)-.055:s*12.92,a=a>.0031308?1.055*a**(1/2.4)-.055:a*12.92,o=Math.min(Math.max(0,o),1),s=Math.min(Math.max(0,s),1),a=Math.min(Math.max(0,a),1),[o*255,s*255,a*255]};convert$2.xyz.lab=function(t){let r=t[0],e=t[1],n=t[2];r/=95.047,e/=100,n/=108.883,r=r>.008856?r**(1/3):7.787*r+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,n=n>.008856?n**(1/3):7.787*n+16/116;const o=116*e-16,s=500*(r-e),a=200*(e-n);return[o,s,a]};convert$2.lab.xyz=function(t){const r=t[0],e=t[1],n=t[2];let o,s,a;s=(r+16)/116,o=e/500+s,a=s-n/200;const l=s**3,c=o**3,h=a**3;return s=l>.008856?l:(s-16/116)/7.787,o=c>.008856?c:(o-16/116)/7.787,a=h>.008856?h:(a-16/116)/7.787,o*=95.047,s*=100,a*=108.883,[o,s,a]};convert$2.lab.lch=function(t){const r=t[0],e=t[1],n=t[2];let o;o=Math.atan2(n,e)*360/2/Math.PI,o<0&&(o+=360);const a=Math.sqrt(e*e+n*n);return[r,a,o]};convert$2.lch.lab=function(t){const r=t[0],e=t[1],o=t[2]/360*2*Math.PI,s=e*Math.cos(o),a=e*Math.sin(o);return[r,s,a]};convert$2.rgb.ansi16=function(t,r=null){const[e,n,o]=t;let s=r===null?convert$2.rgb.hsv(t)[2]:r;if(s=Math.round(s/50),s===0)return 30;let a=30+(Math.round(o/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return s===2&&(a+=60),a};convert$2.hsv.ansi16=function(t){return convert$2.rgb.ansi16(convert$2.hsv.rgb(t),t[2])};convert$2.rgb.ansi256=function(t){const r=t[0],e=t[1],n=t[2];return r===e&&e===n?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(e/255*5)+Math.round(n/255*5)};convert$2.ansi16.rgb=function(t){let r=t%10;if(r===0||r===7)return t>50&&(r+=3.5),r=r/10.5*255,[r,r,r];const e=(~~(t>50)+1)*.5,n=(r&1)*e*255,o=(r>>1&1)*e*255,s=(r>>2&1)*e*255;return[n,o,s]};convert$2.ansi256.rgb=function(t){if(t>=232){const s=(t-232)*10+8;return[s,s,s]}t-=16;let r;const e=Math.floor(t/36)/5*255,n=Math.floor((r=t%36)/6)/5*255,o=r%6/5*255;return[e,n,o]};convert$2.rgb.hex=function(t){const e=(((Math.round(t[0])&255)<<16)+((Math.round(t[1])&255)<<8)+(Math.round(t[2])&255)).toString(16).toUpperCase();return"000000".substring(e.length)+e};convert$2.hex.rgb=function(t){const r=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!r)return[0,0,0];let e=r[0];r[0].length===3&&(e=e.split("").map(l=>l+l).join(""));const n=parseInt(e,16),o=n>>16&255,s=n>>8&255,a=n&255;return[o,s,a]};convert$2.rgb.hcg=function(t){const r=t[0]/255,e=t[1]/255,n=t[2]/255,o=Math.max(Math.max(r,e),n),s=Math.min(Math.min(r,e),n),a=o-s;let l,c;return a<1?l=s/(1-a):l=0,a<=0?c=0:o===r?c=(e-n)/a%6:o===e?c=2+(n-r)/a:c=4+(r-e)/a,c/=6,c%=1,[c*360,a*100,l*100]};convert$2.hsl.hcg=function(t){const r=t[1]/100,e=t[2]/100,n=e<.5?2*r*e:2*r*(1-e);let o=0;return n<1&&(o=(e-.5*n)/(1-n)),[t[0],n*100,o*100]};convert$2.hsv.hcg=function(t){const r=t[1]/100,e=t[2]/100,n=r*e;let o=0;return n<1&&(o=(e-n)/(1-n)),[t[0],n*100,o*100]};convert$2.hcg.rgb=function(t){const r=t[0]/360,e=t[1]/100,n=t[2]/100;if(e===0)return[n*255,n*255,n*255];const o=[0,0,0],s=r%1*6,a=s%1,l=1-a;let c=0;switch(Math.floor(s)){case 0:o[0]=1,o[1]=a,o[2]=0;break;case 1:o[0]=l,o[1]=1,o[2]=0;break;case 2:o[0]=0,o[1]=1,o[2]=a;break;case 3:o[0]=0,o[1]=l,o[2]=1;break;case 4:o[0]=a,o[1]=0,o[2]=1;break;default:o[0]=1,o[1]=0,o[2]=l}return c=(1-e)*n,[(e*o[0]+c)*255,(e*o[1]+c)*255,(e*o[2]+c)*255]};convert$2.hcg.hsv=function(t){const r=t[1]/100,e=t[2]/100,n=r+e*(1-r);let o=0;return n>0&&(o=r/n),[t[0],o*100,n*100]};convert$2.hcg.hsl=function(t){const r=t[1]/100,n=t[2]/100*(1-r)+.5*r;let o=0;return n>0&&n<.5?o=r/(2*n):n>=.5&&n<1&&(o=r/(2*(1-n))),[t[0],o*100,n*100]};convert$2.hcg.hwb=function(t){const r=t[1]/100,e=t[2]/100,n=r+e*(1-r);return[t[0],(n-r)*100,(1-n)*100]};convert$2.hwb.hcg=function(t){const r=t[1]/100,n=1-t[2]/100,o=n-r;let s=0;return o<1&&(s=(n-o)/(1-o)),[t[0],o*100,s*100]};convert$2.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]};convert$2.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]};convert$2.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]};convert$2.gray.hsl=function(t){return[0,0,t[0]]};convert$2.gray.hsv=convert$2.gray.hsl;convert$2.gray.hwb=function(t){return[0,100,t[0]]};convert$2.gray.cmyk=function(t){return[0,0,0,t[0]]};convert$2.gray.lab=function(t){return[t[0],0,0]};convert$2.gray.hex=function(t){const r=Math.round(t[0]/100*255)&255,n=((r<<16)+(r<<8)+r).toString(16).toUpperCase();return"000000".substring(n.length)+n};convert$2.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};const conversions$1=conversions$2;function buildGraph(){const t={},r=Object.keys(conversions$1);for(let e=r.length,n=0;n<e;n++)t[r[n]]={distance:-1,parent:null};return t}function deriveBFS(t){const r=buildGraph(),e=[t];for(r[t].distance=0;e.length;){const n=e.pop(),o=Object.keys(conversions$1[n]);for(let s=o.length,a=0;a<s;a++){const l=o[a],c=r[l];c.distance===-1&&(c.distance=r[n].distance+1,c.parent=n,e.unshift(l))}}return r}function link(t,r){return function(e){return r(t(e))}}function wrapConversion(t,r){const e=[r[t].parent,t];let n=conversions$1[r[t].parent][t],o=r[t].parent;for(;r[o].parent;)e.unshift(r[o].parent),n=link(conversions$1[r[o].parent][o],n),o=r[o].parent;return n.conversion=e,n}var route$1=function(t){const r=deriveBFS(t),e={},n=Object.keys(r);for(let o=n.length,s=0;s<o;s++){const a=n[s];r[a].parent!==null&&(e[a]=wrapConversion(a,r))}return e};const conversions=conversions$2,route=route$1,convert$1={},models=Object.keys(conversions);function wrapRaw(t){const r=function(...e){const n=e[0];return n==null?n:(n.length>1&&(e=n),t(e))};return"conversion"in t&&(r.conversion=t.conversion),r}function wrapRounded(t){const r=function(...e){const n=e[0];if(n==null)return n;n.length>1&&(e=n);const o=t(e);if(typeof o=="object")for(let s=o.length,a=0;a<s;a++)o[a]=Math.round(o[a]);return o};return"conversion"in t&&(r.conversion=t.conversion),r}models.forEach(t=>{convert$1[t]={},Object.defineProperty(convert$1[t],"channels",{value:conversions[t].channels}),Object.defineProperty(convert$1[t],"labels",{value:conversions[t].labels});const r=route(t);Object.keys(r).forEach(n=>{const o=r[n];convert$1[t][n]=wrapRounded(o),convert$1[t][n].raw=wrapRaw(o)})});var colorConvert=convert$1;const colorString=colorStringExports,convert=colorConvert,skippedModels=["keyword","gray","hex"],hashedModelKeys={};for(const t of Object.keys(convert))hashedModelKeys[[...convert[t].labels].sort().join("")]=t;const limiters={};function Color(t,r){if(!(this instanceof Color))return new Color(t,r);if(r&&r in skippedModels&&(r=null),r&&!(r in convert))throw new Error("Unknown model: "+r);let e,n;if(t==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof Color)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if(typeof t=="string"){const o=colorString.get(t);if(o===null)throw new Error("Unable to parse color from string: "+t);this.model=o.model,n=convert[this.model].channels,this.color=o.value.slice(0,n),this.valpha=typeof o.value[n]=="number"?o.value[n]:1}else if(t.length>0){this.model=r||"rgb",n=convert[this.model].channels;const o=Array.prototype.slice.call(t,0,n);this.color=zeroArray(o,n),this.valpha=typeof t[n]=="number"?t[n]:1}else if(typeof t=="number")this.model="rgb",this.color=[t>>16&255,t>>8&255,t&255],this.valpha=1;else{this.valpha=1;const o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha=typeof t.alpha=="number"?t.alpha:0);const s=o.sort().join("");if(!(s in hashedModelKeys))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=hashedModelKeys[s];const{labels:a}=convert[this.model],l=[];for(e=0;e<a.length;e++)l.push(t[a[e]]);this.color=zeroArray(l)}if(limiters[this.model])for(n=convert[this.model].channels,e=0;e<n;e++){const o=limiters[this.model][e];o&&(this.color[e]=o(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}Color.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let r=this.model in colorString.to?this:this.rgb();r=r.round(typeof t=="number"?t:1);const e=r.valpha===1?r.color:[...r.color,this.valpha];return colorString.to[r.model](e)},percentString(t){const r=this.rgb().round(typeof t=="number"?t:1),e=r.valpha===1?r.color:[...r.color,this.valpha];return colorString.to.rgb.percent(e)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:r}=convert[this.model],{labels:e}=convert[this.model];for(let n=0;n<r;n++)t[e[n]]=this.color[n];return this.valpha!==1&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,this.valpha!==1&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,this.valpha!==1&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new Color([...this.color.map(roundToPlace(t)),this.valpha],this.model)},alpha(t){return t!==void 0?new Color([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:getset("rgb",0,maxfn(255)),green:getset("rgb",1,maxfn(255)),blue:getset("rgb",2,maxfn(255)),hue:getset(["hsl","hsv","hsl","hwb","hcg"],0,t=>(t%360+360)%360),saturationl:getset("hsl",1,maxfn(100)),lightness:getset("hsl",2,maxfn(100)),saturationv:getset("hsv",1,maxfn(100)),value:getset("hsv",2,maxfn(100)),chroma:getset("hcg",1,maxfn(100)),gray:getset("hcg",2,maxfn(100)),white:getset("hwb",1,maxfn(100)),wblack:getset("hwb",2,maxfn(100)),cyan:getset("cmyk",0,maxfn(100)),magenta:getset("cmyk",1,maxfn(100)),yellow:getset("cmyk",2,maxfn(100)),black:getset("cmyk",3,maxfn(100)),x:getset("xyz",0,maxfn(95.047)),y:getset("xyz",1,maxfn(100)),z:getset("xyz",2,maxfn(108.833)),l:getset("lab",0,maxfn(100)),a:getset("lab",1),b:getset("lab",2),keyword(t){return t!==void 0?new Color(t):convert[this.model].keyword(this.color)},hex(t){return t!==void 0?new Color(t):colorString.to.hex(this.rgb().round().color)},hexa(t){if(t!==void 0)return new Color(t);const r=this.rgb().round().color;let e=Math.round(this.valpha*255).toString(16).toUpperCase();return e.length===1&&(e="0"+e),colorString.to.hex(r)+e},rgbNumber(){const t=this.rgb().color;return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255},luminosity(){const t=this.rgb().color,r=[];for(const[e,n]of t.entries()){const o=n/255;r[e]=o<=.04045?o/12.92:((o+.055)/1.055)**2.4}return .2126*r[0]+.7152*r[1]+.0722*r[2]},contrast(t){const r=this.luminosity(),e=t.luminosity();return r>e?(r+.05)/(e+.05):(e+.05)/(r+.05)},level(t){const r=this.contrast(t);return r>=7?"AAA":r>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(t[0]*2126+t[1]*7152+t[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let r=0;r<3;r++)t.color[r]=255-t.color[r];return t},lighten(t){const r=this.hsl();return r.color[2]+=r.color[2]*t,r},darken(t){const r=this.hsl();return r.color[2]-=r.color[2]*t,r},saturate(t){const r=this.hsl();return r.color[1]+=r.color[1]*t,r},desaturate(t){const r=this.hsl();return r.color[1]-=r.color[1]*t,r},whiten(t){const r=this.hwb();return r.color[1]+=r.color[1]*t,r},blacken(t){const r=this.hwb();return r.color[2]+=r.color[2]*t,r},grayscale(){const t=this.rgb().color,r=t[0]*.3+t[1]*.59+t[2]*.11;return Color.rgb(r,r,r)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const r=this.hsl();let e=r.color[0];return e=(e+t)%360,e=e<0?360+e:e,r.color[0]=e,r},mix(t,r){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const e=t.rgb(),n=this.rgb(),o=r===void 0?.5:r,s=2*o-1,a=e.alpha()-n.alpha(),l=((s*a===-1?s:(s+a)/(1+s*a))+1)/2,c=1-l;return Color.rgb(l*e.red()+c*n.red(),l*e.green()+c*n.green(),l*e.blue()+c*n.blue(),e.alpha()*o+n.alpha()*(1-o))}};for(const t of Object.keys(convert)){if(skippedModels.includes(t))continue;const{channels:r}=convert[t];Color.prototype[t]=function(...e){return this.model===t?new Color(this):e.length>0?new Color(e,t):new Color([...assertArray(convert[this.model][t].raw(this.color)),this.valpha],t)},Color[t]=function(...e){let n=e[0];return typeof n=="number"&&(n=zeroArray(e,r)),new Color(n,t)}}function roundTo(t,r){return Number(t.toFixed(r))}function roundToPlace(t){return function(r){return roundTo(r,t)}}function getset(t,r,e){t=Array.isArray(t)?t:[t];for(const n of t)(limiters[n]||(limiters[n]=[]))[r]=e;return t=t[0],function(n){let o;return n!==void 0?(e&&(n=e(n)),o=this[t](),o.color[r]=n,o):(o=this[t]().color[r],e&&(o=e(o)),o)}}function maxfn(t){return function(r){return Math.max(0,Math.min(t,r))}}function assertArray(t){return Array.isArray(t)?t:[t]}function zeroArray(t,r){for(let e=0;e<r;e++)typeof t[e]!="number"&&(t[e]=0);return t}var color=Color,__awaiter$1=commonjsGlobal&&commonjsGlobal.__awaiter||function(t,r,e,n){function o(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(u){a(u)}}function c(f){try{h(n.throw(f))}catch(u){a(u)}}function h(f){f.done?s(f.value):o(f.value).then(l,c)}h((n=n.apply(t,r||[])).next())})},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(conversion,"__esModule",{value:!0});conversion.RattaRLEDecoder=conversion.toImage=void 0;const image_js_1$1=require$$0,color_1=__importDefault(color);function concatUint8Arrays$1(t){let r=0;for(const o of t)r+=o.length;const e=new Uint8Array(r);let n=0;for(const o of t)e.set(o,n),n+=o.length;return e}function compositeImages(t,r){return __awaiter$1(this,void 0,void 0,function*(){if(t.width!==r.width||t.height!==r.height)throw new Error("Images must have the same dimensions for compositing.");for(let e=0;e<r.height;e++)for(let n=0;n<r.width;n++){const o=t.getPixelXY(n,e),s=r.getPixelXY(n,e),a=blendPixelOverlay(o,s);r.setPixelXY(n,e,a)}})}function blendPixelOverlay(t,r){const[e,n,o,s]=t,[a,l,c,h]=r;return n===0&&o===0&&s===0&&e==0?[a,l,c,h]:t}function toImage(t,r){const e=r?r.map(o=>t.pages[o-1]):t.pages,n=new RattaRLEDecoder;return Promise.all(e.map((o,s)=>__awaiter$1(this,void 0,void 0,function*(){const a=o.LAYERSEQ.map(f=>o[f]).filter(f=>f.bitmapBuffer!==null&&f.bitmapBuffer.length),l=a.map(f=>__awaiter$1(this,void 0,void 0,function*(){let u=null;return f.LAYERNAME=="BGLAYER"&&o.PAGESTYLE.startsWith("user_")?yield image_js_1$1.Image.load(f.bitmapBuffer):(u=n.decode(f.bitmapBuffer,t.pageWidth,t.pageHeight),new image_js_1$1.Image(t.pageWidth,t.pageHeight,u,{components:3,alpha:1}))}));let c=yield Promise.all(l);c=c.reverse();let h=c[0].clone();for(let f=1;f<a.length;f++)compositeImages(c[f],h);return h.grey({keepAlpha:!0})})))}conversion.toImage=toImage;const defaultPalette={background:(0,color_1.default)("transparent"),black:(0,color_1.default)("black"),darkGray:(0,color_1.default)("darkgray"),gray:(0,color_1.default)("gray"),white:(0,color_1.default)("white"),markerBlack:(0,color_1.default)("black"),markerDarkGray:(0,color_1.default)("darkgray"),markerGray:(0,color_1.default)("gray"),darkGrayX2:(0,color_1.default)("darkgray"),grayX2:(0,color_1.default)("gray"),markerDarkGrayX2:(0,color_1.default)("darkgray"),markerGrayX2:(0,color_1.default)("gray")};class RattaRLEDecoder{constructor(){this.encodedPalette={black:97,background:98,darkGray:99,gray:100,white:101,markerBlack:102,markerDarkGray:103,markerGray:104,darkGrayX2:157,grayX2:201,markerDarkGrayX2:158,markerGrayX2:202},this.specialLengthMarker=255,this.specialLength=16384,this.specialLengthForBlank=1024}decode(r,e,n,o,s=!1){const a=o??defaultPalette,l=Object.entries(this.encodedPalette).reduce((y,[_,w])=>{var S;return y[w]=(S=a[_])!==null&&S!==void 0?S:defaultPalette[_],y},{}),c=e*n*4,h=[];let f=[],u=null,[d,g]=[0,0];for(let y=1;y<r.length;y+=2){d=r.at(y-1),g=r.at(y);let _=!1;if(u!==null){let[w,S]=u;u=null,d===w?(g=1+g+((S&127)+1<<7),f.push([d,g]),_=!0):(S=(S&127)+1<<7,f.push([w,S]))}_||(g===this.specialLengthMarker?(s?g=this.specialLengthForBlank:g=this.specialLength,f.push([d,g]),_=!0):g&128?u=[d,g]:(g+=1,f.push([d,g]),_=!0));for(const[w,S]of f.values())this.addColorBuffer(h,w,S,l);f=[]}u!==null&&([d,g]=u,g=this.adjustTailLength(g,this.getChunksLength(h),c),g>0&&this.addColorBuffer(h,d,g,l));let m=concatUint8Arrays$1(h);if(m.length!==c)throw new Error(`Uint8Array length ${m.length} doesn't match expected length ${c}.`);return m}addColorBuffer(r,e,n,o){let s=e===-1?(0,color_1.default)("transparent"):o[e],a;s===void 0?a=Uint8Array.from(new Uint8Array([255,255,255,0])):s.alpha()===0?a=Uint8Array.from(new Uint8Array([0,0,0,0])):a=Uint8Array.from(new Uint8Array([...s.rgb().array(),~~(255*s.alpha())]));for(let l=0;l<n;l++)r.push(a);return r}adjustTailLength(r,e,n){const o=n-e;let s;for(let a=7;a>=0;a--)if(s=(r&127)+1<<a,s<=o)return s;return 0}getChunksLength(r){return r.reduce((e,n)=>e+n.length,0)}}conversion.RattaRLEDecoder=RattaRLEDecoder;var mirror={},__awaiter=commonjsGlobal&&commonjsGlobal.__awaiter||function(t,r,e,n){function o(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function l(f){try{h(n.next(f))}catch(u){a(u)}}function c(f){try{h(n.throw(f))}catch(u){a(u)}}function h(f){f.done?s(f.value):o(f.value).then(l,c)}h((n=n.apply(t,r||[])).next())})};Object.defineProperty(mirror,"__esModule",{value:!0});mirror.fetchMirrorFrame=void 0;const image_js_1=require$$0;function fetchMirrorFrame(t){var r;return __awaiter(this,void 0,void 0,function*(){const e=`http://${t}/screencast.mjpeg`,n=new AbortController,o=yield fetch(e,{method:"GET",signal:n.signal});if(!o.ok)throw new Error("Failed to fetch the resource.");const s=o.headers.get("content-type");if(!s||!s.includes("multipart"))throw new Error("Invalid response. Expected multipart content type.");const a=(r=o.body)===null||r===void 0?void 0:r.getReader();if(!a)throw new Error("Failed to get reader for response body.");let l=s.split("boundary=")[1];if(!l)throw new Error("Boundary not found in response headers.");let c=[],h=new Uint8Array;return new Promise((f,u)=>{let d=!1;const g=`\r
\r
`,m=_=>__awaiter(this,void 0,void 0,function*(){h=concatUint8Arrays(h,_);let w=new TextDecoder().decode(h).indexOf("Content-Type:",0),S=findBoundary(h,l,w+2);const v=h.slice(w,S),b=new TextDecoder().decode(v).indexOf(g);c.length===0&&b!==-1&&(c=new TextDecoder().decode(v.slice(0,b)).split(`\r
`));const k=c.find(R=>R.toLowerCase().startsWith("content-type:")),C=c.find(R=>R.toLowerCase().startsWith("content-length:"));if(k&&k.includes("image/jpeg")&&C){d=!0;const R=parseInt(C.split(":")[1].trim());if(h.length<b+R+1)return;const A=h.slice(b+g.length,b+R+1),$=image_js_1.Image.load(A);f($),n.abort()}}),y=()=>__awaiter(this,void 0,void 0,function*(){const{done:_,value:w}=yield a.read();if(new TextDecoder().decode(w),_){d||u(new Error("No JPEG image found in multipart stream."));return}yield m(w),yield y()});y().catch(_=>u(_))})})}mirror.fetchMirrorFrame=fetchMirrorFrame;function findBoundary(t,r,e=0){const n=`${r}`;return new TextDecoder().decode(t).indexOf(n)}function concatUint8Arrays(t,r){const e=new Uint8Array(t.length+r.length);return e.set(t,0),e.set(r,t.length),e}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.fetchMirrorFrame=t.toImage=t.SupernoteX=void 0;var r=parsing;Object.defineProperty(t,"SupernoteX",{enumerable:!0,get:function(){return r.SupernoteX}});var e=conversion;Object.defineProperty(t,"toImage",{enumerable:!0,get:function(){return e.toImage}});var n=mirror;Object.defineProperty(t,"fetchMirrorFrame",{enumerable:!0,get:function(){return n.fetchMirrorFrame}})})(lib);document.getElementById("noteInput").addEventListener("change",async t=>{const e=t.target.files[0];if(!e){alert("Please select a file.");return}try{const n=document.getElementById("images");n.innerHTML="";const o=await e.arrayBuffer(),s=new Uint8Array(o),a=new lib.SupernoteX(s);let l=1;for(const c of a.pages){const h=document.createElement("span");h.textContent=`Processing page ${l}...`,n.appendChild(h);const[f]=await lib.toImage(a,[l]),u=await f.toBuffer("image/png"),d=`data:image/png;base64,${btoa(new Uint8Array(u).reduce((m,y)=>m+String.fromCharCode(y),""))}`,g=document.createElement("img");g.src=d,g.alt=`Page ${l}`,n.replaceChild(g,h),l++}}catch(n){console.error("Error processing the file:",n),alert("An error occurred while processing the file.")}});
